import{R as React,g as getAugmentedNamespace,r as reactExports,j as jsxRuntimeExports,a as ReactDOM}from"./client-DEd7WeES.js";const createStoreImpl=w=>{let s;const y=new Set,r=(n,t)=>{const i=typeof n=="function"?n(s):n;if(!Object.is(i,s)){const h=s;s=t??(typeof i!="object"||i===null)?i:Object.assign({},s,i),y.forEach(l=>l(s,h))}},g=()=>s,L={setState:r,getState:g,getInitialState:()=>j,subscribe:n=>(y.add(n),()=>y.delete(n))},j=s=w(r,g,L);return L},createStore=(w=>w?createStoreImpl(w):createStoreImpl),identity=w=>w;function useStore(w,s=identity){const y=React.useSyncExternalStore(w.subscribe,React.useCallback(()=>s(w.getState()),[w,s]),React.useCallback(()=>s(w.getInitialState()),[w,s]));return React.useDebugValue(y),y}const createImpl=w=>{const s=createStore(w),y=r=>useStore(s,r);return Object.assign(y,s),y},create=(w=>w?createImpl(w):createImpl),API_URL=void 0,useAuthStore=create(w=>({user:null,token:null,isLoading:!1,error:null,hydrate:async()=>{if(typeof window<"u"){if(window.chrome?.storage)return new Promise(s=>{window.chrome.storage.local.get(["auth_token","user"],y=>{if(y.auth_token&&y.user)w({token:y.auth_token,user:JSON.parse(y.user)});else{const r=localStorage.getItem("auth_token"),g=localStorage.getItem("user");r&&g&&w({token:r,user:JSON.parse(g)})}s()})});{const s=localStorage.getItem("auth_token"),y=localStorage.getItem("user");s&&y&&w({token:s,user:JSON.parse(y)})}}},register:async(s,y)=>{w({isLoading:!0,error:null});try{const r=await fetch(`${API_URL}/api/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,password:y})}),g=await r.text();if(!g)throw new Error("Empty response from server");const P=JSON.parse(g);if(!r.ok)throw new Error(P.error||"Registration failed");w({user:{id:P.id,email:P.email},token:P.token,isLoading:!1}),typeof window<"u"&&(window.chrome?.storage&&window.chrome.storage.local.set({auth_token:P.token,user:JSON.stringify({id:P.id,email:P.email})}),localStorage.setItem("auth_token",P.token),localStorage.setItem("user",JSON.stringify({id:P.id,email:P.email})))}catch(r){throw w({error:r instanceof Error?r.message:"Registration failed",isLoading:!1}),r}},login:async(s,y)=>{w({isLoading:!0,error:null});try{const r=await fetch(`${API_URL}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,password:y})}),g=await r.text();if(!g)throw new Error("Empty response from server");const P=JSON.parse(g);if(!r.ok)throw new Error(P.error||"Login failed");w({user:{id:P.id,email:P.email},token:P.token,isLoading:!1}),typeof window<"u"&&(window.chrome?.storage&&window.chrome.storage.local.set({auth_token:P.token,user:JSON.stringify({id:P.id,email:P.email})}),localStorage.setItem("auth_token",P.token),localStorage.setItem("user",JSON.stringify({id:P.id,email:P.email})))}catch(r){throw w({error:r instanceof Error?r.message:"Login failed",isLoading:!1}),r}},logout:()=>{w({user:null,token:null,error:null}),typeof window<"u"&&(window.chrome?.storage&&window.chrome.storage.local.remove(["auth_token","user"]),localStorage.removeItem("auth_token"),localStorage.removeItem("user"))},setToken:s=>{w({token:s}),typeof window<"u"&&(localStorage.setItem("auth_token",s),window.chrome?.storage&&window.chrome.storage.local.set({auth_token:s}))}}));function commonjsRequire(w){throw new Error('Could not dynamically require "'+w+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);var hasRequiredPdf;function requirePdf(){return hasRequiredPdf||(hasRequiredPdf=1,(function(module,exports$1){(function(s,y){module.exports=s.pdfjsLib=y()})(globalThis,()=>(()=>{var __webpack_modules__=[,((w,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.VerbosityLevel=s.Util=s.UnknownErrorException=s.UnexpectedResponseException=s.TextRenderingMode=s.RenderingIntentFlag=s.PromiseCapability=s.PermissionFlag=s.PasswordResponses=s.PasswordException=s.PageActionEventType=s.OPS=s.MissingPDFException=s.MAX_IMAGE_SIZE_TO_CACHE=s.LINE_FACTOR=s.LINE_DESCENT_FACTOR=s.InvalidPDFException=s.ImageKind=s.IDENTITY_MATRIX=s.FormatError=s.FeatureTest=s.FONT_IDENTITY_MATRIX=s.DocumentActionEventType=s.CMapCompressionType=s.BaseException=s.BASELINE_FACTOR=s.AnnotationType=s.AnnotationReplyType=s.AnnotationPrefix=s.AnnotationMode=s.AnnotationFlag=s.AnnotationFieldFlag=s.AnnotationEditorType=s.AnnotationEditorPrefix=s.AnnotationEditorParamsType=s.AnnotationBorderStyleType=s.AnnotationActionEventType=s.AbortException=void 0,s.assert=c,s.bytesToString=N,s.createValidAbsoluteUrl=_,s.getModificationDate=mt,s.getUuid=Nt,s.getVerbosityLevel=nt,s.info=$,s.isArrayBuffer=ut,s.isArrayEqual=At,s.isNodeJS=void 0,s.normalizeUnicode=Dt,s.objectFromMap=V,s.objectSize=st,s.setVerbosityLevel=et,s.shadow=F,s.string32=q,s.stringToBytes=U,s.stringToPDFString=lt,s.stringToUTF8String=ct,s.unreachable=b,s.utf8StringToString=ht,s.warn=D;const y=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");s.isNodeJS=y;const r=[1,0,0,1,0,0];s.IDENTITY_MATRIX=r;const g=[.001,0,0,.001,0,0];s.FONT_IDENTITY_MATRIX=g;const P=1e7;s.MAX_IMAGE_SIZE_TO_CACHE=P;const C=1.35;s.LINE_FACTOR=C;const L=.35;s.LINE_DESCENT_FACTOR=L;const j=L/C;s.BASELINE_FACTOR=j;const n={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};s.RenderingIntentFlag=n;const t={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};s.AnnotationMode=t;const i="pdfjs_internal_editor_";s.AnnotationEditorPrefix=i;const h={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};s.AnnotationEditorType=h;const l={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};s.AnnotationEditorParamsType=l;const e={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};s.PermissionFlag=e;const u={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};s.TextRenderingMode=u;const p={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};s.ImageKind=p;const o={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};s.AnnotationType=o;const v={GROUP:"Group",REPLY:"R"};s.AnnotationReplyType=v;const R={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};s.AnnotationFlag=R;const T={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};s.AnnotationFieldFlag=T;const f={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};s.AnnotationBorderStyleType=f;const S={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};s.AnnotationActionEventType=S;const B={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};s.DocumentActionEventType=B;const H={O:"PageOpen",C:"PageClose"};s.PageActionEventType=H;const O={ERRORS:0,WARNINGS:1,INFOS:5};s.VerbosityLevel=O;const z={NONE:0,BINARY:1};s.CMapCompressionType=z;const X={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};s.OPS=X;const it={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};s.PasswordResponses=it;let Q=O.WARNINGS;function et(tt){Number.isInteger(tt)&&(Q=tt)}function nt(){return Q}function $(tt){Q>=O.INFOS&&console.log(`Info: ${tt}`)}function D(tt){Q>=O.WARNINGS&&console.log(`Warning: ${tt}`)}function b(tt){throw new Error(tt)}function c(tt,G){tt||b(G)}function d(tt){switch(tt?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function _(tt,G=null,W=null){if(!tt)return null;try{if(W&&typeof tt=="string"&&(W.addDefaultProtocol&&tt.startsWith("www.")&&tt.match(/\./g)?.length>=2&&(tt=`http://${tt}`),W.tryConvertEncoding))try{tt=ct(tt)}catch{}const at=G?new URL(tt,G):new URL(tt);if(d(at))return at}catch{}return null}function F(tt,G,W,at=!1){return Object.defineProperty(tt,G,{value:W,enumerable:!at,configurable:!0,writable:!1}),W}const M=(function(){function G(W,at){this.constructor===G&&b("Cannot initialize BaseException."),this.message=W,this.name=at}return G.prototype=new Error,G.constructor=G,G})();s.BaseException=M;class I extends M{constructor(G,W){super(G,"PasswordException"),this.code=W}}s.PasswordException=I;class E extends M{constructor(G,W){super(G,"UnknownErrorException"),this.details=W}}s.UnknownErrorException=E;class a extends M{constructor(G){super(G,"InvalidPDFException")}}s.InvalidPDFException=a;class m extends M{constructor(G){super(G,"MissingPDFException")}}s.MissingPDFException=m;class A extends M{constructor(G,W){super(G,"UnexpectedResponseException"),this.status=W}}s.UnexpectedResponseException=A;class x extends M{constructor(G){super(G,"FormatError")}}s.FormatError=x;class k extends M{constructor(G){super(G,"AbortException")}}s.AbortException=k;function N(tt){(typeof tt!="object"||tt?.length===void 0)&&b("Invalid argument for bytesToString");const G=tt.length,W=8192;if(G<W)return String.fromCharCode.apply(null,tt);const at=[];for(let dt=0;dt<G;dt+=W){const pt=Math.min(dt+W,G),gt=tt.subarray(dt,pt);at.push(String.fromCharCode.apply(null,gt))}return at.join("")}function U(tt){typeof tt!="string"&&b("Invalid argument for stringToBytes");const G=tt.length,W=new Uint8Array(G);for(let at=0;at<G;++at)W[at]=tt.charCodeAt(at)&255;return W}function q(tt){return String.fromCharCode(tt>>24&255,tt>>16&255,tt>>8&255,tt&255)}function st(tt){return Object.keys(tt).length}function V(tt){const G=Object.create(null);for(const[W,at]of tt)G[W]=at;return G}function Y(){const tt=new Uint8Array(4);return tt[0]=1,new Uint32Array(tt.buffer,0,1)[0]===1}function K(){try{return new Function(""),!0}catch{return!1}}class J{static get isLittleEndian(){return F(this,"isLittleEndian",Y())}static get isEvalSupported(){return F(this,"isEvalSupported",K())}static get isOffscreenCanvasSupported(){return F(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?F(this,"platform",{isWin:!1,isMac:!1}):F(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){return F(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}s.FeatureTest=J;const Z=[...Array(256).keys()].map(tt=>tt.toString(16).padStart(2,"0"));class rt{static makeHexColor(G,W,at){return`#${Z[G]}${Z[W]}${Z[at]}`}static scaleMinMax(G,W){let at;G[0]?(G[0]<0&&(at=W[0],W[0]=W[1],W[1]=at),W[0]*=G[0],W[1]*=G[0],G[3]<0&&(at=W[2],W[2]=W[3],W[3]=at),W[2]*=G[3],W[3]*=G[3]):(at=W[0],W[0]=W[2],W[2]=at,at=W[1],W[1]=W[3],W[3]=at,G[1]<0&&(at=W[2],W[2]=W[3],W[3]=at),W[2]*=G[1],W[3]*=G[1],G[2]<0&&(at=W[0],W[0]=W[1],W[1]=at),W[0]*=G[2],W[1]*=G[2]),W[0]+=G[4],W[1]+=G[4],W[2]+=G[5],W[3]+=G[5]}static transform(G,W){return[G[0]*W[0]+G[2]*W[1],G[1]*W[0]+G[3]*W[1],G[0]*W[2]+G[2]*W[3],G[1]*W[2]+G[3]*W[3],G[0]*W[4]+G[2]*W[5]+G[4],G[1]*W[4]+G[3]*W[5]+G[5]]}static applyTransform(G,W){const at=G[0]*W[0]+G[1]*W[2]+W[4],dt=G[0]*W[1]+G[1]*W[3]+W[5];return[at,dt]}static applyInverseTransform(G,W){const at=W[0]*W[3]-W[1]*W[2],dt=(G[0]*W[3]-G[1]*W[2]+W[2]*W[5]-W[4]*W[3])/at,pt=(-G[0]*W[1]+G[1]*W[0]+W[4]*W[1]-W[5]*W[0])/at;return[dt,pt]}static getAxialAlignedBoundingBox(G,W){const at=this.applyTransform(G,W),dt=this.applyTransform(G.slice(2,4),W),pt=this.applyTransform([G[0],G[3]],W),gt=this.applyTransform([G[2],G[1]],W);return[Math.min(at[0],dt[0],pt[0],gt[0]),Math.min(at[1],dt[1],pt[1],gt[1]),Math.max(at[0],dt[0],pt[0],gt[0]),Math.max(at[1],dt[1],pt[1],gt[1])]}static inverseTransform(G){const W=G[0]*G[3]-G[1]*G[2];return[G[3]/W,-G[1]/W,-G[2]/W,G[0]/W,(G[2]*G[5]-G[4]*G[3])/W,(G[4]*G[1]-G[5]*G[0])/W]}static singularValueDecompose2dScale(G){const W=[G[0],G[2],G[1],G[3]],at=G[0]*W[0]+G[1]*W[2],dt=G[0]*W[1]+G[1]*W[3],pt=G[2]*W[0]+G[3]*W[2],gt=G[2]*W[1]+G[3]*W[3],wt=(at+gt)/2,Ct=Math.sqrt((at+gt)**2-4*(at*gt-pt*dt))/2,Et=wt+Ct||1,_t=wt-Ct||1;return[Math.sqrt(Et),Math.sqrt(_t)]}static normalizeRect(G){const W=G.slice(0);return G[0]>G[2]&&(W[0]=G[2],W[2]=G[0]),G[1]>G[3]&&(W[1]=G[3],W[3]=G[1]),W}static intersect(G,W){const at=Math.max(Math.min(G[0],G[2]),Math.min(W[0],W[2])),dt=Math.min(Math.max(G[0],G[2]),Math.max(W[0],W[2]));if(at>dt)return null;const pt=Math.max(Math.min(G[1],G[3]),Math.min(W[1],W[3])),gt=Math.min(Math.max(G[1],G[3]),Math.max(W[1],W[3]));return pt>gt?null:[at,pt,dt,gt]}static bezierBoundingBox(G,W,at,dt,pt,gt,wt,Ct){const Et=[],_t=[[],[]];let Tt,St,Rt,ft,Ft,Mt,It,Lt;for(let Ot=0;Ot<2;++Ot){if(Ot===0?(St=6*G-12*at+6*pt,Tt=-3*G+9*at-9*pt+3*wt,Rt=3*at-3*G):(St=6*W-12*dt+6*gt,Tt=-3*W+9*dt-9*gt+3*Ct,Rt=3*dt-3*W),Math.abs(Tt)<1e-12){if(Math.abs(St)<1e-12)continue;ft=-Rt/St,0<ft&&ft<1&&Et.push(ft);continue}It=St*St-4*Rt*Tt,Lt=Math.sqrt(It),!(It<0)&&(Ft=(-St+Lt)/(2*Tt),0<Ft&&Ft<1&&Et.push(Ft),Mt=(-St-Lt)/(2*Tt),0<Mt&&Mt<1&&Et.push(Mt))}let Pt=Et.length,yt;const kt=Pt;for(;Pt--;)ft=Et[Pt],yt=1-ft,_t[0][Pt]=yt*yt*yt*G+3*yt*yt*ft*at+3*yt*ft*ft*pt+ft*ft*ft*wt,_t[1][Pt]=yt*yt*yt*W+3*yt*yt*ft*dt+3*yt*ft*ft*gt+ft*ft*ft*Ct;return _t[0][kt]=G,_t[1][kt]=W,_t[0][kt+1]=wt,_t[1][kt+1]=Ct,_t[0].length=_t[1].length=kt+2,[Math.min(..._t[0]),Math.min(..._t[1]),Math.max(..._t[0]),Math.max(..._t[1])]}}s.Util=rt;const ot=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function lt(tt){if(tt[0]>="ï"){let W;if(tt[0]==="þ"&&tt[1]==="ÿ"?W="utf-16be":tt[0]==="ÿ"&&tt[1]==="þ"?W="utf-16le":tt[0]==="ï"&&tt[1]==="»"&&tt[2]==="¿"&&(W="utf-8"),W)try{const at=new TextDecoder(W,{fatal:!0}),dt=U(tt);return at.decode(dt)}catch(at){D(`stringToPDFString: "${at}".`)}}const G=[];for(let W=0,at=tt.length;W<at;W++){const dt=ot[tt.charCodeAt(W)];G.push(dt?String.fromCharCode(dt):tt.charAt(W))}return G.join("")}function ct(tt){return decodeURIComponent(escape(tt))}function ht(tt){return unescape(encodeURIComponent(tt))}function ut(tt){return typeof tt=="object"&&tt?.byteLength!==void 0}function At(tt,G){if(tt.length!==G.length)return!1;for(let W=0,at=tt.length;W<at;W++)if(tt[W]!==G[W])return!1;return!0}function mt(tt=new Date){return[tt.getUTCFullYear().toString(),(tt.getUTCMonth()+1).toString().padStart(2,"0"),tt.getUTCDate().toString().padStart(2,"0"),tt.getUTCHours().toString().padStart(2,"0"),tt.getUTCMinutes().toString().padStart(2,"0"),tt.getUTCSeconds().toString().padStart(2,"0")].join("")}class xt{#t=!1;constructor(){this.promise=new Promise((G,W)=>{this.resolve=at=>{this.#t=!0,G(at)},this.reject=at=>{this.#t=!0,W(at)}})}get settled(){return this.#t}}s.PromiseCapability=xt;let bt=null,vt=null;function Dt(tt){return bt||(bt=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,vt=new Map([["ﬅ","ſt"]])),tt.replaceAll(bt,(G,W,at)=>W?W.normalize("NFKC"):vt.get(at))}function Nt(){if(typeof crypto<"u"&&typeof crypto?.randomUUID=="function")return crypto.randomUUID();const tt=new Uint8Array(32);if(typeof crypto<"u"&&typeof crypto?.getRandomValues=="function")crypto.getRandomValues(tt);else for(let G=0;G<32;G++)tt[G]=Math.floor(Math.random()*255);return N(tt)}const jt="pdfjs_internal_id_";s.AnnotationPrefix=jt}),((__unused_webpack_module,exports$1,__w_pdfjs_require__)=>{Object.defineProperty(exports$1,"__esModule",{value:!0}),exports$1.RenderTask=exports$1.PDFWorkerUtil=exports$1.PDFWorker=exports$1.PDFPageProxy=exports$1.PDFDocumentProxy=exports$1.PDFDocumentLoadingTask=exports$1.PDFDataRangeTransport=exports$1.LoopbackPort=exports$1.DefaultStandardFontDataFactory=exports$1.DefaultFilterFactory=exports$1.DefaultCanvasFactory=exports$1.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports$1,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports$1.build=void 0,exports$1.getDocument=getDocument,exports$1.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports$1.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports$1.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports$1.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports$1.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(w){if(typeof w=="string"||w instanceof URL?w={url:w}:(0,_util.isArrayBuffer)(w)&&(w={data:w}),typeof w!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!w.url&&!w.data&&!w.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const s=new PDFDocumentLoadingTask,{docId:y}=s,r=w.url?getUrlProp(w.url):null,g=w.data?getDataProp(w.data):null,P=w.httpHeaders||null,C=w.withCredentials===!0,L=w.password??null,j=w.range instanceof PDFDataRangeTransport?w.range:null,n=Number.isInteger(w.rangeChunkSize)&&w.rangeChunkSize>0?w.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let t=w.worker instanceof PDFWorker?w.worker:null;const i=w.verbosity,h=typeof w.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(w.docBaseUrl)?w.docBaseUrl:null,l=typeof w.cMapUrl=="string"?w.cMapUrl:null,e=w.cMapPacked!==!1,u=w.CMapReaderFactory||DefaultCMapReaderFactory,p=typeof w.standardFontDataUrl=="string"?w.standardFontDataUrl:null,o=w.StandardFontDataFactory||DefaultStandardFontDataFactory,v=w.stopAtErrors!==!0,R=Number.isInteger(w.maxImageSize)&&w.maxImageSize>-1?w.maxImageSize:-1,T=w.isEvalSupported!==!1,f=typeof w.isOffscreenCanvasSupported=="boolean"?w.isOffscreenCanvasSupported:!_util.isNodeJS,S=Number.isInteger(w.canvasMaxAreaInBytes)?w.canvasMaxAreaInBytes:-1,B=typeof w.disableFontFace=="boolean"?w.disableFontFace:_util.isNodeJS,H=w.fontExtraProperties===!0,O=w.enableXfa===!0,z=w.ownerDocument||globalThis.document,X=w.disableRange===!0,it=w.disableStream===!0,Q=w.disableAutoFetch===!0,et=w.pdfBug===!0,nt=j?j.length:w.length??NaN,$=typeof w.useSystemFonts=="boolean"?w.useSystemFonts:!_util.isNodeJS&&!B,D=typeof w.useWorkerFetch=="boolean"?w.useWorkerFetch:u===_display_utils.DOMCMapReaderFactory&&o===_display_utils.DOMStandardFontDataFactory&&l&&p&&(0,_display_utils.isValidFetchUrl)(l,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(p,document.baseURI),b=w.canvasFactory||new DefaultCanvasFactory({ownerDocument:z}),c=w.filterFactory||new DefaultFilterFactory({docId:y,ownerDocument:z}),d=null;(0,_util.setVerbosityLevel)(i);const _={canvasFactory:b,filterFactory:c};if(D||(_.cMapReaderFactory=new u({baseUrl:l,isCompressed:e}),_.standardFontDataFactory=new o({baseUrl:p})),!t){const I={verbosity:i,port:_worker_options.GlobalWorkerOptions.workerPort};t=I.port?PDFWorker.fromPort(I):new PDFWorker(I),s._worker=t}const F={docId:y,apiVersion:"3.11.174",data:g,password:L,disableAutoFetch:Q,rangeChunkSize:n,length:nt,docBaseUrl:h,enableXfa:O,evaluatorOptions:{maxImageSize:R,disableFontFace:B,ignoreErrors:v,isEvalSupported:T,isOffscreenCanvasSupported:f,canvasMaxAreaInBytes:S,fontExtraProperties:H,useSystemFonts:$,cMapUrl:D?l:null,standardFontDataUrl:D?p:null}},M={ignoreErrors:v,isEvalSupported:T,disableFontFace:B,fontExtraProperties:H,enableXfa:O,ownerDocument:z,disableAutoFetch:Q,pdfBug:et,styleElement:d};return t.promise.then(function(){if(s.destroyed)throw new Error("Loading aborted");const I=_fetchDocument(t,F),E=new Promise(function(a){let m;j?m=new _transport_stream.PDFDataTransportStream({length:nt,initialData:j.initialData,progressiveDone:j.progressiveDone,contentDispositionFilename:j.contentDispositionFilename,disableRange:X,disableStream:it},j):g||(m=(x=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(x):(0,_display_utils.isValidFetchUrl)(x.url)?new _displayFetch_stream.PDFFetchStream(x):new _displayNetwork.PDFNetworkStream(x))({url:r,length:nt,httpHeaders:P,withCredentials:C,rangeChunkSize:n,disableRange:X,disableStream:it})),a(m)});return Promise.all([I,E]).then(function([a,m]){if(s.destroyed)throw new Error("Loading aborted");const A=new _message_handler.MessageHandler(y,a,t.port),x=new WorkerTransport(A,s,m,M,_);s._transport=x,A.send("Ready",null)})}).catch(s._capability.reject),s}async function _fetchDocument(w,s){if(w.destroyed)throw new Error("Worker was destroyed");const y=await w.messageHandler.sendWithPromise("GetDocRequest",s,s.data?[s.data.buffer]:null);if(w.destroyed)throw new Error("Worker was destroyed");return y}function getUrlProp(w){if(w instanceof URL)return w.href;try{return new URL(w,window.location).href}catch{if(_util.isNodeJS&&typeof w=="string")return w}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(w){if(_util.isNodeJS&&typeof Buffer<"u"&&w instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(w instanceof Uint8Array&&w.byteLength===w.buffer.byteLength)return w;if(typeof w=="string")return(0,_util.stringToBytes)(w);if(typeof w=="object"&&!isNaN(w?.length)||(0,_util.isArrayBuffer)(w))return new Uint8Array(w);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}class PDFDocumentLoadingTask{static#t=0;constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${PDFDocumentLoadingTask.#t++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(s){throw this._worker?.port&&delete this._worker._pendingDestroy,s}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}exports$1.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(s,y,r=!1,g=null){this.length=s,this.initialData=y,this.progressiveDone=r,this.contentDispositionFilename=g,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(s){this._rangeListeners.push(s)}addProgressListener(s){this._progressListeners.push(s)}addProgressiveReadListener(s){this._progressiveReadListeners.push(s)}addProgressiveDoneListener(s){this._progressiveDoneListeners.push(s)}onDataRange(s,y){for(const r of this._rangeListeners)r(s,y)}onDataProgress(s,y){this._readyCapability.promise.then(()=>{for(const r of this._progressListeners)r(s,y)})}onDataProgressiveRead(s){this._readyCapability.promise.then(()=>{for(const y of this._progressiveReadListeners)y(s)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const s of this._progressiveDoneListeners)s()})}transportReady(){this._readyCapability.resolve()}requestDataRange(s,y){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports$1.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(s,y){this._pdfInfo=s,this._transport=y,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(r=>{if(!r)return r;const g=[];for(const P in r)g.push(...r[P]);return g}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(s){return this._transport.getPage(s)}getPageIndex(s){return this._transport.getPageIndex(s)}getDestinations(){return this._transport.getDestinations()}getDestination(s){return this._transport.getDestination(s)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(s=!1){return this._transport.startCleanup(s||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports$1.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{#t=null;#e=!1;constructor(s,y,r,g=!1){this._pageIndex=s,this._pageInfo=y,this._transport=r,this._stats=g?new _display_utils.StatTimer:null,this._pdfBug=g,this.commonObjs=r.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:s,rotation:y=this.rotate,offsetX:r=0,offsetY:g=0,dontFlip:P=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:s,rotation:y,offsetX:r,offsetY:g,dontFlip:P})}getAnnotations({intent:s="display"}={}){const y=this._transport.getRenderingIntent(s);return this._transport.getAnnotations(this._pageIndex,y.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:s,viewport:y,intent:r="display",annotationMode:g=_util.AnnotationMode.ENABLE,transform:P=null,background:C=null,optionalContentConfigPromise:L=null,annotationCanvasMap:j=null,pageColors:n=null,printAnnotationStorage:t=null}){this._stats?.time("Overall");const i=this._transport.getRenderingIntent(r,g,t);this.#e=!1,this.#s(),L||(L=this._transport.getOptionalContentConfig());let h=this._intentStates.get(i.cacheKey);h||(h=Object.create(null),this._intentStates.set(i.cacheKey,h)),h.streamReaderCancelTimeout&&(clearTimeout(h.streamReaderCancelTimeout),h.streamReaderCancelTimeout=null);const l=!!(i.renderingIntent&_util.RenderingIntentFlag.PRINT);h.displayReadyCapability||(h.displayReadyCapability=new _util.PromiseCapability,h.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(i));const e=o=>{h.renderTasks.delete(u),(this._maybeCleanupAfterRender||l)&&(this.#e=!0),this.#i(!l),o?(u.capability.reject(o),this._abortOperatorList({intentState:h,reason:o instanceof Error?o:new Error(o)})):u.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")},u=new InternalRenderTask({callback:e,params:{canvasContext:s,viewport:y,transform:P,background:C},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:j,operatorList:h.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!l,pdfBug:this._pdfBug,pageColors:n});(h.renderTasks||=new Set).add(u);const p=u.task;return Promise.all([h.displayReadyCapability.promise,L]).then(([o,v])=>{if(this.destroyed){e();return}this._stats?.time("Rendering"),u.initializeGraphics({transparency:o,optionalContentConfig:v}),u.operatorListChanged()}).catch(e),p}getOperatorList({intent:s="display",annotationMode:y=_util.AnnotationMode.ENABLE,printAnnotationStorage:r=null}={}){function g(){C.operatorList.lastChunk&&(C.opListReadCapability.resolve(C.operatorList),C.renderTasks.delete(L))}const P=this._transport.getRenderingIntent(s,y,r,!0);let C=this._intentStates.get(P.cacheKey);C||(C=Object.create(null),this._intentStates.set(P.cacheKey,C));let L;return C.opListReadCapability||(L=Object.create(null),L.operatorListChanged=g,C.opListReadCapability=new _util.PromiseCapability,(C.renderTasks||=new Set).add(L),C.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(P)),C.opListReadCapability.promise}streamTextContent({includeMarkedContent:s=!1,disableNormalization:y=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:s===!0,disableNormalization:y===!0},{highWaterMark:100,size(g){return g.items.length}})}getTextContent(s={}){if(this._transport._htmlForXfa)return this.getXfa().then(r=>_xfa_text.XfaText.textContent(r));const y=this.streamTextContent(s);return new Promise(function(r,g){function P(){C.read().then(function({value:j,done:n}){if(n){r(L);return}Object.assign(L.styles,j.styles),L.items.push(...j.items),P()},g)}const C=y.getReader(),L={items:[],styles:Object.create(null)};P()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const s=[];for(const y of this._intentStates.values())if(this._abortOperatorList({intentState:y,reason:new Error("Page was destroyed."),force:!0}),!y.opListReadCapability)for(const r of y.renderTasks)s.push(r.completed),r.cancel();return this.objs.clear(),this.#e=!1,this.#s(),Promise.all(s)}cleanup(s=!1){this.#e=!0;const y=this.#i(!1);return s&&y&&(this._stats&&=new _display_utils.StatTimer),y}#i(s=!1){if(this.#s(),!this.#e||this.destroyed)return!1;if(s)return this.#t=setTimeout(()=>{this.#t=null,this.#i(!1)},DELAYED_CLEANUP_TIMEOUT),!1;for(const{renderTasks:y,operatorList:r}of this._intentStates.values())if(y.size>0||!r.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}#s(){this.#t&&(clearTimeout(this.#t),this.#t=null)}_startRenderPage(s,y){const r=this._intentStates.get(y);r&&(this._stats?.timeEnd("Page Request"),r.displayReadyCapability?.resolve(s))}_renderPageChunk(s,y){for(let r=0,g=s.length;r<g;r++)y.operatorList.fnArray.push(s.fnArray[r]),y.operatorList.argsArray.push(s.argsArray[r]);y.operatorList.lastChunk=s.lastChunk,y.operatorList.separateAnnots=s.separateAnnots;for(const r of y.renderTasks)r.operatorListChanged();s.lastChunk&&this.#i(!0)}_pumpOperatorList({renderingIntent:s,cacheKey:y,annotationStorageSerializable:r}){const{map:g,transfers:P}=r,L=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:s,cacheKey:y,annotationStorage:g},P).getReader(),j=this._intentStates.get(y);j.streamReader=L;const n=()=>{L.read().then(({value:t,done:i})=>{if(i){j.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(t,j),n())},t=>{if(j.streamReader=null,!this._transport.destroyed){if(j.operatorList){j.operatorList.lastChunk=!0;for(const i of j.renderTasks)i.operatorListChanged();this.#i(!0)}if(j.displayReadyCapability)j.displayReadyCapability.reject(t);else if(j.opListReadCapability)j.opListReadCapability.reject(t);else throw t}})};n()}_abortOperatorList({intentState:s,reason:y,force:r=!1}){if(s.streamReader){if(s.streamReaderCancelTimeout&&(clearTimeout(s.streamReaderCancelTimeout),s.streamReaderCancelTimeout=null),!r){if(s.renderTasks.size>0)return;if(y instanceof _display_utils.RenderingCancelledException){let g=RENDERING_CANCELLED_TIMEOUT;y.extraDelay>0&&y.extraDelay<1e3&&(g+=y.extraDelay),s.streamReaderCancelTimeout=setTimeout(()=>{s.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:s,reason:y,force:!0})},g);return}}if(s.streamReader.cancel(new _util.AbortException(y.message)).catch(()=>{}),s.streamReader=null,!this._transport.destroyed){for(const[g,P]of this._intentStates)if(P===s){this._intentStates.delete(g);break}this.cleanup()}}}get stats(){return this._stats}}exports$1.PDFPageProxy=PDFPageProxy;class LoopbackPort{#t=new Set;#e=Promise.resolve();postMessage(s,y){const r={data:structuredClone(s,y?{transfer:y}:null)};this.#e.then(()=>{for(const g of this.#t)g.call(this,r)})}addEventListener(s,y){this.#t.add(y)}removeEventListener(s,y){this.#t.delete(y)}terminate(){this.#t.clear()}}exports$1.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports$1.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const w=document?.currentScript?.src;w&&(PDFWorkerUtil.fallbackWorkerSrc=w.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(w,s){let y;try{if(y=new URL(w),!y.origin||y.origin==="null")return!1}catch{return!1}const r=new URL(s,y);return y.origin===r.origin},PDFWorkerUtil.createCDNWrapper=function(w){const s=`importScripts("${w}");`;return URL.createObjectURL(new Blob([s]))}}class PDFWorker{static#workerPorts;constructor({name:w=null,port:s=null,verbosity:y=(0,_util.getVerbosityLevel)()}={}){if(this.name=w,this.destroyed=!1,this.verbosity=y,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,s){if(PDFWorker.#workerPorts?.has(s))throw new Error("Cannot use more than one PDFWorker per port.");(PDFWorker.#workerPorts||=new WeakMap).set(s,this),this._initializeFromPort(s);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(w){this._port=w,this._messageHandler=new _message_handler.MessageHandler("main","worker",w),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:w}=PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,w)||(w=PDFWorkerUtil.createCDNWrapper(new URL(w,window.location).href));const s=new Worker(w),y=new _message_handler.MessageHandler("main","worker",s),r=()=>{s.removeEventListener("error",g),y.destroy(),s.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},g=()=>{this._webWorker||r()};s.addEventListener("error",g),y.on("test",C=>{if(s.removeEventListener("error",g),this.destroyed){r();return}C?(this._messageHandler=y,this._port=s,this._webWorker=s,this._readyCapability.resolve(),y.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),y.destroy(),s.terminate())}),y.on("ready",C=>{if(s.removeEventListener("error",g),this.destroyed){r();return}try{P()}catch{this._setupFakeWorker()}});const P=()=>{const C=new Uint8Array;y.send("test",C,[C.buffer])};P();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),PDFWorker._setupFakeWorkerGlobal.then(w=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const s=new LoopbackPort;this._port=s;const y=`fake${PDFWorkerUtil.fakeWorkerId++}`,r=new _message_handler.MessageHandler(y+"_worker",y,s);w.setup(r,s);const g=new _message_handler.MessageHandler(y,y+"_worker",s);this._messageHandler=g,this._readyCapability.resolve(),g.send("configure",{verbosity:this.verbosity})}).catch(w=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${w.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),PDFWorker.#workerPorts?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(w){if(!w?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const s=this.#workerPorts?.get(w.port);if(s){if(s._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return s}return new PDFWorker(w)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}}exports$1.PDFWorker=PDFWorker;class WorkerTransport{#t=new Map;#e=new Map;#i=new Map;#s=null;constructor(s,y,r,g,P){this.messageHandler=s,this.loadingTask=y,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:g.ownerDocument,styleElement:g.styleElement}),this._params=g,this.canvasFactory=P.canvasFactory,this.filterFactory=P.filterFactory,this.cMapReaderFactory=P.cMapReaderFactory,this.standardFontDataFactory=P.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=r,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}#o(s,y=null){const r=this.#t.get(s);if(r)return r;const g=this.messageHandler.sendWithPromise(s,y);return this.#t.set(s,g),g}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(s,y=_util.AnnotationMode.ENABLE,r=null,g=!1){let P=_util.RenderingIntentFlag.DISPLAY,C=_annotation_storage.SerializableEmpty;switch(s){case"any":P=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":P=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${s}`)}switch(y){case _util.AnnotationMode.DISABLE:P+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:P+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:P+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,C=(P&_util.RenderingIntentFlag.PRINT&&r instanceof _annotation_storage.PrintAnnotationStorage?r:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${y}`)}return g&&(P+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:P,cacheKey:`${P}_${C.hash}`,annotationStorageSerializable:C}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,this.#s?.reject(new Error("Worker was destroyed during onPassword callback"));const s=[];for(const r of this.#e.values())s.push(r._destroy());this.#e.clear(),this.#i.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const y=this.messageHandler.sendWithPromise("Terminate",null);return s.push(y),Promise.all(s).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),this._networkStream?.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:s,loadingTask:y}=this;s.on("GetReader",(r,g)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=P=>{this._lastProgress={loaded:P.loaded,total:P.total}},g.onPull=()=>{this._fullReader.read().then(function({value:P,done:C}){if(C){g.close();return}(0,_util.assert)(P instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),g.enqueue(new Uint8Array(P),1,[P])}).catch(P=>{g.error(P)})},g.onCancel=P=>{this._fullReader.cancel(P),g.ready.catch(C=>{if(!this.destroyed)throw C})}}),s.on("ReaderHeadersReady",r=>{const g=new _util.PromiseCapability,P=this._fullReader;return P.headersReady.then(()=>{(!P.isStreamingSupported||!P.isRangeSupported)&&(this._lastProgress&&y.onProgress?.(this._lastProgress),P.onProgress=C=>{y.onProgress?.({loaded:C.loaded,total:C.total})}),g.resolve({isStreamingSupported:P.isStreamingSupported,isRangeSupported:P.isRangeSupported,contentLength:P.contentLength})},g.reject),g.promise}),s.on("GetRangeReader",(r,g)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const P=this._networkStream.getRangeReader(r.begin,r.end);if(!P){g.close();return}g.onPull=()=>{P.read().then(function({value:C,done:L}){if(L){g.close();return}(0,_util.assert)(C instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),g.enqueue(new Uint8Array(C),1,[C])}).catch(C=>{g.error(C)})},g.onCancel=C=>{P.cancel(C),g.ready.catch(L=>{if(!this.destroyed)throw L})}}),s.on("GetDoc",({pdfInfo:r})=>{this._numPages=r.numPages,this._htmlForXfa=r.htmlForXfa,delete r.htmlForXfa,y._capability.resolve(new PDFDocumentProxy(r,this))}),s.on("DocException",function(r){let g;switch(r.name){case"PasswordException":g=new _util.PasswordException(r.message,r.code);break;case"InvalidPDFException":g=new _util.InvalidPDFException(r.message);break;case"MissingPDFException":g=new _util.MissingPDFException(r.message);break;case"UnexpectedResponseException":g=new _util.UnexpectedResponseException(r.message,r.status);break;case"UnknownErrorException":g=new _util.UnknownErrorException(r.message,r.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}y._capability.reject(g)}),s.on("PasswordRequest",r=>{if(this.#s=new _util.PromiseCapability,y.onPassword){const g=P=>{P instanceof Error?this.#s.reject(P):this.#s.resolve({password:P})};try{y.onPassword(g,r.code)}catch(P){this.#s.reject(P)}}else this.#s.reject(new _util.PasswordException(r.message,r.code));return this.#s.promise}),s.on("DataLoaded",r=>{y.onProgress?.({loaded:r.length,total:r.length}),this.downloadInfoCapability.resolve(r)}),s.on("StartRenderPage",r=>{if(this.destroyed)return;this.#e.get(r.pageIndex)._startRenderPage(r.transparency,r.cacheKey)}),s.on("commonobj",([r,g,P])=>{if(!this.destroyed&&!this.commonObjs.has(r))switch(g){case"Font":const C=this._params;if("error"in P){const n=P.error;(0,_util.warn)(`Error during font loading: ${n}`),this.commonObjs.resolve(r,n);break}const L=C.pdfBug&&globalThis.FontInspector?.enabled?(n,t)=>globalThis.FontInspector.fontAdded(n,t):null,j=new _font_loader.FontFaceObject(P,{isEvalSupported:C.isEvalSupported,disableFontFace:C.disableFontFace,ignoreErrors:C.ignoreErrors,inspectFont:L});this.fontLoader.bind(j).catch(n=>s.sendWithPromise("FontFallback",{id:r})).finally(()=>{!C.fontExtraProperties&&j.data&&(j.data=null),this.commonObjs.resolve(r,j)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(r,P);break;default:throw new Error(`Got unknown common object type ${g}`)}}),s.on("obj",([r,g,P,C])=>{if(this.destroyed)return;const L=this.#e.get(g);if(!L.objs.has(r))switch(P){case"Image":if(L.objs.resolve(r,C),C){let j;if(C.bitmap){const{width:n,height:t}=C;j=n*t*4}else j=C.data?.length||0;j>_util.MAX_IMAGE_SIZE_TO_CACHE&&(L._maybeCleanupAfterRender=!0)}break;case"Pattern":L.objs.resolve(r,C);break;default:throw new Error(`Got unknown object type ${P}`)}}),s.on("DocProgress",r=>{this.destroyed||y.onProgress?.({loaded:r.loaded,total:r.total})}),s.on("FetchBuiltInCMap",r=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(r):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),s.on("FetchStandardFontData",r=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(r):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:s,transfers:y}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:s,filename:this._fullReader?.filename??null},y).finally(()=>{this.annotationStorage.resetModified()})}getPage(s){if(!Number.isInteger(s)||s<=0||s>this._numPages)return Promise.reject(new Error("Invalid page request."));const y=s-1,r=this.#i.get(y);if(r)return r;const g=this.messageHandler.sendWithPromise("GetPage",{pageIndex:y}).then(P=>{if(this.destroyed)throw new Error("Transport destroyed");const C=new PDFPageProxy(y,P,this,this._params.pdfBug);return this.#e.set(y,C),C});return this.#i.set(y,g),g}getPageIndex(s){return typeof s!="object"||s===null||!Number.isInteger(s.num)||s.num<0||!Number.isInteger(s.gen)||s.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:s.num,gen:s.gen})}getAnnotations(s,y){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:s,intent:y})}getFieldObjects(){return this.#o("GetFieldObjects")}hasJSActions(){return this.#o("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(s){return typeof s!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:s})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#o("GetDocJSActions")}getPageJSActions(s){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:s})}getStructTree(s){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:s})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(s=>new _optional_content_config.OptionalContentConfig(s))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const s="GetMetadata",y=this.#t.get(s);if(y)return y;const r=this.messageHandler.sendWithPromise(s,null).then(g=>({info:g[0],metadata:g[1]?new _metadata.Metadata(g[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(s,r),r}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(s=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const y of this.#e.values())if(!y.cleanup())throw new Error(`startCleanup: Page ${y.pageNumber} is currently rendering.`);this.commonObjs.clear(),s||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:s,enableXfa:y}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:s,enableXfa:y})}}class PDFObjects{#t=Object.create(null);#e(s){return this.#t[s]||={capability:new _util.PromiseCapability,data:null}}get(s,y=null){if(y){const g=this.#e(s);return g.capability.promise.then(()=>y(g.data)),null}const r=this.#t[s];if(!r?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${s}.`);return r.data}has(s){return this.#t[s]?.capability.settled||!1}resolve(s,y=null){const r=this.#e(s);r.data=y,r.capability.resolve()}clear(){for(const s in this.#t){const{data:y}=this.#t[s];y?.bitmap?.close()}this.#t=Object.create(null)}}class RenderTask{#t=null;constructor(s){this.#t=s,this.onContinue=null}get promise(){return this.#t.capability.promise}cancel(s=0){this.#t.cancel(null,s)}get separateAnnots(){const{separateAnnots:s}=this.#t.operatorList;if(!s)return!1;const{annotationCanvasMap:y}=this.#t;return s.form||s.canvas&&y?.size>0}}exports$1.RenderTask=RenderTask;class InternalRenderTask{static#t=new WeakSet;constructor({callback:s,params:y,objs:r,commonObjs:g,annotationCanvasMap:P,operatorList:C,pageIndex:L,canvasFactory:j,filterFactory:n,useRequestAnimationFrame:t=!1,pdfBug:i=!1,pageColors:h=null}){this.callback=s,this.params=y,this.objs=r,this.commonObjs=g,this.annotationCanvasMap=P,this.operatorListIdx=null,this.operatorList=C,this._pageIndex=L,this.canvasFactory=j,this.filterFactory=n,this._pdfBug=i,this.pageColors=h,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=t===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=y.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:s=!1,optionalContentConfig:y}){if(this.cancelled)return;if(this._canvas){if(InternalRenderTask.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");InternalRenderTask.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:r,viewport:g,transform:P,background:C}=this.params;this.gfx=new _canvas.CanvasGraphics(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:y},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:P,viewport:g,transparency:s,background:C}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(s=null,y=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),InternalRenderTask.#t.delete(this._canvas),this.callback(s||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,y))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),InternalRenderTask.#t.delete(this._canvas),this.callback())))}}const version="3.11.174";exports$1.version=version;const build="ce8716743";exports$1.build=build}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.SerializableEmpty=s.PrintAnnotationStorage=s.AnnotationStorage=void 0;var r=y(1),g=y(4),P=y(8);const C=Object.freeze({map:null,hash:"",transfers:void 0});s.SerializableEmpty=C;class L{#t=!1;#e=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,i){const h=this.#e.get(t);return h===void 0?i:Object.assign(i,h)}getRawValue(t){return this.#e.get(t)}remove(t){if(this.#e.delete(t),this.#e.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const i of this.#e.values())if(i instanceof g.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(t,i){const h=this.#e.get(t);let l=!1;if(h!==void 0)for(const[e,u]of Object.entries(i))h[e]!==u&&(l=!0,h[e]=u);else l=!0,this.#e.set(t,i);l&&this.#i(),i instanceof g.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(i.constructor._type)}has(t){return this.#e.has(t)}getAll(){return this.#e.size>0?(0,r.objectFromMap)(this.#e):null}setAll(t){for(const[i,h]of Object.entries(t))this.setValue(i,h)}get size(){return this.#e.size}#i(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new j(this)}get serializable(){if(this.#e.size===0)return C;const t=new Map,i=new P.MurmurHash3_64,h=[],l=Object.create(null);let e=!1;for(const[u,p]of this.#e){const o=p instanceof g.AnnotationEditor?p.serialize(!1,l):p;o&&(t.set(u,o),i.update(`${u}:${JSON.stringify(o)}`),e||=!!o.bitmap)}if(e)for(const u of t.values())u.bitmap&&h.push(u.bitmap);return t.size>0?{map:t,hash:i.hexdigest(),transfers:h}:C}}s.AnnotationStorage=L;class j extends L{#t;constructor(t){super();const{map:i,hash:h,transfers:l}=t.serializable,e=structuredClone(i,l?{transfer:l}:null);this.#t={map:e,hash:h,transfers:l}}get print(){(0,r.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}}s.PrintAnnotationStorage=j}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.AnnotationEditor=void 0;var r=y(5),g=y(1),P=y(6);class C{#t="";#e=!1;#i=null;#s=null;#o=null;#a=!1;#r=null;#l=this.focusin.bind(this);#c=this.focusout.bind(this);#n=!1;#f=!1;#d=!1;_initialOptions=Object.create(null);_uiManager=null;_focusEventsAllowed=!0;_l10nPromise=null;#u=!1;#p=C._zIndex++;static _borderLineWidth=-1;static _colorManager=new r.ColorManager;static _zIndex=1;static SMALL_EDITOR_SIZE=0;constructor(n){this.constructor===C&&(0,g.unreachable)("Cannot initialize AnnotationEditor."),this.parent=n.parent,this.id=n.id,this.width=this.height=null,this.pageIndex=n.parent.pageIndex,this.name=n.name,this.div=null,this._uiManager=n.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=n.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:i,pageHeight:h,pageX:l,pageY:e}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,h],this.pageTranslation=[l,e];const[u,p]=this.parentDimensions;this.x=n.x/u,this.y=n.y/p,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,g.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(n){const t=new L({id:n.parent.getNextId(),parent:n.parent,uiManager:n._uiManager});t.annotationElementId=n.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(n,t=null){if(C._l10nPromise||=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(h=>[h,n.get(h)])),t?.strings)for(const h of t.strings)C._l10nPromise.set(h,n.get(h));if(C._borderLineWidth!==-1)return;const i=getComputedStyle(document.documentElement);C._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(n,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(n){return!1}static paste(n,t){(0,g.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#u}set _isDraggable(n){this.#u=n,this.div?.classList.toggle("draggable",n)}center(){const[n,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(n*2),this.y+=this.width*n/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(n*2),this.y-=this.width*n/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(n){this._uiManager.addCommands(n)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#p}setParent(n){n!==null&&(this.pageIndex=n.pageIndex,this.pageDimensions=n.pageDimensions),this.parent=n}focusin(n){this._focusEventsAllowed&&(this.#n?this.#n=!1:this.parent.setSelected(this))}focusout(n){!this._focusEventsAllowed||!this.isAttachedToDOM||n.relatedTarget?.closest(`#${this.id}`)||(n.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(n,t,i,h){const[l,e]=this.parentDimensions;[i,h]=this.screenToPageTranslation(i,h),this.x=(n+i)/l,this.y=(t+h)/e,this.fixAndSetPosition()}#b([n,t],i,h){[i,h]=this.screenToPageTranslation(i,h),this.x+=i/n,this.y+=h/t,this.fixAndSetPosition()}translate(n,t){this.#b(this.parentDimensions,n,t)}translateInPage(n,t){this.#b(this.pageDimensions,n,t),this.div.scrollIntoView({block:"nearest"})}drag(n,t){const[i,h]=this.parentDimensions;if(this.x+=n/i,this.y+=t/h,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:o,y:v}=this.div.getBoundingClientRect();this.parent.findNewParent(this,o,v)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:l,y:e}=this;const[u,p]=this.#m();l+=u,e+=p,this.div.style.left=`${(100*l).toFixed(2)}%`,this.div.style.top=`${(100*e).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}#m(){const[n,t]=this.parentDimensions,{_borderLineWidth:i}=C,h=i/n,l=i/t;switch(this.rotation){case 90:return[-h,l];case 180:return[h,l];case 270:return[h,-l];default:return[-h,-l]}}fixAndSetPosition(){const[n,t]=this.pageDimensions;let{x:i,y:h,width:l,height:e}=this;switch(l*=n,e*=t,i*=n,h*=t,this.rotation){case 0:i=Math.max(0,Math.min(n-l,i)),h=Math.max(0,Math.min(t-e,h));break;case 90:i=Math.max(0,Math.min(n-e,i)),h=Math.min(t,Math.max(l,h));break;case 180:i=Math.min(n,Math.max(l,i)),h=Math.min(t,Math.max(e,h));break;case 270:i=Math.min(n,Math.max(e,i)),h=Math.max(0,Math.min(t-l,h));break}this.x=i/=n,this.y=h/=t;const[u,p]=this.#m();i+=u,h+=p;const{style:o}=this.div;o.left=`${(100*i).toFixed(2)}%`,o.top=`${(100*h).toFixed(2)}%`,this.moveInDOM()}static#g(n,t,i){switch(i){case 90:return[t,-n];case 180:return[-n,-t];case 270:return[-t,n];default:return[n,t]}}screenToPageTranslation(n,t){return C.#g(n,t,this.parentRotation)}pageTranslationToScreen(n,t){return C.#g(n,t,360-this.parentRotation)}#h(n){switch(n){case 90:{const[t,i]=this.pageDimensions;return[0,-t/i,i/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,i]=this.pageDimensions;return[0,t/i,-i/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:n,pageDimensions:[t,i]}=this,h=t*n,l=i*n;return g.FeatureTest.isCSSRoundSupported?[Math.round(h),Math.round(l)]:[h,l]}setDims(n,t){const[i,h]=this.parentDimensions;this.div.style.width=`${(100*n/i).toFixed(2)}%`,this.#a||(this.div.style.height=`${(100*t/h).toFixed(2)}%`),this.#i?.classList.toggle("small",n<C.SMALL_EDITOR_SIZE||t<C.SMALL_EDITOR_SIZE)}fixDims(){const{style:n}=this.div,{height:t,width:i}=n,h=i.endsWith("%"),l=!this.#a&&t.endsWith("%");if(h&&l)return;const[e,u]=this.parentDimensions;h||(n.width=`${(100*parseFloat(i)/e).toFixed(2)}%`),!this.#a&&!l&&(n.height=`${(100*parseFloat(t)/u).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#_(){if(this.#r)return;this.#r=document.createElement("div"),this.#r.classList.add("resizers");const n=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||n.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const t of n){const i=document.createElement("div");this.#r.append(i),i.classList.add("resizer",t),i.addEventListener("pointerdown",this.#E.bind(this,t)),i.addEventListener("contextmenu",P.noContextMenu)}this.div.prepend(this.#r)}#E(n,t){t.preventDefault();const{isMac:i}=g.FeatureTest.platform;if(t.button!==0||t.ctrlKey&&i)return;const h=this.#S.bind(this,n),l=this._isDraggable;this._isDraggable=!1;const e={passive:!0,capture:!0};window.addEventListener("pointermove",h,e);const u=this.x,p=this.y,o=this.width,v=this.height,R=this.parent.div.style.cursor,T=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const f=()=>{this._isDraggable=l,window.removeEventListener("pointerup",f),window.removeEventListener("blur",f),window.removeEventListener("pointermove",h,e),this.parent.div.style.cursor=R,this.div.style.cursor=T;const S=this.x,B=this.y,H=this.width,O=this.height;S===u&&B===p&&H===o&&O===v||this.addCommands({cmd:()=>{this.width=H,this.height=O,this.x=S,this.y=B;const[z,X]=this.parentDimensions;this.setDims(z*H,X*O),this.fixAndSetPosition()},undo:()=>{this.width=o,this.height=v,this.x=u,this.y=p;const[z,X]=this.parentDimensions;this.setDims(z*o,X*v),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",f),window.addEventListener("blur",f)}#S(n,t){const[i,h]=this.parentDimensions,l=this.x,e=this.y,u=this.width,p=this.height,o=C.MIN_SIZE/i,v=C.MIN_SIZE/h,R=E=>Math.round(E*1e4)/1e4,T=this.#h(this.rotation),f=(E,a)=>[T[0]*E+T[2]*a,T[1]*E+T[3]*a],S=this.#h(360-this.rotation),B=(E,a)=>[S[0]*E+S[2]*a,S[1]*E+S[3]*a];let H,O,z=!1,X=!1;switch(n){case"topLeft":z=!0,H=(E,a)=>[0,0],O=(E,a)=>[E,a];break;case"topMiddle":H=(E,a)=>[E/2,0],O=(E,a)=>[E/2,a];break;case"topRight":z=!0,H=(E,a)=>[E,0],O=(E,a)=>[0,a];break;case"middleRight":X=!0,H=(E,a)=>[E,a/2],O=(E,a)=>[0,a/2];break;case"bottomRight":z=!0,H=(E,a)=>[E,a],O=(E,a)=>[0,0];break;case"bottomMiddle":H=(E,a)=>[E/2,a],O=(E,a)=>[E/2,0];break;case"bottomLeft":z=!0,H=(E,a)=>[0,a],O=(E,a)=>[E,0];break;case"middleLeft":X=!0,H=(E,a)=>[0,a/2],O=(E,a)=>[E,a/2];break}const it=H(u,p),Q=O(u,p);let et=f(...Q);const nt=R(l+et[0]),$=R(e+et[1]);let D=1,b=1,[c,d]=this.screenToPageTranslation(t.movementX,t.movementY);if([c,d]=B(c/i,d/h),z){const E=Math.hypot(u,p);D=b=Math.max(Math.min(Math.hypot(Q[0]-it[0]-c,Q[1]-it[1]-d)/E,1/u,1/p),o/u,v/p)}else X?D=Math.max(o,Math.min(1,Math.abs(Q[0]-it[0]-c)))/u:b=Math.max(v,Math.min(1,Math.abs(Q[1]-it[1]-d)))/p;const _=R(u*D),F=R(p*b);et=f(...O(_,F));const M=nt-et[0],I=$-et[1];this.width=_,this.height=F,this.x=M,this.y=I,this.setDims(i*_,h*F),this.fixAndSetPosition()}async addAltTextButton(){if(this.#i)return;const n=this.#i=document.createElement("button");n.className="altText";const t=await C._l10nPromise.get("editor_alt_text_button_label");n.textContent=t,n.setAttribute("aria-label",t),n.tabIndex="0",n.addEventListener("contextmenu",P.noContextMenu),n.addEventListener("pointerdown",i=>i.stopPropagation()),n.addEventListener("click",i=>{i.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),n.addEventListener("keydown",i=>{i.target===n&&i.key==="Enter"&&(i.preventDefault(),this._uiManager.editAltText(this))}),this.#C(),this.div.append(n),C.SMALL_EDITOR_SIZE||(C.SMALL_EDITOR_SIZE=Math.min(128,Math.round(n.getBoundingClientRect().width*1.4)))}async#C(){const n=this.#i;if(!n)return;if(!this.#t&&!this.#e){n.classList.remove("done"),this.#s?.remove();return}C._l10nPromise.get("editor_alt_text_edit_button_label").then(i=>{n.setAttribute("aria-label",i)});let t=this.#s;if(!t){this.#s=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip");const i=t.id=`alt-text-tooltip-${this.id}`;n.setAttribute("aria-describedby",i);const h=100;n.addEventListener("mouseenter",()=>{this.#o=setTimeout(()=>{this.#o=null,this.#s.classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},h)}),n.addEventListener("mouseleave",()=>{clearTimeout(this.#o),this.#o=null,this.#s?.classList.remove("show")})}n.classList.add("done"),t.innerText=this.#e?await C._l10nPromise.get("editor_alt_text_decorative_tooltip"):this.#t,t.parentNode||n.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:this.#t,decorative:this.#e}}set altTextData({altText:n,decorative:t}){this.#t===n&&this.#e===t||(this.#t=n,this.#e=t,this.#C())}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",this.#l),this.div.addEventListener("focusout",this.#c);const[n,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/n).toFixed(2)}%`,this.div.style.maxHeight=`${(100*n/t).toFixed(2)}%`);const[i,h]=this.getInitialTranslation();return this.translate(i,h),(0,r.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(n){const{isMac:t}=g.FeatureTest.platform;if(n.button!==0||n.ctrlKey&&t){n.preventDefault();return}this.#n=!0,this.#P(n)}#P(n){if(!this._isDraggable)return;const t=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let i,h;t&&(i={passive:!0,capture:!0},h=e=>{const[u,p]=this.screenToPageTranslation(e.movementX,e.movementY);this._uiManager.dragSelectedEditors(u,p)},window.addEventListener("pointermove",h,i));const l=()=>{if(window.removeEventListener("pointerup",l),window.removeEventListener("blur",l),t&&window.removeEventListener("pointermove",h,i),this.#n=!1,!this._uiManager.endDragSession()){const{isMac:e}=g.FeatureTest.platform;n.ctrlKey&&!e||n.shiftKey||n.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",l),window.addEventListener("blur",l)}moveInDOM(){this.parent?.moveEditorInDOM(this)}_setParentAndPosition(n,t,i){n.changeParent(this),this.x=t,this.y=i,this.fixAndSetPosition()}getRect(n,t){const i=this.parentScale,[h,l]=this.pageDimensions,[e,u]=this.pageTranslation,p=n/i,o=t/i,v=this.x*h,R=this.y*l,T=this.width*h,f=this.height*l;switch(this.rotation){case 0:return[v+p+e,l-R-o-f+u,v+p+T+e,l-R-o+u];case 90:return[v+o+e,l-R+p+u,v+o+f+e,l-R+p+T+u];case 180:return[v-p-T+e,l-R+o+u,v-p+e,l-R+o+f+u];case 270:return[v-o-f+e,l-R-p-T+u,v-o+e,l-R-p+u];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(n,t){const[i,h,l,e]=n,u=l-i,p=e-h;switch(this.rotation){case 0:return[i,t-e,u,p];case 90:return[i,t-h,p,u];case 180:return[l,t-h,u,p];case 270:return[l,t-e,p,u];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#d=!0}disableEditMode(){this.#d=!1}isInEditMode(){return this.#d}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#l),this.div?.addEventListener("focusout",this.#c)}serialize(n=!1,t=null){(0,g.unreachable)("An editor must be serializable")}static deserialize(n,t,i){const h=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:i});h.rotation=n.rotation;const[l,e]=h.pageDimensions,[u,p,o,v]=h.getRectInCurrentCoords(n.rect,e);return h.x=u/l,h.y=p/e,h.width=o/l,h.height=v/e,h}remove(){this.div.removeEventListener("focusin",this.#l),this.div.removeEventListener("focusout",this.#c),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#i?.remove(),this.#i=null,this.#s=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#_(),this.#r.classList.remove("hidden"))}select(){this.makeResizable(),this.div?.classList.add("selectedEditor")}unselect(){this.#r?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(n,t){}disableEditing(){this.#i&&(this.#i.hidden=!0)}enableEditing(){this.#i&&(this.#i.hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return this.#f}set isEditing(n){this.#f=n,this.parent&&(n?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(n,t){this.#a=!0;const i=n/t,{style:h}=this.div;h.aspectRatio=i,h.height="auto"}static get MIN_SIZE(){return 16}}s.AnnotationEditor=C;class L extends C{constructor(n){super(n),this.annotationElementId=n.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.KeyboardManager=s.CommandManager=s.ColorManager=s.AnnotationEditorUIManager=void 0,s.bindEvents=P,s.opacityToHex=C;var r=y(1),g=y(6);function P(l,e,u){for(const p of u)e.addEventListener(p,l[p].bind(l))}function C(l){return Math.round(Math.min(255,Math.max(1,255*l))).toString(16).padStart(2,"0")}class L{#t=0;getId(){return`${r.AnnotationEditorPrefix}${this.#t++}`}}class j{#t=(0,r.getUuid)();#e=0;#i=null;static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',p=new OffscreenCanvas(1,3).getContext("2d"),o=new Image;o.src=e;const v=o.decode().then(()=>(p.drawImage(o,0,0,1,1,0,0,1,3),new Uint32Array(p.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,r.shadow)(this,"_isSVGFittingCanvas",v)}async#s(e,u){this.#i||=new Map;let p=this.#i.get(e);if(p===null)return null;if(p?.bitmap)return p.refCounter+=1,p;try{p||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let o;if(typeof u=="string"){p.url=u;const v=await fetch(u);if(!v.ok)throw new Error(v.statusText);o=await v.blob()}else o=p.file=u;if(o.type==="image/svg+xml"){const v=j._isSVGFittingCanvas,R=new FileReader,T=new Image,f=new Promise((S,B)=>{T.onload=()=>{p.bitmap=T,p.isSvg=!0,S()},R.onload=async()=>{const H=p.svgUrl=R.result;T.src=await v?`${H}#svgView(preserveAspectRatio(none))`:H},T.onerror=R.onerror=B});R.readAsDataURL(o),await f}else p.bitmap=await createImageBitmap(o);p.refCounter=1}catch(o){console.error(o),p=null}return this.#i.set(e,p),p&&this.#i.set(p.id,p),p}async getFromFile(e){const{lastModified:u,name:p,size:o,type:v}=e;return this.#s(`${u}_${p}_${o}_${v}`,e)}async getFromUrl(e){return this.#s(e,e)}async getFromId(e){this.#i||=new Map;const u=this.#i.get(e);return u?u.bitmap?(u.refCounter+=1,u):u.file?this.getFromFile(u.file):this.getFromUrl(u.url):null}getSvgUrl(e){const u=this.#i.get(e);return u?.isSvg?u.svgUrl:null}deleteId(e){this.#i||=new Map;const u=this.#i.get(e);u&&(u.refCounter-=1,u.refCounter===0&&(u.bitmap=null))}isValidId(e){return e.startsWith(`image_${this.#t}_`)}}class n{#t=[];#e=!1;#i;#s=-1;constructor(e=128){this.#i=e}add({cmd:e,undo:u,mustExec:p,type:o=NaN,overwriteIfSameType:v=!1,keepUndo:R=!1}){if(p&&e(),this.#e)return;const T={cmd:e,undo:u,type:o};if(this.#s===-1){this.#t.length>0&&(this.#t.length=0),this.#s=0,this.#t.push(T);return}if(v&&this.#t[this.#s].type===o){R&&(T.undo=this.#t[this.#s].undo),this.#t[this.#s]=T;return}const f=this.#s+1;f===this.#i?this.#t.splice(0,1):(this.#s=f,f<this.#t.length&&this.#t.splice(f)),this.#t.push(T)}undo(){this.#s!==-1&&(this.#e=!0,this.#t[this.#s].undo(),this.#e=!1,this.#s-=1)}redo(){this.#s<this.#t.length-1&&(this.#s+=1,this.#e=!0,this.#t[this.#s].cmd(),this.#e=!1)}hasSomethingToUndo(){return this.#s!==-1}hasSomethingToRedo(){return this.#s<this.#t.length-1}destroy(){this.#t=null}}s.CommandManager=n;class t{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:u}=r.FeatureTest.platform;for(const[p,o,v={}]of e)for(const R of p){const T=R.startsWith("mac+");u&&T?(this.callbacks.set(R.slice(4),{callback:o,options:v}),this.allKeys.add(R.split("+").at(-1))):!u&&!T&&(this.callbacks.set(R,{callback:o,options:v}),this.allKeys.add(R.split("+").at(-1)))}}#t(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const u=this.buffer.join("+");return this.buffer.length=0,u}exec(e,u){if(!this.allKeys.has(u.key))return;const p=this.callbacks.get(this.#t(u));if(!p)return;const{callback:o,options:{bubbles:v=!1,args:R=[],checker:T=null}}=p;T&&!T(e,u)||(o.bind(e,...R)(),v||(u.stopPropagation(),u.preventDefault()))}}s.KeyboardManager=t;class i{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return(0,g.getColorValues)(e),(0,r.shadow)(this,"_colors",e)}convert(e){const u=(0,g.getRGB)(e);if(!window.matchMedia("(forced-colors: active)").matches)return u;for(const[p,o]of this._colors)if(o.every((v,R)=>v===u[R]))return i._colorsMapping.get(p);return u}getHexCode(e){const u=this._colors.get(e);return u?r.Util.makeHexColor(...u):e}}s.ColorManager=i;class h{#t=null;#e=new Map;#i=new Map;#s=null;#o=null;#a=new n;#r=0;#l=new Set;#c=null;#n=null;#f=new Set;#d=null;#u=new L;#p=!1;#b=!1;#m=null;#g=r.AnnotationEditorType.NONE;#h=new Set;#_=null;#E=this.blur.bind(this);#S=this.focus.bind(this);#C=this.copy.bind(this);#P=this.cut.bind(this);#I=this.paste.bind(this);#L=this.keydown.bind(this);#O=this.onEditingAction.bind(this);#A=this.onPageChanging.bind(this);#D=this.onScaleChanging.bind(this);#k=this.onRotationChanging.bind(this);#R={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1};#y=[0,0];#T=null;#x=null;#N=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=h.prototype,u=v=>{const{activeElement:R}=document;return R&&v.#x.contains(R)&&v.hasSomethingToControl()},p=this.TRANSLATE_SMALL,o=this.TRANSLATE_BIG;return(0,r.shadow)(this,"_keyboardManager",new t([[["ctrl+a","mac+meta+a"],e.selectAll],[["ctrl+z","mac+meta+z"],e.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-p,0],checker:u}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-o,0],checker:u}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[p,0],checker:u}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[o,0],checker:u}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-p],checker:u}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-o],checker:u}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,p],checker:u}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,o],checker:u}]]))}constructor(e,u,p,o,v,R){this.#x=e,this.#N=u,this.#s=p,this._eventBus=o,this._eventBus._on("editingaction",this.#O),this._eventBus._on("pagechanging",this.#A),this._eventBus._on("scalechanging",this.#D),this._eventBus._on("rotationchanging",this.#k),this.#o=v.annotationStorage,this.#d=v.filterFactory,this.#_=R,this.viewParameters={realScale:g.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}destroy(){this.#F(),this.#B(),this._eventBus._off("editingaction",this.#O),this._eventBus._off("pagechanging",this.#A),this._eventBus._off("scalechanging",this.#D),this._eventBus._off("rotationchanging",this.#k);for(const e of this.#i.values())e.destroy();this.#i.clear(),this.#e.clear(),this.#f.clear(),this.#t=null,this.#h.clear(),this.#a.destroy(),this.#s.destroy()}get hcmFilter(){return(0,r.shadow)(this,"hcmFilter",this.#_?this.#d.addHCMFilter(this.#_.foreground,this.#_.background):"none")}get direction(){return(0,r.shadow)(this,"direction",getComputedStyle(this.#x).direction)}editAltText(e){this.#s?.editAltText(this,e)}onPageChanging({pageNumber:e}){this.#r=e-1}focusMainContainer(){this.#x.focus()}findParent(e,u){for(const p of this.#i.values()){const{x:o,y:v,width:R,height:T}=p.div.getBoundingClientRect();if(e>=o&&e<=o+R&&u>=v&&u<=v+T)return p}return null}disableUserSelect(e=!1){this.#N.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#f.add(e)}removeShouldRescale(e){this.#f.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*g.PixelsPerInch.PDF_TO_CSS_UNITS;for(const u of this.#f)u.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}addToAnnotationStorage(e){!e.isEmpty()&&this.#o&&!this.#o.has(e.id)&&this.#o.setValue(e.id,e)}#j(){window.addEventListener("focus",this.#S),window.addEventListener("blur",this.#E)}#B(){window.removeEventListener("focus",this.#S),window.removeEventListener("blur",this.#E)}blur(){if(!this.hasSelection)return;const{activeElement:e}=document;for(const u of this.#h)if(u.div.contains(e)){this.#m=[u,e],u._focusEventsAllowed=!1;break}}focus(){if(!this.#m)return;const[e,u]=this.#m;this.#m=null,u.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0}),u.focus()}#U(){window.addEventListener("keydown",this.#L,{capture:!0})}#F(){window.removeEventListener("keydown",this.#L,{capture:!0})}#M(){document.addEventListener("copy",this.#C),document.addEventListener("cut",this.#P),document.addEventListener("paste",this.#I)}#w(){document.removeEventListener("copy",this.#C),document.removeEventListener("cut",this.#P),document.removeEventListener("paste",this.#I)}addEditListeners(){this.#U(),this.#M()}removeEditListeners(){this.#F(),this.#w()}copy(e){if(e.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const u=[];for(const p of this.#h){const o=p.serialize(!0);o&&u.push(o)}u.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(u))}cut(e){this.copy(e),this.delete()}paste(e){e.preventDefault();const{clipboardData:u}=e;for(const v of u.items)for(const R of this.#n)if(R.isHandlingMimeForPasting(v.type)){R.paste(v,this.currentLayer);return}let p=u.getData("application/pdfjs");if(!p)return;try{p=JSON.parse(p)}catch(v){(0,r.warn)(`paste: "${v.message}".`);return}if(!Array.isArray(p))return;this.unselectAll();const o=this.currentLayer;try{const v=[];for(const f of p){const S=o.deserialize(f);if(!S)return;v.push(S)}const R=()=>{for(const f of v)this.#z(f);this.#G(v)},T=()=>{for(const f of v)f.remove()};this.addCommands({cmd:R,undo:T,mustExec:!0})}catch(v){(0,r.warn)(`paste: "${v.message}".`)}}keydown(e){this.getActive()?.shouldGetKeyboardEvents()||h._keyboardManager.exec(this,e)}onEditingAction(e){["undo","redo","delete","selectAll"].includes(e.name)&&this[e.name]()}#v(e){Object.entries(e).some(([p,o])=>this.#R[p]!==o)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#R,e)})}#H(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#j(),this.#U(),this.#M(),this.#v({isEditing:this.#g!==r.AnnotationEditorType.NONE,isEmpty:this.#W(),hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:this.#a.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#B(),this.#F(),this.#w(),this.#v({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#n){this.#n=e;for(const u of this.#n)this.#H(u.defaultPropertiesToUpdate)}}getId(){return this.#u.getId()}get currentLayer(){return this.#i.get(this.#r)}getLayer(e){return this.#i.get(e)}get currentPageIndex(){return this.#r}addLayer(e){this.#i.set(e.pageIndex,e),this.#p?e.enable():e.disable()}removeLayer(e){this.#i.delete(e.pageIndex)}updateMode(e,u=null){if(this.#g!==e){if(this.#g=e,e===r.AnnotationEditorType.NONE){this.setEditingState(!1),this.#q();return}this.setEditingState(!0),this.#X(),this.unselectAll();for(const p of this.#i.values())p.updateMode(e);if(u){for(const p of this.#e.values())if(p.annotationElementId===u){this.setSelected(p),p.enterInEditMode();break}}}}updateToolbar(e){e!==this.#g&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,u){if(this.#n){if(e===r.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(e);return}for(const p of this.#h)p.updateParams(e,u);for(const p of this.#n)p.updateDefaultParams(e,u)}}enableWaiting(e=!1){if(this.#b!==e){this.#b=e;for(const u of this.#i.values())e?u.disableClick():u.enableClick(),u.div.classList.toggle("waiting",e)}}#X(){if(!this.#p){this.#p=!0;for(const e of this.#i.values())e.enable()}}#q(){if(this.unselectAll(),this.#p){this.#p=!1;for(const e of this.#i.values())e.disable()}}getEditors(e){const u=[];for(const p of this.#e.values())p.pageIndex===e&&u.push(p);return u}getEditor(e){return this.#e.get(e)}addEditor(e){this.#e.set(e.id,e)}removeEditor(e){this.#e.delete(e.id),this.unselect(e),(!e.annotationElementId||!this.#l.has(e.annotationElementId))&&this.#o?.remove(e.id)}addDeletedAnnotationElement(e){this.#l.add(e.annotationElementId),e.deleted=!0}isDeletedAnnotationElement(e){return this.#l.has(e)}removeDeletedAnnotationElement(e){this.#l.delete(e.annotationElementId),e.deleted=!1}#z(e){const u=this.#i.get(e.pageIndex);u?u.addOrRebuild(e):this.addEditor(e)}setActiveEditor(e){this.#t!==e&&(this.#t=e,e&&this.#H(e.propertiesToUpdate))}toggleSelected(e){if(this.#h.has(e)){this.#h.delete(e),e.unselect(),this.#v({hasSelectedEditor:this.hasSelection});return}this.#h.add(e),e.select(),this.#H(e.propertiesToUpdate),this.#v({hasSelectedEditor:!0})}setSelected(e){for(const u of this.#h)u!==e&&u.unselect();this.#h.clear(),this.#h.add(e),e.select(),this.#H(e.propertiesToUpdate),this.#v({hasSelectedEditor:!0})}isSelected(e){return this.#h.has(e)}unselect(e){e.unselect(),this.#h.delete(e),this.#v({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#h.size!==0}undo(){this.#a.undo(),this.#v({hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#W()})}redo(){this.#a.redo(),this.#v({hasSomethingToUndo:!0,hasSomethingToRedo:this.#a.hasSomethingToRedo(),isEmpty:this.#W()})}addCommands(e){this.#a.add(e),this.#v({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#W()})}#W(){if(this.#e.size===0)return!0;if(this.#e.size===1)for(const e of this.#e.values())return e.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const e=[...this.#h],u=()=>{for(const o of e)o.remove()},p=()=>{for(const o of e)this.#z(o)};this.addCommands({cmd:u,undo:p,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#G(e){this.#h.clear();for(const u of e)u.isEmpty()||(this.#h.add(u),u.select());this.#v({hasSelectedEditor:!0})}selectAll(){for(const e of this.#h)e.commit();this.#G(this.#e.values())}unselectAll(){if(this.#t){this.#t.commitOrRemove();return}if(this.hasSelection){for(const e of this.#h)e.unselect();this.#h.clear(),this.#v({hasSelectedEditor:!1})}}translateSelectedEditors(e,u,p=!1){if(p||this.commitOrRemove(),!this.hasSelection)return;this.#y[0]+=e,this.#y[1]+=u;const[o,v]=this.#y,R=[...this.#h],T=1e3;this.#T&&clearTimeout(this.#T),this.#T=setTimeout(()=>{this.#T=null,this.#y[0]=this.#y[1]=0,this.addCommands({cmd:()=>{for(const f of R)this.#e.has(f.id)&&f.translateInPage(o,v)},undo:()=>{for(const f of R)this.#e.has(f.id)&&f.translateInPage(-o,-v)},mustExec:!1})},T);for(const f of R)f.translateInPage(e,u)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#c=new Map;for(const e of this.#h)this.#c.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#c)return!1;this.disableUserSelect(!1);const e=this.#c;this.#c=null;let u=!1;for(const[{x:o,y:v,pageIndex:R},T]of e)T.newX=o,T.newY=v,T.newPageIndex=R,u||=o!==T.savedX||v!==T.savedY||R!==T.savedPageIndex;if(!u)return!1;const p=(o,v,R,T)=>{if(this.#e.has(o.id)){const f=this.#i.get(T);f?o._setParentAndPosition(f,v,R):(o.pageIndex=T,o.x=v,o.y=R)}};return this.addCommands({cmd:()=>{for(const[o,{newX:v,newY:R,newPageIndex:T}]of e)p(o,v,R,T)},undo:()=>{for(const[o,{savedX:v,savedY:R,savedPageIndex:T}]of e)p(o,v,R,T)},mustExec:!0}),!0}dragSelectedEditors(e,u){if(this.#c)for(const p of this.#c.keys())p.drag(e,u)}rebuild(e){if(e.parent===null){const u=this.getLayer(e.pageIndex);u?(u.changeParent(e),u.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}isActive(e){return this.#t===e}getActive(){return this.#t}getMode(){return this.#g}get imageManager(){return(0,r.shadow)(this,"imageManager",new j)}}s.AnnotationEditorUIManager=h}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.StatTimer=s.RenderingCancelledException=s.PixelsPerInch=s.PageViewport=s.PDFDateString=s.DOMStandardFontDataFactory=s.DOMSVGFactory=s.DOMFilterFactory=s.DOMCanvasFactory=s.DOMCMapReaderFactory=void 0,s.deprecated=B,s.getColorValues=it,s.getCurrentTransform=Q,s.getCurrentTransformInverse=et,s.getFilenameFromUrl=o,s.getPdfFilenameFromUrl=v,s.getRGB=X,s.getXfaPageViewport=z,s.isDataScheme=u,s.isPdfFile=p,s.isValidFetchUrl=T,s.loadScript=S,s.noContextMenu=f,s.setLayerDimensions=nt;var r=y(7),g=y(1);const P="http://www.w3.org/2000/svg";class C{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}s.PixelsPerInch=C;class L extends r.BaseFilterFactory{#t;#e;#i;#s;#o;#a;#r;#l;#c;#n;#f=0;constructor({docId:D,ownerDocument:b=globalThis.document}={}){super(),this.#i=D,this.#s=b}get#d(){return this.#t||=new Map}get#u(){if(!this.#e){const D=this.#s.createElement("div"),{style:b}=D;b.visibility="hidden",b.contain="strict",b.width=b.height=0,b.position="absolute",b.top=b.left=0,b.zIndex=-1;const c=this.#s.createElementNS(P,"svg");c.setAttribute("width",0),c.setAttribute("height",0),this.#e=this.#s.createElementNS(P,"defs"),D.append(c),c.append(this.#e),this.#s.body.append(D)}return this.#e}addFilter(D){if(!D)return"none";let b=this.#d.get(D);if(b)return b;let c,d,_,F;if(D.length===1){const a=D[0],m=new Array(256);for(let A=0;A<256;A++)m[A]=a[A]/255;F=c=d=_=m.join(",")}else{const[a,m,A]=D,x=new Array(256),k=new Array(256),N=new Array(256);for(let U=0;U<256;U++)x[U]=a[U]/255,k[U]=m[U]/255,N[U]=A[U]/255;c=x.join(","),d=k.join(","),_=N.join(","),F=`${c}${d}${_}`}if(b=this.#d.get(F),b)return this.#d.set(D,b),b;const M=`g_${this.#i}_transfer_map_${this.#f++}`,I=`url(#${M})`;this.#d.set(D,I),this.#d.set(F,I);const E=this.#b(M);return this.#g(c,d,_,E),I}addHCMFilter(D,b){const c=`${D}-${b}`;if(this.#a===c)return this.#r;if(this.#a=c,this.#r="none",this.#o?.remove(),!D||!b)return this.#r;const d=this.#h(D);D=g.Util.makeHexColor(...d);const _=this.#h(b);if(b=g.Util.makeHexColor(..._),this.#u.style.color="",D==="#000000"&&b==="#ffffff"||D===b)return this.#r;const F=new Array(256);for(let m=0;m<=255;m++){const A=m/255;F[m]=A<=.03928?A/12.92:((A+.055)/1.055)**2.4}const M=F.join(","),I=`g_${this.#i}_hcm_filter`,E=this.#l=this.#b(I);this.#g(M,M,M,E),this.#p(E);const a=(m,A)=>{const x=d[m]/255,k=_[m]/255,N=new Array(A+1);for(let U=0;U<=A;U++)N[U]=x+U/A*(k-x);return N.join(",")};return this.#g(a(0,5),a(1,5),a(2,5),E),this.#r=`url(#${I})`,this.#r}addHighlightHCMFilter(D,b,c,d){const _=`${D}-${b}-${c}-${d}`;if(this.#c===_)return this.#n;if(this.#c=_,this.#n="none",this.#l?.remove(),!D||!b)return this.#n;const[F,M]=[D,b].map(this.#h.bind(this));let I=Math.round(.2126*F[0]+.7152*F[1]+.0722*F[2]),E=Math.round(.2126*M[0]+.7152*M[1]+.0722*M[2]),[a,m]=[c,d].map(this.#h.bind(this));E<I&&([I,E,a,m]=[E,I,m,a]),this.#u.style.color="";const A=(N,U,q)=>{const st=new Array(256),V=(E-I)/q,Y=N/255,K=(U-N)/(255*q);let J=0;for(let Z=0;Z<=q;Z++){const rt=Math.round(I+Z*V),ot=Y+Z*K;for(let lt=J;lt<=rt;lt++)st[lt]=ot;J=rt+1}for(let Z=J;Z<256;Z++)st[Z]=st[J-1];return st.join(",")},x=`g_${this.#i}_hcm_highlight_filter`,k=this.#l=this.#b(x);return this.#p(k),this.#g(A(a[0],m[0],5),A(a[1],m[1],5),A(a[2],m[2],5),k),this.#n=`url(#${x})`,this.#n}destroy(D=!1){D&&(this.#r||this.#n)||(this.#e&&(this.#e.parentNode.parentNode.remove(),this.#e=null),this.#t&&(this.#t.clear(),this.#t=null),this.#f=0)}#p(D){const b=this.#s.createElementNS(P,"feColorMatrix");b.setAttribute("type","matrix"),b.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),D.append(b)}#b(D){const b=this.#s.createElementNS(P,"filter");return b.setAttribute("color-interpolation-filters","sRGB"),b.setAttribute("id",D),this.#u.append(b),b}#m(D,b,c){const d=this.#s.createElementNS(P,b);d.setAttribute("type","discrete"),d.setAttribute("tableValues",c),D.append(d)}#g(D,b,c,d){const _=this.#s.createElementNS(P,"feComponentTransfer");d.append(_),this.#m(_,"feFuncR",D),this.#m(_,"feFuncG",b),this.#m(_,"feFuncB",c)}#h(D){return this.#u.style.color=D,X(getComputedStyle(this.#u).getPropertyValue("color"))}}s.DOMFilterFactory=L;class j extends r.BaseCanvasFactory{constructor({ownerDocument:D=globalThis.document}={}){super(),this._document=D}_createCanvas(D,b){const c=this._document.createElement("canvas");return c.width=D,c.height=b,c}}s.DOMCanvasFactory=j;async function n($,D=!1){if(T($,document.baseURI)){const b=await fetch($);if(!b.ok)throw new Error(b.statusText);return D?new Uint8Array(await b.arrayBuffer()):(0,g.stringToBytes)(await b.text())}return new Promise((b,c)=>{const d=new XMLHttpRequest;d.open("GET",$,!0),D&&(d.responseType="arraybuffer"),d.onreadystatechange=()=>{if(d.readyState===XMLHttpRequest.DONE){if(d.status===200||d.status===0){let _;if(D&&d.response?_=new Uint8Array(d.response):!D&&d.responseText&&(_=(0,g.stringToBytes)(d.responseText)),_){b(_);return}}c(new Error(d.statusText))}},d.send(null)})}class t extends r.BaseCMapReaderFactory{_fetchData(D,b){return n(D,this.isCompressed).then(c=>({cMapData:c,compressionType:b}))}}s.DOMCMapReaderFactory=t;class i extends r.BaseStandardFontDataFactory{_fetchData(D){return n(D,!0)}}s.DOMStandardFontDataFactory=i;class h extends r.BaseSVGFactory{_createSVG(D){return document.createElementNS(P,D)}}s.DOMSVGFactory=h;class l{constructor({viewBox:D,scale:b,rotation:c,offsetX:d=0,offsetY:_=0,dontFlip:F=!1}){this.viewBox=D,this.scale=b,this.rotation=c,this.offsetX=d,this.offsetY=_;const M=(D[2]+D[0])/2,I=(D[3]+D[1])/2;let E,a,m,A;switch(c%=360,c<0&&(c+=360),c){case 180:E=-1,a=0,m=0,A=1;break;case 90:E=0,a=1,m=1,A=0;break;case 270:E=0,a=-1,m=-1,A=0;break;case 0:E=1,a=0,m=0,A=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}F&&(m=-m,A=-A);let x,k,N,U;E===0?(x=Math.abs(I-D[1])*b+d,k=Math.abs(M-D[0])*b+_,N=(D[3]-D[1])*b,U=(D[2]-D[0])*b):(x=Math.abs(M-D[0])*b+d,k=Math.abs(I-D[1])*b+_,N=(D[2]-D[0])*b,U=(D[3]-D[1])*b),this.transform=[E*b,a*b,m*b,A*b,x-E*b*M-m*b*I,k-a*b*M-A*b*I],this.width=N,this.height=U}get rawDims(){const{viewBox:D}=this;return(0,g.shadow)(this,"rawDims",{pageWidth:D[2]-D[0],pageHeight:D[3]-D[1],pageX:D[0],pageY:D[1]})}clone({scale:D=this.scale,rotation:b=this.rotation,offsetX:c=this.offsetX,offsetY:d=this.offsetY,dontFlip:_=!1}={}){return new l({viewBox:this.viewBox.slice(),scale:D,rotation:b,offsetX:c,offsetY:d,dontFlip:_})}convertToViewportPoint(D,b){return g.Util.applyTransform([D,b],this.transform)}convertToViewportRectangle(D){const b=g.Util.applyTransform([D[0],D[1]],this.transform),c=g.Util.applyTransform([D[2],D[3]],this.transform);return[b[0],b[1],c[0],c[1]]}convertToPdfPoint(D,b){return g.Util.applyInverseTransform([D,b],this.transform)}}s.PageViewport=l;class e extends g.BaseException{constructor(D,b=0){super(D,"RenderingCancelledException"),this.extraDelay=b}}s.RenderingCancelledException=e;function u($){const D=$.length;let b=0;for(;b<D&&$[b].trim()==="";)b++;return $.substring(b,b+5).toLowerCase()==="data:"}function p($){return typeof $=="string"&&/\.pdf$/i.test($)}function o($,D=!1){return D||([$]=$.split(/[#?]/,1)),$.substring($.lastIndexOf("/")+1)}function v($,D="document.pdf"){if(typeof $!="string")return D;if(u($))return(0,g.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),D;const b=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,c=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,d=b.exec($);let _=c.exec(d[1])||c.exec(d[2])||c.exec(d[3]);if(_&&(_=_[0],_.includes("%")))try{_=c.exec(decodeURIComponent(_))[0]}catch{}return _||D}class R{started=Object.create(null);times=[];time(D){D in this.started&&(0,g.warn)(`Timer is already running for ${D}`),this.started[D]=Date.now()}timeEnd(D){D in this.started||(0,g.warn)(`Timer has not been started for ${D}`),this.times.push({name:D,start:this.started[D],end:Date.now()}),delete this.started[D]}toString(){const D=[];let b=0;for(const{name:c}of this.times)b=Math.max(c.length,b);for(const{name:c,start:d,end:_}of this.times)D.push(`${c.padEnd(b)} ${_-d}ms
`);return D.join("")}}s.StatTimer=R;function T($,D){try{const{protocol:b}=D?new URL($,D):new URL($);return b==="http:"||b==="https:"}catch{return!1}}function f($){$.preventDefault()}function S($,D=!1){return new Promise((b,c)=>{const d=document.createElement("script");d.src=$,d.onload=function(_){D&&d.remove(),b(_)},d.onerror=function(){c(new Error(`Cannot load script at: ${d.src}`))},(document.head||document.documentElement).append(d)})}function B($){console.log("Deprecated API usage: "+$)}let H;class O{static toDateObject(D){if(!D||typeof D!="string")return null;H||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const b=H.exec(D);if(!b)return null;const c=parseInt(b[1],10);let d=parseInt(b[2],10);d=d>=1&&d<=12?d-1:0;let _=parseInt(b[3],10);_=_>=1&&_<=31?_:1;let F=parseInt(b[4],10);F=F>=0&&F<=23?F:0;let M=parseInt(b[5],10);M=M>=0&&M<=59?M:0;let I=parseInt(b[6],10);I=I>=0&&I<=59?I:0;const E=b[7]||"Z";let a=parseInt(b[8],10);a=a>=0&&a<=23?a:0;let m=parseInt(b[9],10)||0;return m=m>=0&&m<=59?m:0,E==="-"?(F+=a,M+=m):E==="+"&&(F-=a,M-=m),new Date(Date.UTC(c,d,_,F,M,I))}}s.PDFDateString=O;function z($,{scale:D=1,rotation:b=0}){const{width:c,height:d}=$.attributes.style,_=[0,0,parseInt(c),parseInt(d)];return new l({viewBox:_,scale:D,rotation:b})}function X($){if($.startsWith("#")){const D=parseInt($.slice(1),16);return[(D&16711680)>>16,(D&65280)>>8,D&255]}return $.startsWith("rgb(")?$.slice(4,-1).split(",").map(D=>parseInt(D)):$.startsWith("rgba(")?$.slice(5,-1).split(",").map(D=>parseInt(D)).slice(0,3):((0,g.warn)(`Not a valid color format: "${$}"`),[0,0,0])}function it($){const D=document.createElement("span");D.style.visibility="hidden",document.body.append(D);for(const b of $.keys()){D.style.color=b;const c=window.getComputedStyle(D).color;$.set(b,X(c))}D.remove()}function Q($){const{a:D,b,c,d,e:_,f:F}=$.getTransform();return[D,b,c,d,_,F]}function et($){const{a:D,b,c,d,e:_,f:F}=$.getTransform().invertSelf();return[D,b,c,d,_,F]}function nt($,D,b=!1,c=!0){if(D instanceof l){const{pageWidth:d,pageHeight:_}=D.rawDims,{style:F}=$,M=g.FeatureTest.isCSSRoundSupported,I=`var(--scale-factor) * ${d}px`,E=`var(--scale-factor) * ${_}px`,a=M?`round(${I}, 1px)`:`calc(${I})`,m=M?`round(${E}, 1px)`:`calc(${E})`;!b||D.rotation%180===0?(F.width=a,F.height=m):(F.width=m,F.height=a)}c&&$.setAttribute("data-main-rotation",D.rotation)}}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BaseStandardFontDataFactory=s.BaseSVGFactory=s.BaseFilterFactory=s.BaseCanvasFactory=s.BaseCMapReaderFactory=void 0;var r=y(1);class g{constructor(){this.constructor===g&&(0,r.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(t){return"none"}addHCMFilter(t,i){return"none"}addHighlightHCMFilter(t,i,h,l){return"none"}destroy(t=!1){}}s.BaseFilterFactory=g;class P{constructor(){this.constructor===P&&(0,r.unreachable)("Cannot initialize BaseCanvasFactory.")}create(t,i){if(t<=0||i<=0)throw new Error("Invalid canvas size");const h=this._createCanvas(t,i);return{canvas:h,context:h.getContext("2d")}}reset(t,i,h){if(!t.canvas)throw new Error("Canvas is not specified");if(i<=0||h<=0)throw new Error("Invalid canvas size");t.canvas.width=i,t.canvas.height=h}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,i){(0,r.unreachable)("Abstract method `_createCanvas` called.")}}s.BaseCanvasFactory=P;class C{constructor({baseUrl:t=null,isCompressed:i=!0}){this.constructor===C&&(0,r.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=t,this.isCompressed=i}async fetch({name:t}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!t)throw new Error("CMap name must be specified.");const i=this.baseUrl+t+(this.isCompressed?".bcmap":""),h=this.isCompressed?r.CMapCompressionType.BINARY:r.CMapCompressionType.NONE;return this._fetchData(i,h).catch(l=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${i}`)})}_fetchData(t,i){(0,r.unreachable)("Abstract method `_fetchData` called.")}}s.BaseCMapReaderFactory=C;class L{constructor({baseUrl:t=null}){this.constructor===L&&(0,r.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!t)throw new Error("Font filename must be specified.");const i=`${this.baseUrl}${t}`;return this._fetchData(i).catch(h=>{throw new Error(`Unable to load font data at: ${i}`)})}_fetchData(t){(0,r.unreachable)("Abstract method `_fetchData` called.")}}s.BaseStandardFontDataFactory=L;class j{constructor(){this.constructor===j&&(0,r.unreachable)("Cannot initialize BaseSVGFactory.")}create(t,i,h=!1){if(t<=0||i<=0)throw new Error("Invalid SVG dimensions");const l=this._createSVG("svg:svg");return l.setAttribute("version","1.1"),h||(l.setAttribute("width",`${t}px`),l.setAttribute("height",`${i}px`)),l.setAttribute("preserveAspectRatio","none"),l.setAttribute("viewBox",`0 0 ${t} ${i}`),l}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){(0,r.unreachable)("Abstract method `_createSVG` called.")}}s.BaseSVGFactory=j}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.MurmurHash3_64=void 0;var r=y(1);const g=3285377520,P=4294901760,C=65535;class L{constructor(n){this.h1=n?n&4294967295:g,this.h2=n?n&4294967295:g}update(n){let t,i;if(typeof n=="string"){t=new Uint8Array(n.length*2),i=0;for(let B=0,H=n.length;B<H;B++){const O=n.charCodeAt(B);O<=255?t[i++]=O:(t[i++]=O>>>8,t[i++]=O&255)}}else if((0,r.isArrayBuffer)(n))t=n.slice(),i=t.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const h=i>>2,l=i-h*4,e=new Uint32Array(t.buffer,0,h);let u=0,p=0,o=this.h1,v=this.h2;const R=3432918353,T=461845907,f=R&C,S=T&C;for(let B=0;B<h;B++)B&1?(u=e[B],u=u*R&P|u*f&C,u=u<<15|u>>>17,u=u*T&P|u*S&C,o^=u,o=o<<13|o>>>19,o=o*5+3864292196):(p=e[B],p=p*R&P|p*f&C,p=p<<15|p>>>17,p=p*T&P|p*S&C,v^=p,v=v<<13|v>>>19,v=v*5+3864292196);switch(u=0,l){case 3:u^=t[h*4+2]<<16;case 2:u^=t[h*4+1]<<8;case 1:u^=t[h*4],u=u*R&P|u*f&C,u=u<<15|u>>>17,u=u*T&P|u*S&C,h&1?o^=u:v^=u}this.h1=o,this.h2=v}hexdigest(){let n=this.h1,t=this.h2;return n^=t>>>1,n=n*3981806797&P|n*36045&C,t=t*4283543511&P|((t<<16|n>>>16)*2950163797&P)>>>16,n^=t>>>1,n=n*444984403&P|n*60499&C,t=t*3301882366&P|((t<<16|n>>>16)*3120437893&P)>>>16,n^=t>>>1,(n>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}s.MurmurHash3_64=L}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.FontLoader=s.FontFaceObject=void 0;var r=y(1);class g{#t=new Set;constructor({ownerDocument:L=globalThis.document,styleElement:j=null}){this._document=L,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(L){this.nativeFontFaces.add(L),this._document.fonts.add(L)}removeNativeFontFace(L){this.nativeFontFaces.delete(L),this._document.fonts.delete(L)}insertRule(L){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const j=this.styleElement.sheet;j.insertRule(L,j.cssRules.length)}clear(){for(const L of this.nativeFontFaces)this._document.fonts.delete(L);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(L){if(!(!L||this.#t.has(L.loadedName))){if((0,r.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:j,src:n,style:t}=L,i=new FontFace(j,n,t);this.addNativeFontFace(i);try{await i.load(),this.#t.add(j)}catch{(0,r.warn)(`Cannot load system font: ${L.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(i)}return}(0,r.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(L){if(L.attached||L.missingFile&&!L.systemFontInfo)return;if(L.attached=!0,L.systemFontInfo){await this.loadSystemFont(L.systemFontInfo);return}if(this.isFontLoadingAPISupported){const n=L.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(t){throw(0,r.warn)(`Failed to load font '${n.family}': '${t}'.`),L.disableFontFace=!0,t}}return}const j=L.createFontFaceRule();if(j){if(this.insertRule(j),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const t=this._queueLoadingCallback(n);this._prepareFontLoadEvent(L,t)})}}get isFontLoadingAPISupported(){const L=!!this._document?.fonts;return(0,r.shadow)(this,"isFontLoadingAPISupported",L)}get isSyncFontLoadingSupported(){let L=!1;return(r.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(L=!0),(0,r.shadow)(this,"isSyncFontLoadingSupported",L)}_queueLoadingCallback(L){function j(){for((0,r.assert)(!t.done,"completeRequest() cannot be called twice."),t.done=!0;n.length>0&&n[0].done;){const i=n.shift();setTimeout(i.callback,0)}}const{loadingRequests:n}=this,t={done:!1,complete:j,callback:L};return n.push(t),t}get _loadTestFont(){const L=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,r.shadow)(this,"_loadTestFont",L)}_prepareFontLoadEvent(L,j){function n(z,X){return z.charCodeAt(X)<<24|z.charCodeAt(X+1)<<16|z.charCodeAt(X+2)<<8|z.charCodeAt(X+3)&255}function t(z,X,it,Q){const et=z.substring(0,X),nt=z.substring(X+it);return et+Q+nt}let i,h;const l=this._document.createElement("canvas");l.width=1,l.height=1;const e=l.getContext("2d");let u=0;function p(z,X){if(++u>30){(0,r.warn)("Load test font never loaded."),X();return}if(e.font="30px "+z,e.fillText(".",0,20),e.getImageData(0,0,1,1).data[3]>0){X();return}setTimeout(p.bind(null,z,X))}const o=`lt${Date.now()}${this.loadTestFontId++}`;let v=this._loadTestFont;v=t(v,976,o.length,o);const T=16,f=1482184792;let S=n(v,T);for(i=0,h=o.length-3;i<h;i+=4)S=S-f+n(o,i)|0;i<o.length&&(S=S-f+n(o+"XXX",i)|0),v=t(v,T,4,(0,r.string32)(S));const B=`url(data:font/opentype;base64,${btoa(v)});`,H=`@font-face {font-family:"${o}";src:${B}}`;this.insertRule(H);const O=this._document.createElement("div");O.style.visibility="hidden",O.style.width=O.style.height="10px",O.style.position="absolute",O.style.top=O.style.left="0px";for(const z of[L.loadedName,o]){const X=this._document.createElement("span");X.textContent="Hi",X.style.fontFamily=z,O.append(X)}this._document.body.append(O),p(o,()=>{O.remove(),j.complete()})}}s.FontLoader=g;class P{constructor(L,{isEvalSupported:j=!0,disableFontFace:n=!1,ignoreErrors:t=!1,inspectFont:i=null}){this.compiledGlyphs=Object.create(null);for(const h in L)this[h]=L[h];this.isEvalSupported=j!==!1,this.disableFontFace=n===!0,this.ignoreErrors=t===!0,this._inspectFont=i}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let L;if(!this.cssFontInfo)L=new FontFace(this.loadedName,this.data,{});else{const j={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(j.style=`oblique ${this.cssFontInfo.italicAngle}deg`),L=new FontFace(this.cssFontInfo.fontFamily,this.data,j)}return this._inspectFont?.(this),L}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const L=(0,r.bytesToString)(this.data),j=`url(data:${this.mimetype};base64,${btoa(L)});`;let n;if(!this.cssFontInfo)n=`@font-face {font-family:"${this.loadedName}";src:${j}}`;else{let t=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(t+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),n=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${t}src:${j}}`}return this._inspectFont?.(this,j),n}getPathGenerator(L,j){if(this.compiledGlyphs[j]!==void 0)return this.compiledGlyphs[j];let n;try{n=L.get(this.loadedName+"_path_"+j)}catch(t){if(!this.ignoreErrors)throw t;return(0,r.warn)(`getPathGenerator - ignoring character: "${t}".`),this.compiledGlyphs[j]=function(i,h){}}if(this.isEvalSupported&&r.FeatureTest.isEvalSupported){const t=[];for(const i of n){const h=i.args!==void 0?i.args.join(","):"";t.push("c.",i.cmd,"(",h,`);
`)}return this.compiledGlyphs[j]=new Function("c","size",t.join(""))}return this.compiledGlyphs[j]=function(t,i){for(const h of n)h.cmd==="scale"&&(h.args=[i,-i]),t[h.cmd].apply(t,h.args)}}}s.FontFaceObject=P}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.NodeStandardFontDataFactory=s.NodeFilterFactory=s.NodeCanvasFactory=s.NodeCMapReaderFactory=void 0;var r=y(7);y(1);const g=function(n){return new Promise((t,i)=>{require$$5.readFile(n,(l,e)=>{if(l||!e){i(new Error(l));return}t(new Uint8Array(e))})})};class P extends r.BaseFilterFactory{}s.NodeFilterFactory=P;class C extends r.BaseCanvasFactory{_createCanvas(t,i){return require$$5.createCanvas(t,i)}}s.NodeCanvasFactory=C;class L extends r.BaseCMapReaderFactory{_fetchData(t,i){return g(t).then(h=>({cMapData:h,compressionType:i}))}}s.NodeCMapReaderFactory=L;class j extends r.BaseStandardFontDataFactory{_fetchData(t){return g(t)}}s.NodeStandardFontDataFactory=j}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CanvasGraphics=void 0;var r=y(1),g=y(6),P=y(12),C=y(13);const L=16,j=100,n=4096,t=15,i=10,h=1e3,l=16;function e(b,c){if(b._removeMirroring)throw new Error("Context is already forwarding operations.");b.__originalSave=b.save,b.__originalRestore=b.restore,b.__originalRotate=b.rotate,b.__originalScale=b.scale,b.__originalTranslate=b.translate,b.__originalTransform=b.transform,b.__originalSetTransform=b.setTransform,b.__originalResetTransform=b.resetTransform,b.__originalClip=b.clip,b.__originalMoveTo=b.moveTo,b.__originalLineTo=b.lineTo,b.__originalBezierCurveTo=b.bezierCurveTo,b.__originalRect=b.rect,b.__originalClosePath=b.closePath,b.__originalBeginPath=b.beginPath,b._removeMirroring=()=>{b.save=b.__originalSave,b.restore=b.__originalRestore,b.rotate=b.__originalRotate,b.scale=b.__originalScale,b.translate=b.__originalTranslate,b.transform=b.__originalTransform,b.setTransform=b.__originalSetTransform,b.resetTransform=b.__originalResetTransform,b.clip=b.__originalClip,b.moveTo=b.__originalMoveTo,b.lineTo=b.__originalLineTo,b.bezierCurveTo=b.__originalBezierCurveTo,b.rect=b.__originalRect,b.closePath=b.__originalClosePath,b.beginPath=b.__originalBeginPath,delete b._removeMirroring},b.save=function(){c.save(),this.__originalSave()},b.restore=function(){c.restore(),this.__originalRestore()},b.translate=function(_,F){c.translate(_,F),this.__originalTranslate(_,F)},b.scale=function(_,F){c.scale(_,F),this.__originalScale(_,F)},b.transform=function(_,F,M,I,E,a){c.transform(_,F,M,I,E,a),this.__originalTransform(_,F,M,I,E,a)},b.setTransform=function(_,F,M,I,E,a){c.setTransform(_,F,M,I,E,a),this.__originalSetTransform(_,F,M,I,E,a)},b.resetTransform=function(){c.resetTransform(),this.__originalResetTransform()},b.rotate=function(_){c.rotate(_),this.__originalRotate(_)},b.clip=function(_){c.clip(_),this.__originalClip(_)},b.moveTo=function(d,_){c.moveTo(d,_),this.__originalMoveTo(d,_)},b.lineTo=function(d,_){c.lineTo(d,_),this.__originalLineTo(d,_)},b.bezierCurveTo=function(d,_,F,M,I,E){c.bezierCurveTo(d,_,F,M,I,E),this.__originalBezierCurveTo(d,_,F,M,I,E)},b.rect=function(d,_,F,M){c.rect(d,_,F,M),this.__originalRect(d,_,F,M)},b.closePath=function(){c.closePath(),this.__originalClosePath()},b.beginPath=function(){c.beginPath(),this.__originalBeginPath()}}class u{constructor(c){this.canvasFactory=c,this.cache=Object.create(null)}getCanvas(c,d,_){let F;return this.cache[c]!==void 0?(F=this.cache[c],this.canvasFactory.reset(F,d,_)):(F=this.canvasFactory.create(d,_),this.cache[c]=F),F}delete(c){delete this.cache[c]}clear(){for(const c in this.cache){const d=this.cache[c];this.canvasFactory.destroy(d),delete this.cache[c]}}}function p(b,c,d,_,F,M,I,E,a,m){const[A,x,k,N,U,q]=(0,g.getCurrentTransform)(b);if(x===0&&k===0){const Y=I*A+U,K=Math.round(Y),J=E*N+q,Z=Math.round(J),rt=(I+a)*A+U,ot=Math.abs(Math.round(rt)-K)||1,lt=(E+m)*N+q,ct=Math.abs(Math.round(lt)-Z)||1;return b.setTransform(Math.sign(A),0,0,Math.sign(N),K,Z),b.drawImage(c,d,_,F,M,0,0,ot,ct),b.setTransform(A,x,k,N,U,q),[ot,ct]}if(A===0&&N===0){const Y=E*k+U,K=Math.round(Y),J=I*x+q,Z=Math.round(J),rt=(E+m)*k+U,ot=Math.abs(Math.round(rt)-K)||1,lt=(I+a)*x+q,ct=Math.abs(Math.round(lt)-Z)||1;return b.setTransform(0,Math.sign(x),Math.sign(k),0,K,Z),b.drawImage(c,d,_,F,M,0,0,ct,ot),b.setTransform(A,x,k,N,U,q),[ct,ot]}b.drawImage(c,d,_,F,M,I,E,a,m);const st=Math.hypot(A,x),V=Math.hypot(k,N);return[st*a,V*m]}function o(b){const{width:c,height:d}=b;if(c>h||d>h)return null;const _=1e3,F=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),M=c+1;let I=new Uint8Array(M*(d+1)),E,a,m;const A=c+7&-8;let x=new Uint8Array(A*d),k=0;for(const V of b.data){let Y=128;for(;Y>0;)x[k++]=V&Y?0:255,Y>>=1}let N=0;for(k=0,x[k]!==0&&(I[0]=1,++N),a=1;a<c;a++)x[k]!==x[k+1]&&(I[a]=x[k]?2:1,++N),k++;for(x[k]!==0&&(I[a]=2,++N),E=1;E<d;E++){k=E*A,m=E*M,x[k-A]!==x[k]&&(I[m]=x[k]?1:8,++N);let V=(x[k]?4:0)+(x[k-A]?8:0);for(a=1;a<c;a++)V=(V>>2)+(x[k+1]?4:0)+(x[k-A+1]?8:0),F[V]&&(I[m+a]=F[V],++N),k++;if(x[k-A]!==x[k]&&(I[m+a]=x[k]?2:4,++N),N>_)return null}for(k=A*(d-1),m=E*M,x[k]!==0&&(I[m]=8,++N),a=1;a<c;a++)x[k]!==x[k+1]&&(I[m+a]=x[k]?4:8,++N),k++;if(x[k]!==0&&(I[m+a]=4,++N),N>_)return null;const U=new Int32Array([0,M,-1,0,-M,0,0,0,1]),q=new Path2D;for(E=0;N&&E<=d;E++){let V=E*M;const Y=V+c;for(;V<Y&&!I[V];)V++;if(V===Y)continue;q.moveTo(V%M,E);const K=V;let J=I[V];do{const Z=U[J];do V+=Z;while(!I[V]);const rt=I[V];rt!==5&&rt!==10?(J=rt,I[V]=0):(J=rt&51*J>>4,I[V]&=J>>2|J<<2),q.lineTo(V%M,V/M|0),I[V]||--N}while(K!==V);--E}return x=null,I=null,function(V){V.save(),V.scale(1/c,-1/d),V.translate(0,-d),V.fill(q),V.beginPath(),V.restore()}}class v{constructor(c,d){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=r.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=r.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=r.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,c,d])}clone(){const c=Object.create(this);return c.clipBox=this.clipBox.slice(),c}setCurrentPoint(c,d){this.x=c,this.y=d}updatePathMinMax(c,d,_){[d,_]=r.Util.applyTransform([d,_],c),this.minX=Math.min(this.minX,d),this.minY=Math.min(this.minY,_),this.maxX=Math.max(this.maxX,d),this.maxY=Math.max(this.maxY,_)}updateRectMinMax(c,d){const _=r.Util.applyTransform(d,c),F=r.Util.applyTransform(d.slice(2),c);this.minX=Math.min(this.minX,_[0],F[0]),this.minY=Math.min(this.minY,_[1],F[1]),this.maxX=Math.max(this.maxX,_[0],F[0]),this.maxY=Math.max(this.maxY,_[1],F[1])}updateScalingPathMinMax(c,d){r.Util.scaleMinMax(c,d),this.minX=Math.min(this.minX,d[0]),this.maxX=Math.max(this.maxX,d[1]),this.minY=Math.min(this.minY,d[2]),this.maxY=Math.max(this.maxY,d[3])}updateCurvePathMinMax(c,d,_,F,M,I,E,a,m,A){const x=r.Util.bezierBoundingBox(d,_,F,M,I,E,a,m);if(A){A[0]=Math.min(A[0],x[0],x[2]),A[1]=Math.max(A[1],x[0],x[2]),A[2]=Math.min(A[2],x[1],x[3]),A[3]=Math.max(A[3],x[1],x[3]);return}this.updateRectMinMax(c,x)}getPathBoundingBox(c=P.PathType.FILL,d=null){const _=[this.minX,this.minY,this.maxX,this.maxY];if(c===P.PathType.STROKE){d||(0,r.unreachable)("Stroke bounding box must include transform.");const F=r.Util.singularValueDecompose2dScale(d),M=F[0]*this.lineWidth/2,I=F[1]*this.lineWidth/2;_[0]-=M,_[1]-=I,_[2]+=M,_[3]+=I}return _}updateClipFromPath(){const c=r.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(c||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(c){this.clipBox=c,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(c=P.PathType.FILL,d=null){return r.Util.intersect(this.clipBox,this.getPathBoundingBox(c,d))}}function R(b,c){if(typeof ImageData<"u"&&c instanceof ImageData){b.putImageData(c,0,0);return}const d=c.height,_=c.width,F=d%l,M=(d-F)/l,I=F===0?M:M+1,E=b.createImageData(_,l);let a=0,m;const A=c.data,x=E.data;let k,N,U,q;if(c.kind===r.ImageKind.GRAYSCALE_1BPP){const st=A.byteLength,V=new Uint32Array(x.buffer,0,x.byteLength>>2),Y=V.length,K=_+7>>3,J=4294967295,Z=r.FeatureTest.isLittleEndian?4278190080:255;for(k=0;k<I;k++){for(U=k<M?l:F,m=0,N=0;N<U;N++){const rt=st-a;let ot=0;const lt=rt>K?_:rt*8-7,ct=lt&-8;let ht=0,ut=0;for(;ot<ct;ot+=8)ut=A[a++],V[m++]=ut&128?J:Z,V[m++]=ut&64?J:Z,V[m++]=ut&32?J:Z,V[m++]=ut&16?J:Z,V[m++]=ut&8?J:Z,V[m++]=ut&4?J:Z,V[m++]=ut&2?J:Z,V[m++]=ut&1?J:Z;for(;ot<lt;ot++)ht===0&&(ut=A[a++],ht=128),V[m++]=ut&ht?J:Z,ht>>=1}for(;m<Y;)V[m++]=0;b.putImageData(E,0,k*l)}}else if(c.kind===r.ImageKind.RGBA_32BPP){for(N=0,q=_*l*4,k=0;k<M;k++)x.set(A.subarray(a,a+q)),a+=q,b.putImageData(E,0,N),N+=l;k<I&&(q=_*F*4,x.set(A.subarray(a,a+q)),b.putImageData(E,0,N))}else if(c.kind===r.ImageKind.RGB_24BPP)for(U=l,q=_*U,k=0;k<I;k++){for(k>=M&&(U=F,q=_*U),m=0,N=q;N--;)x[m++]=A[a++],x[m++]=A[a++],x[m++]=A[a++],x[m++]=255;b.putImageData(E,0,k*l)}else throw new Error(`bad image kind: ${c.kind}`)}function T(b,c){if(c.bitmap){b.drawImage(c.bitmap,0,0);return}const d=c.height,_=c.width,F=d%l,M=(d-F)/l,I=F===0?M:M+1,E=b.createImageData(_,l);let a=0;const m=c.data,A=E.data;for(let x=0;x<I;x++){const k=x<M?l:F;({srcPos:a}=(0,C.convertBlackAndWhiteToRGBA)({src:m,srcPos:a,dest:A,width:_,height:k,nonBlackColor:0})),b.putImageData(E,0,x*l)}}function f(b,c){const d=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const _ of d)b[_]!==void 0&&(c[_]=b[_]);b.setLineDash!==void 0&&(c.setLineDash(b.getLineDash()),c.lineDashOffset=b.lineDashOffset)}function S(b){if(b.strokeStyle=b.fillStyle="#000000",b.fillRule="nonzero",b.globalAlpha=1,b.lineWidth=1,b.lineCap="butt",b.lineJoin="miter",b.miterLimit=10,b.globalCompositeOperation="source-over",b.font="10px sans-serif",b.setLineDash!==void 0&&(b.setLineDash([]),b.lineDashOffset=0),!r.isNodeJS){const{filter:c}=b;c!=="none"&&c!==""&&(b.filter="none")}}function B(b,c,d,_){const F=b.length;for(let M=3;M<F;M+=4){const I=b[M];if(I===0)b[M-3]=c,b[M-2]=d,b[M-1]=_;else if(I<255){const E=255-I;b[M-3]=b[M-3]*I+c*E>>8,b[M-2]=b[M-2]*I+d*E>>8,b[M-1]=b[M-1]*I+_*E>>8}}}function H(b,c,d){const _=b.length,F=1/255;for(let M=3;M<_;M+=4){const I=d?d[b[M]]:b[M];c[M]=c[M]*I*F|0}}function O(b,c,d){const _=b.length;for(let F=3;F<_;F+=4){const M=b[F-3]*77+b[F-2]*152+b[F-1]*28;c[F]=d?c[F]*d[M>>8]>>8:c[F]*M>>16}}function z(b,c,d,_,F,M,I,E,a,m,A){const x=!!M,k=x?M[0]:0,N=x?M[1]:0,U=x?M[2]:0,q=F==="Luminosity"?O:H,V=Math.min(_,Math.ceil(1048576/d));for(let Y=0;Y<_;Y+=V){const K=Math.min(V,_-Y),J=b.getImageData(E-m,Y+(a-A),d,K),Z=c.getImageData(E,Y+a,d,K);x&&B(J.data,k,N,U),q(J.data,Z.data,I),c.putImageData(Z,E,Y+a)}}function X(b,c,d,_){const F=_[0],M=_[1],I=_[2]-F,E=_[3]-M;I===0||E===0||(z(c.context,d,I,E,c.subtype,c.backdrop,c.transferMap,F,M,c.offsetX,c.offsetY),b.save(),b.globalAlpha=1,b.globalCompositeOperation="source-over",b.setTransform(1,0,0,1,0,0),b.drawImage(d.canvas,0,0),b.restore())}function it(b,c){const d=r.Util.singularValueDecompose2dScale(b);d[0]=Math.fround(d[0]),d[1]=Math.fround(d[1]);const _=Math.fround((globalThis.devicePixelRatio||1)*g.PixelsPerInch.PDF_TO_CSS_UNITS);return c!==void 0?c:d[0]<=_||d[1]<=_}const Q=["butt","round","square"],et=["miter","round","bevel"],nt={},$={};class D{constructor(c,d,_,F,M,{optionalContentConfig:I,markedContentStack:E=null},a,m){this.ctx=c,this.current=new v(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=d,this.objs=_,this.canvasFactory=F,this.filterFactory=M,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=E||[],this.optionalContentConfig=I,this.cachedCanvases=new u(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=a,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=m,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(c,d=null){return typeof c=="string"?c.startsWith("g_")?this.commonObjs.get(c):this.objs.get(c):d}beginDrawing({transform:c,viewport:d,transparency:_=!1,background:F=null}){const M=this.ctx.canvas.width,I=this.ctx.canvas.height,E=this.ctx.fillStyle;if(this.ctx.fillStyle=F||"#ffffff",this.ctx.fillRect(0,0,M,I),this.ctx.fillStyle=E,_){const a=this.cachedCanvases.getCanvas("transparent",M,I);this.compositeCtx=this.ctx,this.transparentCanvas=a.canvas,this.ctx=a.context,this.ctx.save(),this.ctx.transform(...(0,g.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),S(this.ctx),c&&(this.ctx.transform(...c),this.outputScaleX=c[0],this.outputScaleY=c[0]),this.ctx.transform(...d.transform),this.viewportScale=d.scale,this.baseTransform=(0,g.getCurrentTransform)(this.ctx)}executeOperatorList(c,d,_,F){const M=c.argsArray,I=c.fnArray;let E=d||0;const a=M.length;if(a===E)return E;const m=a-E>i&&typeof _=="function",A=m?Date.now()+t:0;let x=0;const k=this.commonObjs,N=this.objs;let U;for(;;){if(F!==void 0&&E===F.nextBreakPoint)return F.breakIt(E,_),E;if(U=I[E],U!==r.OPS.dependency)this[U].apply(this,M[E]);else for(const q of M[E]){const st=q.startsWith("g_")?k:N;if(!st.has(q))return st.get(q,_),E}if(E++,E===a)return E;if(m&&++x>i){if(Date.now()>A)return _(),E;x=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const c of this._cachedBitmapsMap.values()){for(const d of c.values())typeof HTMLCanvasElement<"u"&&d instanceof HTMLCanvasElement&&(d.width=d.height=0);c.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const c=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(c!=="none"){const d=this.ctx.filter;this.ctx.filter=c,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=d}}}_scaleImage(c,d){const _=c.width,F=c.height;let M=Math.max(Math.hypot(d[0],d[1]),1),I=Math.max(Math.hypot(d[2],d[3]),1),E=_,a=F,m="prescale1",A,x;for(;M>2&&E>1||I>2&&a>1;){let k=E,N=a;M>2&&E>1&&(k=E>=16384?Math.floor(E/2)-1||1:Math.ceil(E/2),M/=E/k),I>2&&a>1&&(N=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a)/2,I/=a/N),A=this.cachedCanvases.getCanvas(m,k,N),x=A.context,x.clearRect(0,0,k,N),x.drawImage(c,0,0,E,a,0,0,k,N),c=A.canvas,E=k,a=N,m=m==="prescale1"?"prescale2":"prescale1"}return{img:c,paintWidth:E,paintHeight:a}}_createMaskCanvas(c){const d=this.ctx,{width:_,height:F}=c,M=this.current.fillColor,I=this.current.patternFill,E=(0,g.getCurrentTransform)(d);let a,m,A,x;if((c.bitmap||c.data)&&c.count>1){const ot=c.bitmap||c.data.buffer;m=JSON.stringify(I?E:[E.slice(0,4),M]),a=this._cachedBitmapsMap.get(ot),a||(a=new Map,this._cachedBitmapsMap.set(ot,a));const lt=a.get(m);if(lt&&!I){const ct=Math.round(Math.min(E[0],E[2])+E[4]),ht=Math.round(Math.min(E[1],E[3])+E[5]);return{canvas:lt,offsetX:ct,offsetY:ht}}A=lt}A||(x=this.cachedCanvases.getCanvas("maskCanvas",_,F),T(x.context,c));let k=r.Util.transform(E,[1/_,0,0,-1/F,0,0]);k=r.Util.transform(k,[1,0,0,1,0,-F]);const N=r.Util.applyTransform([0,0],k),U=r.Util.applyTransform([_,F],k),q=r.Util.normalizeRect([N[0],N[1],U[0],U[1]]),st=Math.round(q[2]-q[0])||1,V=Math.round(q[3]-q[1])||1,Y=this.cachedCanvases.getCanvas("fillCanvas",st,V),K=Y.context,J=Math.min(N[0],U[0]),Z=Math.min(N[1],U[1]);K.translate(-J,-Z),K.transform(...k),A||(A=this._scaleImage(x.canvas,(0,g.getCurrentTransformInverse)(K)),A=A.img,a&&I&&a.set(m,A)),K.imageSmoothingEnabled=it((0,g.getCurrentTransform)(K),c.interpolate),p(K,A,0,0,A.width,A.height,0,0,_,F),K.globalCompositeOperation="source-in";const rt=r.Util.transform((0,g.getCurrentTransformInverse)(K),[1,0,0,1,-J,-Z]);return K.fillStyle=I?M.getPattern(d,this,rt,P.PathType.FILL):M,K.fillRect(0,0,_,F),a&&!I&&(this.cachedCanvases.delete("fillCanvas"),a.set(m,Y.canvas)),{canvas:Y.canvas,offsetX:Math.round(J),offsetY:Math.round(Z)}}setLineWidth(c){c!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=c,this.ctx.lineWidth=c}setLineCap(c){this.ctx.lineCap=Q[c]}setLineJoin(c){this.ctx.lineJoin=et[c]}setMiterLimit(c){this.ctx.miterLimit=c}setDash(c,d){const _=this.ctx;_.setLineDash!==void 0&&(_.setLineDash(c),_.lineDashOffset=d)}setRenderingIntent(c){}setFlatness(c){}setGState(c){for(const[d,_]of c)switch(d){case"LW":this.setLineWidth(_);break;case"LC":this.setLineCap(_);break;case"LJ":this.setLineJoin(_);break;case"ML":this.setMiterLimit(_);break;case"D":this.setDash(_[0],_[1]);break;case"RI":this.setRenderingIntent(_);break;case"FL":this.setFlatness(_);break;case"Font":this.setFont(_[0],_[1]);break;case"CA":this.current.strokeAlpha=_;break;case"ca":this.current.fillAlpha=_,this.ctx.globalAlpha=_;break;case"BM":this.ctx.globalCompositeOperation=_;break;case"SMask":this.current.activeSMask=_?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(_);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const c=this.inSMaskMode;this.current.activeSMask&&!c?this.beginSMaskMode():!this.current.activeSMask&&c&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const c=this.ctx.canvas.width,d=this.ctx.canvas.height,_="smaskGroupAt"+this.groupLevel,F=this.cachedCanvases.getCanvas(_,c,d);this.suspendedCtx=this.ctx,this.ctx=F.context;const M=this.ctx;M.setTransform(...(0,g.getCurrentTransform)(this.suspendedCtx)),f(this.suspendedCtx,M),e(M,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),f(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(c){if(!this.current.activeSMask)return;c?(c[0]=Math.floor(c[0]),c[1]=Math.floor(c[1]),c[2]=Math.ceil(c[2]),c[3]=Math.ceil(c[3])):c=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const d=this.current.activeSMask,_=this.suspendedCtx;X(_,d,this.ctx,c),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(f(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const c=this.current;this.stateStack.push(c),this.current=c.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),f(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(c,d,_,F,M,I){this.ctx.transform(c,d,_,F,M,I),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(c,d,_){const F=this.ctx,M=this.current;let I=M.x,E=M.y,a,m;const A=(0,g.getCurrentTransform)(F),x=A[0]===0&&A[3]===0||A[1]===0&&A[2]===0,k=x?_.slice(0):null;for(let N=0,U=0,q=c.length;N<q;N++)switch(c[N]|0){case r.OPS.rectangle:I=d[U++],E=d[U++];const st=d[U++],V=d[U++],Y=I+st,K=E+V;F.moveTo(I,E),st===0||V===0?F.lineTo(Y,K):(F.lineTo(Y,E),F.lineTo(Y,K),F.lineTo(I,K)),x||M.updateRectMinMax(A,[I,E,Y,K]),F.closePath();break;case r.OPS.moveTo:I=d[U++],E=d[U++],F.moveTo(I,E),x||M.updatePathMinMax(A,I,E);break;case r.OPS.lineTo:I=d[U++],E=d[U++],F.lineTo(I,E),x||M.updatePathMinMax(A,I,E);break;case r.OPS.curveTo:a=I,m=E,I=d[U+4],E=d[U+5],F.bezierCurveTo(d[U],d[U+1],d[U+2],d[U+3],I,E),M.updateCurvePathMinMax(A,a,m,d[U],d[U+1],d[U+2],d[U+3],I,E,k),U+=6;break;case r.OPS.curveTo2:a=I,m=E,F.bezierCurveTo(I,E,d[U],d[U+1],d[U+2],d[U+3]),M.updateCurvePathMinMax(A,a,m,I,E,d[U],d[U+1],d[U+2],d[U+3],k),I=d[U+2],E=d[U+3],U+=4;break;case r.OPS.curveTo3:a=I,m=E,I=d[U+2],E=d[U+3],F.bezierCurveTo(d[U],d[U+1],I,E,I,E),M.updateCurvePathMinMax(A,a,m,d[U],d[U+1],I,E,I,E,k),U+=4;break;case r.OPS.closePath:F.closePath();break}x&&M.updateScalingPathMinMax(A,k),M.setCurrentPoint(I,E)}closePath(){this.ctx.closePath()}stroke(c=!0){const d=this.ctx,_=this.current.strokeColor;d.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof _=="object"&&_?.getPattern?(d.save(),d.strokeStyle=_.getPattern(d,this,(0,g.getCurrentTransformInverse)(d),P.PathType.STROKE),this.rescaleAndStroke(!1),d.restore()):this.rescaleAndStroke(!0)),c&&this.consumePath(this.current.getClippedPathBoundingBox()),d.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(c=!0){const d=this.ctx,_=this.current.fillColor,F=this.current.patternFill;let M=!1;F&&(d.save(),d.fillStyle=_.getPattern(d,this,(0,g.getCurrentTransformInverse)(d),P.PathType.FILL),M=!0);const I=this.current.getClippedPathBoundingBox();this.contentVisible&&I!==null&&(this.pendingEOFill?(d.fill("evenodd"),this.pendingEOFill=!1):d.fill()),M&&d.restore(),c&&this.consumePath(I)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=nt}eoClip(){this.pendingClip=$}beginText(){this.current.textMatrix=r.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const c=this.pendingTextPaths,d=this.ctx;if(c===void 0){d.beginPath();return}d.save(),d.beginPath();for(const _ of c)d.setTransform(..._.transform),d.translate(_.x,_.y),_.addToPath(d,_.fontSize);d.restore(),d.clip(),d.beginPath(),delete this.pendingTextPaths}setCharSpacing(c){this.current.charSpacing=c}setWordSpacing(c){this.current.wordSpacing=c}setHScale(c){this.current.textHScale=c/100}setLeading(c){this.current.leading=-c}setFont(c,d){const _=this.commonObjs.get(c),F=this.current;if(!_)throw new Error(`Can't find font for ${c}`);if(F.fontMatrix=_.fontMatrix||r.FONT_IDENTITY_MATRIX,(F.fontMatrix[0]===0||F.fontMatrix[3]===0)&&(0,r.warn)("Invalid font matrix for font "+c),d<0?(d=-d,F.fontDirection=-1):F.fontDirection=1,this.current.font=_,this.current.fontSize=d,_.isType3Font)return;const M=_.loadedName||"sans-serif",I=_.systemFontInfo?.css||`"${M}", ${_.fallbackName}`;let E="normal";_.black?E="900":_.bold&&(E="bold");const a=_.italic?"italic":"normal";let m=d;d<L?m=L:d>j&&(m=j),this.current.fontSizeScale=d/m,this.ctx.font=`${a} ${E} ${m}px ${I}`}setTextRenderingMode(c){this.current.textRenderingMode=c}setTextRise(c){this.current.textRise=c}moveText(c,d){this.current.x=this.current.lineX+=c,this.current.y=this.current.lineY+=d}setLeadingMoveText(c,d){this.setLeading(-d),this.moveText(c,d)}setTextMatrix(c,d,_,F,M,I){this.current.textMatrix=[c,d,_,F,M,I],this.current.textMatrixScale=Math.hypot(c,d),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(c,d,_,F){const M=this.ctx,I=this.current,E=I.font,a=I.textRenderingMode,m=I.fontSize/I.fontSizeScale,A=a&r.TextRenderingMode.FILL_STROKE_MASK,x=!!(a&r.TextRenderingMode.ADD_TO_PATH_FLAG),k=I.patternFill&&!E.missingFile;let N;(E.disableFontFace||x||k)&&(N=E.getPathGenerator(this.commonObjs,c)),E.disableFontFace||k?(M.save(),M.translate(d,_),M.beginPath(),N(M,m),F&&M.setTransform(...F),(A===r.TextRenderingMode.FILL||A===r.TextRenderingMode.FILL_STROKE)&&M.fill(),(A===r.TextRenderingMode.STROKE||A===r.TextRenderingMode.FILL_STROKE)&&M.stroke(),M.restore()):((A===r.TextRenderingMode.FILL||A===r.TextRenderingMode.FILL_STROKE)&&M.fillText(c,d,_),(A===r.TextRenderingMode.STROKE||A===r.TextRenderingMode.FILL_STROKE)&&M.strokeText(c,d,_)),x&&(this.pendingTextPaths||=[]).push({transform:(0,g.getCurrentTransform)(M),x:d,y:_,fontSize:m,addToPath:N})}get isFontSubpixelAAEnabled(){const{context:c}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);c.scale(1.5,1),c.fillText("I",0,10);const d=c.getImageData(0,0,10,10).data;let _=!1;for(let F=3;F<d.length;F+=4)if(d[F]>0&&d[F]<255){_=!0;break}return(0,r.shadow)(this,"isFontSubpixelAAEnabled",_)}showText(c){const d=this.current,_=d.font;if(_.isType3Font)return this.showType3Text(c);const F=d.fontSize;if(F===0)return;const M=this.ctx,I=d.fontSizeScale,E=d.charSpacing,a=d.wordSpacing,m=d.fontDirection,A=d.textHScale*m,x=c.length,k=_.vertical,N=k?1:-1,U=_.defaultVMetrics,q=F*d.fontMatrix[0],st=d.textRenderingMode===r.TextRenderingMode.FILL&&!_.disableFontFace&&!d.patternFill;M.save(),M.transform(...d.textMatrix),M.translate(d.x,d.y+d.textRise),m>0?M.scale(A,-1):M.scale(A,1);let V;if(d.patternFill){M.save();const rt=d.fillColor.getPattern(M,this,(0,g.getCurrentTransformInverse)(M),P.PathType.FILL);V=(0,g.getCurrentTransform)(M),M.restore(),M.fillStyle=rt}let Y=d.lineWidth;const K=d.textMatrixScale;if(K===0||Y===0){const rt=d.textRenderingMode&r.TextRenderingMode.FILL_STROKE_MASK;(rt===r.TextRenderingMode.STROKE||rt===r.TextRenderingMode.FILL_STROKE)&&(Y=this.getSinglePixelWidth())}else Y/=K;if(I!==1&&(M.scale(I,I),Y/=I),M.lineWidth=Y,_.isInvalidPDFjsFont){const rt=[];let ot=0;for(const lt of c)rt.push(lt.unicode),ot+=lt.width;M.fillText(rt.join(""),0,0),d.x+=ot*q*A,M.restore(),this.compose();return}let J=0,Z;for(Z=0;Z<x;++Z){const rt=c[Z];if(typeof rt=="number"){J+=N*rt*F/1e3;continue}let ot=!1;const lt=(rt.isSpace?a:0)+E,ct=rt.fontChar,ht=rt.accent;let ut,At,mt=rt.width;if(k){const bt=rt.vmetric||U,vt=-(rt.vmetric?bt[1]:mt*.5)*q,Dt=bt[2]*q;mt=bt?-bt[0]:mt,ut=vt/I,At=(J+Dt)/I}else ut=J/I,At=0;if(_.remeasure&&mt>0){const bt=M.measureText(ct).width*1e3/F*I;if(mt<bt&&this.isFontSubpixelAAEnabled){const vt=mt/bt;ot=!0,M.save(),M.scale(vt,1),ut/=vt}else mt!==bt&&(ut+=(mt-bt)/2e3*F/I)}if(this.contentVisible&&(rt.isInFont||_.missingFile)){if(st&&!ht)M.fillText(ct,ut,At);else if(this.paintChar(ct,ut,At,V),ht){const bt=ut+F*ht.offset.x/I,vt=At-F*ht.offset.y/I;this.paintChar(ht.fontChar,bt,vt,V)}}const xt=k?mt*q-lt*m:mt*q+lt*m;J+=xt,ot&&M.restore()}k?d.y-=J:d.x+=J*A,M.restore(),this.compose()}showType3Text(c){const d=this.ctx,_=this.current,F=_.font,M=_.fontSize,I=_.fontDirection,E=F.vertical?1:-1,a=_.charSpacing,m=_.wordSpacing,A=_.textHScale*I,x=_.fontMatrix||r.FONT_IDENTITY_MATRIX,k=c.length,N=_.textRenderingMode===r.TextRenderingMode.INVISIBLE;let U,q,st,V;if(!(N||M===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,d.save(),d.transform(..._.textMatrix),d.translate(_.x,_.y),d.scale(A,I),U=0;U<k;++U){if(q=c[U],typeof q=="number"){V=E*q*M/1e3,this.ctx.translate(V,0),_.x+=V*A;continue}const Y=(q.isSpace?m:0)+a,K=F.charProcOperatorList[q.operatorListId];if(!K){(0,r.warn)(`Type3 character "${q.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=q,this.save(),d.scale(M,M),d.transform(...x),this.executeOperatorList(K),this.restore()),st=r.Util.applyTransform([q.width,0],x)[0]*M+Y,d.translate(st,0),_.x+=st*A}d.restore(),this.processingType3=null}}setCharWidth(c,d){}setCharWidthAndBounds(c,d,_,F,M,I){this.ctx.rect(_,F,M-_,I-F),this.ctx.clip(),this.endPath()}getColorN_Pattern(c){let d;if(c[0]==="TilingPattern"){const _=c[1],F=this.baseTransform||(0,g.getCurrentTransform)(this.ctx),M={createCanvasGraphics:I=>new D(I,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};d=new P.TilingPattern(c,_,this.ctx,M,F)}else d=this._getPattern(c[1],c[2]);return d}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(c,d,_){const F=r.Util.makeHexColor(c,d,_);this.ctx.strokeStyle=F,this.current.strokeColor=F}setFillRGBColor(c,d,_){const F=r.Util.makeHexColor(c,d,_);this.ctx.fillStyle=F,this.current.fillColor=F,this.current.patternFill=!1}_getPattern(c,d=null){let _;return this.cachedPatterns.has(c)?_=this.cachedPatterns.get(c):(_=(0,P.getShadingPattern)(this.getObject(c)),this.cachedPatterns.set(c,_)),d&&(_.matrix=d),_}shadingFill(c){if(!this.contentVisible)return;const d=this.ctx;this.save();const _=this._getPattern(c);d.fillStyle=_.getPattern(d,this,(0,g.getCurrentTransformInverse)(d),P.PathType.SHADING);const F=(0,g.getCurrentTransformInverse)(d);if(F){const{width:M,height:I}=d.canvas,[E,a,m,A]=r.Util.getAxialAlignedBoundingBox([0,0,M,I],F);this.ctx.fillRect(E,a,m-E,A-a)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,r.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,r.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(c,d){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(c)&&c.length===6&&this.transform(...c),this.baseTransform=(0,g.getCurrentTransform)(this.ctx),d)){const _=d[2]-d[0],F=d[3]-d[1];this.ctx.rect(d[0],d[1],_,F),this.current.updateRectMinMax((0,g.getCurrentTransform)(this.ctx),d),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(c){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const d=this.ctx;c.isolated||(0,r.info)("TODO: Support non-isolated groups."),c.knockout&&(0,r.warn)("Knockout groups not supported.");const _=(0,g.getCurrentTransform)(d);if(c.matrix&&d.transform(...c.matrix),!c.bbox)throw new Error("Bounding box is required.");let F=r.Util.getAxialAlignedBoundingBox(c.bbox,(0,g.getCurrentTransform)(d));const M=[0,0,d.canvas.width,d.canvas.height];F=r.Util.intersect(F,M)||[0,0,0,0];const I=Math.floor(F[0]),E=Math.floor(F[1]);let a=Math.max(Math.ceil(F[2])-I,1),m=Math.max(Math.ceil(F[3])-E,1),A=1,x=1;a>n&&(A=a/n,a=n),m>n&&(x=m/n,m=n),this.current.startNewPathAndClipBox([0,0,a,m]);let k="groupAt"+this.groupLevel;c.smask&&(k+="_smask_"+this.smaskCounter++%2);const N=this.cachedCanvases.getCanvas(k,a,m),U=N.context;U.scale(1/A,1/x),U.translate(-I,-E),U.transform(..._),c.smask?this.smaskStack.push({canvas:N.canvas,context:U,offsetX:I,offsetY:E,scaleX:A,scaleY:x,subtype:c.smask.subtype,backdrop:c.smask.backdrop,transferMap:c.smask.transferMap||null,startTransformInverse:null}):(d.setTransform(1,0,0,1,0,0),d.translate(I,E),d.scale(A,x),d.save()),f(d,U),this.ctx=U,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(d),this.groupLevel++}endGroup(c){if(!this.contentVisible)return;this.groupLevel--;const d=this.ctx,_=this.groupStack.pop();if(this.ctx=_,this.ctx.imageSmoothingEnabled=!1,c.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const F=(0,g.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...F);const M=r.Util.getAxialAlignedBoundingBox([0,0,d.canvas.width,d.canvas.height],F);this.ctx.drawImage(d.canvas,0,0),this.ctx.restore(),this.compose(M)}}beginAnnotation(c,d,_,F,M){if(this.#t(),S(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(d)&&d.length===4){const I=d[2]-d[0],E=d[3]-d[1];if(M&&this.annotationCanvasMap){_=_.slice(),_[4]-=d[0],_[5]-=d[1],d=d.slice(),d[0]=d[1]=0,d[2]=I,d[3]=E;const[a,m]=r.Util.singularValueDecompose2dScale((0,g.getCurrentTransform)(this.ctx)),{viewportScale:A}=this,x=Math.ceil(I*this.outputScaleX*A),k=Math.ceil(E*this.outputScaleY*A);this.annotationCanvas=this.canvasFactory.create(x,k);const{canvas:N,context:U}=this.annotationCanvas;this.annotationCanvasMap.set(c,N),this.annotationCanvas.savedCtx=this.ctx,this.ctx=U,this.ctx.save(),this.ctx.setTransform(a,0,0,-m,0,E*m),S(this.ctx)}else S(this.ctx),this.ctx.rect(d[0],d[1],I,E),this.ctx.clip(),this.endPath()}this.current=new v(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(..._),this.transform(...F)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(c){if(!this.contentVisible)return;const d=c.count;c=this.getObject(c.data,c),c.count=d;const _=this.ctx,F=this.processingType3;if(F&&(F.compiled===void 0&&(F.compiled=o(c)),F.compiled)){F.compiled(_);return}const M=this._createMaskCanvas(c),I=M.canvas;_.save(),_.setTransform(1,0,0,1,0,0),_.drawImage(I,M.offsetX,M.offsetY),_.restore(),this.compose()}paintImageMaskXObjectRepeat(c,d,_=0,F=0,M,I){if(!this.contentVisible)return;c=this.getObject(c.data,c);const E=this.ctx;E.save();const a=(0,g.getCurrentTransform)(E);E.transform(d,_,F,M,0,0);const m=this._createMaskCanvas(c);E.setTransform(1,0,0,1,m.offsetX-a[4],m.offsetY-a[5]);for(let A=0,x=I.length;A<x;A+=2){const k=r.Util.transform(a,[d,_,F,M,I[A],I[A+1]]),[N,U]=r.Util.applyTransform([0,0],k);E.drawImage(m.canvas,N,U)}E.restore(),this.compose()}paintImageMaskXObjectGroup(c){if(!this.contentVisible)return;const d=this.ctx,_=this.current.fillColor,F=this.current.patternFill;for(const M of c){const{data:I,width:E,height:a,transform:m}=M,A=this.cachedCanvases.getCanvas("maskCanvas",E,a),x=A.context;x.save();const k=this.getObject(I,M);T(x,k),x.globalCompositeOperation="source-in",x.fillStyle=F?_.getPattern(x,this,(0,g.getCurrentTransformInverse)(d),P.PathType.FILL):_,x.fillRect(0,0,E,a),x.restore(),d.save(),d.transform(...m),d.scale(1,-1),p(d,A.canvas,0,0,E,a,0,-1,1,1),d.restore()}this.compose()}paintImageXObject(c){if(!this.contentVisible)return;const d=this.getObject(c);if(!d){(0,r.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(d)}paintImageXObjectRepeat(c,d,_,F){if(!this.contentVisible)return;const M=this.getObject(c);if(!M){(0,r.warn)("Dependent image isn't ready yet");return}const I=M.width,E=M.height,a=[];for(let m=0,A=F.length;m<A;m+=2)a.push({transform:[d,0,0,_,F[m],F[m+1]],x:0,y:0,w:I,h:E});this.paintInlineImageXObjectGroup(M,a)}applyTransferMapsToCanvas(c){return this.current.transferMaps!=="none"&&(c.filter=this.current.transferMaps,c.drawImage(c.canvas,0,0),c.filter="none"),c.canvas}applyTransferMapsToBitmap(c){if(this.current.transferMaps==="none")return c.bitmap;const{bitmap:d,width:_,height:F}=c,M=this.cachedCanvases.getCanvas("inlineImage",_,F),I=M.context;return I.filter=this.current.transferMaps,I.drawImage(d,0,0),I.filter="none",M.canvas}paintInlineImageXObject(c){if(!this.contentVisible)return;const d=c.width,_=c.height,F=this.ctx;if(this.save(),!r.isNodeJS){const{filter:E}=F;E!=="none"&&E!==""&&(F.filter="none")}F.scale(1/d,-1/_);let M;if(c.bitmap)M=this.applyTransferMapsToBitmap(c);else if(typeof HTMLElement=="function"&&c instanceof HTMLElement||!c.data)M=c;else{const a=this.cachedCanvases.getCanvas("inlineImage",d,_).context;R(a,c),M=this.applyTransferMapsToCanvas(a)}const I=this._scaleImage(M,(0,g.getCurrentTransformInverse)(F));F.imageSmoothingEnabled=it((0,g.getCurrentTransform)(F),c.interpolate),p(F,I.img,0,0,I.paintWidth,I.paintHeight,0,-_,d,_),this.compose(),this.restore()}paintInlineImageXObjectGroup(c,d){if(!this.contentVisible)return;const _=this.ctx;let F;if(c.bitmap)F=c.bitmap;else{const M=c.width,I=c.height,a=this.cachedCanvases.getCanvas("inlineImage",M,I).context;R(a,c),F=this.applyTransferMapsToCanvas(a)}for(const M of d)_.save(),_.transform(...M.transform),_.scale(1,-1),p(_,F,M.x,M.y,M.w,M.h,0,-1,1,1),_.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(c){}markPointProps(c,d){}beginMarkedContent(c){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(c,d){c==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(d)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(c){const d=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(c);const _=this.ctx;this.pendingClip&&(d||(this.pendingClip===$?_.clip("evenodd"):_.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),_.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const c=(0,g.getCurrentTransform)(this.ctx);if(c[1]===0&&c[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(c[0]),Math.abs(c[3]));else{const d=Math.abs(c[0]*c[3]-c[2]*c[1]),_=Math.hypot(c[0],c[2]),F=Math.hypot(c[1],c[3]);this._cachedGetSinglePixelWidth=Math.max(_,F)/d}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:c}=this.current,{a:d,b:_,c:F,d:M}=this.ctx.getTransform();let I,E;if(_===0&&F===0){const a=Math.abs(d),m=Math.abs(M);if(a===m)if(c===0)I=E=1/a;else{const A=a*c;I=E=A<1?1/A:1}else if(c===0)I=1/a,E=1/m;else{const A=a*c,x=m*c;I=A<1?1/A:1,E=x<1?1/x:1}}else{const a=Math.abs(d*M-_*F),m=Math.hypot(d,_),A=Math.hypot(F,M);if(c===0)I=A/a,E=m/a;else{const x=c*a;I=A>x?A/x:1,E=m>x?m/x:1}}this._cachedScaleForStroking[0]=I,this._cachedScaleForStroking[1]=E}return this._cachedScaleForStroking}rescaleAndStroke(c){const{ctx:d}=this,{lineWidth:_}=this.current,[F,M]=this.getScaleForStroking();if(d.lineWidth=_||1,F===1&&M===1){d.stroke();return}const I=d.getLineDash();if(c&&d.save(),d.scale(F,M),I.length>0){const E=Math.max(F,M);d.setLineDash(I.map(a=>a/E)),d.lineDashOffset/=E}d.stroke(),c&&d.restore()}isContentVisible(){for(let c=this.markedContentStack.length-1;c>=0;c--)if(!this.markedContentStack[c].visible)return!1;return!0}}s.CanvasGraphics=D;for(const b in r.OPS)D.prototype[b]!==void 0&&(D.prototype[r.OPS[b]]=D.prototype[b])}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.TilingPattern=s.PathType=void 0,s.getShadingPattern=l;var r=y(1),g=y(6);const P={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};s.PathType=P;function C(p,o){if(!o)return;const v=o[2]-o[0],R=o[3]-o[1],T=new Path2D;T.rect(o[0],o[1],v,R),p.clip(T)}class L{constructor(){this.constructor===L&&(0,r.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,r.unreachable)("Abstract method `getPattern` called.")}}class j extends L{constructor(o){super(),this._type=o[1],this._bbox=o[2],this._colorStops=o[3],this._p0=o[4],this._p1=o[5],this._r0=o[6],this._r1=o[7],this.matrix=null}_createGradient(o){let v;this._type==="axial"?v=o.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(v=o.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const R of this._colorStops)v.addColorStop(R[0],R[1]);return v}getPattern(o,v,R,T){let f;if(T===P.STROKE||T===P.FILL){const S=v.current.getClippedPathBoundingBox(T,(0,g.getCurrentTransform)(o))||[0,0,0,0],B=Math.ceil(S[2]-S[0])||1,H=Math.ceil(S[3]-S[1])||1,O=v.cachedCanvases.getCanvas("pattern",B,H,!0),z=O.context;z.clearRect(0,0,z.canvas.width,z.canvas.height),z.beginPath(),z.rect(0,0,z.canvas.width,z.canvas.height),z.translate(-S[0],-S[1]),R=r.Util.transform(R,[1,0,0,1,S[0],S[1]]),z.transform(...v.baseTransform),this.matrix&&z.transform(...this.matrix),C(z,this._bbox),z.fillStyle=this._createGradient(z),z.fill(),f=o.createPattern(O.canvas,"no-repeat");const X=new DOMMatrix(R);f.setTransform(X)}else C(o,this._bbox),f=this._createGradient(o);return f}}function n(p,o,v,R,T,f,S,B){const H=o.coords,O=o.colors,z=p.data,X=p.width*4;let it;H[v+1]>H[R+1]&&(it=v,v=R,R=it,it=f,f=S,S=it),H[R+1]>H[T+1]&&(it=R,R=T,T=it,it=S,S=B,B=it),H[v+1]>H[R+1]&&(it=v,v=R,R=it,it=f,f=S,S=it);const Q=(H[v]+o.offsetX)*o.scaleX,et=(H[v+1]+o.offsetY)*o.scaleY,nt=(H[R]+o.offsetX)*o.scaleX,$=(H[R+1]+o.offsetY)*o.scaleY,D=(H[T]+o.offsetX)*o.scaleX,b=(H[T+1]+o.offsetY)*o.scaleY;if(et>=b)return;const c=O[f],d=O[f+1],_=O[f+2],F=O[S],M=O[S+1],I=O[S+2],E=O[B],a=O[B+1],m=O[B+2],A=Math.round(et),x=Math.round(b);let k,N,U,q,st,V,Y,K;for(let J=A;J<=x;J++){if(J<$){const ct=J<et?0:(et-J)/(et-$);k=Q-(Q-nt)*ct,N=c-(c-F)*ct,U=d-(d-M)*ct,q=_-(_-I)*ct}else{let ct;J>b?ct=1:$===b?ct=0:ct=($-J)/($-b),k=nt-(nt-D)*ct,N=F-(F-E)*ct,U=M-(M-a)*ct,q=I-(I-m)*ct}let Z;J<et?Z=0:J>b?Z=1:Z=(et-J)/(et-b),st=Q-(Q-D)*Z,V=c-(c-E)*Z,Y=d-(d-a)*Z,K=_-(_-m)*Z;const rt=Math.round(Math.min(k,st)),ot=Math.round(Math.max(k,st));let lt=X*J+rt*4;for(let ct=rt;ct<=ot;ct++)Z=(k-ct)/(k-st),Z<0?Z=0:Z>1&&(Z=1),z[lt++]=N-(N-V)*Z|0,z[lt++]=U-(U-Y)*Z|0,z[lt++]=q-(q-K)*Z|0,z[lt++]=255}}function t(p,o,v){const R=o.coords,T=o.colors;let f,S;switch(o.type){case"lattice":const B=o.verticesPerRow,H=Math.floor(R.length/B)-1,O=B-1;for(f=0;f<H;f++){let z=f*B;for(let X=0;X<O;X++,z++)n(p,v,R[z],R[z+1],R[z+B],T[z],T[z+1],T[z+B]),n(p,v,R[z+B+1],R[z+1],R[z+B],T[z+B+1],T[z+1],T[z+B])}break;case"triangles":for(f=0,S=R.length;f<S;f+=3)n(p,v,R[f],R[f+1],R[f+2],T[f],T[f+1],T[f+2]);break;default:throw new Error("illegal figure")}}class i extends L{constructor(o){super(),this._coords=o[2],this._colors=o[3],this._figures=o[4],this._bounds=o[5],this._bbox=o[7],this._background=o[8],this.matrix=null}_createMeshCanvas(o,v,R){const B=Math.floor(this._bounds[0]),H=Math.floor(this._bounds[1]),O=Math.ceil(this._bounds[2])-B,z=Math.ceil(this._bounds[3])-H,X=Math.min(Math.ceil(Math.abs(O*o[0]*1.1)),3e3),it=Math.min(Math.ceil(Math.abs(z*o[1]*1.1)),3e3),Q=O/X,et=z/it,nt={coords:this._coords,colors:this._colors,offsetX:-B,offsetY:-H,scaleX:1/Q,scaleY:1/et},$=X+4,D=it+4,b=R.getCanvas("mesh",$,D,!1),c=b.context,d=c.createImageData(X,it);if(v){const F=d.data;for(let M=0,I=F.length;M<I;M+=4)F[M]=v[0],F[M+1]=v[1],F[M+2]=v[2],F[M+3]=255}for(const F of this._figures)t(d,F,nt);return c.putImageData(d,2,2),{canvas:b.canvas,offsetX:B-2*Q,offsetY:H-2*et,scaleX:Q,scaleY:et}}getPattern(o,v,R,T){C(o,this._bbox);let f;if(T===P.SHADING)f=r.Util.singularValueDecompose2dScale((0,g.getCurrentTransform)(o));else if(f=r.Util.singularValueDecompose2dScale(v.baseTransform),this.matrix){const B=r.Util.singularValueDecompose2dScale(this.matrix);f=[f[0]*B[0],f[1]*B[1]]}const S=this._createMeshCanvas(f,T===P.SHADING?null:this._background,v.cachedCanvases);return T!==P.SHADING&&(o.setTransform(...v.baseTransform),this.matrix&&o.transform(...this.matrix)),o.translate(S.offsetX,S.offsetY),o.scale(S.scaleX,S.scaleY),o.createPattern(S.canvas,"no-repeat")}}class h extends L{getPattern(){return"hotpink"}}function l(p){switch(p[0]){case"RadialAxial":return new j(p);case"Mesh":return new i(p);case"Dummy":return new h}throw new Error(`Unknown IR type: ${p[0]}`)}const e={COLORED:1,UNCOLORED:2};class u{static MAX_PATTERN_SIZE=3e3;constructor(o,v,R,T,f){this.operatorList=o[2],this.matrix=o[3]||[1,0,0,1,0,0],this.bbox=o[4],this.xstep=o[5],this.ystep=o[6],this.paintType=o[7],this.tilingType=o[8],this.color=v,this.ctx=R,this.canvasGraphicsFactory=T,this.baseTransform=f}createPatternCanvas(o){const v=this.operatorList,R=this.bbox,T=this.xstep,f=this.ystep,S=this.paintType,B=this.tilingType,H=this.color,O=this.canvasGraphicsFactory;(0,r.info)("TilingType: "+B);const z=R[0],X=R[1],it=R[2],Q=R[3],et=r.Util.singularValueDecompose2dScale(this.matrix),nt=r.Util.singularValueDecompose2dScale(this.baseTransform),$=[et[0]*nt[0],et[1]*nt[1]],D=this.getSizeAndScale(T,this.ctx.canvas.width,$[0]),b=this.getSizeAndScale(f,this.ctx.canvas.height,$[1]),c=o.cachedCanvases.getCanvas("pattern",D.size,b.size,!0),d=c.context,_=O.createCanvasGraphics(d);_.groupLevel=o.groupLevel,this.setFillAndStrokeStyleToContext(_,S,H);let F=z,M=X,I=it,E=Q;return z<0&&(F=0,I+=Math.abs(z)),X<0&&(M=0,E+=Math.abs(X)),d.translate(-(D.scale*F),-(b.scale*M)),_.transform(D.scale,0,0,b.scale,0,0),d.save(),this.clipBbox(_,F,M,I,E),_.baseTransform=(0,g.getCurrentTransform)(_.ctx),_.executeOperatorList(v),_.endDrawing(),{canvas:c.canvas,scaleX:D.scale,scaleY:b.scale,offsetX:F,offsetY:M}}getSizeAndScale(o,v,R){o=Math.abs(o);const T=Math.max(u.MAX_PATTERN_SIZE,v);let f=Math.ceil(o*R);return f>=T?f=T:R=f/o,{scale:R,size:f}}clipBbox(o,v,R,T,f){const S=T-v,B=f-R;o.ctx.rect(v,R,S,B),o.current.updateRectMinMax((0,g.getCurrentTransform)(o.ctx),[v,R,T,f]),o.clip(),o.endPath()}setFillAndStrokeStyleToContext(o,v,R){const T=o.ctx,f=o.current;switch(v){case e.COLORED:const S=this.ctx;T.fillStyle=S.fillStyle,T.strokeStyle=S.strokeStyle,f.fillColor=S.fillStyle,f.strokeColor=S.strokeStyle;break;case e.UNCOLORED:const B=r.Util.makeHexColor(R[0],R[1],R[2]);T.fillStyle=B,T.strokeStyle=B,f.fillColor=B,f.strokeColor=B;break;default:throw new r.FormatError(`Unsupported paint type: ${v}`)}}getPattern(o,v,R,T){let f=R;T!==P.SHADING&&(f=r.Util.transform(f,v.baseTransform),this.matrix&&(f=r.Util.transform(f,this.matrix)));const S=this.createPatternCanvas(v);let B=new DOMMatrix(f);B=B.translate(S.offsetX,S.offsetY),B=B.scale(1/S.scaleX,1/S.scaleY);const H=o.createPattern(S.canvas,"repeat");return H.setTransform(B),H}}s.TilingPattern=u}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.convertBlackAndWhiteToRGBA=P,s.convertToRGBA=g,s.grayToRGBA=L;var r=y(1);function g(j){switch(j.kind){case r.ImageKind.GRAYSCALE_1BPP:return P(j);case r.ImageKind.RGB_24BPP:return C(j)}return null}function P({src:j,srcPos:n=0,dest:t,width:i,height:h,nonBlackColor:l=4294967295,inverseDecode:e=!1}){const u=r.FeatureTest.isLittleEndian?4278190080:255,[p,o]=e?[l,u]:[u,l],v=i>>3,R=i&7,T=j.length;t=new Uint32Array(t.buffer);let f=0;for(let S=0;S<h;S++){for(const H=n+v;n<H;n++){const O=n<T?j[n]:255;t[f++]=O&128?o:p,t[f++]=O&64?o:p,t[f++]=O&32?o:p,t[f++]=O&16?o:p,t[f++]=O&8?o:p,t[f++]=O&4?o:p,t[f++]=O&2?o:p,t[f++]=O&1?o:p}if(R===0)continue;const B=n<T?j[n++]:255;for(let H=0;H<R;H++)t[f++]=B&1<<7-H?o:p}return{srcPos:n,destPos:f}}function C({src:j,srcPos:n=0,dest:t,destPos:i=0,width:h,height:l}){let e=0;const u=j.length>>2,p=new Uint32Array(j.buffer,n,u);if(r.FeatureTest.isLittleEndian){for(;e<u-2;e+=3,i+=4){const o=p[e],v=p[e+1],R=p[e+2];t[i]=o|4278190080,t[i+1]=o>>>24|v<<8|4278190080,t[i+2]=v>>>16|R<<16|4278190080,t[i+3]=R>>>8|4278190080}for(let o=e*4,v=j.length;o<v;o+=3)t[i++]=j[o]|j[o+1]<<8|j[o+2]<<16|4278190080}else{for(;e<u-2;e+=3,i+=4){const o=p[e],v=p[e+1],R=p[e+2];t[i]=o|255,t[i+1]=o<<24|v>>>8|255,t[i+2]=v<<16|R>>>16|255,t[i+3]=R<<8|255}for(let o=e*4,v=j.length;o<v;o+=3)t[i++]=j[o]<<24|j[o+1]<<16|j[o+2]<<8|255}return{srcPos:n,destPos:i}}function L(j,n){if(r.FeatureTest.isLittleEndian)for(let t=0,i=j.length;t<i;t++)n[t]=j[t]*65793|4278190080;else for(let t=0,i=j.length;t<i;t++)n[t]=j[t]*16843008|255}}),((w,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.GlobalWorkerOptions=void 0;const y=Object.create(null);s.GlobalWorkerOptions=y,y.workerPort=null,y.workerSrc=""}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.MessageHandler=void 0;var r=y(1);const g={DATA:1,ERROR:2},P={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function C(j){switch(j instanceof Error||typeof j=="object"&&j!==null||(0,r.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),j.name){case"AbortException":return new r.AbortException(j.message);case"MissingPDFException":return new r.MissingPDFException(j.message);case"PasswordException":return new r.PasswordException(j.message,j.code);case"UnexpectedResponseException":return new r.UnexpectedResponseException(j.message,j.status);case"UnknownErrorException":return new r.UnknownErrorException(j.message,j.details);default:return new r.UnknownErrorException(j.message,j.toString())}}class L{constructor(n,t,i){this.sourceName=n,this.targetName=t,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=h=>{const l=h.data;if(l.targetName!==this.sourceName)return;if(l.stream){this.#e(l);return}if(l.callback){const u=l.callbackId,p=this.callbackCapabilities[u];if(!p)throw new Error(`Cannot resolve callback ${u}`);if(delete this.callbackCapabilities[u],l.callback===g.DATA)p.resolve(l.data);else if(l.callback===g.ERROR)p.reject(C(l.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[l.action];if(!e)throw new Error(`Unknown action from worker: ${l.action}`);if(l.callbackId){const u=this.sourceName,p=l.sourceName;new Promise(function(o){o(e(l.data))}).then(function(o){i.postMessage({sourceName:u,targetName:p,callback:g.DATA,callbackId:l.callbackId,data:o})},function(o){i.postMessage({sourceName:u,targetName:p,callback:g.ERROR,callbackId:l.callbackId,reason:C(o)})});return}if(l.streamId){this.#t(l);return}e(l.data)},i.addEventListener("message",this._onComObjOnMessage)}on(n,t){const i=this.actionHandler;if(i[n])throw new Error(`There is already an actionName called "${n}"`);i[n]=t}send(n,t,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:n,data:t},i)}sendWithPromise(n,t,i){const h=this.callbackId++,l=new r.PromiseCapability;this.callbackCapabilities[h]=l;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:n,callbackId:h,data:t},i)}catch(e){l.reject(e)}return l.promise}sendWithStream(n,t,i,h){const l=this.streamId++,e=this.sourceName,u=this.targetName,p=this.comObj;return new ReadableStream({start:o=>{const v=new r.PromiseCapability;return this.streamControllers[l]={controller:o,startCall:v,pullCall:null,cancelCall:null,isClosed:!1},p.postMessage({sourceName:e,targetName:u,action:n,streamId:l,data:t,desiredSize:o.desiredSize},h),v.promise},pull:o=>{const v=new r.PromiseCapability;return this.streamControllers[l].pullCall=v,p.postMessage({sourceName:e,targetName:u,stream:P.PULL,streamId:l,desiredSize:o.desiredSize}),v.promise},cancel:o=>{(0,r.assert)(o instanceof Error,"cancel must have a valid reason");const v=new r.PromiseCapability;return this.streamControllers[l].cancelCall=v,this.streamControllers[l].isClosed=!0,p.postMessage({sourceName:e,targetName:u,stream:P.CANCEL,streamId:l,reason:C(o)}),v.promise}},i)}#t(n){const t=n.streamId,i=this.sourceName,h=n.sourceName,l=this.comObj,e=this,u=this.actionHandler[n.action],p={enqueue(o,v=1,R){if(this.isCancelled)return;const T=this.desiredSize;this.desiredSize-=v,T>0&&this.desiredSize<=0&&(this.sinkCapability=new r.PromiseCapability,this.ready=this.sinkCapability.promise),l.postMessage({sourceName:i,targetName:h,stream:P.ENQUEUE,streamId:t,chunk:o},R)},close(){this.isCancelled||(this.isCancelled=!0,l.postMessage({sourceName:i,targetName:h,stream:P.CLOSE,streamId:t}),delete e.streamSinks[t])},error(o){(0,r.assert)(o instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,l.postMessage({sourceName:i,targetName:h,stream:P.ERROR,streamId:t,reason:C(o)}))},sinkCapability:new r.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:n.desiredSize,ready:null};p.sinkCapability.resolve(),p.ready=p.sinkCapability.promise,this.streamSinks[t]=p,new Promise(function(o){o(u(n.data,p))}).then(function(){l.postMessage({sourceName:i,targetName:h,stream:P.START_COMPLETE,streamId:t,success:!0})},function(o){l.postMessage({sourceName:i,targetName:h,stream:P.START_COMPLETE,streamId:t,reason:C(o)})})}#e(n){const t=n.streamId,i=this.sourceName,h=n.sourceName,l=this.comObj,e=this.streamControllers[t],u=this.streamSinks[t];switch(n.stream){case P.START_COMPLETE:n.success?e.startCall.resolve():e.startCall.reject(C(n.reason));break;case P.PULL_COMPLETE:n.success?e.pullCall.resolve():e.pullCall.reject(C(n.reason));break;case P.PULL:if(!u){l.postMessage({sourceName:i,targetName:h,stream:P.PULL_COMPLETE,streamId:t,success:!0});break}u.desiredSize<=0&&n.desiredSize>0&&u.sinkCapability.resolve(),u.desiredSize=n.desiredSize,new Promise(function(p){p(u.onPull?.())}).then(function(){l.postMessage({sourceName:i,targetName:h,stream:P.PULL_COMPLETE,streamId:t,success:!0})},function(p){l.postMessage({sourceName:i,targetName:h,stream:P.PULL_COMPLETE,streamId:t,reason:C(p)})});break;case P.ENQUEUE:if((0,r.assert)(e,"enqueue should have stream controller"),e.isClosed)break;e.controller.enqueue(n.chunk);break;case P.CLOSE:if((0,r.assert)(e,"close should have stream controller"),e.isClosed)break;e.isClosed=!0,e.controller.close(),this.#i(e,t);break;case P.ERROR:(0,r.assert)(e,"error should have stream controller"),e.controller.error(C(n.reason)),this.#i(e,t);break;case P.CANCEL_COMPLETE:n.success?e.cancelCall.resolve():e.cancelCall.reject(C(n.reason)),this.#i(e,t);break;case P.CANCEL:if(!u)break;new Promise(function(p){p(u.onCancel?.(C(n.reason)))}).then(function(){l.postMessage({sourceName:i,targetName:h,stream:P.CANCEL_COMPLETE,streamId:t,success:!0})},function(p){l.postMessage({sourceName:i,targetName:h,stream:P.CANCEL_COMPLETE,streamId:t,reason:C(p)})}),u.sinkCapability.reject(C(n.reason)),u.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#i(n,t){await Promise.allSettled([n.startCall?.promise,n.pullCall?.promise,n.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}s.MessageHandler=L}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Metadata=void 0;var r=y(1);class g{#t;#e;constructor({parsedData:C,rawData:L}){this.#t=C,this.#e=L}getRaw(){return this.#e}get(C){return this.#t.get(C)??null}getAll(){return(0,r.objectFromMap)(this.#t)}has(C){return this.#t.has(C)}}s.Metadata=g}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.OptionalContentConfig=void 0;var r=y(1),g=y(8);const P=Symbol("INTERNAL");class C{#t=!0;constructor(n,t){this.name=n,this.intent=t}get visible(){return this.#t}_setVisible(n,t){n!==P&&(0,r.unreachable)("Internal method `_setVisible` called."),this.#t=t}}class L{#t=null;#e=new Map;#i=null;#s=null;constructor(n){if(this.name=null,this.creator=null,n!==null){this.name=n.name,this.creator=n.creator,this.#s=n.order;for(const t of n.groups)this.#e.set(t.id,new C(t.name,t.intent));if(n.baseState==="OFF")for(const t of this.#e.values())t._setVisible(P,!1);for(const t of n.on)this.#e.get(t)._setVisible(P,!0);for(const t of n.off)this.#e.get(t)._setVisible(P,!1);this.#i=this.getHash()}}#o(n){const t=n.length;if(t<2)return!0;const i=n[0];for(let h=1;h<t;h++){const l=n[h];let e;if(Array.isArray(l))e=this.#o(l);else if(this.#e.has(l))e=this.#e.get(l).visible;else return(0,r.warn)(`Optional content group not found: ${l}`),!0;switch(i){case"And":if(!e)return!1;break;case"Or":if(e)return!0;break;case"Not":return!e;default:return!0}}return i==="And"}isVisible(n){if(this.#e.size===0)return!0;if(!n)return(0,r.warn)("Optional content group not defined."),!0;if(n.type==="OCG")return this.#e.has(n.id)?this.#e.get(n.id).visible:((0,r.warn)(`Optional content group not found: ${n.id}`),!0);if(n.type==="OCMD"){if(n.expression)return this.#o(n.expression);if(!n.policy||n.policy==="AnyOn"){for(const t of n.ids){if(!this.#e.has(t))return(0,r.warn)(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!0}return!1}else if(n.policy==="AllOn"){for(const t of n.ids){if(!this.#e.has(t))return(0,r.warn)(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!1}return!0}else if(n.policy==="AnyOff"){for(const t of n.ids){if(!this.#e.has(t))return(0,r.warn)(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!0}return!1}else if(n.policy==="AllOff"){for(const t of n.ids){if(!this.#e.has(t))return(0,r.warn)(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!1}return!0}return(0,r.warn)(`Unknown optional content policy ${n.policy}.`),!0}return(0,r.warn)(`Unknown group type ${n.type}.`),!0}setVisibility(n,t=!0){if(!this.#e.has(n)){(0,r.warn)(`Optional content group not found: ${n}`);return}this.#e.get(n)._setVisible(P,!!t),this.#t=null}get hasInitialVisibility(){return this.#i===null||this.getHash()===this.#i}getOrder(){return this.#e.size?this.#s?this.#s.slice():[...this.#e.keys()]:null}getGroups(){return this.#e.size>0?(0,r.objectFromMap)(this.#e):null}getGroup(n){return this.#e.get(n)||null}getHash(){if(this.#t!==null)return this.#t;const n=new g.MurmurHash3_64;for(const[t,i]of this.#e)n.update(`${t}:${i.visible}`);return this.#t=n.hexdigest()}}s.OptionalContentConfig=L}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.PDFDataTransportStream=void 0;var r=y(1),g=y(6);class P{constructor({length:n,initialData:t,progressiveDone:i=!1,contentDispositionFilename:h=null,disableRange:l=!1,disableStream:e=!1},u){if((0,r.assert)(u,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=i,this._contentDispositionFilename=h,t?.length>0){const p=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;this._queuedChunks.push(p)}this._pdfDataRangeTransport=u,this._isStreamingSupported=!e,this._isRangeSupported=!l,this._contentLength=n,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((p,o)=>{this._onReceiveData({begin:p,chunk:o})}),this._pdfDataRangeTransport.addProgressListener((p,o)=>{this._onProgress({loaded:p,total:o})}),this._pdfDataRangeTransport.addProgressiveReadListener(p=>{this._onReceiveData({chunk:p})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:n,chunk:t}){const i=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(n===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{const h=this._rangeReaders.some(function(l){return l._begin!==n?!1:(l._enqueue(i),!0)});(0,r.assert)(h,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(n){n.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:n.loaded}):this._fullRequestReader?.onProgress?.({loaded:n.loaded,total:n.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(n){const t=this._rangeReaders.indexOf(n);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){(0,r.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const n=this._queuedChunks;return this._queuedChunks=null,new C(this,n,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(n,t){if(t<=this._progressiveDataLength)return null;const i=new L(this,n,t);return this._pdfDataRangeTransport.requestDataRange(n,t),this._rangeReaders.push(i),i}cancelAllRequests(n){this._fullRequestReader?.cancel(n);for(const t of this._rangeReaders.slice(0))t.cancel(n);this._pdfDataRangeTransport.abort()}}s.PDFDataTransportStream=P;class C{constructor(n,t,i=!1,h=null){this._stream=n,this._done=i||!1,this._filename=(0,g.isPdfFile)(h)?h:null,this._queuedChunks=t||[],this._loaded=0;for(const l of this._queuedChunks)this._loaded+=l.byteLength;this._requests=[],this._headersReady=Promise.resolve(),n._fullRequestReader=this,this.onProgress=null}_enqueue(n){this._done||(this._requests.length>0?this._requests.shift().resolve({value:n,done:!1}):this._queuedChunks.push(n),this._loaded+=n.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const n=new r.PromiseCapability;return this._requests.push(n),n.promise}cancel(n){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class L{constructor(n,t,i){this._stream=n,this._begin=t,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(n){if(!this._done){if(this._requests.length===0)this._queuedChunk=n;else{this._requests.shift().resolve({value:n,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const n=new r.PromiseCapability;return this._requests.push(n),n.promise}cancel(n){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.PDFFetchStream=void 0;var r=y(1),g=y(20);function P(i,h,l){return{method:"GET",headers:i,signal:l.signal,mode:"cors",credentials:h?"include":"same-origin",redirect:"follow"}}function C(i){const h=new Headers;for(const l in i){const e=i[l];e!==void 0&&h.append(l,e)}return h}function L(i){return i instanceof Uint8Array?i.buffer:i instanceof ArrayBuffer?i:((0,r.warn)(`getArrayBuffer - unexpected data format: ${i}`),new Uint8Array(i).buffer)}class j{constructor(h){this.source=h,this.isHttp=/^https?:/i.test(h.url),this.httpHeaders=this.isHttp&&h.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new n(this),this._fullRequestReader}getRangeReader(h,l){if(l<=this._progressiveDataLength)return null;const e=new t(this,h,l);return this._rangeRequestReaders.push(e),e}cancelAllRequests(h){this._fullRequestReader?.cancel(h);for(const l of this._rangeRequestReaders.slice(0))l.cancel(h)}}s.PDFFetchStream=j;class n{constructor(h){this._stream=h,this._reader=null,this._loaded=0,this._filename=null;const l=h.source;this._withCredentials=l.withCredentials||!1,this._contentLength=l.length,this._headersCapability=new r.PromiseCapability,this._disableRange=l.disableRange||!1,this._rangeChunkSize=l.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!l.disableStream,this._isRangeSupported=!l.disableRange,this._headers=C(this._stream.httpHeaders);const e=l.url;fetch(e,P(this._headers,this._withCredentials,this._abortController)).then(u=>{if(!(0,g.validateResponseStatus)(u.status))throw(0,g.createResponseStatusError)(u.status,e);this._reader=u.body.getReader(),this._headersCapability.resolve();const p=R=>u.headers.get(R),{allowRangeRequests:o,suggestedLength:v}=(0,g.validateRangeRequestCapabilities)({getResponseHeader:p,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=v||this._contentLength,this._filename=(0,g.extractFilenameFromHeader)(p),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new r.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:h,done:l}=await this._reader.read();return l?{value:h,done:l}:(this._loaded+=h.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:L(h),done:!1})}cancel(h){this._reader?.cancel(h),this._abortController.abort()}}class t{constructor(h,l,e){this._stream=h,this._reader=null,this._loaded=0;const u=h.source;this._withCredentials=u.withCredentials||!1,this._readCapability=new r.PromiseCapability,this._isStreamingSupported=!u.disableStream,this._abortController=new AbortController,this._headers=C(this._stream.httpHeaders),this._headers.append("Range",`bytes=${l}-${e-1}`);const p=u.url;fetch(p,P(this._headers,this._withCredentials,this._abortController)).then(o=>{if(!(0,g.validateResponseStatus)(o.status))throw(0,g.createResponseStatusError)(o.status,p);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:h,done:l}=await this._reader.read();return l?{value:h,done:l}:(this._loaded+=h.byteLength,this.onProgress?.({loaded:this._loaded}),{value:L(h),done:!1})}cancel(h){this._reader?.cancel(h),this._abortController.abort()}}}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.createResponseStatusError=j,s.extractFilenameFromHeader=L,s.validateRangeRequestCapabilities=C,s.validateResponseStatus=n;var r=y(1),g=y(21),P=y(6);function C({getResponseHeader:t,isHttp:i,rangeChunkSize:h,disableRange:l}){const e={allowRangeRequests:!1,suggestedLength:void 0},u=parseInt(t("Content-Length"),10);return!Number.isInteger(u)||(e.suggestedLength=u,u<=2*h)||l||!i||t("Accept-Ranges")!=="bytes"||(t("Content-Encoding")||"identity")!=="identity"||(e.allowRangeRequests=!0),e}function L(t){const i=t("Content-Disposition");if(i){let h=(0,g.getFilenameFromContentDispositionHeader)(i);if(h.includes("%"))try{h=decodeURIComponent(h)}catch{}if((0,P.isPdfFile)(h))return h}return null}function j(t,i){return t===404||t===0&&i.startsWith("file:")?new r.MissingPDFException('Missing PDF "'+i+'".'):new r.UnexpectedResponseException(`Unexpected server response (${t}) while retrieving PDF "${i}".`,t)}function n(t){return t===200||t===206}}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.getFilenameFromContentDispositionHeader=g;var r=y(1);function g(P){let C=!0,L=j("filename\\*","i").exec(P);if(L){L=L[1];let u=h(L);return u=unescape(u),u=l(u),u=e(u),t(u)}if(L=i(P),L){const u=e(L);return t(u)}if(L=j("filename","i").exec(P),L){L=L[1];let u=h(L);return u=e(u),t(u)}function j(u,p){return new RegExp("(?:^|;)\\s*"+u+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',p)}function n(u,p){if(u){if(!/^[\x00-\xFF]+$/.test(p))return p;try{const o=new TextDecoder(u,{fatal:!0}),v=(0,r.stringToBytes)(p);p=o.decode(v),C=!1}catch{}}return p}function t(u){return C&&/[\x80-\xff]/.test(u)&&(u=n("utf-8",u),C&&(u=n("iso-8859-1",u))),u}function i(u){const p=[];let o;const v=j("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(o=v.exec(u))!==null;){let[,T,f,S]=o;if(T=parseInt(T,10),T in p){if(T===0)break;continue}p[T]=[f,S]}const R=[];for(let T=0;T<p.length&&T in p;++T){let[f,S]=p[T];S=h(S),f&&(S=unescape(S),T===0&&(S=l(S))),R.push(S)}return R.join("")}function h(u){if(u.startsWith('"')){const p=u.slice(1).split('\\"');for(let o=0;o<p.length;++o){const v=p[o].indexOf('"');v!==-1&&(p[o]=p[o].slice(0,v),p.length=o+1),p[o]=p[o].replaceAll(/\\(.)/g,"$1")}u=p.join('"')}return u}function l(u){const p=u.indexOf("'");if(p===-1)return u;const o=u.slice(0,p),R=u.slice(p+1).replace(/^[^']*'/,"");return n(o,R)}function e(u){return!u.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(u)?u:u.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(p,o,v,R){if(v==="q"||v==="Q")return R=R.replaceAll("_"," "),R=R.replaceAll(/=([0-9a-fA-F]{2})/g,function(T,f){return String.fromCharCode(parseInt(f,16))}),n(o,R);try{R=atob(R)}catch{}return n(o,R)})}return""}}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.PDFNetworkStream=void 0;var r=y(1),g=y(20);const P=200,C=206;function L(h){const l=h.response;return typeof l!="string"?l:(0,r.stringToBytes)(l).buffer}class j{constructor(l,e={}){this.url=l,this.isHttp=/^https?:/i.test(l),this.httpHeaders=this.isHttp&&e.httpHeaders||Object.create(null),this.withCredentials=e.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(l,e,u){const p={begin:l,end:e};for(const o in u)p[o]=u[o];return this.request(p)}requestFull(l){return this.request(l)}request(l){const e=new XMLHttpRequest,u=this.currXhrId++,p=this.pendingRequests[u]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const o in this.httpHeaders){const v=this.httpHeaders[o];v!==void 0&&e.setRequestHeader(o,v)}return this.isHttp&&"begin"in l&&"end"in l?(e.setRequestHeader("Range",`bytes=${l.begin}-${l.end-1}`),p.expectedStatus=C):p.expectedStatus=P,e.responseType="arraybuffer",l.onError&&(e.onerror=function(o){l.onError(e.status)}),e.onreadystatechange=this.onStateChange.bind(this,u),e.onprogress=this.onProgress.bind(this,u),p.onHeadersReceived=l.onHeadersReceived,p.onDone=l.onDone,p.onError=l.onError,p.onProgress=l.onProgress,e.send(null),u}onProgress(l,e){const u=this.pendingRequests[l];u&&u.onProgress?.(e)}onStateChange(l,e){const u=this.pendingRequests[l];if(!u)return;const p=u.xhr;if(p.readyState>=2&&u.onHeadersReceived&&(u.onHeadersReceived(),delete u.onHeadersReceived),p.readyState!==4||!(l in this.pendingRequests))return;if(delete this.pendingRequests[l],p.status===0&&this.isHttp){u.onError?.(p.status);return}const o=p.status||P;if(!(o===P&&u.expectedStatus===C)&&o!==u.expectedStatus){u.onError?.(p.status);return}const R=L(p);if(o===C){const T=p.getResponseHeader("Content-Range"),f=/bytes (\d+)-(\d+)\/(\d+)/.exec(T);u.onDone({begin:parseInt(f[1],10),chunk:R})}else R?u.onDone({begin:0,chunk:R}):u.onError?.(p.status)}getRequestXhr(l){return this.pendingRequests[l].xhr}isPendingRequest(l){return l in this.pendingRequests}abortRequest(l){const e=this.pendingRequests[l].xhr;delete this.pendingRequests[l],e.abort()}}class n{constructor(l){this._source=l,this._manager=new j(l.url,{httpHeaders:l.httpHeaders,withCredentials:l.withCredentials}),this._rangeChunkSize=l.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(l){const e=this._rangeRequestReaders.indexOf(l);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new t(this._manager,this._source),this._fullRequestReader}getRangeReader(l,e){const u=new i(this._manager,l,e);return u.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(u),u}cancelAllRequests(l){this._fullRequestReader?.cancel(l);for(const e of this._rangeRequestReaders.slice(0))e.cancel(l)}}s.PDFNetworkStream=n;class t{constructor(l,e){this._manager=l;const u={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._fullRequestId=l.requestFull(u),this._headersReceivedCapability=new r.PromiseCapability,this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const l=this._fullRequestId,e=this._manager.getRequestXhr(l),u=v=>e.getResponseHeader(v),{allowRangeRequests:p,suggestedLength:o}=(0,g.validateRangeRequestCapabilities)({getResponseHeader:u,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});p&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=(0,g.extractFilenameFromHeader)(u),this._isRangeSupported&&this._manager.abortRequest(l),this._headersReceivedCapability.resolve()}_onDone(l){if(l&&(this._requests.length>0?this._requests.shift().resolve({value:l.chunk,done:!1}):this._cachedChunks.push(l.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(l){this._storedError=(0,g.createResponseStatusError)(l,this._url),this._headersReceivedCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(l){this.onProgress?.({loaded:l.loaded,total:l.lengthComputable?l.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const l=new r.PromiseCapability;return this._requests.push(l),l.promise}cancel(l){this._done=!0,this._headersReceivedCapability.reject(l);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class i{constructor(l,e,u){this._manager=l;const p={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=l.url,this._requestId=l.requestRange(e,u,p),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(l){const e=l.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const u of this._requests)u.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(l){this._storedError=(0,g.createResponseStatusError)(l,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(l){this.isStreamingSupported||this.onProgress?.({loaded:l.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const l=new r.PromiseCapability;return this._requests.push(l),l.promise}cancel(l){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.PDFNodeStream=void 0;var r=y(1),g=y(20);const P=/^file:\/\/\/[a-zA-Z]:\//;function C(u){const p=require$$5,o=p.parse(u);return o.protocol==="file:"||o.host?o:/^[a-z]:[/\\]/i.test(u)?p.parse(`file:///${u}`):(o.host||(o.protocol="file:"),o)}class L{constructor(p){this.source=p,this.url=C(p.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&p.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new l(this):new i(this),this._fullRequestReader}getRangeReader(p,o){if(o<=this._progressiveDataLength)return null;const v=this.isFsUrl?new e(this,p,o):new h(this,p,o);return this._rangeRequestReaders.push(v),v}cancelAllRequests(p){this._fullRequestReader?.cancel(p);for(const o of this._rangeRequestReaders.slice(0))o.cancel(p)}}s.PDFNodeStream=L;class j{constructor(p){this._url=p.url,this._done=!1,this._storedError=null,this.onProgress=null;const o=p.source;this._contentLength=o.length,this._loaded=0,this._filename=null,this._disableRange=o.disableRange||!1,this._rangeChunkSize=o.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!o.disableStream,this._isRangeSupported=!o.disableRange,this._readableStream=null,this._readCapability=new r.PromiseCapability,this._headersCapability=new r.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const p=this._readableStream.read();return p===null?(this._readCapability=new r.PromiseCapability,this.read()):(this._loaded+=p.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(p).buffer,done:!1})}cancel(p){if(!this._readableStream){this._error(p);return}this._readableStream.destroy(p)}_error(p){this._storedError=p,this._readCapability.resolve()}_setReadableStream(p){this._readableStream=p,p.on("readable",()=>{this._readCapability.resolve()}),p.on("end",()=>{p.destroy(),this._done=!0,this._readCapability.resolve()}),p.on("error",o=>{this._error(o)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new r.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class n{constructor(p){this._url=p.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new r.PromiseCapability;const o=p.source;this._isStreamingSupported=!o.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const p=this._readableStream.read();return p===null?(this._readCapability=new r.PromiseCapability,this.read()):(this._loaded+=p.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(p).buffer,done:!1})}cancel(p){if(!this._readableStream){this._error(p);return}this._readableStream.destroy(p)}_error(p){this._storedError=p,this._readCapability.resolve()}_setReadableStream(p){this._readableStream=p,p.on("readable",()=>{this._readCapability.resolve()}),p.on("end",()=>{p.destroy(),this._done=!0,this._readCapability.resolve()}),p.on("error",o=>{this._error(o)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function t(u,p){return{protocol:u.protocol,auth:u.auth,host:u.hostname,port:u.port,path:u.path,method:"GET",headers:p}}class i extends j{constructor(p){super(p);const o=v=>{if(v.statusCode===404){const S=new r.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=S,this._headersCapability.reject(S);return}this._headersCapability.resolve(),this._setReadableStream(v);const R=S=>this._readableStream.headers[S.toLowerCase()],{allowRangeRequests:T,suggestedLength:f}=(0,g.validateRangeRequestCapabilities)({getResponseHeader:R,isHttp:p.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=T,this._contentLength=f||this._contentLength,this._filename=(0,g.extractFilenameFromHeader)(R)};if(this._request=null,this._url.protocol==="http:"){const v=require$$5;this._request=v.request(t(this._url,p.httpHeaders),o)}else{const v=require$$5;this._request=v.request(t(this._url,p.httpHeaders),o)}this._request.on("error",v=>{this._storedError=v,this._headersCapability.reject(v)}),this._request.end()}}class h extends n{constructor(p,o,v){super(p),this._httpHeaders={};for(const T in p.httpHeaders){const f=p.httpHeaders[T];f!==void 0&&(this._httpHeaders[T]=f)}this._httpHeaders.Range=`bytes=${o}-${v-1}`;const R=T=>{if(T.statusCode===404){const f=new r.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=f;return}this._setReadableStream(T)};if(this._request=null,this._url.protocol==="http:"){const T=require$$5;this._request=T.request(t(this._url,this._httpHeaders),R)}else{const T=require$$5;this._request=T.request(t(this._url,this._httpHeaders),R)}this._request.on("error",T=>{this._storedError=T}),this._request.end()}}class l extends j{constructor(p){super(p);let o=decodeURIComponent(this._url.path);P.test(this._url.href)&&(o=o.replace(/^\//,""));const v=require$$5;v.lstat(o,(R,T)=>{if(R){R.code==="ENOENT"&&(R=new r.MissingPDFException(`Missing PDF "${o}".`)),this._storedError=R,this._headersCapability.reject(R);return}this._contentLength=T.size,this._setReadableStream(v.createReadStream(o)),this._headersCapability.resolve()})}}class e extends n{constructor(p,o,v){super(p);let R=decodeURIComponent(this._url.path);P.test(this._url.href)&&(R=R.replace(/^\//,""));const T=require$$5;this._setReadableStream(T.createReadStream(R,{start:o,end:v-1}))}}}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.SVGGraphics=void 0;var r=y(6),g=y(1);const P={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},C="http://www.w3.org/XML/1998/namespace",L="http://www.w3.org/1999/xlink",j=["butt","round","square"],n=["miter","round","bevel"],t=function(T,f="",S=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!S)return URL.createObjectURL(new Blob([T],{type:f}));const B="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let H=`data:${f};base64,`;for(let O=0,z=T.length;O<z;O+=3){const X=T[O]&255,it=T[O+1]&255,Q=T[O+2]&255,et=X>>2,nt=(X&3)<<4|it>>4,$=O+1<z?(it&15)<<2|Q>>6:64,D=O+2<z?Q&63:64;H+=B[et]+B[nt]+B[$]+B[D]}return H},i=(function(){const T=new Uint8Array([137,80,78,71,13,10,26,10]),f=12,S=new Int32Array(256);for(let Q=0;Q<256;Q++){let et=Q;for(let nt=0;nt<8;nt++)et=et&1?3988292384^et>>1&2147483647:et>>1&2147483647;S[Q]=et}function B(Q,et,nt){let $=-1;for(let D=et;D<nt;D++){const b=($^Q[D])&255,c=S[b];$=$>>>8^c}return $^-1}function H(Q,et,nt,$){let D=$;const b=et.length;nt[D]=b>>24&255,nt[D+1]=b>>16&255,nt[D+2]=b>>8&255,nt[D+3]=b&255,D+=4,nt[D]=Q.charCodeAt(0)&255,nt[D+1]=Q.charCodeAt(1)&255,nt[D+2]=Q.charCodeAt(2)&255,nt[D+3]=Q.charCodeAt(3)&255,D+=4,nt.set(et,D),D+=et.length;const c=B(nt,$+4,D);nt[D]=c>>24&255,nt[D+1]=c>>16&255,nt[D+2]=c>>8&255,nt[D+3]=c&255}function O(Q,et,nt){let $=1,D=0;for(let b=et;b<nt;++b)$=($+(Q[b]&255))%65521,D=(D+$)%65521;return D<<16|$}function z(Q){if(!g.isNodeJS)return X(Q);try{const et=parseInt(process.versions.node)>=8?Q:Buffer.from(Q),nt=require$$5.deflateSync(et,{level:9});return nt instanceof Uint8Array?nt:new Uint8Array(nt)}catch(et){(0,g.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+et)}return X(Q)}function X(Q){let et=Q.length;const nt=65535,$=Math.ceil(et/nt),D=new Uint8Array(2+et+$*5+4);let b=0;D[b++]=120,D[b++]=156;let c=0;for(;et>nt;)D[b++]=0,D[b++]=255,D[b++]=255,D[b++]=0,D[b++]=0,D.set(Q.subarray(c,c+nt),b),b+=nt,c+=nt,et-=nt;D[b++]=1,D[b++]=et&255,D[b++]=et>>8&255,D[b++]=~et&65535&255,D[b++]=(~et&65535)>>8&255,D.set(Q.subarray(c),b),b+=Q.length-c;const d=O(Q,0,Q.length);return D[b++]=d>>24&255,D[b++]=d>>16&255,D[b++]=d>>8&255,D[b++]=d&255,D}function it(Q,et,nt,$){const D=Q.width,b=Q.height;let c,d,_;const F=Q.data;switch(et){case g.ImageKind.GRAYSCALE_1BPP:d=0,c=1,_=D+7>>3;break;case g.ImageKind.RGB_24BPP:d=2,c=8,_=D*3;break;case g.ImageKind.RGBA_32BPP:d=6,c=8,_=D*4;break;default:throw new Error("invalid format")}const M=new Uint8Array((1+_)*b);let I=0,E=0;for(let N=0;N<b;++N)M[I++]=0,M.set(F.subarray(E,E+_),I),E+=_,I+=_;if(et===g.ImageKind.GRAYSCALE_1BPP&&$){I=0;for(let N=0;N<b;N++){I++;for(let U=0;U<_;U++)M[I++]^=255}}const a=new Uint8Array([D>>24&255,D>>16&255,D>>8&255,D&255,b>>24&255,b>>16&255,b>>8&255,b&255,c,d,0,0,0]),m=z(M),A=T.length+f*3+a.length+m.length,x=new Uint8Array(A);let k=0;return x.set(T,k),k+=T.length,H("IHDR",a,x,k),k+=f+a.length,H("IDATA",m,x,k),k+=f+m.length,H("IEND",new Uint8Array(0),x,k),t(x,"image/png",nt)}return function(et,nt,$){const D=et.kind===void 0?g.ImageKind.GRAYSCALE_1BPP:et.kind;return it(et,D,nt,$)}})();class h{constructor(){this.fontSizeScale=1,this.fontWeight=P.fontWeight,this.fontSize=0,this.textMatrix=g.IDENTITY_MATRIX,this.fontMatrix=g.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=g.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=P.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(f,S){this.x=f,this.y=S}}function l(T){let f=[];const S=[];for(const B of T){if(B.fn==="save"){f.push({fnId:92,fn:"group",items:[]}),S.push(f),f=f.at(-1).items;continue}B.fn==="restore"?f=S.pop():f.push(B)}return f}function e(T){if(Number.isInteger(T))return T.toString();const f=T.toFixed(10);let S=f.length-1;if(f[S]!=="0")return f;do S--;while(f[S]==="0");return f.substring(0,f[S]==="."?S:S+1)}function u(T){if(T[4]===0&&T[5]===0){if(T[1]===0&&T[2]===0)return T[0]===1&&T[3]===1?"":`scale(${e(T[0])} ${e(T[3])})`;if(T[0]===T[3]&&T[1]===-T[2]){const f=Math.acos(T[0])*180/Math.PI;return`rotate(${e(f)})`}}else if(T[0]===1&&T[1]===0&&T[2]===0&&T[3]===1)return`translate(${e(T[4])} ${e(T[5])})`;return`matrix(${e(T[0])} ${e(T[1])} ${e(T[2])} ${e(T[3])} ${e(T[4])} ${e(T[5])})`}let p=0,o=0,v=0;class R{constructor(f,S,B=!1){(0,r.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new r.DOMSVGFactory,this.current=new h,this.transformMatrix=g.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=f,this.objs=S,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!B,this._operatorIdMapping=[];for(const H in g.OPS)this._operatorIdMapping[g.OPS[H]]=H}getObject(f,S=null){return typeof f=="string"?f.startsWith("g_")?this.commonObjs.get(f):this.objs.get(f):S}save(){this.transformStack.push(this.transformMatrix);const f=this.current;this.extraStack.push(f),this.current=f.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(f){this.save(),this.executeOpTree(f),this.restore()}loadDependencies(f){const S=f.fnArray,B=f.argsArray;for(let H=0,O=S.length;H<O;H++)if(S[H]===g.OPS.dependency)for(const z of B[H]){const X=z.startsWith("g_")?this.commonObjs:this.objs,it=new Promise(Q=>{X.get(z,Q)});this.current.dependencies.push(it)}return Promise.all(this.current.dependencies)}transform(f,S,B,H,O,z){const X=[f,S,B,H,O,z];this.transformMatrix=g.Util.transform(this.transformMatrix,X),this.tgrp=null}getSVG(f,S){this.viewport=S;const B=this._initialize(S);return this.loadDependencies(f).then(()=>(this.transformMatrix=g.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(f)),B))}convertOpList(f){const S=this._operatorIdMapping,B=f.argsArray,H=f.fnArray,O=[];for(let z=0,X=H.length;z<X;z++){const it=H[z];O.push({fnId:it,fn:S[it],args:B[z]})}return l(O)}executeOpTree(f){for(const S of f){const B=S.fn,H=S.fnId,O=S.args;switch(H|0){case g.OPS.beginText:this.beginText();break;case g.OPS.dependency:break;case g.OPS.setLeading:this.setLeading(O);break;case g.OPS.setLeadingMoveText:this.setLeadingMoveText(O[0],O[1]);break;case g.OPS.setFont:this.setFont(O);break;case g.OPS.showText:this.showText(O[0]);break;case g.OPS.showSpacedText:this.showText(O[0]);break;case g.OPS.endText:this.endText();break;case g.OPS.moveText:this.moveText(O[0],O[1]);break;case g.OPS.setCharSpacing:this.setCharSpacing(O[0]);break;case g.OPS.setWordSpacing:this.setWordSpacing(O[0]);break;case g.OPS.setHScale:this.setHScale(O[0]);break;case g.OPS.setTextMatrix:this.setTextMatrix(O[0],O[1],O[2],O[3],O[4],O[5]);break;case g.OPS.setTextRise:this.setTextRise(O[0]);break;case g.OPS.setTextRenderingMode:this.setTextRenderingMode(O[0]);break;case g.OPS.setLineWidth:this.setLineWidth(O[0]);break;case g.OPS.setLineJoin:this.setLineJoin(O[0]);break;case g.OPS.setLineCap:this.setLineCap(O[0]);break;case g.OPS.setMiterLimit:this.setMiterLimit(O[0]);break;case g.OPS.setFillRGBColor:this.setFillRGBColor(O[0],O[1],O[2]);break;case g.OPS.setStrokeRGBColor:this.setStrokeRGBColor(O[0],O[1],O[2]);break;case g.OPS.setStrokeColorN:this.setStrokeColorN(O);break;case g.OPS.setFillColorN:this.setFillColorN(O);break;case g.OPS.shadingFill:this.shadingFill(O[0]);break;case g.OPS.setDash:this.setDash(O[0],O[1]);break;case g.OPS.setRenderingIntent:this.setRenderingIntent(O[0]);break;case g.OPS.setFlatness:this.setFlatness(O[0]);break;case g.OPS.setGState:this.setGState(O[0]);break;case g.OPS.fill:this.fill();break;case g.OPS.eoFill:this.eoFill();break;case g.OPS.stroke:this.stroke();break;case g.OPS.fillStroke:this.fillStroke();break;case g.OPS.eoFillStroke:this.eoFillStroke();break;case g.OPS.clip:this.clip("nonzero");break;case g.OPS.eoClip:this.clip("evenodd");break;case g.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case g.OPS.paintImageXObject:this.paintImageXObject(O[0]);break;case g.OPS.paintInlineImageXObject:this.paintInlineImageXObject(O[0]);break;case g.OPS.paintImageMaskXObject:this.paintImageMaskXObject(O[0]);break;case g.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(O[0],O[1]);break;case g.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case g.OPS.closePath:this.closePath();break;case g.OPS.closeStroke:this.closeStroke();break;case g.OPS.closeFillStroke:this.closeFillStroke();break;case g.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case g.OPS.nextLine:this.nextLine();break;case g.OPS.transform:this.transform(O[0],O[1],O[2],O[3],O[4],O[5]);break;case g.OPS.constructPath:this.constructPath(O[0],O[1]);break;case g.OPS.endPath:this.endPath();break;case 92:this.group(S.items);break;default:(0,g.warn)(`Unimplemented operator ${B}`);break}}}setWordSpacing(f){this.current.wordSpacing=f}setCharSpacing(f){this.current.charSpacing=f}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(f,S,B,H,O,z){const X=this.current;X.textMatrix=X.lineMatrix=[f,S,B,H,O,z],X.textMatrixScale=Math.hypot(f,S),X.x=X.lineX=0,X.y=X.lineY=0,X.xcoords=[],X.ycoords=[],X.tspan=this.svgFactory.createElement("svg:tspan"),X.tspan.setAttributeNS(null,"font-family",X.fontFamily),X.tspan.setAttributeNS(null,"font-size",`${e(X.fontSize)}px`),X.tspan.setAttributeNS(null,"y",e(-X.y)),X.txtElement=this.svgFactory.createElement("svg:text"),X.txtElement.append(X.tspan)}beginText(){const f=this.current;f.x=f.lineX=0,f.y=f.lineY=0,f.textMatrix=g.IDENTITY_MATRIX,f.lineMatrix=g.IDENTITY_MATRIX,f.textMatrixScale=1,f.tspan=this.svgFactory.createElement("svg:tspan"),f.txtElement=this.svgFactory.createElement("svg:text"),f.txtgrp=this.svgFactory.createElement("svg:g"),f.xcoords=[],f.ycoords=[]}moveText(f,S){const B=this.current;B.x=B.lineX+=f,B.y=B.lineY+=S,B.xcoords=[],B.ycoords=[],B.tspan=this.svgFactory.createElement("svg:tspan"),B.tspan.setAttributeNS(null,"font-family",B.fontFamily),B.tspan.setAttributeNS(null,"font-size",`${e(B.fontSize)}px`),B.tspan.setAttributeNS(null,"y",e(-B.y))}showText(f){const S=this.current,B=S.font,H=S.fontSize;if(H===0)return;const O=S.fontSizeScale,z=S.charSpacing,X=S.wordSpacing,it=S.fontDirection,Q=S.textHScale*it,et=B.vertical,nt=et?1:-1,$=B.defaultVMetrics,D=H*S.fontMatrix[0];let b=0;for(const _ of f){if(_===null){b+=it*X;continue}else if(typeof _=="number"){b+=nt*_*H/1e3;continue}const F=(_.isSpace?X:0)+z,M=_.fontChar;let I,E,a=_.width;if(et){let A;const x=_.vmetric||$;A=_.vmetric?x[1]:a*.5,A=-A*D;const k=x[2]*D;a=x?-x[0]:a,I=A/O,E=(b+k)/O}else I=b/O,E=0;(_.isInFont||B.missingFile)&&(S.xcoords.push(S.x+I),et&&S.ycoords.push(-S.y+E),S.tspan.textContent+=M);const m=et?a*D-F*it:a*D+F*it;b+=m}S.tspan.setAttributeNS(null,"x",S.xcoords.map(e).join(" ")),et?S.tspan.setAttributeNS(null,"y",S.ycoords.map(e).join(" ")):S.tspan.setAttributeNS(null,"y",e(-S.y)),et?S.y-=b:S.x+=b*Q,S.tspan.setAttributeNS(null,"font-family",S.fontFamily),S.tspan.setAttributeNS(null,"font-size",`${e(S.fontSize)}px`),S.fontStyle!==P.fontStyle&&S.tspan.setAttributeNS(null,"font-style",S.fontStyle),S.fontWeight!==P.fontWeight&&S.tspan.setAttributeNS(null,"font-weight",S.fontWeight);const c=S.textRenderingMode&g.TextRenderingMode.FILL_STROKE_MASK;if(c===g.TextRenderingMode.FILL||c===g.TextRenderingMode.FILL_STROKE?(S.fillColor!==P.fillColor&&S.tspan.setAttributeNS(null,"fill",S.fillColor),S.fillAlpha<1&&S.tspan.setAttributeNS(null,"fill-opacity",S.fillAlpha)):S.textRenderingMode===g.TextRenderingMode.ADD_TO_PATH?S.tspan.setAttributeNS(null,"fill","transparent"):S.tspan.setAttributeNS(null,"fill","none"),c===g.TextRenderingMode.STROKE||c===g.TextRenderingMode.FILL_STROKE){const _=1/(S.textMatrixScale||1);this._setStrokeAttributes(S.tspan,_)}let d=S.textMatrix;S.textRise!==0&&(d=d.slice(),d[5]+=S.textRise),S.txtElement.setAttributeNS(null,"transform",`${u(d)} scale(${e(Q)}, -1)`),S.txtElement.setAttributeNS(C,"xml:space","preserve"),S.txtElement.append(S.tspan),S.txtgrp.append(S.txtElement),this._ensureTransformGroup().append(S.txtElement)}setLeadingMoveText(f,S){this.setLeading(-S),this.moveText(f,S)}addFontStyle(f){if(!f.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const S=t(f.data,f.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${f.loadedName}"; src: url(${S}); }
`}setFont(f){const S=this.current,B=this.commonObjs.get(f[0]);let H=f[1];S.font=B,this.embedFonts&&!B.missingFile&&!this.embeddedFonts[B.loadedName]&&(this.addFontStyle(B),this.embeddedFonts[B.loadedName]=B),S.fontMatrix=B.fontMatrix||g.FONT_IDENTITY_MATRIX;let O="normal";B.black?O="900":B.bold&&(O="bold");const z=B.italic?"italic":"normal";H<0?(H=-H,S.fontDirection=-1):S.fontDirection=1,S.fontSize=H,S.fontFamily=B.loadedName,S.fontWeight=O,S.fontStyle=z,S.tspan=this.svgFactory.createElement("svg:tspan"),S.tspan.setAttributeNS(null,"y",e(-S.y)),S.xcoords=[],S.ycoords=[]}endText(){const f=this.current;f.textRenderingMode&g.TextRenderingMode.ADD_TO_PATH_FLAG&&f.txtElement?.hasChildNodes()&&(f.element=f.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(f){f>0&&(this.current.lineWidth=f)}setLineCap(f){this.current.lineCap=j[f]}setLineJoin(f){this.current.lineJoin=n[f]}setMiterLimit(f){this.current.miterLimit=f}setStrokeAlpha(f){this.current.strokeAlpha=f}setStrokeRGBColor(f,S,B){this.current.strokeColor=g.Util.makeHexColor(f,S,B)}setFillAlpha(f){this.current.fillAlpha=f}setFillRGBColor(f,S,B){this.current.fillColor=g.Util.makeHexColor(f,S,B),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(f){this.current.strokeColor=this._makeColorN_Pattern(f)}setFillColorN(f){this.current.fillColor=this._makeColorN_Pattern(f)}shadingFill(f){const{width:S,height:B}=this.viewport,H=g.Util.inverseTransform(this.transformMatrix),[O,z,X,it]=g.Util.getAxialAlignedBoundingBox([0,0,S,B],H),Q=this.svgFactory.createElement("svg:rect");Q.setAttributeNS(null,"x",O),Q.setAttributeNS(null,"y",z),Q.setAttributeNS(null,"width",X-O),Q.setAttributeNS(null,"height",it-z),Q.setAttributeNS(null,"fill",this._makeShadingPattern(f)),this.current.fillAlpha<1&&Q.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(Q)}_makeColorN_Pattern(f){return f[0]==="TilingPattern"?this._makeTilingPattern(f):this._makeShadingPattern(f)}_makeTilingPattern(f){const S=f[1],B=f[2],H=f[3]||g.IDENTITY_MATRIX,[O,z,X,it]=f[4],Q=f[5],et=f[6],nt=f[7],$=`shading${v++}`,[D,b,c,d]=g.Util.normalizeRect([...g.Util.applyTransform([O,z],H),...g.Util.applyTransform([X,it],H)]),[_,F]=g.Util.singularValueDecompose2dScale(H),M=Q*_,I=et*F,E=this.svgFactory.createElement("svg:pattern");E.setAttributeNS(null,"id",$),E.setAttributeNS(null,"patternUnits","userSpaceOnUse"),E.setAttributeNS(null,"width",M),E.setAttributeNS(null,"height",I),E.setAttributeNS(null,"x",`${D}`),E.setAttributeNS(null,"y",`${b}`);const a=this.svg,m=this.transformMatrix,A=this.current.fillColor,x=this.current.strokeColor,k=this.svgFactory.create(c-D,d-b);if(this.svg=k,this.transformMatrix=H,nt===2){const N=g.Util.makeHexColor(...S);this.current.fillColor=N,this.current.strokeColor=N}return this.executeOpTree(this.convertOpList(B)),this.svg=a,this.transformMatrix=m,this.current.fillColor=A,this.current.strokeColor=x,E.append(k.childNodes[0]),this.defs.append(E),`url(#${$})`}_makeShadingPattern(f){switch(typeof f=="string"&&(f=this.objs.get(f)),f[0]){case"RadialAxial":const S=`shading${v++}`,B=f[3];let H;switch(f[1]){case"axial":const O=f[4],z=f[5];H=this.svgFactory.createElement("svg:linearGradient"),H.setAttributeNS(null,"id",S),H.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),H.setAttributeNS(null,"x1",O[0]),H.setAttributeNS(null,"y1",O[1]),H.setAttributeNS(null,"x2",z[0]),H.setAttributeNS(null,"y2",z[1]);break;case"radial":const X=f[4],it=f[5],Q=f[6],et=f[7];H=this.svgFactory.createElement("svg:radialGradient"),H.setAttributeNS(null,"id",S),H.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),H.setAttributeNS(null,"cx",it[0]),H.setAttributeNS(null,"cy",it[1]),H.setAttributeNS(null,"r",et),H.setAttributeNS(null,"fx",X[0]),H.setAttributeNS(null,"fy",X[1]),H.setAttributeNS(null,"fr",Q);break;default:throw new Error(`Unknown RadialAxial type: ${f[1]}`)}for(const O of B){const z=this.svgFactory.createElement("svg:stop");z.setAttributeNS(null,"offset",O[0]),z.setAttributeNS(null,"stop-color",O[1]),H.append(z)}return this.defs.append(H),`url(#${S})`;case"Mesh":return(0,g.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${f[0]}`)}}setDash(f,S){this.current.dashArray=f,this.current.dashPhase=S}constructPath(f,S){const B=this.current;let H=B.x,O=B.y,z=[],X=0;for(const it of f)switch(it|0){case g.OPS.rectangle:H=S[X++],O=S[X++];const Q=S[X++],et=S[X++],nt=H+Q,$=O+et;z.push("M",e(H),e(O),"L",e(nt),e(O),"L",e(nt),e($),"L",e(H),e($),"Z");break;case g.OPS.moveTo:H=S[X++],O=S[X++],z.push("M",e(H),e(O));break;case g.OPS.lineTo:H=S[X++],O=S[X++],z.push("L",e(H),e(O));break;case g.OPS.curveTo:H=S[X+4],O=S[X+5],z.push("C",e(S[X]),e(S[X+1]),e(S[X+2]),e(S[X+3]),e(H),e(O)),X+=6;break;case g.OPS.curveTo2:z.push("C",e(H),e(O),e(S[X]),e(S[X+1]),e(S[X+2]),e(S[X+3])),H=S[X+2],O=S[X+3],X+=4;break;case g.OPS.curveTo3:H=S[X+2],O=S[X+3],z.push("C",e(S[X]),e(S[X+1]),e(H),e(O),e(H),e(O)),X+=4;break;case g.OPS.closePath:z.push("Z");break}z=z.join(" "),B.path&&f.length>0&&f[0]!==g.OPS.rectangle&&f[0]!==g.OPS.moveTo?z=B.path.getAttributeNS(null,"d")+z:(B.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(B.path)),B.path.setAttributeNS(null,"d",z),B.path.setAttributeNS(null,"fill","none"),B.element=B.path,B.setCurrentPoint(H,O)}endPath(){const f=this.current;if(f.path=null,!this.pendingClip)return;if(!f.element){this.pendingClip=null;return}const S=`clippath${p++}`,B=this.svgFactory.createElement("svg:clipPath");B.setAttributeNS(null,"id",S),B.setAttributeNS(null,"transform",u(this.transformMatrix));const H=f.element.cloneNode(!0);if(this.pendingClip==="evenodd"?H.setAttributeNS(null,"clip-rule","evenodd"):H.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,B.append(H),this.defs.append(B),f.activeClipUrl){f.clipGroup=null;for(const O of this.extraStack)O.clipGroup=null;B.setAttributeNS(null,"clip-path",f.activeClipUrl)}f.activeClipUrl=`url(#${S})`,this.tgrp=null}clip(f){this.pendingClip=f}closePath(){const f=this.current;if(f.path){const S=`${f.path.getAttributeNS(null,"d")}Z`;f.path.setAttributeNS(null,"d",S)}}setLeading(f){this.current.leading=-f}setTextRise(f){this.current.textRise=f}setTextRenderingMode(f){this.current.textRenderingMode=f}setHScale(f){this.current.textHScale=f/100}setRenderingIntent(f){}setFlatness(f){}setGState(f){for(const[S,B]of f)switch(S){case"LW":this.setLineWidth(B);break;case"LC":this.setLineCap(B);break;case"LJ":this.setLineJoin(B);break;case"ML":this.setMiterLimit(B);break;case"D":this.setDash(B[0],B[1]);break;case"RI":this.setRenderingIntent(B);break;case"FL":this.setFlatness(B);break;case"Font":this.setFont(B);break;case"CA":this.setStrokeAlpha(B);break;case"ca":this.setFillAlpha(B);break;default:(0,g.warn)(`Unimplemented graphic state operator ${S}`);break}}fill(){const f=this.current;f.element&&(f.element.setAttributeNS(null,"fill",f.fillColor),f.element.setAttributeNS(null,"fill-opacity",f.fillAlpha),this.endPath())}stroke(){const f=this.current;f.element&&(this._setStrokeAttributes(f.element),f.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(f,S=1){const B=this.current;let H=B.dashArray;S!==1&&H.length>0&&(H=H.map(function(O){return S*O})),f.setAttributeNS(null,"stroke",B.strokeColor),f.setAttributeNS(null,"stroke-opacity",B.strokeAlpha),f.setAttributeNS(null,"stroke-miterlimit",e(B.miterLimit)),f.setAttributeNS(null,"stroke-linecap",B.lineCap),f.setAttributeNS(null,"stroke-linejoin",B.lineJoin),f.setAttributeNS(null,"stroke-width",e(S*B.lineWidth)+"px"),f.setAttributeNS(null,"stroke-dasharray",H.map(e).join(" ")),f.setAttributeNS(null,"stroke-dashoffset",e(S*B.dashPhase)+"px")}eoFill(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const f=this.svgFactory.createElement("svg:rect");f.setAttributeNS(null,"x","0"),f.setAttributeNS(null,"y","0"),f.setAttributeNS(null,"width","1px"),f.setAttributeNS(null,"height","1px"),f.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(f)}paintImageXObject(f){const S=this.getObject(f);if(!S){(0,g.warn)(`Dependent image with object ID ${f} is not ready yet`);return}this.paintInlineImageXObject(S)}paintInlineImageXObject(f,S){const B=f.width,H=f.height,O=i(f,this.forceDataSchema,!!S),z=this.svgFactory.createElement("svg:rect");z.setAttributeNS(null,"x","0"),z.setAttributeNS(null,"y","0"),z.setAttributeNS(null,"width",e(B)),z.setAttributeNS(null,"height",e(H)),this.current.element=z,this.clip("nonzero");const X=this.svgFactory.createElement("svg:image");X.setAttributeNS(L,"xlink:href",O),X.setAttributeNS(null,"x","0"),X.setAttributeNS(null,"y",e(-H)),X.setAttributeNS(null,"width",e(B)+"px"),X.setAttributeNS(null,"height",e(H)+"px"),X.setAttributeNS(null,"transform",`scale(${e(1/B)} ${e(-1/H)})`),S?S.append(X):this._ensureTransformGroup().append(X)}paintImageMaskXObject(f){const S=this.getObject(f.data,f);if(S.bitmap){(0,g.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const B=this.current,H=S.width,O=S.height,z=B.fillColor;B.maskId=`mask${o++}`;const X=this.svgFactory.createElement("svg:mask");X.setAttributeNS(null,"id",B.maskId);const it=this.svgFactory.createElement("svg:rect");it.setAttributeNS(null,"x","0"),it.setAttributeNS(null,"y","0"),it.setAttributeNS(null,"width",e(H)),it.setAttributeNS(null,"height",e(O)),it.setAttributeNS(null,"fill",z),it.setAttributeNS(null,"mask",`url(#${B.maskId})`),this.defs.append(X),this._ensureTransformGroup().append(it),this.paintInlineImageXObject(S,X)}paintFormXObjectBegin(f,S){if(Array.isArray(f)&&f.length===6&&this.transform(f[0],f[1],f[2],f[3],f[4],f[5]),S){const B=S[2]-S[0],H=S[3]-S[1],O=this.svgFactory.createElement("svg:rect");O.setAttributeNS(null,"x",S[0]),O.setAttributeNS(null,"y",S[1]),O.setAttributeNS(null,"width",e(B)),O.setAttributeNS(null,"height",e(H)),this.current.element=O,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(f){const S=this.svgFactory.create(f.width,f.height),B=this.svgFactory.createElement("svg:defs");S.append(B),this.defs=B;const H=this.svgFactory.createElement("svg:g");return H.setAttributeNS(null,"transform",u(f.transform)),S.append(H),this.svg=H,S}_ensureClipGroup(){if(!this.current.clipGroup){const f=this.svgFactory.createElement("svg:g");f.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(f),this.current.clipGroup=f}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",u(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}s.SVGGraphics=R}),((w,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.XfaText=void 0;class y{static textContent(g){const P=[],C={items:P,styles:Object.create(null)};function L(j){if(!j)return;let n=null;const t=j.name;if(t==="#text")n=j.value;else if(y.shouldBuildText(t))j?.attributes?.textContent?n=j.attributes.textContent:j.value&&(n=j.value);else return;if(n!==null&&P.push({str:n}),!!j.children)for(const i of j.children)L(i)}return L(g),C}static shouldBuildText(g){return!(g==="textarea"||g==="input"||g==="option"||g==="select")}}s.XfaText=y}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.TextLayerRenderTask=void 0,s.renderTextLayer=u,s.updateTextLayer=p;var r=y(1),g=y(6);const P=1e5,C=30,L=.8,j=new Map;function n(o,v){let R;if(v&&r.FeatureTest.isOffscreenCanvasSupported)R=new OffscreenCanvas(o,o).getContext("2d",{alpha:!1});else{const T=document.createElement("canvas");T.width=T.height=o,R=T.getContext("2d",{alpha:!1})}return R}function t(o,v){const R=j.get(o);if(R)return R;const T=n(C,v);T.font=`${C}px ${o}`;const f=T.measureText("");let S=f.fontBoundingBoxAscent,B=Math.abs(f.fontBoundingBoxDescent);if(S){const O=S/(S+B);return j.set(o,O),T.canvas.width=T.canvas.height=0,O}T.strokeStyle="red",T.clearRect(0,0,C,C),T.strokeText("g",0,0);let H=T.getImageData(0,0,C,C).data;B=0;for(let O=H.length-1-3;O>=0;O-=4)if(H[O]>0){B=Math.ceil(O/4/C);break}T.clearRect(0,0,C,C),T.strokeText("A",0,C),H=T.getImageData(0,0,C,C).data,S=0;for(let O=0,z=H.length;O<z;O+=4)if(H[O]>0){S=C-Math.floor(O/4/C);break}if(T.canvas.width=T.canvas.height=0,S){const O=S/(S+B);return j.set(o,O),O}return j.set(o,L),L}function i(o,v,R){const T=document.createElement("span"),f={angle:0,canvasWidth:0,hasText:v.str!=="",hasEOL:v.hasEOL,fontSize:0};o._textDivs.push(T);const S=r.Util.transform(o._transform,v.transform);let B=Math.atan2(S[1],S[0]);const H=R[v.fontName];H.vertical&&(B+=Math.PI/2);const O=Math.hypot(S[2],S[3]),z=O*t(H.fontFamily,o._isOffscreenCanvasSupported);let X,it;B===0?(X=S[4],it=S[5]-z):(X=S[4]+z*Math.sin(B),it=S[5]-z*Math.cos(B));const Q="calc(var(--scale-factor)*",et=T.style;o._container===o._rootContainer?(et.left=`${(100*X/o._pageWidth).toFixed(2)}%`,et.top=`${(100*it/o._pageHeight).toFixed(2)}%`):(et.left=`${Q}${X.toFixed(2)}px)`,et.top=`${Q}${it.toFixed(2)}px)`),et.fontSize=`${Q}${O.toFixed(2)}px)`,et.fontFamily=H.fontFamily,f.fontSize=O,T.setAttribute("role","presentation"),T.textContent=v.str,T.dir=v.dir,o._fontInspectorEnabled&&(T.dataset.fontName=v.fontName),B!==0&&(f.angle=B*(180/Math.PI));let nt=!1;if(v.str.length>1)nt=!0;else if(v.str!==" "&&v.transform[0]!==v.transform[3]){const $=Math.abs(v.transform[0]),D=Math.abs(v.transform[3]);$!==D&&Math.max($,D)/Math.min($,D)>1.5&&(nt=!0)}nt&&(f.canvasWidth=H.vertical?v.height:v.width),o._textDivProperties.set(T,f),o._isReadableStream&&o._layoutText(T)}function h(o){const{div:v,scale:R,properties:T,ctx:f,prevFontSize:S,prevFontFamily:B}=o,{style:H}=v;let O="";if(T.canvasWidth!==0&&T.hasText){const{fontFamily:z}=H,{canvasWidth:X,fontSize:it}=T;(S!==it||B!==z)&&(f.font=`${it*R}px ${z}`,o.prevFontSize=it,o.prevFontFamily=z);const{width:Q}=f.measureText(v.textContent);Q>0&&(O=`scaleX(${X*R/Q})`)}T.angle!==0&&(O=`rotate(${T.angle}deg) ${O}`),O.length>0&&(H.transform=O)}function l(o){if(o._canceled)return;const v=o._textDivs,R=o._capability;if(v.length>P){R.resolve();return}if(!o._isReadableStream)for(const f of v)o._layoutText(f);R.resolve()}class e{constructor({textContentSource:v,container:R,viewport:T,textDivs:f,textDivProperties:S,textContentItemsStr:B,isOffscreenCanvasSupported:H}){this._textContentSource=v,this._isReadableStream=v instanceof ReadableStream,this._container=this._rootContainer=R,this._textDivs=f||[],this._textContentItemsStr=B||[],this._isOffscreenCanvasSupported=H,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=S||new WeakMap,this._canceled=!1,this._capability=new r.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:T.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:n(0,H)};const{pageWidth:O,pageHeight:z,pageX:X,pageY:it}=T.rawDims;this._transform=[1,0,0,-1,-X,it+z],this._pageWidth=O,this._pageHeight=z,(0,g.setLayerDimensions)(R,T),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new r.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new r.AbortException("TextLayer task cancelled."))}_processItems(v,R){for(const T of v){if(T.str===void 0){if(T.type==="beginMarkedContentProps"||T.type==="beginMarkedContent"){const f=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),T.id!==null&&this._container.setAttribute("id",`${T.id}`),f.append(this._container)}else T.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(T.str),i(this,T,R)}}_layoutText(v){const R=this._layoutTextParams.properties=this._textDivProperties.get(v);if(this._layoutTextParams.div=v,h(this._layoutTextParams),R.hasText&&this._container.append(v),R.hasEOL){const T=document.createElement("br");T.setAttribute("role","presentation"),this._container.append(T)}}_render(){const v=new r.PromiseCapability;let R=Object.create(null);if(this._isReadableStream){const T=()=>{this._reader.read().then(({value:f,done:S})=>{if(S){v.resolve();return}Object.assign(R,f.styles),this._processItems(f.items,R),T()},v.reject)};this._reader=this._textContentSource.getReader(),T()}else if(this._textContentSource){const{items:T,styles:f}=this._textContentSource;this._processItems(T,f),v.resolve()}else throw new Error('No "textContentSource" parameter specified.');v.promise.then(()=>{R=null,l(this)},this._capability.reject)}}s.TextLayerRenderTask=e;function u(o){!o.textContentSource&&(o.textContent||o.textContentStream)&&((0,g.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),o.textContentSource=o.textContent||o.textContentStream);const{container:v,viewport:R}=o,T=getComputedStyle(v),f=T.getPropertyValue("visibility"),S=parseFloat(T.getPropertyValue("--scale-factor"));f==="visible"&&(!S||Math.abs(S-R.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const B=new e(o);return B._render(),B}function p({container:o,viewport:v,textDivs:R,textDivProperties:T,isOffscreenCanvasSupported:f,mustRotate:S=!0,mustRescale:B=!0}){if(S&&(0,g.setLayerDimensions)(o,{rotation:v.rotation}),B){const H=n(0,f),z={prevFontSize:null,prevFontFamily:null,div:null,scale:v.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:H};for(const X of R)z.properties=T.get(X),z.div=X,h(z)}}}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.AnnotationEditorLayer=void 0;var r=y(1),g=y(4),P=y(28),C=y(33),L=y(6),j=y(34);class n{#t;#e=!1;#i=null;#s=this.pointerup.bind(this);#o=this.pointerdown.bind(this);#a=new Map;#r=!1;#l=!1;#c=!1;#n;static _initialized=!1;constructor({uiManager:i,pageIndex:h,div:l,accessibilityManager:e,annotationLayer:u,viewport:p,l10n:o}){const v=[P.FreeTextEditor,C.InkEditor,j.StampEditor];if(!n._initialized){n._initialized=!0;for(const R of v)R.initialize(o)}i.registerEditorTypes(v),this.#n=i,this.pageIndex=h,this.div=l,this.#t=e,this.#i=u,this.viewport=p,this.#n.addLayer(this)}get isEmpty(){return this.#a.size===0}updateToolbar(i){this.#n.updateToolbar(i)}updateMode(i=this.#n.getMode()){this.#p(),i===r.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),i!==r.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",i===r.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",i===r.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",i===r.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(i){if(!i&&this.#n.getMode()!==r.AnnotationEditorType.INK)return;if(!i){for(const l of this.#a.values())if(l.isEmpty()){l.setInBackground();return}}this.#d({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(i){this.#n.setEditingState(i)}addCommands(i){this.#n.addCommands(i)}enable(){this.div.style.pointerEvents="auto";const i=new Set;for(const l of this.#a.values())l.enableEditing(),l.annotationElementId&&i.add(l.annotationElementId);if(!this.#i)return;const h=this.#i.getEditableAnnotations();for(const l of h){if(l.hide(),this.#n.isDeletedAnnotationElement(l.data.id)||i.has(l.data.id))continue;const e=this.deserialize(l);e&&(this.addOrRebuild(e),e.enableEditing())}}disable(){this.#c=!0,this.div.style.pointerEvents="none";const i=new Set;for(const h of this.#a.values()){if(h.disableEditing(),!h.annotationElementId||h.serialize()!==null){i.add(h.annotationElementId);continue}this.getEditableAnnotation(h.annotationElementId)?.show(),h.remove()}if(this.#i){const h=this.#i.getEditableAnnotations();for(const l of h){const{id:e}=l.data;i.has(e)||this.#n.isDeletedAnnotationElement(e)||l.show()}}this.#p(),this.isEmpty&&(this.div.hidden=!0),this.#c=!1}getEditableAnnotation(i){return this.#i?.getEditableAnnotation(i)||null}setActiveEditor(i){this.#n.getActive()!==i&&this.#n.setActiveEditor(i)}enableClick(){this.div.addEventListener("pointerdown",this.#o),this.div.addEventListener("pointerup",this.#s)}disableClick(){this.div.removeEventListener("pointerdown",this.#o),this.div.removeEventListener("pointerup",this.#s)}attach(i){this.#a.set(i.id,i);const{annotationElementId:h}=i;h&&this.#n.isDeletedAnnotationElement(h)&&this.#n.removeDeletedAnnotationElement(i)}detach(i){this.#a.delete(i.id),this.#t?.removePointerInTextLayer(i.contentDiv),!this.#c&&i.annotationElementId&&this.#n.addDeletedAnnotationElement(i)}remove(i){this.detach(i),this.#n.removeEditor(i),i.div.contains(document.activeElement)&&setTimeout(()=>{this.#n.focusMainContainer()},0),i.div.remove(),i.isAttachedToDOM=!1,this.#l||this.addInkEditorIfNeeded(!1)}changeParent(i){i.parent!==this&&(i.annotationElementId&&(this.#n.addDeletedAnnotationElement(i.annotationElementId),g.AnnotationEditor.deleteAnnotationElement(i),i.annotationElementId=null),this.attach(i),i.parent?.detach(i),i.setParent(this),i.div&&i.isAttachedToDOM&&(i.div.remove(),this.div.append(i.div)))}add(i){if(this.changeParent(i),this.#n.addEditor(i),this.attach(i),!i.isAttachedToDOM){const h=i.render();this.div.append(h),i.isAttachedToDOM=!0}i.fixAndSetPosition(),i.onceAdded(),this.#n.addToAnnotationStorage(i)}moveEditorInDOM(i){if(!i.isAttachedToDOM)return;const{activeElement:h}=document;i.div.contains(h)&&(i._focusEventsAllowed=!1,setTimeout(()=>{i.div.contains(document.activeElement)?i._focusEventsAllowed=!0:(i.div.addEventListener("focusin",()=>{i._focusEventsAllowed=!0},{once:!0}),h.focus())},0)),i._structTreeParentId=this.#t?.moveElementInDOM(this.div,i.div,i.contentDiv,!0)}addOrRebuild(i){i.needsToBeRebuilt()?i.rebuild():this.add(i)}addUndoableEditor(i){const h=()=>i._uiManager.rebuild(i),l=()=>{i.remove()};this.addCommands({cmd:h,undo:l,mustExec:!1})}getNextId(){return this.#n.getId()}#f(i){switch(this.#n.getMode()){case r.AnnotationEditorType.FREETEXT:return new P.FreeTextEditor(i);case r.AnnotationEditorType.INK:return new C.InkEditor(i);case r.AnnotationEditorType.STAMP:return new j.StampEditor(i)}return null}pasteEditor(i,h){this.#n.updateToolbar(i),this.#n.updateMode(i);const{offsetX:l,offsetY:e}=this.#u(),u=this.getNextId(),p=this.#f({parent:this,id:u,x:l,y:e,uiManager:this.#n,isCentered:!0,...h});p&&this.add(p)}deserialize(i){switch(i.annotationType??i.annotationEditorType){case r.AnnotationEditorType.FREETEXT:return P.FreeTextEditor.deserialize(i,this,this.#n);case r.AnnotationEditorType.INK:return C.InkEditor.deserialize(i,this,this.#n);case r.AnnotationEditorType.STAMP:return j.StampEditor.deserialize(i,this,this.#n)}return null}#d(i,h){const l=this.getNextId(),e=this.#f({parent:this,id:l,x:i.offsetX,y:i.offsetY,uiManager:this.#n,isCentered:h});return e&&this.add(e),e}#u(){const{x:i,y:h,width:l,height:e}=this.div.getBoundingClientRect(),u=Math.max(0,i),p=Math.max(0,h),o=Math.min(window.innerWidth,i+l),v=Math.min(window.innerHeight,h+e),R=(u+o)/2-i,T=(p+v)/2-h,[f,S]=this.viewport.rotation%180===0?[R,T]:[T,R];return{offsetX:f,offsetY:S}}addNewEditor(){this.#d(this.#u(),!0)}setSelected(i){this.#n.setSelected(i)}toggleSelected(i){this.#n.toggleSelected(i)}isSelected(i){return this.#n.isSelected(i)}unselect(i){this.#n.unselect(i)}pointerup(i){const{isMac:h}=r.FeatureTest.platform;if(!(i.button!==0||i.ctrlKey&&h)&&i.target===this.div&&this.#r){if(this.#r=!1,!this.#e){this.#e=!0;return}if(this.#n.getMode()===r.AnnotationEditorType.STAMP){this.#n.unselectAll();return}this.#d(i,!1)}}pointerdown(i){if(this.#r){this.#r=!1;return}const{isMac:h}=r.FeatureTest.platform;if(i.button!==0||i.ctrlKey&&h||i.target!==this.div)return;this.#r=!0;const l=this.#n.getActive();this.#e=!l||l.isEmpty()}findNewParent(i,h,l){const e=this.#n.findParent(h,l);return e===null||e===this?!1:(e.changeParent(i),!0)}destroy(){this.#n.getActive()?.parent===this&&(this.#n.commitOrRemove(),this.#n.setActiveEditor(null));for(const i of this.#a.values())this.#t?.removePointerInTextLayer(i.contentDiv),i.setParent(null),i.isAttachedToDOM=!1,i.div.remove();this.div=null,this.#a.clear(),this.#n.removeLayer(this)}#p(){this.#l=!0;for(const i of this.#a.values())i.isEmpty()&&i.remove();this.#l=!1}render({viewport:i}){this.viewport=i,(0,L.setLayerDimensions)(this.div,i);for(const h of this.#n.getEditors(this.pageIndex))this.add(h);this.updateMode()}update({viewport:i}){this.#n.commitOrRemove(),this.viewport=i,(0,L.setLayerDimensions)(this.div,{rotation:i.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:i,pageHeight:h}=this.viewport.rawDims;return[i,h]}}s.AnnotationEditorLayer=n}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.FreeTextEditor=void 0;var r=y(1),g=y(5),P=y(4),C=y(29);class L extends P.AnnotationEditor{#t=this.editorDivBlur.bind(this);#e=this.editorDivFocus.bind(this);#i=this.editorDivInput.bind(this);#s=this.editorDivKeydown.bind(this);#o;#a="";#r=`${this.id}-editor`;#l;#c=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const n=L.prototype,t=l=>l.isEmpty(),i=g.AnnotationEditorUIManager.TRANSLATE_SMALL,h=g.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,r.shadow)(this,"_keyboardManager",new g.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],n.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],n.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],n._translateEmpty,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],n._translateEmpty,{args:[-h,0],checker:t}],[["ArrowRight","mac+ArrowRight"],n._translateEmpty,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],n._translateEmpty,{args:[h,0],checker:t}],[["ArrowUp","mac+ArrowUp"],n._translateEmpty,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],n._translateEmpty,{args:[0,-h],checker:t}],[["ArrowDown","mac+ArrowDown"],n._translateEmpty,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],n._translateEmpty,{args:[0,h],checker:t}]]))}static _type="freetext";constructor(n){super({...n,name:"freeTextEditor"}),this.#o=n.color||L._defaultColor||P.AnnotationEditor._defaultLineColor,this.#l=n.fontSize||L._defaultFontSize}static initialize(n){P.AnnotationEditor.initialize(n,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const t=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(t.getPropertyValue("--freetext-padding"))}static updateDefaultParams(n,t){switch(n){case r.AnnotationEditorParamsType.FREETEXT_SIZE:L._defaultFontSize=t;break;case r.AnnotationEditorParamsType.FREETEXT_COLOR:L._defaultColor=t;break}}updateParams(n,t){switch(n){case r.AnnotationEditorParamsType.FREETEXT_SIZE:this.#n(t);break;case r.AnnotationEditorParamsType.FREETEXT_COLOR:this.#f(t);break}}static get defaultPropertiesToUpdate(){return[[r.AnnotationEditorParamsType.FREETEXT_SIZE,L._defaultFontSize],[r.AnnotationEditorParamsType.FREETEXT_COLOR,L._defaultColor||P.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[r.AnnotationEditorParamsType.FREETEXT_SIZE,this.#l],[r.AnnotationEditorParamsType.FREETEXT_COLOR,this.#o]]}#n(n){const t=h=>{this.editorDiv.style.fontSize=`calc(${h}px * var(--scale-factor))`,this.translate(0,-(h-this.#l)*this.parentScale),this.#l=h,this.#u()},i=this.#l;this.addCommands({cmd:()=>{t(n)},undo:()=>{t(i)},mustExec:!0,type:r.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#f(n){const t=this.#o;this.addCommands({cmd:()=>{this.#o=this.editorDiv.style.color=n},undo:()=>{this.#o=this.editorDiv.style.color=t},mustExec:!0,type:r.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(n,t){this._uiManager.translateSelectedEditors(n,t,!0)}getInitialTranslation(){const n=this.parentScale;return[-L._internalPadding*n,-(L._internalPadding+this.#l)*n]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(r.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",this.#s),this.editorDiv.addEventListener("focus",this.#e),this.editorDiv.addEventListener("blur",this.#t),this.editorDiv.addEventListener("input",this.#i))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#r),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",this.#s),this.editorDiv.removeEventListener("focus",this.#e),this.editorDiv.removeEventListener("blur",this.#t),this.editorDiv.removeEventListener("input",this.#i),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(n){this._focusEventsAllowed&&(super.focusin(n),n.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){if(this.width){this.#m();return}this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}#d(){const n=this.editorDiv.getElementsByTagName("div");if(n.length===0)return this.editorDiv.innerText;const t=[];for(const i of n)t.push(i.innerText.replace(/\r\n?|\n/,""));return t.join(`
`)}#u(){const[n,t]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:h,div:l}=this,e=l.style.display;l.style.display="hidden",h.div.append(this.div),i=l.getBoundingClientRect(),l.remove(),l.style.display=e}this.rotation%180===this.parentRotation%180?(this.width=i.width/n,this.height=i.height/t):(this.width=i.height/n,this.height=i.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const n=this.#a,t=this.#a=this.#d().trimEnd();if(n===t)return;const i=h=>{if(this.#a=h,!h){this.remove();return}this.#p(),this._uiManager.rebuild(this),this.#u()};this.addCommands({cmd:()=>{i(t)},undo:()=>{i(n)},mustExec:!1}),this.#u()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(n){this.enterInEditMode()}keydown(n){n.target===this.div&&n.key==="Enter"&&(this.enterInEditMode(),n.preventDefault())}editorDivKeydown(n){L._keyboardManager.exec(this,n)}editorDivFocus(n){this.isEditing=!0}editorDivBlur(n){this.isEditing=!1}editorDivInput(n){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let n,t;this.width&&(n=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#r),this.enableEditing(),P.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(h=>this.editorDiv?.setAttribute("aria-label",h)),P.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(h=>this.editorDiv?.setAttribute("default-content",h)),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${this.#l}px * var(--scale-factor))`,i.color=this.#o,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,g.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[h,l]=this.parentDimensions;if(this.annotationElementId){const{position:e}=this.#c;let[u,p]=this.getInitialTranslation();[u,p]=this.pageTranslationToScreen(u,p);const[o,v]=this.pageDimensions,[R,T]=this.pageTranslation;let f,S;switch(this.rotation){case 0:f=n+(e[0]-R)/o,S=t+this.height-(e[1]-T)/v;break;case 90:f=n+(e[0]-R)/o,S=t-(e[1]-T)/v,[u,p]=[p,-u];break;case 180:f=n-this.width+(e[0]-R)/o,S=t-(e[1]-T)/v,[u,p]=[-u,-p];break;case 270:f=n+(e[0]-R-this.height*v)/o,S=t+(e[1]-T-this.width*o)/v,[u,p]=[-p,u];break}this.setAt(f*h,S*l,u,p)}else this.setAt(n*h,t*l,this.width*h,this.height*l);this.#p(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}#p(){if(this.editorDiv.replaceChildren(),!!this.#a)for(const n of this.#a.split(`
`)){const t=document.createElement("div");t.append(n?document.createTextNode(n):document.createElement("br")),this.editorDiv.append(t)}}get contentDiv(){return this.editorDiv}static deserialize(n,t,i){let h=null;if(n instanceof C.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:e,fontColor:u},rect:p,rotation:o,id:v},textContent:R,textPosition:T,parent:{page:{pageNumber:f}}}=n;if(!R||R.length===0)return null;h=n={annotationType:r.AnnotationEditorType.FREETEXT,color:Array.from(u),fontSize:e,value:R.join(`
`),position:T,pageIndex:f-1,rect:p,rotation:o,id:v,deleted:!1}}const l=super.deserialize(n,t,i);return l.#l=n.fontSize,l.#o=r.Util.makeHexColor(...n.color),l.#a=n.value,l.annotationElementId=n.id||null,l.#c=h,l}serialize(n=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const t=L._internalPadding*this.parentScale,i=this.getRect(t,t),h=P.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#o),l={annotationType:r.AnnotationEditorType.FREETEXT,color:h,fontSize:this.#l,value:this.#a,pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return n?l:this.annotationElementId&&!this.#b(l)?null:(l.id=this.annotationElementId,l)}#b(n){const{value:t,fontSize:i,color:h,rect:l,pageIndex:e}=this.#c;return n.value!==t||n.fontSize!==i||n.rect.some((u,p)=>Math.abs(u-l[p])>=1)||n.color.some((u,p)=>u!==h[p])||n.pageIndex!==e}#m(n=!1){if(!this.annotationElementId)return;if(this.#u(),!n&&(this.width===0||this.height===0)){setTimeout(()=>this.#m(!0),0);return}const t=L._internalPadding*this.parentScale;this.#c.rect=this.getRect(t,t)}}s.FreeTextEditor=L}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.StampAnnotationElement=s.InkAnnotationElement=s.FreeTextAnnotationElement=s.AnnotationLayer=void 0;var r=y(1),g=y(6),P=y(3),C=y(30),L=y(31),j=y(32);const n=1e3,t=9,i=new WeakSet;function h(E){return{width:E[2]-E[0],height:E[3]-E[1]}}class l{static create(a){switch(a.data.annotationType){case r.AnnotationType.LINK:return new u(a);case r.AnnotationType.TEXT:return new p(a);case r.AnnotationType.WIDGET:switch(a.data.fieldType){case"Tx":return new v(a);case"Btn":return a.data.radioButton?new f(a):a.data.checkBox?new T(a):new S(a);case"Ch":return new B(a);case"Sig":return new R(a)}return new o(a);case r.AnnotationType.POPUP:return new H(a);case r.AnnotationType.FREETEXT:return new z(a);case r.AnnotationType.LINE:return new X(a);case r.AnnotationType.SQUARE:return new it(a);case r.AnnotationType.CIRCLE:return new Q(a);case r.AnnotationType.POLYLINE:return new et(a);case r.AnnotationType.CARET:return new $(a);case r.AnnotationType.INK:return new D(a);case r.AnnotationType.POLYGON:return new nt(a);case r.AnnotationType.HIGHLIGHT:return new b(a);case r.AnnotationType.UNDERLINE:return new c(a);case r.AnnotationType.SQUIGGLY:return new d(a);case r.AnnotationType.STRIKEOUT:return new _(a);case r.AnnotationType.STAMP:return new F(a);case r.AnnotationType.FILEATTACHMENT:return new M(a);default:return new e(a)}}}class e{#t=!1;constructor(a,{isRenderable:m=!1,ignoreBorder:A=!1,createQuadrilaterals:x=!1}={}){this.isRenderable=m,this.data=a.data,this.layer=a.layer,this.linkService=a.linkService,this.downloadManager=a.downloadManager,this.imageResourcesPath=a.imageResourcesPath,this.renderForms=a.renderForms,this.svgFactory=a.svgFactory,this.annotationStorage=a.annotationStorage,this.enableScripting=a.enableScripting,this.hasJSActions=a.hasJSActions,this._fieldObjects=a.fieldObjects,this.parent=a.parent,m&&(this.container=this._createContainer(A)),x&&this._createQuadrilaterals()}static _hasPopupData({titleObj:a,contentsObj:m,richText:A}){return!!(a?.str||m?.str||A?.str)}get hasPopupData(){return e._hasPopupData(this.data)}_createContainer(a){const{data:m,parent:{page:A,viewport:x}}=this,k=document.createElement("section");k.setAttribute("data-annotation-id",m.id),this instanceof o||(k.tabIndex=n),k.style.zIndex=this.parent.zIndex++,this.data.popupRef&&k.setAttribute("aria-haspopup","dialog"),m.noRotate&&k.classList.add("norotate");const{pageWidth:N,pageHeight:U,pageX:q,pageY:st}=x.rawDims;if(!m.rect||this instanceof H){const{rotation:Z}=m;return!m.hasOwnCanvas&&Z!==0&&this.setRotation(Z,k),k}const{width:V,height:Y}=h(m.rect),K=r.Util.normalizeRect([m.rect[0],A.view[3]-m.rect[1]+A.view[1],m.rect[2],A.view[3]-m.rect[3]+A.view[1]]);if(!a&&m.borderStyle.width>0){k.style.borderWidth=`${m.borderStyle.width}px`;const Z=m.borderStyle.horizontalCornerRadius,rt=m.borderStyle.verticalCornerRadius;if(Z>0||rt>0){const lt=`calc(${Z}px * var(--scale-factor)) / calc(${rt}px * var(--scale-factor))`;k.style.borderRadius=lt}else if(this instanceof f){const lt=`calc(${V}px * var(--scale-factor)) / calc(${Y}px * var(--scale-factor))`;k.style.borderRadius=lt}switch(m.borderStyle.style){case r.AnnotationBorderStyleType.SOLID:k.style.borderStyle="solid";break;case r.AnnotationBorderStyleType.DASHED:k.style.borderStyle="dashed";break;case r.AnnotationBorderStyleType.BEVELED:(0,r.warn)("Unimplemented border style: beveled");break;case r.AnnotationBorderStyleType.INSET:(0,r.warn)("Unimplemented border style: inset");break;case r.AnnotationBorderStyleType.UNDERLINE:k.style.borderBottomStyle="solid";break}const ot=m.borderColor||null;ot?(this.#t=!0,k.style.borderColor=r.Util.makeHexColor(ot[0]|0,ot[1]|0,ot[2]|0)):k.style.borderWidth=0}k.style.left=`${100*(K[0]-q)/N}%`,k.style.top=`${100*(K[1]-st)/U}%`;const{rotation:J}=m;return m.hasOwnCanvas||J===0?(k.style.width=`${100*V/N}%`,k.style.height=`${100*Y/U}%`):this.setRotation(J,k),k}setRotation(a,m=this.container){if(!this.data.rect)return;const{pageWidth:A,pageHeight:x}=this.parent.viewport.rawDims,{width:k,height:N}=h(this.data.rect);let U,q;a%180===0?(U=100*k/A,q=100*N/x):(U=100*N/A,q=100*k/x),m.style.width=`${U}%`,m.style.height=`${q}%`,m.setAttribute("data-main-rotation",(360-a)%360)}get _commonActions(){const a=(m,A,x)=>{const k=x.detail[m],N=k[0],U=k.slice(1);x.target.style[A]=C.ColorConverters[`${N}_HTML`](U),this.annotationStorage.setValue(this.data.id,{[A]:C.ColorConverters[`${N}_rgb`](U)})};return(0,r.shadow)(this,"_commonActions",{display:m=>{const{display:A}=m.detail,x=A%2===1;this.container.style.visibility=x?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:x,noPrint:A===1||A===2})},print:m=>{this.annotationStorage.setValue(this.data.id,{noPrint:!m.detail.print})},hidden:m=>{const{hidden:A}=m.detail;this.container.style.visibility=A?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:A,noView:A})},focus:m=>{setTimeout(()=>m.target.focus({preventScroll:!1}),0)},userName:m=>{m.target.title=m.detail.userName},readonly:m=>{m.target.disabled=m.detail.readonly},required:m=>{this._setRequired(m.target,m.detail.required)},bgColor:m=>{a("bgColor","backgroundColor",m)},fillColor:m=>{a("fillColor","backgroundColor",m)},fgColor:m=>{a("fgColor","color",m)},textColor:m=>{a("textColor","color",m)},borderColor:m=>{a("borderColor","borderColor",m)},strokeColor:m=>{a("strokeColor","borderColor",m)},rotation:m=>{const A=m.detail.rotation;this.setRotation(A),this.annotationStorage.setValue(this.data.id,{rotation:A})}})}_dispatchEventFromSandbox(a,m){const A=this._commonActions;for(const x of Object.keys(m.detail))(a[x]||A[x])?.(m)}_setDefaultPropertiesFromJS(a){if(!this.enableScripting)return;const m=this.annotationStorage.getRawValue(this.data.id);if(!m)return;const A=this._commonActions;for(const[x,k]of Object.entries(m)){const N=A[x];if(N){const U={detail:{[x]:k},target:a};N(U),delete m[x]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:a}=this.data;if(!a)return;const[m,A,x,k]=this.data.rect;if(a.length===1){const[,{x:rt,y:ot},{x:lt,y:ct}]=a[0];if(x===rt&&k===ot&&m===lt&&A===ct)return}const{style:N}=this.container;let U;if(this.#t){const{borderColor:rt,borderWidth:ot}=N;N.borderWidth=0,U=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${rt}" stroke-width="${ot}">`],this.container.classList.add("hasBorder")}const q=x-m,st=k-A,{svgFactory:V}=this,Y=V.createElement("svg");Y.classList.add("quadrilateralsContainer"),Y.setAttribute("width",0),Y.setAttribute("height",0);const K=V.createElement("defs");Y.append(K);const J=V.createElement("clipPath"),Z=`clippath_${this.data.id}`;J.setAttribute("id",Z),J.setAttribute("clipPathUnits","objectBoundingBox"),K.append(J);for(const[,{x:rt,y:ot},{x:lt,y:ct}]of a){const ht=V.createElement("rect"),ut=(lt-m)/q,At=(k-ot)/st,mt=(rt-lt)/q,xt=(ot-ct)/st;ht.setAttribute("x",ut),ht.setAttribute("y",At),ht.setAttribute("width",mt),ht.setAttribute("height",xt),J.append(ht),U?.push(`<rect vector-effect="non-scaling-stroke" x="${ut}" y="${At}" width="${mt}" height="${xt}"/>`)}this.#t&&(U.push("</g></svg>')"),N.backgroundImage=U.join("")),this.container.append(Y),this.container.style.clipPath=`url(#${Z})`}_createPopup(){const{container:a,data:m}=this;a.setAttribute("aria-haspopup","dialog");const A=new H({data:{color:m.color,titleObj:m.titleObj,modificationDate:m.modificationDate,contentsObj:m.contentsObj,richText:m.richText,parentRect:m.rect,borderStyle:0,id:`popup_${m.id}`,rotation:m.rotation},parent:this.parent,elements:[this]});this.parent.div.append(A.render())}render(){(0,r.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(a,m=null){const A=[];if(this._fieldObjects){const x=this._fieldObjects[a];if(x)for(const{page:k,id:N,exportValues:U}of x){if(k===-1||N===m)continue;const q=typeof U=="string"?U:null,st=document.querySelector(`[data-element-id="${N}"]`);if(st&&!i.has(st)){(0,r.warn)(`_getElementsByName - element not allowed: ${N}`);continue}A.push({id:N,exportValue:q,domElement:st})}return A}for(const x of document.getElementsByName(a)){const{exportValue:k}=x,N=x.getAttribute("data-element-id");N!==m&&i.has(x)&&A.push({id:N,exportValue:k,domElement:x})}return A}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const a=this.getElementsToTriggerPopup();if(Array.isArray(a))for(const m of a)m.classList.add("highlightArea");else a.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:a,data:{id:m}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:a,editId:m})})}}class u extends e{constructor(a,m=null){super(a,{isRenderable:!0,ignoreBorder:!!m?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=a.data.isTooltipOnly}render(){const{data:a,linkService:m}=this,A=document.createElement("a");A.setAttribute("data-element-id",a.id);let x=!1;return a.url?(m.addLinkAttributes(A,a.url,a.newWindow),x=!0):a.action?(this._bindNamedAction(A,a.action),x=!0):a.attachment?(this._bindAttachment(A,a.attachment),x=!0):a.setOCGState?(this.#e(A,a.setOCGState),x=!0):a.dest?(this._bindLink(A,a.dest),x=!0):(a.actions&&(a.actions.Action||a.actions["Mouse Up"]||a.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(A,a),x=!0),a.resetForm?(this._bindResetFormAction(A,a.resetForm),x=!0):this.isTooltipOnly&&!x&&(this._bindLink(A,""),x=!0)),this.container.classList.add("linkAnnotation"),x&&this.container.append(A),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(a,m){a.href=this.linkService.getDestinationHash(m),a.onclick=()=>(m&&this.linkService.goToDestination(m),!1),(m||m==="")&&this.#t()}_bindNamedAction(a,m){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.linkService.executeNamedAction(m),!1),this.#t()}_bindAttachment(a,m){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.downloadManager?.openOrDownloadData(this.container,m.content,m.filename),!1),this.#t()}#e(a,m){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.linkService.executeSetOCGState(m),!1),this.#t()}_bindJSAction(a,m){a.href=this.linkService.getAnchorUrl("");const A=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const x of Object.keys(m.actions)){const k=A.get(x);k&&(a[k]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:m.id,name:x}}),!1))}a.onclick||(a.onclick=()=>!1),this.#t()}_bindResetFormAction(a,m){const A=a.onclick;if(A||(a.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){(0,r.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),A||(a.onclick=()=>!1);return}a.onclick=()=>{A?.();const{fields:x,refs:k,include:N}=m,U=[];if(x.length!==0||k.length!==0){const V=new Set(k);for(const Y of x){const K=this._fieldObjects[Y]||[];for(const{id:J}of K)V.add(J)}for(const Y of Object.values(this._fieldObjects))for(const K of Y)V.has(K.id)===N&&U.push(K)}else for(const V of Object.values(this._fieldObjects))U.push(...V);const q=this.annotationStorage,st=[];for(const V of U){const{id:Y}=V;switch(st.push(Y),V.type){case"text":{const J=V.defaultValue||"";q.setValue(Y,{value:J});break}case"checkbox":case"radiobutton":{const J=V.defaultValue===V.exportValues;q.setValue(Y,{value:J});break}case"combobox":case"listbox":{const J=V.defaultValue||"";q.setValue(Y,{value:J});break}default:continue}const K=document.querySelector(`[data-element-id="${Y}"]`);if(K){if(!i.has(K)){(0,r.warn)(`_bindResetFormAction - element not allowed: ${Y}`);continue}}else continue;K.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:st,name:"ResetForm"}}),!1}}}class p extends e{constructor(a){super(a,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const a=document.createElement("img");return a.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",a.alt="[{{type}} Annotation]",a.dataset.l10nId="text_annotation_type",a.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(a),this.container}}class o extends e{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(a){this.data.hasOwnCanvas&&(a.previousSibling?.nodeName==="CANVAS"&&(a.previousSibling.hidden=!0),a.hidden=!1)}_getKeyModifier(a){const{isWin:m,isMac:A}=r.FeatureTest.platform;return m&&a.ctrlKey||A&&a.metaKey}_setEventListener(a,m,A,x,k){A.includes("mouse")?a.addEventListener(A,N=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:x,value:k(N),shift:N.shiftKey,modifier:this._getKeyModifier(N)}})}):a.addEventListener(A,N=>{if(A==="blur"){if(!m.focused||!N.relatedTarget)return;m.focused=!1}else if(A==="focus"){if(m.focused)return;m.focused=!0}k&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:x,value:k(N)}})})}_setEventListeners(a,m,A,x){for(const[k,N]of A)(N==="Action"||this.data.actions?.[N])&&((N==="Focus"||N==="Blur")&&(m||={focused:!1}),this._setEventListener(a,m,k,N,x),N==="Focus"&&!this.data.actions?.Blur?this._setEventListener(a,m,"blur","Blur",null):N==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(a,m,"focus","Focus",null))}_setBackgroundColor(a){const m=this.data.backgroundColor||null;a.style.backgroundColor=m===null?"transparent":r.Util.makeHexColor(m[0],m[1],m[2])}_setTextStyle(a){const m=["left","center","right"],{fontColor:A}=this.data.defaultAppearanceData,x=this.data.defaultAppearanceData.fontSize||t,k=a.style;let N;const U=2,q=st=>Math.round(10*st)/10;if(this.data.multiLine){const st=Math.abs(this.data.rect[3]-this.data.rect[1]-U),V=Math.round(st/(r.LINE_FACTOR*x))||1,Y=st/V;N=Math.min(x,q(Y/r.LINE_FACTOR))}else{const st=Math.abs(this.data.rect[3]-this.data.rect[1]-U);N=Math.min(x,q(st/r.LINE_FACTOR))}k.fontSize=`calc(${N}px * var(--scale-factor))`,k.color=r.Util.makeHexColor(A[0],A[1],A[2]),this.data.textAlignment!==null&&(k.textAlign=m[this.data.textAlignment])}_setRequired(a,m){m?a.setAttribute("required",!0):a.removeAttribute("required"),a.setAttribute("aria-required",m)}}class v extends o{constructor(a){const m=a.renderForms||!a.data.hasAppearance&&!!a.data.fieldValue;super(a,{isRenderable:m})}setPropertyOnSiblings(a,m,A,x){const k=this.annotationStorage;for(const N of this._getElementsByName(a.name,a.id))N.domElement&&(N.domElement[m]=A),k.setValue(N.id,{[x]:A})}render(){const a=this.annotationStorage,m=this.data.id;this.container.classList.add("textWidgetAnnotation");let A=null;if(this.renderForms){const x=a.getValue(m,{value:this.data.fieldValue});let k=x.value||"";const N=a.getValue(m,{charLimit:this.data.maxLen}).charLimit;N&&k.length>N&&(k=k.slice(0,N));let U=x.formattedValue||this.data.textContent?.join(`
`)||null;U&&this.data.comb&&(U=U.replaceAll(/\s+/g,""));const q={userValue:k,formattedValue:U,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(A=document.createElement("textarea"),A.textContent=U??k,this.data.doNotScroll&&(A.style.overflowY="hidden")):(A=document.createElement("input"),A.type="text",A.setAttribute("value",U??k),this.data.doNotScroll&&(A.style.overflowX="hidden")),this.data.hasOwnCanvas&&(A.hidden=!0),i.add(A),A.setAttribute("data-element-id",m),A.disabled=this.data.readOnly,A.name=this.data.fieldName,A.tabIndex=n,this._setRequired(A,this.data.required),N&&(A.maxLength=N),A.addEventListener("input",V=>{a.setValue(m,{value:V.target.value}),this.setPropertyOnSiblings(A,"value",V.target.value,"value"),q.formattedValue=null}),A.addEventListener("resetform",V=>{const Y=this.data.defaultFieldValue??"";A.value=q.userValue=Y,q.formattedValue=null});let st=V=>{const{formattedValue:Y}=q;Y!=null&&(V.target.value=Y),V.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){A.addEventListener("focus",Y=>{if(q.focused)return;const{target:K}=Y;q.userValue&&(K.value=q.userValue),q.lastCommittedValue=K.value,q.commitKey=1,q.focused=!0}),A.addEventListener("updatefromsandbox",Y=>{this.showElementAndHideCanvas(Y.target);const K={value(J){q.userValue=J.detail.value??"",a.setValue(m,{value:q.userValue.toString()}),J.target.value=q.userValue},formattedValue(J){const{formattedValue:Z}=J.detail;q.formattedValue=Z,Z!=null&&J.target!==document.activeElement&&(J.target.value=Z),a.setValue(m,{formattedValue:Z})},selRange(J){J.target.setSelectionRange(...J.detail.selRange)},charLimit:J=>{const{charLimit:Z}=J.detail,{target:rt}=J;if(Z===0){rt.removeAttribute("maxLength");return}rt.setAttribute("maxLength",Z);let ot=q.userValue;!ot||ot.length<=Z||(ot=ot.slice(0,Z),rt.value=q.userValue=ot,a.setValue(m,{value:ot}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:m,name:"Keystroke",value:ot,willCommit:!0,commitKey:1,selStart:rt.selectionStart,selEnd:rt.selectionEnd}}))}};this._dispatchEventFromSandbox(K,Y)}),A.addEventListener("keydown",Y=>{q.commitKey=1;let K=-1;if(Y.key==="Escape"?K=0:Y.key==="Enter"&&!this.data.multiLine?K=2:Y.key==="Tab"&&(q.commitKey=3),K===-1)return;const{value:J}=Y.target;q.lastCommittedValue!==J&&(q.lastCommittedValue=J,q.userValue=J,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:m,name:"Keystroke",value:J,willCommit:!0,commitKey:K,selStart:Y.target.selectionStart,selEnd:Y.target.selectionEnd}}))});const V=st;st=null,A.addEventListener("blur",Y=>{if(!q.focused||!Y.relatedTarget)return;q.focused=!1;const{value:K}=Y.target;q.userValue=K,q.lastCommittedValue!==K&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:m,name:"Keystroke",value:K,willCommit:!0,commitKey:q.commitKey,selStart:Y.target.selectionStart,selEnd:Y.target.selectionEnd}}),V(Y)}),this.data.actions?.Keystroke&&A.addEventListener("beforeinput",Y=>{q.lastCommittedValue=null;const{data:K,target:J}=Y,{value:Z,selectionStart:rt,selectionEnd:ot}=J;let lt=rt,ct=ot;switch(Y.inputType){case"deleteWordBackward":{const ht=Z.substring(0,rt).match(/\w*[^\w]*$/);ht&&(lt-=ht[0].length);break}case"deleteWordForward":{const ht=Z.substring(rt).match(/^[^\w]*\w*/);ht&&(ct+=ht[0].length);break}case"deleteContentBackward":rt===ot&&(lt-=1);break;case"deleteContentForward":rt===ot&&(ct+=1);break}Y.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:m,name:"Keystroke",value:Z,change:K||"",willCommit:!1,selStart:lt,selEnd:ct}})}),this._setEventListeners(A,q,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Y=>Y.target.value)}if(st&&A.addEventListener("blur",st),this.data.comb){const Y=(this.data.rect[2]-this.data.rect[0])/N;A.classList.add("comb"),A.style.letterSpacing=`calc(${Y}px * var(--scale-factor) - 1ch)`}}else A=document.createElement("div"),A.textContent=this.data.fieldValue,A.style.verticalAlign="middle",A.style.display="table-cell";return this._setTextStyle(A),this._setBackgroundColor(A),this._setDefaultPropertiesFromJS(A),this.container.append(A),this.container}}class R extends o{constructor(a){super(a,{isRenderable:!!a.data.hasOwnCanvas})}}class T extends o{constructor(a){super(a,{isRenderable:a.renderForms})}render(){const a=this.annotationStorage,m=this.data,A=m.id;let x=a.getValue(A,{value:m.exportValue===m.fieldValue}).value;typeof x=="string"&&(x=x!=="Off",a.setValue(A,{value:x})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const k=document.createElement("input");return i.add(k),k.setAttribute("data-element-id",A),k.disabled=m.readOnly,this._setRequired(k,this.data.required),k.type="checkbox",k.name=m.fieldName,x&&k.setAttribute("checked",!0),k.setAttribute("exportValue",m.exportValue),k.tabIndex=n,k.addEventListener("change",N=>{const{name:U,checked:q}=N.target;for(const st of this._getElementsByName(U,A)){const V=q&&st.exportValue===m.exportValue;st.domElement&&(st.domElement.checked=V),a.setValue(st.id,{value:V})}a.setValue(A,{value:q})}),k.addEventListener("resetform",N=>{const U=m.defaultFieldValue||"Off";N.target.checked=U===m.exportValue}),this.enableScripting&&this.hasJSActions&&(k.addEventListener("updatefromsandbox",N=>{const U={value(q){q.target.checked=q.detail.value!=="Off",a.setValue(A,{value:q.target.checked})}};this._dispatchEventFromSandbox(U,N)}),this._setEventListeners(k,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],N=>N.target.checked)),this._setBackgroundColor(k),this._setDefaultPropertiesFromJS(k),this.container.append(k),this.container}}class f extends o{constructor(a){super(a,{isRenderable:a.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const a=this.annotationStorage,m=this.data,A=m.id;let x=a.getValue(A,{value:m.fieldValue===m.buttonValue}).value;typeof x=="string"&&(x=x!==m.buttonValue,a.setValue(A,{value:x}));const k=document.createElement("input");if(i.add(k),k.setAttribute("data-element-id",A),k.disabled=m.readOnly,this._setRequired(k,this.data.required),k.type="radio",k.name=m.fieldName,x&&k.setAttribute("checked",!0),k.tabIndex=n,k.addEventListener("change",N=>{const{name:U,checked:q}=N.target;for(const st of this._getElementsByName(U,A))a.setValue(st.id,{value:!1});a.setValue(A,{value:q})}),k.addEventListener("resetform",N=>{const U=m.defaultFieldValue;N.target.checked=U!=null&&U===m.buttonValue}),this.enableScripting&&this.hasJSActions){const N=m.buttonValue;k.addEventListener("updatefromsandbox",U=>{const q={value:st=>{const V=N===st.detail.value;for(const Y of this._getElementsByName(st.target.name)){const K=V&&Y.id===A;Y.domElement&&(Y.domElement.checked=K),a.setValue(Y.id,{value:K})}}};this._dispatchEventFromSandbox(q,U)}),this._setEventListeners(k,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],U=>U.target.checked)}return this._setBackgroundColor(k),this._setDefaultPropertiesFromJS(k),this.container.append(k),this.container}}class S extends u{constructor(a){super(a,{ignoreBorder:a.data.hasAppearance})}render(){const a=super.render();a.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(a.title=this.data.alternativeText);const m=a.lastChild;return this.enableScripting&&this.hasJSActions&&m&&(this._setDefaultPropertiesFromJS(m),m.addEventListener("updatefromsandbox",A=>{this._dispatchEventFromSandbox({},A)})),a}}class B extends o{constructor(a){super(a,{isRenderable:a.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const a=this.annotationStorage,m=this.data.id,A=a.getValue(m,{value:this.data.fieldValue}),x=document.createElement("select");i.add(x),x.setAttribute("data-element-id",m),x.disabled=this.data.readOnly,this._setRequired(x,this.data.required),x.name=this.data.fieldName,x.tabIndex=n;let k=this.data.combo&&this.data.options.length>0;this.data.combo||(x.size=this.data.options.length,this.data.multiSelect&&(x.multiple=!0)),x.addEventListener("resetform",V=>{const Y=this.data.defaultFieldValue;for(const K of x.options)K.selected=K.value===Y});for(const V of this.data.options){const Y=document.createElement("option");Y.textContent=V.displayValue,Y.value=V.exportValue,A.value.includes(V.exportValue)&&(Y.setAttribute("selected",!0),k=!1),x.append(Y)}let N=null;if(k){const V=document.createElement("option");V.value=" ",V.setAttribute("hidden",!0),V.setAttribute("selected",!0),x.prepend(V),N=()=>{V.remove(),x.removeEventListener("input",N),N=null},x.addEventListener("input",N)}const U=V=>{const Y=V?"value":"textContent",{options:K,multiple:J}=x;return J?Array.prototype.filter.call(K,Z=>Z.selected).map(Z=>Z[Y]):K.selectedIndex===-1?null:K[K.selectedIndex][Y]};let q=U(!1);const st=V=>{const Y=V.target.options;return Array.prototype.map.call(Y,K=>({displayValue:K.textContent,exportValue:K.value}))};return this.enableScripting&&this.hasJSActions?(x.addEventListener("updatefromsandbox",V=>{const Y={value(K){N?.();const J=K.detail.value,Z=new Set(Array.isArray(J)?J:[J]);for(const rt of x.options)rt.selected=Z.has(rt.value);a.setValue(m,{value:U(!0)}),q=U(!1)},multipleSelection(K){x.multiple=!0},remove(K){const J=x.options,Z=K.detail.remove;J[Z].selected=!1,x.remove(Z),J.length>0&&Array.prototype.findIndex.call(J,ot=>ot.selected)===-1&&(J[0].selected=!0),a.setValue(m,{value:U(!0),items:st(K)}),q=U(!1)},clear(K){for(;x.length!==0;)x.remove(0);a.setValue(m,{value:null,items:[]}),q=U(!1)},insert(K){const{index:J,displayValue:Z,exportValue:rt}=K.detail.insert,ot=x.children[J],lt=document.createElement("option");lt.textContent=Z,lt.value=rt,ot?ot.before(lt):x.append(lt),a.setValue(m,{value:U(!0),items:st(K)}),q=U(!1)},items(K){const{items:J}=K.detail;for(;x.length!==0;)x.remove(0);for(const Z of J){const{displayValue:rt,exportValue:ot}=Z,lt=document.createElement("option");lt.textContent=rt,lt.value=ot,x.append(lt)}x.options.length>0&&(x.options[0].selected=!0),a.setValue(m,{value:U(!0),items:st(K)}),q=U(!1)},indices(K){const J=new Set(K.detail.indices);for(const Z of K.target.options)Z.selected=J.has(Z.index);a.setValue(m,{value:U(!0)}),q=U(!1)},editable(K){K.target.disabled=!K.detail.editable}};this._dispatchEventFromSandbox(Y,V)}),x.addEventListener("input",V=>{const Y=U(!0);a.setValue(m,{value:Y}),V.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:m,name:"Keystroke",value:q,changeEx:Y,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(x,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],V=>V.target.value)):x.addEventListener("input",function(V){a.setValue(m,{value:U(!0)})}),this.data.combo&&this._setTextStyle(x),this._setBackgroundColor(x),this._setDefaultPropertiesFromJS(x),this.container.append(x),this.container}}class H extends e{constructor(a){const{data:m,elements:A}=a;super(a,{isRenderable:e._hasPopupData(m)}),this.elements=A}render(){this.container.classList.add("popupAnnotation");const a=new O({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),m=[];for(const A of this.elements)A.popup=a,m.push(A.data.id),A.addHighlightArea();return this.container.setAttribute("aria-controls",m.map(A=>`${r.AnnotationPrefix}${A}`).join(",")),this.container}}class O{#t=null;#e=this.#h.bind(this);#i=this.#S.bind(this);#s=this.#E.bind(this);#o=this.#_.bind(this);#a=null;#r=null;#l=null;#c=null;#n=null;#f=null;#d=!1;#u=null;#p=null;#b=null;#m=null;#g=!1;constructor({container:a,color:m,elements:A,titleObj:x,modificationDate:k,contentsObj:N,richText:U,parent:q,rect:st,parentRect:V,open:Y}){this.#r=a,this.#m=x,this.#l=N,this.#b=U,this.#n=q,this.#a=m,this.#p=st,this.#f=V,this.#c=A;const K=g.PDFDateString.toDateObject(k);K&&(this.#t=q.l10n.get("annotation_date_string",{date:K.toLocaleDateString(),time:K.toLocaleTimeString()})),this.trigger=A.flatMap(J=>J.getElementsToTriggerPopup());for(const J of this.trigger)J.addEventListener("click",this.#o),J.addEventListener("mouseenter",this.#s),J.addEventListener("mouseleave",this.#i),J.classList.add("popupTriggerArea");for(const J of A)J.container?.addEventListener("keydown",this.#e);this.#r.hidden=!0,Y&&this.#_()}render(){if(this.#u)return;const{page:{view:a},viewport:{rawDims:{pageWidth:m,pageHeight:A,pageX:x,pageY:k}}}=this.#n,N=this.#u=document.createElement("div");if(N.className="popup",this.#a){const ht=N.style.outlineColor=r.Util.makeHexColor(...this.#a);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?N.style.backgroundColor=`color-mix(in srgb, ${ht} 30%, white)`:N.style.backgroundColor=r.Util.makeHexColor(...this.#a.map(At=>Math.floor(.7*(255-At)+At)))}const U=document.createElement("span");U.className="header";const q=document.createElement("h1");if(U.append(q),{dir:q.dir,str:q.textContent}=this.#m,N.append(U),this.#t){const ht=document.createElement("span");ht.classList.add("popupDate"),this.#t.then(ut=>{ht.textContent=ut}),U.append(ht)}const st=this.#l,V=this.#b;if(V?.str&&(!st?.str||st.str===V.str))j.XfaLayer.render({xfaHtml:V.html,intent:"richText",div:N}),N.lastChild.classList.add("richText","popupContent");else{const ht=this._formatContents(st);N.append(ht)}let Y=!!this.#f,K=Y?this.#f:this.#p;for(const ht of this.#c)if(!K||r.Util.intersect(ht.data.rect,K)!==null){K=ht.data.rect,Y=!0;break}const J=r.Util.normalizeRect([K[0],a[3]-K[1]+a[1],K[2],a[3]-K[3]+a[1]]),rt=Y?K[2]-K[0]+5:0,ot=J[0]+rt,lt=J[1],{style:ct}=this.#r;ct.left=`${100*(ot-x)/m}%`,ct.top=`${100*(lt-k)/A}%`,this.#r.append(N)}_formatContents({str:a,dir:m}){const A=document.createElement("p");A.classList.add("popupContent"),A.dir=m;const x=a.split(/(?:\r\n?|\n)/);for(let k=0,N=x.length;k<N;++k){const U=x[k];A.append(document.createTextNode(U)),k<N-1&&A.append(document.createElement("br"))}return A}#h(a){a.altKey||a.shiftKey||a.ctrlKey||a.metaKey||(a.key==="Enter"||a.key==="Escape"&&this.#d)&&this.#_()}#_(){this.#d=!this.#d,this.#d?(this.#E(),this.#r.addEventListener("click",this.#o),this.#r.addEventListener("keydown",this.#e)):(this.#S(),this.#r.removeEventListener("click",this.#o),this.#r.removeEventListener("keydown",this.#e))}#E(){this.#u||this.render(),this.isVisible?this.#d&&this.#r.classList.add("focused"):(this.#r.hidden=!1,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)+1e3)}#S(){this.#r.classList.remove("focused"),!(this.#d||!this.isVisible)&&(this.#r.hidden=!0,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)-1e3)}forceHide(){this.#g=this.isVisible,this.#g&&(this.#r.hidden=!0)}maybeShow(){this.#g&&(this.#g=!1,this.#r.hidden=!1)}get isVisible(){return this.#r.hidden===!1}}class z extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.textContent=a.data.textContent,this.textPosition=a.data.textPosition,this.annotationEditorType=r.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const a=document.createElement("div");a.classList.add("annotationTextContent"),a.setAttribute("role","comment");for(const m of this.textContent){const A=document.createElement("span");A.textContent=m,a.append(A)}this.container.append(a)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}s.FreeTextAnnotationElement=z;class X extends e{#t=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const a=this.data,{width:m,height:A}=h(a.rect),x=this.svgFactory.create(m,A,!0),k=this.#t=this.svgFactory.createElement("svg:line");return k.setAttribute("x1",a.rect[2]-a.lineCoordinates[0]),k.setAttribute("y1",a.rect[3]-a.lineCoordinates[1]),k.setAttribute("x2",a.rect[2]-a.lineCoordinates[2]),k.setAttribute("y2",a.rect[3]-a.lineCoordinates[3]),k.setAttribute("stroke-width",a.borderStyle.width||1),k.setAttribute("stroke","transparent"),k.setAttribute("fill","transparent"),x.append(k),this.container.append(x),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class it extends e{#t=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const a=this.data,{width:m,height:A}=h(a.rect),x=this.svgFactory.create(m,A,!0),k=a.borderStyle.width,N=this.#t=this.svgFactory.createElement("svg:rect");return N.setAttribute("x",k/2),N.setAttribute("y",k/2),N.setAttribute("width",m-k),N.setAttribute("height",A-k),N.setAttribute("stroke-width",k||1),N.setAttribute("stroke","transparent"),N.setAttribute("fill","transparent"),x.append(N),this.container.append(x),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Q extends e{#t=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const a=this.data,{width:m,height:A}=h(a.rect),x=this.svgFactory.create(m,A,!0),k=a.borderStyle.width,N=this.#t=this.svgFactory.createElement("svg:ellipse");return N.setAttribute("cx",m/2),N.setAttribute("cy",A/2),N.setAttribute("rx",m/2-k/2),N.setAttribute("ry",A/2-k/2),N.setAttribute("stroke-width",k||1),N.setAttribute("stroke","transparent"),N.setAttribute("fill","transparent"),x.append(N),this.container.append(x),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class et extends e{#t=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const a=this.data,{width:m,height:A}=h(a.rect),x=this.svgFactory.create(m,A,!0);let k=[];for(const U of a.vertices){const q=U.x-a.rect[0],st=a.rect[3]-U.y;k.push(q+","+st)}k=k.join(" ");const N=this.#t=this.svgFactory.createElement(this.svgElementName);return N.setAttribute("points",k),N.setAttribute("stroke-width",a.borderStyle.width||1),N.setAttribute("stroke","transparent"),N.setAttribute("fill","transparent"),x.append(N),this.container.append(x),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class nt extends et{constructor(a){super(a),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class $ extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class D extends e{#t=[];constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=r.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const a=this.data,{width:m,height:A}=h(a.rect),x=this.svgFactory.create(m,A,!0);for(const k of a.inkLists){let N=[];for(const q of k){const st=q.x-a.rect[0],V=a.rect[3]-q.y;N.push(`${st},${V}`)}N=N.join(" ");const U=this.svgFactory.createElement(this.svgElementName);this.#t.push(U),U.setAttribute("points",N),U.setAttribute("stroke-width",a.borderStyle.width||1),U.setAttribute("stroke","transparent"),U.setAttribute("fill","transparent"),!a.popupRef&&this.hasPopupData&&this._createPopup(),x.append(U)}return this.container.append(x),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}s.InkAnnotationElement=D;class b extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class c extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class d extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class _ extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class F extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}s.StampAnnotationElement=F;class M extends e{#t=null;constructor(a){super(a,{isRenderable:!0});const{filename:m,content:A}=this.data.file;this.filename=(0,g.getFilenameFromUrl)(m,!0),this.content=A,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:m,content:A})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:a,data:m}=this;let A;m.hasAppearance||m.fillAlpha===0?A=document.createElement("div"):(A=document.createElement("img"),A.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(m.name)?"paperclip":"pushpin"}.svg`,m.fillAlpha&&m.fillAlpha<1&&(A.style=`filter: opacity(${Math.round(m.fillAlpha*100)}%);`)),A.addEventListener("dblclick",this.#e.bind(this)),this.#t=A;const{isMac:x}=r.FeatureTest.platform;return a.addEventListener("keydown",k=>{k.key==="Enter"&&(x?k.metaKey:k.ctrlKey)&&this.#e()}),!m.popupRef&&this.hasPopupData?this._createPopup():A.classList.add("popupTriggerArea"),a.append(A),a}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.container,this.content,this.filename)}}class I{#t=null;#e=null;#i=new Map;constructor({div:a,accessibilityManager:m,annotationCanvasMap:A,l10n:x,page:k,viewport:N}){this.div=a,this.#t=m,this.#e=A,this.l10n=x,this.page=k,this.viewport=N,this.zIndex=0,this.l10n||=L.NullL10n}#s(a,m){const A=a.firstChild||a;A.id=`${r.AnnotationPrefix}${m}`,this.div.append(a),this.#t?.moveElementInDOM(this.div,a,A,!1)}async render(a){const{annotations:m}=a,A=this.div;(0,g.setLayerDimensions)(A,this.viewport);const x=new Map,k={data:null,layer:A,linkService:a.linkService,downloadManager:a.downloadManager,imageResourcesPath:a.imageResourcesPath||"",renderForms:a.renderForms!==!1,svgFactory:new g.DOMSVGFactory,annotationStorage:a.annotationStorage||new P.AnnotationStorage,enableScripting:a.enableScripting===!0,hasJSActions:a.hasJSActions,fieldObjects:a.fieldObjects,parent:this,elements:null};for(const N of m){if(N.noHTML)continue;const U=N.annotationType===r.AnnotationType.POPUP;if(U){const V=x.get(N.id);if(!V)continue;k.elements=V}else{const{width:V,height:Y}=h(N.rect);if(V<=0||Y<=0)continue}k.data=N;const q=l.create(k);if(!q.isRenderable)continue;if(!U&&N.popupRef){const V=x.get(N.popupRef);V?V.push(q):x.set(N.popupRef,[q])}q.annotationEditorType>0&&this.#i.set(q.data.id,q);const st=q.render();N.hidden&&(st.style.visibility="hidden"),this.#s(st,N.id)}this.#o(),await this.l10n.translate(A)}update({viewport:a}){const m=this.div;this.viewport=a,(0,g.setLayerDimensions)(m,{rotation:a.rotation}),this.#o(),m.hidden=!1}#o(){if(!this.#e)return;const a=this.div;for(const[m,A]of this.#e){const x=a.querySelector(`[data-annotation-id="${m}"]`);if(!x)continue;const{firstChild:k}=x;k?k.nodeName==="CANVAS"?k.replaceWith(A):k.before(A):x.append(A)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#i.values())}getEditableAnnotation(a){return this.#i.get(a)}}s.AnnotationLayer=I}),((w,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ColorConverters=void 0;function y(P){return Math.floor(Math.max(0,Math.min(1,P))*255).toString(16).padStart(2,"0")}function r(P){return Math.max(0,Math.min(255,255*P))}class g{static CMYK_G([C,L,j,n]){return["G",1-Math.min(1,.3*C+.59*j+.11*L+n)]}static G_CMYK([C]){return["CMYK",0,0,0,1-C]}static G_RGB([C]){return["RGB",C,C,C]}static G_rgb([C]){return C=r(C),[C,C,C]}static G_HTML([C]){const L=y(C);return`#${L}${L}${L}`}static RGB_G([C,L,j]){return["G",.3*C+.59*L+.11*j]}static RGB_rgb(C){return C.map(r)}static RGB_HTML(C){return`#${C.map(y).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([C,L,j,n]){return["RGB",1-Math.min(1,C+n),1-Math.min(1,j+n),1-Math.min(1,L+n)]}static CMYK_rgb([C,L,j,n]){return[r(1-Math.min(1,C+n)),r(1-Math.min(1,j+n)),r(1-Math.min(1,L+n))]}static CMYK_HTML(C){const L=this.CMYK_RGB(C).slice(1);return this.RGB_HTML(L)}static RGB_CMYK([C,L,j]){const n=1-C,t=1-L,i=1-j,h=Math.min(n,t,i);return["CMYK",n,t,i,h]}}s.ColorConverters=g}),((w,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.NullL10n=void 0,s.getL10nFallback=r;const y={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};y.print_progress_percent="{{progress}}%";function r(C,L){switch(C){case"find_match_count":C=`find_match_count[${L.total===1?"one":"other"}]`;break;case"find_match_count_limit":C=`find_match_count_limit[${L.limit===1?"one":"other"}]`;break}return y[C]||""}function g(C,L){return L?C.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(j,n)=>n in L?L[n]:"{{"+n+"}}"):C}const P={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(C,L=null,j=r(C,L)){return g(j,L)},async translate(C){}};s.NullL10n=P}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.XfaLayer=void 0;var r=y(25);class g{static setupStorage(C,L,j,n,t){const i=n.getValue(L,{value:null});switch(j.name){case"textarea":if(i.value!==null&&(C.textContent=i.value),t==="print")break;C.addEventListener("input",h=>{n.setValue(L,{value:h.target.value})});break;case"input":if(j.attributes.type==="radio"||j.attributes.type==="checkbox"){if(i.value===j.attributes.xfaOn?C.setAttribute("checked",!0):i.value===j.attributes.xfaOff&&C.removeAttribute("checked"),t==="print")break;C.addEventListener("change",h=>{n.setValue(L,{value:h.target.checked?h.target.getAttribute("xfaOn"):h.target.getAttribute("xfaOff")})})}else{if(i.value!==null&&C.setAttribute("value",i.value),t==="print")break;C.addEventListener("input",h=>{n.setValue(L,{value:h.target.value})})}break;case"select":if(i.value!==null){C.setAttribute("value",i.value);for(const h of j.children)h.attributes.value===i.value?h.attributes.selected=!0:h.attributes.hasOwnProperty("selected")&&delete h.attributes.selected}C.addEventListener("input",h=>{const l=h.target.options,e=l.selectedIndex===-1?"":l[l.selectedIndex].value;n.setValue(L,{value:e})});break}}static setAttributes({html:C,element:L,storage:j=null,intent:n,linkService:t}){const{attributes:i}=L,h=C instanceof HTMLAnchorElement;i.type==="radio"&&(i.name=`${i.name}-${n}`);for(const[l,e]of Object.entries(i))if(e!=null)switch(l){case"class":e.length&&C.setAttribute(l,e.join(" "));break;case"dataId":break;case"id":C.setAttribute("data-element-id",e);break;case"style":Object.assign(C.style,e);break;case"textContent":C.textContent=e;break;default:(!h||l!=="href"&&l!=="newWindow")&&C.setAttribute(l,e)}h&&t.addLinkAttributes(C,i.href,i.newWindow),j&&i.dataId&&this.setupStorage(C,i.dataId,L,j)}static render(C){const L=C.annotationStorage,j=C.linkService,n=C.xfaHtml,t=C.intent||"display",i=document.createElement(n.name);n.attributes&&this.setAttributes({html:i,element:n,intent:t,linkService:j});const h=[[n,-1,i]],l=C.div;if(l.append(i),C.viewport){const u=`matrix(${C.viewport.transform.join(",")})`;l.style.transform=u}t!=="richText"&&l.setAttribute("class","xfaLayer xfaFont");const e=[];for(;h.length>0;){const[u,p,o]=h.at(-1);if(p+1===u.children.length){h.pop();continue}const v=u.children[++h.at(-1)[1]];if(v===null)continue;const{name:R}=v;if(R==="#text"){const f=document.createTextNode(v.value);e.push(f),o.append(f);continue}const T=v?.attributes?.xmlns?document.createElementNS(v.attributes.xmlns,R):document.createElement(R);if(o.append(T),v.attributes&&this.setAttributes({html:T,element:v,storage:L,intent:t,linkService:j}),v.children&&v.children.length>0)h.push([v,-1,T]);else if(v.value){const f=document.createTextNode(v.value);r.XfaText.shouldBuildText(R)&&e.push(f),T.append(f)}}for(const u of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))u.setAttribute("readOnly",!0);return{textDivs:e}}static update(C){const L=`matrix(${C.viewport.transform.join(",")})`;C.div.style.transform=L,C.div.hidden=!1}}s.XfaLayer=g}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.InkEditor=void 0;var r=y(1),g=y(4),P=y(29),C=y(6),L=y(5);class j extends g.AnnotationEditor{#t=0;#e=0;#i=this.canvasPointermove.bind(this);#s=this.canvasPointerleave.bind(this);#o=this.canvasPointerup.bind(this);#a=this.canvasPointerdown.bind(this);#r=new Path2D;#l=!1;#c=!1;#n=!1;#f=null;#d=0;#u=0;#p=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";constructor(t){super({...t,name:"inkEditor"}),this.color=t.color||null,this.thickness=t.thickness||null,this.opacity=t.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(t){g.AnnotationEditor.initialize(t,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(t,i){switch(t){case r.AnnotationEditorParamsType.INK_THICKNESS:j._defaultThickness=i;break;case r.AnnotationEditorParamsType.INK_COLOR:j._defaultColor=i;break;case r.AnnotationEditorParamsType.INK_OPACITY:j._defaultOpacity=i/100;break}}updateParams(t,i){switch(t){case r.AnnotationEditorParamsType.INK_THICKNESS:this.#b(i);break;case r.AnnotationEditorParamsType.INK_COLOR:this.#m(i);break;case r.AnnotationEditorParamsType.INK_OPACITY:this.#g(i);break}}static get defaultPropertiesToUpdate(){return[[r.AnnotationEditorParamsType.INK_THICKNESS,j._defaultThickness],[r.AnnotationEditorParamsType.INK_COLOR,j._defaultColor||g.AnnotationEditor._defaultLineColor],[r.AnnotationEditorParamsType.INK_OPACITY,Math.round(j._defaultOpacity*100)]]}get propertiesToUpdate(){return[[r.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||j._defaultThickness],[r.AnnotationEditorParamsType.INK_COLOR,this.color||j._defaultColor||g.AnnotationEditor._defaultLineColor],[r.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??j._defaultOpacity))]]}#b(t){const i=this.thickness;this.addCommands({cmd:()=>{this.thickness=t,this.#w()},undo:()=>{this.thickness=i,this.#w()},mustExec:!0,type:r.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#m(t){const i=this.color;this.addCommands({cmd:()=>{this.color=t,this.#A()},undo:()=>{this.color=i,this.#A()},mustExec:!0,type:r.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#g(t){t/=100;const i=this.opacity;this.addCommands({cmd:()=>{this.opacity=t,this.#A()},undo:()=>{this.opacity=i,this.#A()},mustExec:!0,type:r.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(this.#k(),this.#R()),this.isAttachedToDOM||(this.parent.add(this),this.#y()),this.#w()))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#f.disconnect(),this.#f=null,super.remove())}setParent(t){!this.parent&&t?this._uiManager.removeShouldRescale(this):this.parent&&t===null&&this._uiManager.addShouldRescale(this),super.setParent(t)}onScaleChanging(){const[t,i]=this.parentDimensions,h=this.width*t,l=this.height*i;this.setDimensions(h,l)}enableEditMode(){this.#l||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",this.#a))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#a))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}#h(){const{parentRotation:t,parentDimensions:[i,h]}=this;switch(t){case 90:return[0,h,h,i];case 180:return[i,h,i,h];case 270:return[i,0,h,i];default:return[0,0,i,h]}}#_(){const{ctx:t,color:i,opacity:h,thickness:l,parentScale:e,scaleFactor:u}=this;t.lineWidth=l*e/u,t.lineCap="round",t.lineJoin="round",t.miterLimit=10,t.strokeStyle=`${i}${(0,L.opacityToHex)(h)}`}#E(t,i){this.canvas.addEventListener("contextmenu",C.noContextMenu),this.canvas.addEventListener("pointerleave",this.#s),this.canvas.addEventListener("pointermove",this.#i),this.canvas.addEventListener("pointerup",this.#o),this.canvas.removeEventListener("pointerdown",this.#a),this.isEditing=!0,this.#n||(this.#n=!0,this.#y(),this.thickness||=j._defaultThickness,this.color||=j._defaultColor||g.AnnotationEditor._defaultLineColor,this.opacity??=j._defaultOpacity),this.currentPath.push([t,i]),this.#c=!1,this.#_(),this.#p=()=>{this.#I(),this.#p&&window.requestAnimationFrame(this.#p)},window.requestAnimationFrame(this.#p)}#S(t,i){const[h,l]=this.currentPath.at(-1);if(this.currentPath.length>1&&t===h&&i===l)return;const e=this.currentPath;let u=this.#r;if(e.push([t,i]),this.#c=!0,e.length<=2){u.moveTo(...e[0]),u.lineTo(t,i);return}e.length===3&&(this.#r=u=new Path2D,u.moveTo(...e[0])),this.#L(u,...e.at(-3),...e.at(-2),t,i)}#C(){if(this.currentPath.length===0)return;const t=this.currentPath.at(-1);this.#r.lineTo(...t)}#P(t,i){this.#p=null,t=Math.min(Math.max(t,0),this.canvas.width),i=Math.min(Math.max(i,0),this.canvas.height),this.#S(t,i),this.#C();let h;if(this.currentPath.length!==1)h=this.#O();else{const o=[t,i];h=[[o,o.slice(),o.slice(),o]]}const l=this.#r,e=this.currentPath;this.currentPath=[],this.#r=new Path2D;const u=()=>{this.allRawPaths.push(e),this.paths.push(h),this.bezierPath2D.push(l),this.rebuild()},p=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(this.#k(),this.#R()),this.#w())};this.addCommands({cmd:u,undo:p,mustExec:!0})}#I(){if(!this.#c)return;this.#c=!1;const t=Math.ceil(this.thickness*this.parentScale),i=this.currentPath.slice(-3),h=i.map(u=>u[0]),l=i.map(u=>u[1]);Math.min(...h)-t,Math.max(...h)+t,Math.min(...l)-t,Math.max(...l)+t;const{ctx:e}=this;e.save(),e.clearRect(0,0,this.canvas.width,this.canvas.height);for(const u of this.bezierPath2D)e.stroke(u);e.stroke(this.#r),e.restore()}#L(t,i,h,l,e,u,p){const o=(i+l)/2,v=(h+e)/2,R=(l+u)/2,T=(e+p)/2;t.bezierCurveTo(o+2*(l-o)/3,v+2*(e-v)/3,R+2*(l-R)/3,T+2*(e-T)/3,R,T)}#O(){const t=this.currentPath;if(t.length<=2)return[[t[0],t[0],t.at(-1),t.at(-1)]];const i=[];let h,[l,e]=t[0];for(h=1;h<t.length-2;h++){const[f,S]=t[h],[B,H]=t[h+1],O=(f+B)/2,z=(S+H)/2,X=[l+2*(f-l)/3,e+2*(S-e)/3],it=[O+2*(f-O)/3,z+2*(S-z)/3];i.push([[l,e],X,it,[O,z]]),[l,e]=[O,z]}const[u,p]=t[h],[o,v]=t[h+1],R=[l+2*(u-l)/3,e+2*(p-e)/3],T=[o+2*(u-o)/3,v+2*(p-v)/3];return i.push([[l,e],R,T,[o,v]]),i}#A(){if(this.isEmpty()){this.#x();return}this.#_();const{canvas:t,ctx:i}=this;i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,t.width,t.height),this.#x();for(const h of this.bezierPath2D)i.stroke(h)}commit(){this.#l||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#l=!0,this.div.classList.add("disabled"),this.#w(!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),this.enableEditMode())}canvasPointerdown(t){t.button!==0||!this.isInEditMode()||this.#l||(this.setInForeground(),t.preventDefault(),t.type!=="mouse"&&this.div.focus(),this.#E(t.offsetX,t.offsetY))}canvasPointermove(t){t.preventDefault(),this.#S(t.offsetX,t.offsetY)}canvasPointerup(t){t.preventDefault(),this.#D(t)}canvasPointerleave(t){this.#D(t)}#D(t){this.canvas.removeEventListener("pointerleave",this.#s),this.canvas.removeEventListener("pointermove",this.#i),this.canvas.removeEventListener("pointerup",this.#o),this.canvas.addEventListener("pointerdown",this.#a),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",C.noContextMenu)},10),this.#P(t.offsetX,t.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#k(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",g.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(t=>this.canvas?.setAttribute("aria-label",t)),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#R(){this.#f=new ResizeObserver(t=>{const i=t[0].contentRect;i.width&&i.height&&this.setDimensions(i.width,i.height)}),this.#f.observe(this.div)}get isResizable(){return!this.isEmpty()&&this.#l}render(){if(this.div)return this.div;let t,i;this.width&&(t=this.x,i=this.y),super.render(),g.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(p=>this.div?.setAttribute("aria-label",p));const[h,l,e,u]=this.#h();if(this.setAt(h,l,0,0),this.setDims(e,u),this.#k(),this.width){const[p,o]=this.parentDimensions;this.setAspectRatio(this.width*p,this.height*o),this.setAt(t*p,i*o,this.width*p,this.height*o),this.#n=!0,this.#y(),this.setDims(this.width*p,this.height*o),this.#A(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#R(),this.div}#y(){if(!this.#n)return;const[t,i]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*t),this.canvas.height=Math.ceil(this.height*i),this.#x()}setDimensions(t,i){const h=Math.round(t),l=Math.round(i);if(this.#d===h&&this.#u===l)return;this.#d=h,this.#u=l,this.canvas.style.visibility="hidden";const[e,u]=this.parentDimensions;this.width=t/e,this.height=i/u,this.fixAndSetPosition(),this.#l&&this.#T(t,i),this.#y(),this.#A(),this.canvas.style.visibility="visible",this.fixDims()}#T(t,i){const h=this.#M(),l=(t-h)/this.#e,e=(i-h)/this.#t;this.scaleFactor=Math.min(l,e)}#x(){const t=this.#M()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+t,this.translationY*this.scaleFactor+t)}static#N(t){const i=new Path2D;for(let h=0,l=t.length;h<l;h++){const[e,u,p,o]=t[h];h===0&&i.moveTo(...e),i.bezierCurveTo(u[0],u[1],p[0],p[1],o[0],o[1])}return i}static#j(t,i,h){const[l,e,u,p]=i;switch(h){case 0:for(let o=0,v=t.length;o<v;o+=2)t[o]+=l,t[o+1]=p-t[o+1];break;case 90:for(let o=0,v=t.length;o<v;o+=2){const R=t[o];t[o]=t[o+1]+l,t[o+1]=R+e}break;case 180:for(let o=0,v=t.length;o<v;o+=2)t[o]=u-t[o],t[o+1]+=e;break;case 270:for(let o=0,v=t.length;o<v;o+=2){const R=t[o];t[o]=u-t[o+1],t[o+1]=p-R}break;default:throw new Error("Invalid rotation")}return t}static#B(t,i,h){const[l,e,u,p]=i;switch(h){case 0:for(let o=0,v=t.length;o<v;o+=2)t[o]-=l,t[o+1]=p-t[o+1];break;case 90:for(let o=0,v=t.length;o<v;o+=2){const R=t[o];t[o]=t[o+1]-e,t[o+1]=R-l}break;case 180:for(let o=0,v=t.length;o<v;o+=2)t[o]=u-t[o],t[o+1]-=e;break;case 270:for(let o=0,v=t.length;o<v;o+=2){const R=t[o];t[o]=p-t[o+1],t[o+1]=u-R}break;default:throw new Error("Invalid rotation")}return t}#U(t,i,h,l){const e=[],u=this.thickness/2,p=t*i+u,o=t*h+u;for(const v of this.paths){const R=[],T=[];for(let f=0,S=v.length;f<S;f++){const[B,H,O,z]=v[f],X=t*B[0]+p,it=t*B[1]+o,Q=t*H[0]+p,et=t*H[1]+o,nt=t*O[0]+p,$=t*O[1]+o,D=t*z[0]+p,b=t*z[1]+o;f===0&&(R.push(X,it),T.push(X,it)),R.push(Q,et,nt,$,D,b),T.push(Q,et),f===S-1&&T.push(D,b)}e.push({bezier:j.#j(R,l,this.rotation),points:j.#j(T,l,this.rotation)})}return e}#F(){let t=1/0,i=-1/0,h=1/0,l=-1/0;for(const e of this.paths)for(const[u,p,o,v]of e){const R=r.Util.bezierBoundingBox(...u,...p,...o,...v);t=Math.min(t,R[0]),h=Math.min(h,R[1]),i=Math.max(i,R[2]),l=Math.max(l,R[3])}return[t,h,i,l]}#M(){return this.#l?Math.ceil(this.thickness*this.parentScale):0}#w(t=!1){if(this.isEmpty())return;if(!this.#l){this.#A();return}const i=this.#F(),h=this.#M();this.#e=Math.max(g.AnnotationEditor.MIN_SIZE,i[2]-i[0]),this.#t=Math.max(g.AnnotationEditor.MIN_SIZE,i[3]-i[1]);const l=Math.ceil(h+this.#e*this.scaleFactor),e=Math.ceil(h+this.#t*this.scaleFactor),[u,p]=this.parentDimensions;this.width=l/u,this.height=e/p,this.setAspectRatio(l,e);const o=this.translationX,v=this.translationY;this.translationX=-i[0],this.translationY=-i[1],this.#y(),this.#A(),this.#d=l,this.#u=e,this.setDims(l,e);const R=t?h/this.scaleFactor/2:0;this.translate(o-this.translationX-R,v-this.translationY-R)}static deserialize(t,i,h){if(t instanceof P.InkAnnotationElement)return null;const l=super.deserialize(t,i,h);l.thickness=t.thickness,l.color=r.Util.makeHexColor(...t.color),l.opacity=t.opacity;const[e,u]=l.pageDimensions,p=l.width*e,o=l.height*u,v=l.parentScale,R=t.thickness/2;l.#l=!0,l.#d=Math.round(p),l.#u=Math.round(o);const{paths:T,rect:f,rotation:S}=t;for(let{bezier:H}of T){H=j.#B(H,f,S);const O=[];l.paths.push(O);let z=v*(H[0]-R),X=v*(H[1]-R);for(let Q=2,et=H.length;Q<et;Q+=6){const nt=v*(H[Q]-R),$=v*(H[Q+1]-R),D=v*(H[Q+2]-R),b=v*(H[Q+3]-R),c=v*(H[Q+4]-R),d=v*(H[Q+5]-R);O.push([[z,X],[nt,$],[D,b],[c,d]]),z=c,X=d}const it=this.#N(O);l.bezierPath2D.push(it)}const B=l.#F();return l.#e=Math.max(g.AnnotationEditor.MIN_SIZE,B[2]-B[0]),l.#t=Math.max(g.AnnotationEditor.MIN_SIZE,B[3]-B[1]),l.#T(p,o),l}serialize(){if(this.isEmpty())return null;const t=this.getRect(0,0),i=g.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:r.AnnotationEditorType.INK,color:i,thickness:this.thickness,opacity:this.opacity,paths:this.#U(this.scaleFactor/this.parentScale,this.translationX,this.translationY,t),pageIndex:this.pageIndex,rect:t,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}s.InkEditor=j}),((w,s,y)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.StampEditor=void 0;var r=y(1),g=y(4),P=y(6),C=y(29);class L extends g.AnnotationEditor{#t=null;#e=null;#i=null;#s=null;#o=null;#a=null;#r=null;#l=null;#c=!1;#n=!1;static _type="stamp";constructor(n){super({...n,name:"stampEditor"}),this.#s=n.bitmapUrl,this.#o=n.bitmapFile}static initialize(n){g.AnnotationEditor.initialize(n)}static get supportedTypes(){const n=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,r.shadow)(this,"supportedTypes",n.map(t=>`image/${t}`))}static get supportedTypesStr(){return(0,r.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(n){return this.supportedTypes.includes(n)}static paste(n,t){t.pasteEditor(r.AnnotationEditorType.STAMP,{bitmapFile:n.getAsFile()})}#f(n,t=!1){if(!n){this.remove();return}this.#t=n.bitmap,t||(this.#e=n.id,this.#c=n.isSvg),this.#p()}#d(){this.#i=null,this._uiManager.enableWaiting(!1),this.#a&&this.div.focus()}#u(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(t=>this.#f(t,!0)).finally(()=>this.#d());return}if(this.#s){const t=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromUrl(t).then(i=>this.#f(i)).finally(()=>this.#d());return}if(this.#o){const t=this.#o;this.#o=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromFile(t).then(i=>this.#f(i)).finally(()=>this.#d());return}const n=document.createElement("input");n.type="file",n.accept=L.supportedTypesStr,this.#i=new Promise(t=>{n.addEventListener("change",async()=>{if(!n.files||n.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const i=await this._uiManager.imageManager.getFromFile(n.files[0]);this.#f(i)}t()}),n.addEventListener("cancel",()=>{this.remove(),t()})}).finally(()=>this.#d()),n.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#a?.remove(),this.#a=null,this.#r?.disconnect(),this.#r=null),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#u();return}super.rebuild(),this.div!==null&&(this.#e&&this.#u(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#i||this.#t||this.#s||this.#o)}get isResizable(){return!0}render(){if(this.div)return this.div;let n,t;if(this.width&&(n=this.x,t=this.y),super.render(),this.div.hidden=!0,this.#t?this.#p():this.#u(),this.width){const[i,h]=this.parentDimensions;this.setAt(n*i,t*h,this.width*i,this.height*h)}return this.div}#p(){const{div:n}=this;let{width:t,height:i}=this.#t;const[h,l]=this.pageDimensions,e=.75;if(this.width)t=this.width*h,i=this.height*l;else if(t>e*h||i>e*l){const v=Math.min(e*h/t,e*l/i);t*=v,i*=v}const[u,p]=this.parentDimensions;this.setDims(t*u/h,i*p/l),this._uiManager.enableWaiting(!1);const o=this.#a=document.createElement("canvas");n.append(o),n.hidden=!1,this.#g(t,i),this.#_(),this.#n||(this.parent.addUndoableEditor(this),this.#n=!0),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()}#b(n,t){const[i,h]=this.parentDimensions;this.width=n/i,this.height=t/h,this.setDims(n,t),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this.#l!==null&&clearTimeout(this.#l);const l=200;this.#l=setTimeout(()=>{this.#l=null,this.#g(n,t)},l)}#m(n,t){const{width:i,height:h}=this.#t;let l=i,e=h,u=this.#t;for(;l>2*n||e>2*t;){const p=l,o=e;l>2*n&&(l=l>=16384?Math.floor(l/2)-1:Math.ceil(l/2)),e>2*t&&(e=e>=16384?Math.floor(e/2)-1:Math.ceil(e/2));const v=new OffscreenCanvas(l,e);v.getContext("2d").drawImage(u,0,0,p,o,0,0,l,e),u=v.transferToImageBitmap()}return u}#g(n,t){n=Math.ceil(n),t=Math.ceil(t);const i=this.#a;if(!i||i.width===n&&i.height===t)return;i.width=n,i.height=t;const h=this.#c?this.#t:this.#m(n,t),l=i.getContext("2d");l.filter=this._uiManager.hcmFilter,l.drawImage(h,0,0,h.width,h.height,0,0,n,t)}#h(n){if(n){if(this.#c){const h=this._uiManager.imageManager.getSvgUrl(this.#e);if(h)return h}const t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#t,t.getContext("2d").drawImage(this.#t,0,0),t.toDataURL()}if(this.#c){const[t,i]=this.pageDimensions,h=Math.round(this.width*t*P.PixelsPerInch.PDF_TO_CSS_UNITS),l=Math.round(this.height*i*P.PixelsPerInch.PDF_TO_CSS_UNITS),e=new OffscreenCanvas(h,l);return e.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,h,l),e.transferToImageBitmap()}return structuredClone(this.#t)}#_(){this.#r=new ResizeObserver(n=>{const t=n[0].contentRect;t.width&&t.height&&this.#b(t.width,t.height)}),this.#r.observe(this.div)}static deserialize(n,t,i){if(n instanceof C.StampAnnotationElement)return null;const h=super.deserialize(n,t,i),{rect:l,bitmapUrl:e,bitmapId:u,isSvg:p,accessibilityData:o}=n;u&&i.imageManager.isValidId(u)?h.#e=u:h.#s=e,h.#c=p;const[v,R]=h.pageDimensions;return h.width=(l[2]-l[0])/v,h.height=(l[3]-l[1])/R,o&&(h.altTextData=o),h}serialize(n=!1,t=null){if(this.isEmpty())return null;const i={annotationType:r.AnnotationEditorType.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#c,structTreeParentId:this._structTreeParentId};if(n)return i.bitmapUrl=this.#h(!0),i.accessibilityData=this.altTextData,i;const{decorative:h,altText:l}=this.altTextData;if(!h&&l&&(i.accessibilityData={type:"Figure",alt:l}),t===null)return i;t.stamps||=new Map;const e=this.#c?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!t.stamps.has(this.#e))t.stamps.set(this.#e,{area:e,serialized:i}),i.bitmap=this.#h(!1);else if(this.#c){const u=t.stamps.get(this.#e);e>u.area&&(u.area=e,u.serialized.bitmap.close(),u.serialized.bitmap=this.#h(!1))}return i}}s.StampEditor=L})],__webpack_module_cache__={};function __w_pdfjs_require__(w){var s=__webpack_module_cache__[w];if(s!==void 0)return s.exports;var y=__webpack_module_cache__[w]={exports:{}};return __webpack_modules__[w](y,y.exports,__w_pdfjs_require__),y.exports}var __webpack_exports__={};return(()=>{var w=__webpack_exports__;Object.defineProperty(w,"__esModule",{value:!0}),Object.defineProperty(w,"AbortException",{enumerable:!0,get:function(){return s.AbortException}}),Object.defineProperty(w,"AnnotationEditorLayer",{enumerable:!0,get:function(){return P.AnnotationEditorLayer}}),Object.defineProperty(w,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return s.AnnotationEditorParamsType}}),Object.defineProperty(w,"AnnotationEditorType",{enumerable:!0,get:function(){return s.AnnotationEditorType}}),Object.defineProperty(w,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return C.AnnotationEditorUIManager}}),Object.defineProperty(w,"AnnotationLayer",{enumerable:!0,get:function(){return L.AnnotationLayer}}),Object.defineProperty(w,"AnnotationMode",{enumerable:!0,get:function(){return s.AnnotationMode}}),Object.defineProperty(w,"CMapCompressionType",{enumerable:!0,get:function(){return s.CMapCompressionType}}),Object.defineProperty(w,"DOMSVGFactory",{enumerable:!0,get:function(){return r.DOMSVGFactory}}),Object.defineProperty(w,"FeatureTest",{enumerable:!0,get:function(){return s.FeatureTest}}),Object.defineProperty(w,"GlobalWorkerOptions",{enumerable:!0,get:function(){return j.GlobalWorkerOptions}}),Object.defineProperty(w,"ImageKind",{enumerable:!0,get:function(){return s.ImageKind}}),Object.defineProperty(w,"InvalidPDFException",{enumerable:!0,get:function(){return s.InvalidPDFException}}),Object.defineProperty(w,"MissingPDFException",{enumerable:!0,get:function(){return s.MissingPDFException}}),Object.defineProperty(w,"OPS",{enumerable:!0,get:function(){return s.OPS}}),Object.defineProperty(w,"PDFDataRangeTransport",{enumerable:!0,get:function(){return y.PDFDataRangeTransport}}),Object.defineProperty(w,"PDFDateString",{enumerable:!0,get:function(){return r.PDFDateString}}),Object.defineProperty(w,"PDFWorker",{enumerable:!0,get:function(){return y.PDFWorker}}),Object.defineProperty(w,"PasswordResponses",{enumerable:!0,get:function(){return s.PasswordResponses}}),Object.defineProperty(w,"PermissionFlag",{enumerable:!0,get:function(){return s.PermissionFlag}}),Object.defineProperty(w,"PixelsPerInch",{enumerable:!0,get:function(){return r.PixelsPerInch}}),Object.defineProperty(w,"PromiseCapability",{enumerable:!0,get:function(){return s.PromiseCapability}}),Object.defineProperty(w,"RenderingCancelledException",{enumerable:!0,get:function(){return r.RenderingCancelledException}}),Object.defineProperty(w,"SVGGraphics",{enumerable:!0,get:function(){return y.SVGGraphics}}),Object.defineProperty(w,"UnexpectedResponseException",{enumerable:!0,get:function(){return s.UnexpectedResponseException}}),Object.defineProperty(w,"Util",{enumerable:!0,get:function(){return s.Util}}),Object.defineProperty(w,"VerbosityLevel",{enumerable:!0,get:function(){return s.VerbosityLevel}}),Object.defineProperty(w,"XfaLayer",{enumerable:!0,get:function(){return n.XfaLayer}}),Object.defineProperty(w,"build",{enumerable:!0,get:function(){return y.build}}),Object.defineProperty(w,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return s.createValidAbsoluteUrl}}),Object.defineProperty(w,"getDocument",{enumerable:!0,get:function(){return y.getDocument}}),Object.defineProperty(w,"getFilenameFromUrl",{enumerable:!0,get:function(){return r.getFilenameFromUrl}}),Object.defineProperty(w,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return r.getPdfFilenameFromUrl}}),Object.defineProperty(w,"getXfaPageViewport",{enumerable:!0,get:function(){return r.getXfaPageViewport}}),Object.defineProperty(w,"isDataScheme",{enumerable:!0,get:function(){return r.isDataScheme}}),Object.defineProperty(w,"isPdfFile",{enumerable:!0,get:function(){return r.isPdfFile}}),Object.defineProperty(w,"loadScript",{enumerable:!0,get:function(){return r.loadScript}}),Object.defineProperty(w,"noContextMenu",{enumerable:!0,get:function(){return r.noContextMenu}}),Object.defineProperty(w,"normalizeUnicode",{enumerable:!0,get:function(){return s.normalizeUnicode}}),Object.defineProperty(w,"renderTextLayer",{enumerable:!0,get:function(){return g.renderTextLayer}}),Object.defineProperty(w,"setLayerDimensions",{enumerable:!0,get:function(){return r.setLayerDimensions}}),Object.defineProperty(w,"shadow",{enumerable:!0,get:function(){return s.shadow}}),Object.defineProperty(w,"updateTextLayer",{enumerable:!0,get:function(){return g.updateTextLayer}}),Object.defineProperty(w,"version",{enumerable:!0,get:function(){return y.version}});var s=__w_pdfjs_require__(1),y=__w_pdfjs_require__(2),r=__w_pdfjs_require__(6),g=__w_pdfjs_require__(26),P=__w_pdfjs_require__(27),C=__w_pdfjs_require__(5),L=__w_pdfjs_require__(29),j=__w_pdfjs_require__(14),n=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf)),pdf.exports}var pdfExports=requirePdf();pdfExports.GlobalWorkerOptions.workerSrc=chrome.runtime.getURL("pdf.worker.min.js");async function extractTextFromPDF(w){try{const s=await w.arrayBuffer(),y=await pdfExports.getDocument({data:s}).promise;let r="";for(let g=1;g<=y.numPages;g++){const L=(await(await y.getPage(g)).getTextContent()).items.map(j=>j.str).join(" ");r+=L+`
`}return r}catch(s){throw new Error(`Failed to extract text from PDF: ${s instanceof Error?s.message:"Unknown error"}`)}}function extractEmail(w){const s=/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/,y=w.match(s);return y?y[0]:""}function extractPhone(w){const s=/\+?[1-9]\d{0,3}[\s.-]?\(?\d{1,4}\)?[\s.-]?\d{1,4}[\s.-]?\d{1,9}/,y=/(\+?1?\s?)?\(?([0-9]{3})\)?[-.\s]?([0-9]{3})[-.\s]?([0-9]{4})/;let r=w.match(s);return r?r[0].trim():(r=w.match(y),r?r[0].trim():"")}function extractCountryCode(w){const s=/\+([1-9]\d{0,3})(?=[\s.-]?\(?\d)/,y=w.match(s);return y?`+${y[1]}`:""}function extractPhoneNumber(w){return extractPhone(w).replace(/^\+\d{1,3}/,"").replace(/[\s.\-()]/g,"")}function extractFirstAndLastName(w){const s=w.split(`
`).filter(g=>g.trim());if(s.length===0)return{firstName:"",lastName:""};const r=s[0].trim().split(/\s+/);return r.length===0?{firstName:"",lastName:""}:r.length===1?{firstName:r[0],lastName:""}:{firstName:r[0],lastName:r[r.length-1]}}function extractProfessionalSummary(w){const s=/(?:professional\s+summary|summary|objective)[\s\n:]*([^]*?)(?=\n\n|\n[A-Z][a-z]*(?:\s+[A-Z])?[\s\n:]|$)/i,y=w.match(s);return y?y[1].trim().split(`
`)[0].trim().substring(0,500):""}function extractStreetAddress(w){const s=/(?:address|street)[\s\n:]*([^\n]+)/i,y=w.match(s);return y?y[1].trim():""}function extractCity(w){const s=/(?:city)[\s\n:]*([^\n,]+)/i,y=w.match(s);return y?y[1].trim():""}function extractLocation(w){let s=/(?:location|based)[\s\n:]*([^\n]+)/i,y=w.match(s);if(y)return y[1].trim();const r=extractStreetAddress(w),g=extractCity(w),P=extractCountry(w),C=[r,g,P].filter(L=>L.length>0);return C.length>0?C.join(", "):""}function extractCountry(w){const s=/(?:country|nationality)[\s\n:]*([^\n,]+)/i,y=w.match(s);return y?y[1].trim():""}function extractCountryFromLocation(w){const s=w.split(",").map(y=>y.trim());return s.length>0?s[s.length-1]:""}function extractSkills(w){const s=/skills?[\s\n:]*([^]*?)(?=\n\n|\n(?:experience|education|projects|professional|work)[\s\n:]|$)/i,y=w.match(s);if(!y)return[];const g=y[1].split(/[,\n•\-\|;]/).map(P=>P.trim()).filter(P=>!(P.length===0||P.length>50||/^(and|or|the|a)$/i.test(P)));return[...new Set(g)]}function extractExperience(w){const s=/(?:work\s+)?experience[\s\n:]*([^]*?)(?=\n\n|\n(?:education|projects|skills|professional)[\s\n:]|$)/i,y=w.match(s);return y?y[1].split(/\n\n+/).map(P=>P.trim()).filter(P=>P.length>0&&!P.toLowerCase().startsWith("education")):[]}function extractProjects(w){const s=/projects?[\s\n:]*([^]*?)(?=\n\n|\n(?:education|experience|skills|professional)[\s\n:]|$)/i,y=w.match(s);return y?y[1].split(/\n\n+/).map(P=>P.trim()).filter(P=>P.length>0):[]}function extractYearsFromExperience(w){const s=/(\d{1,2})?[\s/]?(\d{4})\s*[-–]\s*(Present|Current|(\d{1,2})?[\s/]?(\d{4}))/i,y=w.match(s);if(y){const r=y[1]||"",g=y[2],P=y[3];let C="",L="";return P.toLowerCase()!=="present"&&P.toLowerCase()!=="current"?(C=y[4]||"",L=y[5]):(C=String(new Date().getMonth()+1),L=String(new Date().getFullYear())),{startDate:`${r}/${g}`,endDate:`${C}/${L}`,startMonth:r,startYear:g,endMonth:String(C),endYear:String(L)}}return{startDate:"",endDate:"",startMonth:"",startYear:"",endMonth:"",endYear:""}}function extractEducation(w){const s=/education[\s\n:]*([^]*?)(?=\n\n|\n(?:experience|projects|skills|professional)[\s\n:]|$)/i,y=w.match(s);return y?y[1].split(/\n\n+/).map(P=>P.trim()).filter(P=>P.length>0):[]}function parseResume(w){const{firstName:s,lastName:y}=extractFirstAndLastName(w),r=extractExperience(w),g=extractPhone(w),P=extractLocation(w);let C=extractCountry(w);const L=extractStreetAddress(w),j=extractCity(w);!C&&P&&(C=extractCountryFromLocation(P));const n=r.map(t=>({text:t,...extractYearsFromExperience(t)}));return{firstName:s,lastName:y,email:extractEmail(w),phone:g,countryCode:extractCountryCode(g),phoneNumber:extractPhoneNumber(g),streetAddress:L,city:j,location:P,country:C,professionalSummary:extractProfessionalSummary(w),skills:extractSkills(w),experience:r,experienceDetails:n,projects:extractProjects(w),education:extractEducation(w)}}function ResumeUpload(){const[w,s]=reactExports.useState(!1),[y,r]=reactExports.useState(null),[g,P]=reactExports.useState(null),[C,L]=reactExports.useState(!1),j=useAuthStore(h=>h.token),n=reactExports.useRef(null),t=()=>{n.current?.click()},i=async h=>{const l=h.target.files?.[0];if(l){s(!0),r(null),L(!1);try{const e=await extractTextFromPDF(l),u=parseResume(e);P(u);const o=await fetch("undefined/api/resume/upload",{method:"POST",headers:{"Content-Type":"application/json",...j?{Authorization:`Bearer ${j}`}:{}},body:JSON.stringify({file_name:l.name,parsed_data:u,raw_text:e})}),v=await o.text();if(!v)throw new Error("Empty response from server");const R=JSON.parse(v);if(!o.ok)throw new Error(R.error||"Upload failed");L(!0)}catch(e){r(e instanceof Error?e.message:"Failed to process resume")}finally{s(!1)}}};return jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[jsxRuntimeExports.jsx("button",{onClick:t,disabled:w,style:{width:"100%",backgroundColor:"#16a34a",color:"white",padding:"8px",borderRadius:"4px",border:"none",cursor:"pointer",opacity:w?.5:1},children:w?"Uploading...":"Upload Resume"}),jsxRuntimeExports.jsx("input",{type:"file",accept:".pdf",ref:n,onChange:i,style:{display:"none"}}),y&&jsxRuntimeExports.jsx("p",{style:{color:"#dc2626",fontSize:"12px"},children:y}),C&&jsxRuntimeExports.jsx("p",{style:{color:"#16a34a",fontSize:"12px"},children:"Resume uploaded successfully!"})]})}function App(){const[w,s]=reactExports.useState(""),[y,r]=reactExports.useState(""),[g,P]=reactExports.useState("login"),[C,L]=reactExports.useState(!0),{user:j,isLoading:n,error:t,login:i,register:h,logout:l,hydrate:e}=useAuthStore();reactExports.useEffect(()=>{e().then(()=>L(!1))},[e]);const u=async()=>{try{g==="login"?await i(w,y):await h(w,y),s(""),r("")}catch(o){console.error(o)}},p=async()=>{try{const o=await chrome.windows.getCurrent();o.id&&(await chrome.sidePanel.open({windowId:o.id}),window.close())}catch(o){console.error("Error opening side panel:",o)}};return C?jsxRuntimeExports.jsx("div",{style:{width:"400px",minHeight:"500px",backgroundColor:"#f0f1f3",display:"flex",alignItems:"center",justifyContent:"center"},children:jsxRuntimeExports.jsx("p",{children:"Loading..."})}):jsxRuntimeExports.jsx("div",{style:{width:"400px",minHeight:"500px",backgroundColor:"#f0f1f3",display:"flex",alignItems:"center",justifyContent:"center",border:"none"},children:jsxRuntimeExports.jsxs("div",{style:{width:"100%",maxWidth:"300px"},children:[jsxRuntimeExports.jsx("h1",{style:{fontSize:"24px",fontWeight:"bold",color:"#111827",marginBottom:"4px",textAlign:"center"},children:"Rae"}),jsxRuntimeExports.jsx("p",{style:{fontSize:"12px",fontWeight:"normal",color:"#6b7280",textAlign:"center",marginBottom:"8px",margin:"0 0 8px 0"},children:"(Resume Autofill Extension)"}),jsxRuntimeExports.jsx("p",{style:{fontSize:"11px",fontWeight:"normal",color:"#1f2937",textAlign:"center",marginBottom:"24px",margin:"0 0 24px 0"},children:"Upload resume once, Apply to jobs everywhere."}),j?jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[jsxRuntimeExports.jsxs("p",{style:{color:"#374151",textAlign:"center"},children:["Welcome back, ",j.email,"!"]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"flex-start"},children:[jsxRuntimeExports.jsx("div",{style:{flex:1},children:jsxRuntimeExports.jsx(ResumeUpload,{})}),jsxRuntimeExports.jsx("button",{onClick:p,style:{backgroundColor:"#64748b",color:"white",padding:"8px 16px",borderRadius:"4px",border:"none",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Edit"})]}),jsxRuntimeExports.jsx("button",{style:{width:"100%",backgroundColor:"#a855f7",color:"white",padding:"8px",borderRadius:"4px",border:"none",cursor:"pointer"},children:"Autofill Form"}),jsxRuntimeExports.jsx("button",{onClick:l,style:{width:"100%",backgroundColor:"#dc2626",color:"white",padding:"8px",borderRadius:"4px",border:"none",cursor:"pointer"},children:"Logout"})]}):jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[jsxRuntimeExports.jsx("input",{type:"email",placeholder:"Email",value:w,onChange:o=>s(o.target.value),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"4px",fontSize:"14px"}}),jsxRuntimeExports.jsx("input",{type:"password",placeholder:"Password",value:y,onChange:o=>r(o.target.value.replace(/\s/g,"")),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"4px",fontSize:"14px"}}),t&&jsxRuntimeExports.jsx("p",{style:{color:"#dc2626",fontSize:"12px"},children:t}),jsxRuntimeExports.jsx("button",{onClick:u,disabled:n,style:{width:"100%",backgroundColor:"#a855f7",color:"white",padding:"8px",borderRadius:"4px",border:"none",cursor:"pointer",opacity:n?.5:1},children:n?"Loading...":g==="login"?"Login":"Register"}),jsxRuntimeExports.jsxs("p",{style:{fontSize:"12px",color:"#6b7280",textAlign:"center"},children:[g==="login"?"Don't have an account? ":"Already have an account? ",jsxRuntimeExports.jsx("button",{onClick:()=>P(g==="login"?"register":"login"),style:{background:"none",border:"none",color:"#a855f7",cursor:"pointer",textDecoration:"underline",fontSize:"12px"},children:g==="login"?"Register":"Login"})]})]})]})})}ReactDOM.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
