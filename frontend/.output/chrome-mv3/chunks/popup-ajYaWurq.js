import{R as React,g as getAugmentedNamespace,r as reactExports,j as jsxRuntimeExports,a as ReactDOM}from"./client-DEd7WeES.js";const createStoreImpl=y=>{let i;const _=new Set,r=(n,t)=>{const s=typeof n=="function"?n(i):n;if(!Object.is(s,i)){const h=i;i=t??(typeof s!="object"||s===null)?s:Object.assign({},i,s),_.forEach(c=>c(i,h))}},p=()=>i,L={setState:r,getState:p,getInitialState:()=>I,subscribe:n=>(_.add(n),()=>_.delete(n))},I=i=y(r,p,L);return L},createStore=(y=>y?createStoreImpl(y):createStoreImpl),identity=y=>y;function useStore(y,i=identity){const _=React.useSyncExternalStore(y.subscribe,React.useCallback(()=>i(y.getState()),[y,i]),React.useCallback(()=>i(y.getInitialState()),[y,i]));return React.useDebugValue(_),_}const createImpl=y=>{const i=createStore(y),_=r=>useStore(i,r);return Object.assign(_,i),_},create=(y=>y?createImpl(y):createImpl);async function sha256(y){const i=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(y));return Array.from(new Uint8Array(i)).map(_=>_.toString(16).padStart(2,"0")).join("")}function getCanvasFingerprint(){try{const y=document.createElement("canvas"),i=y.getContext("2d");return i?(i.textBaseline="top",i.font="14px Arial",i.fillStyle="#f60",i.fillRect(125,1,62,20),i.fillStyle="#069",i.fillText("fingerprint",2,15),i.fillStyle="rgba(102,204,0,0.7)",i.fillText("fingerprint",4,17),y.toDataURL()):"no-canvas"}catch{return"canvas-blocked"}}async function getDeviceFingerprint(){const y=[navigator.userAgent,navigator.language,navigator.languages?.join(",")||"",navigator.platform,String(screen.width),String(screen.height),String(screen.colorDepth),Intl.DateTimeFormat().resolvedOptions().timeZone,String(navigator.hardwareConcurrency||""),String(navigator.deviceMemory||""),getCanvasFingerprint()];return sha256(y.join("|"))}function getBrowserInfo(){const y=navigator.userAgent;let i="Unknown",_="Unknown";return y.includes("Chrome")&&!y.includes("Edg")?i="Chrome":y.includes("Firefox")?i="Firefox":y.includes("Safari")&&!y.includes("Chrome")?i="Safari":y.includes("Edg")?i="Edge":(y.includes("OPR")||y.includes("Opera"))&&(i="Opera"),y.includes("Windows")?_="Windows":y.includes("Mac OS X")?_="macOS":y.includes("Linux")?_="Linux":y.includes("Android")?_="Android":(y.includes("iPhone")||y.includes("iPad"))&&(_="iOS"),{browser:i,os:_}}const API_URL="http://localhost:8080",GOOGLE_CLIENT_ID="131221268968-rib84tsnpi5tiol20doitvcqq91an5c8.apps.googleusercontent.com",LINKEDIN_CLIENT_ID="78hmhdc7lezefx";async function persistSession(y,i,_){const r={auth_token:y,user:JSON.stringify(i),device_id:_};typeof window<"u"&&window.chrome?.storage&&window.chrome.storage.local.set(r),localStorage.setItem("auth_token",y),localStorage.setItem("user",JSON.stringify(i)),localStorage.setItem("device_id",_)}async function clearSession(){typeof window<"u"&&window.chrome?.storage&&window.chrome.storage.local.remove(["auth_token","user","device_id"]),localStorage.removeItem("auth_token"),localStorage.removeItem("user"),localStorage.removeItem("device_id")}async function getOrCreateDeviceId(){const y=localStorage.getItem("device_id");if(y)return y;if(typeof window<"u"&&window.chrome?.storage){const i=await new Promise(_=>window.chrome.storage.local.get(["device_id"],_));if(i.device_id)return i.device_id}return getDeviceFingerprint()}async function launchOAuthFlow(y){return new Promise((i,_)=>{chrome.identity.launchWebAuthFlow({url:y,interactive:!0},r=>{if(chrome.runtime.lastError)return _(new Error(chrome.runtime.lastError.message));if(!r)return _(new Error("OAuth cancelled"));i(r)})})}function buildGoogleAuthUrl(){const y=chrome.identity.getRedirectURL("google");return`https://accounts.google.com/o/oauth2/v2/auth?${new URLSearchParams({client_id:GOOGLE_CLIENT_ID,redirect_uri:y,response_type:"code",scope:"openid email profile",access_type:"offline",prompt:"select_account"})}`}function buildLinkedInAuthUrl(){const y=chrome.identity.getRedirectURL("linkedin");return`https://www.linkedin.com/oauth/v2/authorization?${new URLSearchParams({client_id:LINKEDIN_CLIENT_ID,redirect_uri:y,response_type:"code",scope:"openid profile email",state:crypto.randomUUID()})}`}const useAuthStore=create((y,i)=>({user:null,token:null,deviceId:null,isLoading:!1,error:null,hydrate:async()=>{if(typeof window>"u")return;let _=null,r=null,p=null;if(window.chrome?.storage){const C=await new Promise(w=>window.chrome.storage.local.get(["auth_token","user","device_id"],w));_=C.auth_token||null,r=C.user?JSON.parse(C.user):null,p=C.device_id||null}if(_||(_=localStorage.getItem("auth_token")),!r){const C=localStorage.getItem("user");C&&(r=JSON.parse(C))}p||(p=localStorage.getItem("device_id")),_&&r&&y({token:_,user:r,deviceId:p})},register:async(_,r)=>{y({isLoading:!0,error:null});try{const p=await getOrCreateDeviceId(),{browser:C,os:w}=getBrowserInfo(),L=await fetch(`${API_URL}/api/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:_,password:r,device_id:p,browser:C,os:w})}),I=await L.text();if(!I)throw new Error("Empty response from server");const n=JSON.parse(I);if(!L.ok)throw new Error(n.error||"Registration failed");const t={id:n.id,email:n.email};y({user:t,token:n.token,deviceId:p,isLoading:!1}),await persistSession(n.token,t,p)}catch(p){throw y({error:p instanceof Error?p.message:"Registration failed",isLoading:!1}),p}},login:async(_,r)=>{y({isLoading:!0,error:null});try{const p=await getOrCreateDeviceId(),{browser:C,os:w}=getBrowserInfo(),L=await fetch(`${API_URL}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:_,password:r,device_id:p,browser:C,os:w})}),I=await L.text();if(!I)throw new Error("Empty response from server");const n=JSON.parse(I);if(!L.ok)throw new Error(n.error||"Login failed");const t={id:n.id,email:n.email};y({user:t,token:n.token,deviceId:p,isLoading:!1}),await persistSession(n.token,t,p)}catch(p){throw y({error:p instanceof Error?p.message:"Login failed",isLoading:!1}),p}},loginWithGoogle:async()=>{y({isLoading:!0,error:null});try{const _=await getOrCreateDeviceId(),{browser:r,os:p}=getBrowserInfo(),C=chrome.identity.getRedirectURL("google"),w=buildGoogleAuthUrl(),L=await launchOAuthFlow(w),n=new URL(L).searchParams.get("code");if(!n)throw new Error("No authorization code received");const t=await fetch(`${API_URL}/api/auth/oauth/google`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n,redirect_uri:C,device_id:_,browser:r,os:p})}),s=await t.text();if(!s)throw new Error("Empty response from server");const h=JSON.parse(s);if(!t.ok)throw new Error(h.error||"Google login failed");const c={id:h.id,email:h.email};y({user:c,token:h.token,deviceId:_,isLoading:!1}),await persistSession(h.token,c,_)}catch(_){throw y({error:_ instanceof Error?_.message:"Google login failed",isLoading:!1}),_}},loginWithLinkedIn:async()=>{y({isLoading:!0,error:null});try{const _=await getOrCreateDeviceId(),{browser:r,os:p}=getBrowserInfo(),C=chrome.identity.getRedirectURL("linkedin"),w=buildLinkedInAuthUrl(),L=await launchOAuthFlow(w),n=new URL(L).searchParams.get("code");if(!n)throw new Error("No authorization code received");const t=await fetch(`${API_URL}/api/auth/oauth/linkedin`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n,redirect_uri:C,device_id:_,browser:r,os:p})}),s=await t.text();if(!s)throw new Error("Empty response from server");const h=JSON.parse(s);if(!t.ok)throw new Error(h.error||"LinkedIn login failed");const c={id:h.id,email:h.email};y({user:c,token:h.token,deviceId:_,isLoading:!1}),await persistSession(h.token,c,_)}catch(_){throw y({error:_ instanceof Error?_.message:"LinkedIn login failed",isLoading:!1}),_}},logout:()=>{y({user:null,token:null,deviceId:null,error:null}),clearSession()},setToken:_=>{y({token:_}),localStorage.setItem("auth_token",_),typeof window<"u"&&window.chrome?.storage&&window.chrome.storage.local.set({auth_token:_})}}));function commonjsRequire(y){throw new Error('Could not dynamically require "'+y+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);var hasRequiredPdf;function requirePdf(){return hasRequiredPdf||(hasRequiredPdf=1,(function(module,exports$1){(function(i,_){module.exports=i.pdfjsLib=_()})(globalThis,()=>(()=>{var __webpack_modules__=[,((y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.VerbosityLevel=i.Util=i.UnknownErrorException=i.UnexpectedResponseException=i.TextRenderingMode=i.RenderingIntentFlag=i.PromiseCapability=i.PermissionFlag=i.PasswordResponses=i.PasswordException=i.PageActionEventType=i.OPS=i.MissingPDFException=i.MAX_IMAGE_SIZE_TO_CACHE=i.LINE_FACTOR=i.LINE_DESCENT_FACTOR=i.InvalidPDFException=i.ImageKind=i.IDENTITY_MATRIX=i.FormatError=i.FeatureTest=i.FONT_IDENTITY_MATRIX=i.DocumentActionEventType=i.CMapCompressionType=i.BaseException=i.BASELINE_FACTOR=i.AnnotationType=i.AnnotationReplyType=i.AnnotationPrefix=i.AnnotationMode=i.AnnotationFlag=i.AnnotationFieldFlag=i.AnnotationEditorType=i.AnnotationEditorPrefix=i.AnnotationEditorParamsType=i.AnnotationBorderStyleType=i.AnnotationActionEventType=i.AbortException=void 0,i.assert=l,i.bytesToString=U,i.createValidAbsoluteUrl=A,i.getModificationDate=mt,i.getUuid=Nt,i.getVerbosityLevel=st,i.info=K,i.isArrayBuffer=ut,i.isArrayEqual=At,i.isNodeJS=void 0,i.normalizeUnicode=It,i.objectFromMap=q,i.objectSize=nt,i.setVerbosityLevel=Q,i.shadow=R,i.string32=X,i.stringToBytes=W,i.stringToPDFString=lt,i.stringToUTF8String=ct,i.unreachable=m,i.utf8StringToString=ht,i.warn=D;const _=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");i.isNodeJS=_;const r=[1,0,0,1,0,0];i.IDENTITY_MATRIX=r;const p=[.001,0,0,.001,0,0];i.FONT_IDENTITY_MATRIX=p;const C=1e7;i.MAX_IMAGE_SIZE_TO_CACHE=C;const w=1.35;i.LINE_FACTOR=w;const L=.35;i.LINE_DESCENT_FACTOR=L;const I=L/w;i.BASELINE_FACTOR=I;const n={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};i.RenderingIntentFlag=n;const t={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};i.AnnotationMode=t;const s="pdfjs_internal_editor_";i.AnnotationEditorPrefix=s;const h={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};i.AnnotationEditorType=h;const c={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};i.AnnotationEditorParamsType=c;const e={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};i.PermissionFlag=e;const d={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};i.TextRenderingMode=d;const g={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};i.ImageKind=g;const o={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};i.AnnotationType=o;const v={GROUP:"Group",REPLY:"R"};i.AnnotationReplyType=v;const k={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};i.AnnotationFlag=k;const E={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};i.AnnotationFieldFlag=E;const f={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};i.AnnotationBorderStyleType=f;const x={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};i.AnnotationActionEventType=x;const j={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};i.DocumentActionEventType=j;const B={O:"PageOpen",C:"PageClose"};i.PageActionEventType=B;const N={ERRORS:0,WARNINGS:1,INFOS:5};i.VerbosityLevel=N;const z={NONE:0,BINARY:1};i.CMapCompressionType=z;const H={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};i.OPS=H;const it={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};i.PasswordResponses=it;let Z=N.WARNINGS;function Q(et){Number.isInteger(et)&&(Z=et)}function st(){return Z}function K(et){Z>=N.INFOS&&console.log(`Info: ${et}`)}function D(et){Z>=N.WARNINGS&&console.log(`Warning: ${et}`)}function m(et){throw new Error(et)}function l(et,V){et||m(V)}function u(et){switch(et?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function A(et,V=null,G=null){if(!et)return null;try{if(G&&typeof et=="string"&&(G.addDefaultProtocol&&et.startsWith("www.")&&et.match(/\./g)?.length>=2&&(et=`http://${et}`),G.tryConvertEncoding))try{et=ct(et)}catch{}const at=V?new URL(et,V):new URL(et);if(u(at))return at}catch{}return null}function R(et,V,G,at=!1){return Object.defineProperty(et,V,{value:G,enumerable:!at,configurable:!0,writable:!1}),G}const M=(function(){function V(G,at){this.constructor===V&&m("Cannot initialize BaseException."),this.message=G,this.name=at}return V.prototype=new Error,V.constructor=V,V})();i.BaseException=M;class O extends M{constructor(V,G){super(V,"PasswordException"),this.code=G}}i.PasswordException=O;class T extends M{constructor(V,G){super(V,"UnknownErrorException"),this.details=G}}i.UnknownErrorException=T;class a extends M{constructor(V){super(V,"InvalidPDFException")}}i.InvalidPDFException=a;class b extends M{constructor(V){super(V,"MissingPDFException")}}i.MissingPDFException=b;class S extends M{constructor(V,G){super(V,"UnexpectedResponseException"),this.status=G}}i.UnexpectedResponseException=S;class P extends M{constructor(V){super(V,"FormatError")}}i.FormatError=P;class F extends M{constructor(V){super(V,"AbortException")}}i.AbortException=F;function U(et){(typeof et!="object"||et?.length===void 0)&&m("Invalid argument for bytesToString");const V=et.length,G=8192;if(V<G)return String.fromCharCode.apply(null,et);const at=[];for(let dt=0;dt<V;dt+=G){const pt=Math.min(dt+G,V),gt=et.subarray(dt,pt);at.push(String.fromCharCode.apply(null,gt))}return at.join("")}function W(et){typeof et!="string"&&m("Invalid argument for stringToBytes");const V=et.length,G=new Uint8Array(V);for(let at=0;at<V;++at)G[at]=et.charCodeAt(at)&255;return G}function X(et){return String.fromCharCode(et>>24&255,et>>16&255,et>>8&255,et&255)}function nt(et){return Object.keys(et).length}function q(et){const V=Object.create(null);for(const[G,at]of et)V[G]=at;return V}function Y(){const et=new Uint8Array(4);return et[0]=1,new Uint32Array(et.buffer,0,1)[0]===1}function $(){try{return new Function(""),!0}catch{return!1}}class J{static get isLittleEndian(){return R(this,"isLittleEndian",Y())}static get isEvalSupported(){return R(this,"isEvalSupported",$())}static get isOffscreenCanvasSupported(){return R(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?R(this,"platform",{isWin:!1,isMac:!1}):R(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){return R(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}i.FeatureTest=J;const tt=[...Array(256).keys()].map(et=>et.toString(16).padStart(2,"0"));class rt{static makeHexColor(V,G,at){return`#${tt[V]}${tt[G]}${tt[at]}`}static scaleMinMax(V,G){let at;V[0]?(V[0]<0&&(at=G[0],G[0]=G[1],G[1]=at),G[0]*=V[0],G[1]*=V[0],V[3]<0&&(at=G[2],G[2]=G[3],G[3]=at),G[2]*=V[3],G[3]*=V[3]):(at=G[0],G[0]=G[2],G[2]=at,at=G[1],G[1]=G[3],G[3]=at,V[1]<0&&(at=G[2],G[2]=G[3],G[3]=at),G[2]*=V[1],G[3]*=V[1],V[2]<0&&(at=G[0],G[0]=G[1],G[1]=at),G[0]*=V[2],G[1]*=V[2]),G[0]+=V[4],G[1]+=V[4],G[2]+=V[5],G[3]+=V[5]}static transform(V,G){return[V[0]*G[0]+V[2]*G[1],V[1]*G[0]+V[3]*G[1],V[0]*G[2]+V[2]*G[3],V[1]*G[2]+V[3]*G[3],V[0]*G[4]+V[2]*G[5]+V[4],V[1]*G[4]+V[3]*G[5]+V[5]]}static applyTransform(V,G){const at=V[0]*G[0]+V[1]*G[2]+G[4],dt=V[0]*G[1]+V[1]*G[3]+G[5];return[at,dt]}static applyInverseTransform(V,G){const at=G[0]*G[3]-G[1]*G[2],dt=(V[0]*G[3]-V[1]*G[2]+G[2]*G[5]-G[4]*G[3])/at,pt=(-V[0]*G[1]+V[1]*G[0]+G[4]*G[1]-G[5]*G[0])/at;return[dt,pt]}static getAxialAlignedBoundingBox(V,G){const at=this.applyTransform(V,G),dt=this.applyTransform(V.slice(2,4),G),pt=this.applyTransform([V[0],V[3]],G),gt=this.applyTransform([V[2],V[1]],G);return[Math.min(at[0],dt[0],pt[0],gt[0]),Math.min(at[1],dt[1],pt[1],gt[1]),Math.max(at[0],dt[0],pt[0],gt[0]),Math.max(at[1],dt[1],pt[1],gt[1])]}static inverseTransform(V){const G=V[0]*V[3]-V[1]*V[2];return[V[3]/G,-V[1]/G,-V[2]/G,V[0]/G,(V[2]*V[5]-V[4]*V[3])/G,(V[4]*V[1]-V[5]*V[0])/G]}static singularValueDecompose2dScale(V){const G=[V[0],V[2],V[1],V[3]],at=V[0]*G[0]+V[1]*G[2],dt=V[0]*G[1]+V[1]*G[3],pt=V[2]*G[0]+V[3]*G[2],gt=V[2]*G[1]+V[3]*G[3],wt=(at+gt)/2,Ct=Math.sqrt((at+gt)**2-4*(at*gt-pt*dt))/2,xt=wt+Ct||1,_t=wt-Ct||1;return[Math.sqrt(xt),Math.sqrt(_t)]}static normalizeRect(V){const G=V.slice(0);return V[0]>V[2]&&(G[0]=V[2],G[2]=V[0]),V[1]>V[3]&&(G[1]=V[3],G[3]=V[1]),G}static intersect(V,G){const at=Math.max(Math.min(V[0],V[2]),Math.min(G[0],G[2])),dt=Math.min(Math.max(V[0],V[2]),Math.max(G[0],G[2]));if(at>dt)return null;const pt=Math.max(Math.min(V[1],V[3]),Math.min(G[1],G[3])),gt=Math.min(Math.max(V[1],V[3]),Math.max(G[1],G[3]));return pt>gt?null:[at,pt,dt,gt]}static bezierBoundingBox(V,G,at,dt,pt,gt,wt,Ct){const xt=[],_t=[[],[]];let Tt,St,Rt,ft,Ft,Mt,Dt,Lt;for(let Ot=0;Ot<2;++Ot){if(Ot===0?(St=6*V-12*at+6*pt,Tt=-3*V+9*at-9*pt+3*wt,Rt=3*at-3*V):(St=6*G-12*dt+6*gt,Tt=-3*G+9*dt-9*gt+3*Ct,Rt=3*dt-3*G),Math.abs(Tt)<1e-12){if(Math.abs(St)<1e-12)continue;ft=-Rt/St,0<ft&&ft<1&&xt.push(ft);continue}Dt=St*St-4*Rt*Tt,Lt=Math.sqrt(Dt),!(Dt<0)&&(Ft=(-St+Lt)/(2*Tt),0<Ft&&Ft<1&&xt.push(Ft),Mt=(-St-Lt)/(2*Tt),0<Mt&&Mt<1&&xt.push(Mt))}let Pt=xt.length,yt;const kt=Pt;for(;Pt--;)ft=xt[Pt],yt=1-ft,_t[0][Pt]=yt*yt*yt*V+3*yt*yt*ft*at+3*yt*ft*ft*pt+ft*ft*ft*wt,_t[1][Pt]=yt*yt*yt*G+3*yt*yt*ft*dt+3*yt*ft*ft*gt+ft*ft*ft*Ct;return _t[0][kt]=V,_t[1][kt]=G,_t[0][kt+1]=wt,_t[1][kt+1]=Ct,_t[0].length=_t[1].length=kt+2,[Math.min(..._t[0]),Math.min(..._t[1]),Math.max(..._t[0]),Math.max(..._t[1])]}}i.Util=rt;const ot=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function lt(et){if(et[0]>="ï"){let G;if(et[0]==="þ"&&et[1]==="ÿ"?G="utf-16be":et[0]==="ÿ"&&et[1]==="þ"?G="utf-16le":et[0]==="ï"&&et[1]==="»"&&et[2]==="¿"&&(G="utf-8"),G)try{const at=new TextDecoder(G,{fatal:!0}),dt=W(et);return at.decode(dt)}catch(at){D(`stringToPDFString: "${at}".`)}}const V=[];for(let G=0,at=et.length;G<at;G++){const dt=ot[et.charCodeAt(G)];V.push(dt?String.fromCharCode(dt):et.charAt(G))}return V.join("")}function ct(et){return decodeURIComponent(escape(et))}function ht(et){return unescape(encodeURIComponent(et))}function ut(et){return typeof et=="object"&&et?.byteLength!==void 0}function At(et,V){if(et.length!==V.length)return!1;for(let G=0,at=et.length;G<at;G++)if(et[G]!==V[G])return!1;return!0}function mt(et=new Date){return[et.getUTCFullYear().toString(),(et.getUTCMonth()+1).toString().padStart(2,"0"),et.getUTCDate().toString().padStart(2,"0"),et.getUTCHours().toString().padStart(2,"0"),et.getUTCMinutes().toString().padStart(2,"0"),et.getUTCSeconds().toString().padStart(2,"0")].join("")}class Et{#t=!1;constructor(){this.promise=new Promise((V,G)=>{this.resolve=at=>{this.#t=!0,V(at)},this.reject=at=>{this.#t=!0,G(at)}})}get settled(){return this.#t}}i.PromiseCapability=Et;let bt=null,vt=null;function It(et){return bt||(bt=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,vt=new Map([["ﬅ","ſt"]])),et.replaceAll(bt,(V,G,at)=>G?G.normalize("NFKC"):vt.get(at))}function Nt(){if(typeof crypto<"u"&&typeof crypto?.randomUUID=="function")return crypto.randomUUID();const et=new Uint8Array(32);if(typeof crypto<"u"&&typeof crypto?.getRandomValues=="function")crypto.getRandomValues(et);else for(let V=0;V<32;V++)et[V]=Math.floor(Math.random()*255);return U(et)}const jt="pdfjs_internal_id_";i.AnnotationPrefix=jt}),((__unused_webpack_module,exports$1,__w_pdfjs_require__)=>{Object.defineProperty(exports$1,"__esModule",{value:!0}),exports$1.RenderTask=exports$1.PDFWorkerUtil=exports$1.PDFWorker=exports$1.PDFPageProxy=exports$1.PDFDocumentProxy=exports$1.PDFDocumentLoadingTask=exports$1.PDFDataRangeTransport=exports$1.LoopbackPort=exports$1.DefaultStandardFontDataFactory=exports$1.DefaultFilterFactory=exports$1.DefaultCanvasFactory=exports$1.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports$1,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports$1.build=void 0,exports$1.getDocument=getDocument,exports$1.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports$1.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports$1.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports$1.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports$1.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(y){if(typeof y=="string"||y instanceof URL?y={url:y}:(0,_util.isArrayBuffer)(y)&&(y={data:y}),typeof y!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!y.url&&!y.data&&!y.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const i=new PDFDocumentLoadingTask,{docId:_}=i,r=y.url?getUrlProp(y.url):null,p=y.data?getDataProp(y.data):null,C=y.httpHeaders||null,w=y.withCredentials===!0,L=y.password??null,I=y.range instanceof PDFDataRangeTransport?y.range:null,n=Number.isInteger(y.rangeChunkSize)&&y.rangeChunkSize>0?y.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let t=y.worker instanceof PDFWorker?y.worker:null;const s=y.verbosity,h=typeof y.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(y.docBaseUrl)?y.docBaseUrl:null,c=typeof y.cMapUrl=="string"?y.cMapUrl:null,e=y.cMapPacked!==!1,d=y.CMapReaderFactory||DefaultCMapReaderFactory,g=typeof y.standardFontDataUrl=="string"?y.standardFontDataUrl:null,o=y.StandardFontDataFactory||DefaultStandardFontDataFactory,v=y.stopAtErrors!==!0,k=Number.isInteger(y.maxImageSize)&&y.maxImageSize>-1?y.maxImageSize:-1,E=y.isEvalSupported!==!1,f=typeof y.isOffscreenCanvasSupported=="boolean"?y.isOffscreenCanvasSupported:!_util.isNodeJS,x=Number.isInteger(y.canvasMaxAreaInBytes)?y.canvasMaxAreaInBytes:-1,j=typeof y.disableFontFace=="boolean"?y.disableFontFace:_util.isNodeJS,B=y.fontExtraProperties===!0,N=y.enableXfa===!0,z=y.ownerDocument||globalThis.document,H=y.disableRange===!0,it=y.disableStream===!0,Z=y.disableAutoFetch===!0,Q=y.pdfBug===!0,st=I?I.length:y.length??NaN,K=typeof y.useSystemFonts=="boolean"?y.useSystemFonts:!_util.isNodeJS&&!j,D=typeof y.useWorkerFetch=="boolean"?y.useWorkerFetch:d===_display_utils.DOMCMapReaderFactory&&o===_display_utils.DOMStandardFontDataFactory&&c&&g&&(0,_display_utils.isValidFetchUrl)(c,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(g,document.baseURI),m=y.canvasFactory||new DefaultCanvasFactory({ownerDocument:z}),l=y.filterFactory||new DefaultFilterFactory({docId:_,ownerDocument:z}),u=null;(0,_util.setVerbosityLevel)(s);const A={canvasFactory:m,filterFactory:l};if(D||(A.cMapReaderFactory=new d({baseUrl:c,isCompressed:e}),A.standardFontDataFactory=new o({baseUrl:g})),!t){const O={verbosity:s,port:_worker_options.GlobalWorkerOptions.workerPort};t=O.port?PDFWorker.fromPort(O):new PDFWorker(O),i._worker=t}const R={docId:_,apiVersion:"3.11.174",data:p,password:L,disableAutoFetch:Z,rangeChunkSize:n,length:st,docBaseUrl:h,enableXfa:N,evaluatorOptions:{maxImageSize:k,disableFontFace:j,ignoreErrors:v,isEvalSupported:E,isOffscreenCanvasSupported:f,canvasMaxAreaInBytes:x,fontExtraProperties:B,useSystemFonts:K,cMapUrl:D?c:null,standardFontDataUrl:D?g:null}},M={ignoreErrors:v,isEvalSupported:E,disableFontFace:j,fontExtraProperties:B,enableXfa:N,ownerDocument:z,disableAutoFetch:Z,pdfBug:Q,styleElement:u};return t.promise.then(function(){if(i.destroyed)throw new Error("Loading aborted");const O=_fetchDocument(t,R),T=new Promise(function(a){let b;I?b=new _transport_stream.PDFDataTransportStream({length:st,initialData:I.initialData,progressiveDone:I.progressiveDone,contentDispositionFilename:I.contentDispositionFilename,disableRange:H,disableStream:it},I):p||(b=(P=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(P):(0,_display_utils.isValidFetchUrl)(P.url)?new _displayFetch_stream.PDFFetchStream(P):new _displayNetwork.PDFNetworkStream(P))({url:r,length:st,httpHeaders:C,withCredentials:w,rangeChunkSize:n,disableRange:H,disableStream:it})),a(b)});return Promise.all([O,T]).then(function([a,b]){if(i.destroyed)throw new Error("Loading aborted");const S=new _message_handler.MessageHandler(_,a,t.port),P=new WorkerTransport(S,i,b,M,A);i._transport=P,S.send("Ready",null)})}).catch(i._capability.reject),i}async function _fetchDocument(y,i){if(y.destroyed)throw new Error("Worker was destroyed");const _=await y.messageHandler.sendWithPromise("GetDocRequest",i,i.data?[i.data.buffer]:null);if(y.destroyed)throw new Error("Worker was destroyed");return _}function getUrlProp(y){if(y instanceof URL)return y.href;try{return new URL(y,window.location).href}catch{if(_util.isNodeJS&&typeof y=="string")return y}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(y){if(_util.isNodeJS&&typeof Buffer<"u"&&y instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(y instanceof Uint8Array&&y.byteLength===y.buffer.byteLength)return y;if(typeof y=="string")return(0,_util.stringToBytes)(y);if(typeof y=="object"&&!isNaN(y?.length)||(0,_util.isArrayBuffer)(y))return new Uint8Array(y);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}class PDFDocumentLoadingTask{static#t=0;constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${PDFDocumentLoadingTask.#t++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(i){throw this._worker?.port&&delete this._worker._pendingDestroy,i}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}exports$1.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(i,_,r=!1,p=null){this.length=i,this.initialData=_,this.progressiveDone=r,this.contentDispositionFilename=p,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(i){this._rangeListeners.push(i)}addProgressListener(i){this._progressListeners.push(i)}addProgressiveReadListener(i){this._progressiveReadListeners.push(i)}addProgressiveDoneListener(i){this._progressiveDoneListeners.push(i)}onDataRange(i,_){for(const r of this._rangeListeners)r(i,_)}onDataProgress(i,_){this._readyCapability.promise.then(()=>{for(const r of this._progressListeners)r(i,_)})}onDataProgressiveRead(i){this._readyCapability.promise.then(()=>{for(const _ of this._progressiveReadListeners)_(i)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const i of this._progressiveDoneListeners)i()})}transportReady(){this._readyCapability.resolve()}requestDataRange(i,_){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports$1.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(i,_){this._pdfInfo=i,this._transport=_,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(r=>{if(!r)return r;const p=[];for(const C in r)p.push(...r[C]);return p}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(i){return this._transport.getPage(i)}getPageIndex(i){return this._transport.getPageIndex(i)}getDestinations(){return this._transport.getDestinations()}getDestination(i){return this._transport.getDestination(i)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(i=!1){return this._transport.startCleanup(i||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports$1.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{#t=null;#e=!1;constructor(i,_,r,p=!1){this._pageIndex=i,this._pageInfo=_,this._transport=r,this._stats=p?new _display_utils.StatTimer:null,this._pdfBug=p,this.commonObjs=r.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:i,rotation:_=this.rotate,offsetX:r=0,offsetY:p=0,dontFlip:C=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:i,rotation:_,offsetX:r,offsetY:p,dontFlip:C})}getAnnotations({intent:i="display"}={}){const _=this._transport.getRenderingIntent(i);return this._transport.getAnnotations(this._pageIndex,_.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:i,viewport:_,intent:r="display",annotationMode:p=_util.AnnotationMode.ENABLE,transform:C=null,background:w=null,optionalContentConfigPromise:L=null,annotationCanvasMap:I=null,pageColors:n=null,printAnnotationStorage:t=null}){this._stats?.time("Overall");const s=this._transport.getRenderingIntent(r,p,t);this.#e=!1,this.#s(),L||(L=this._transport.getOptionalContentConfig());let h=this._intentStates.get(s.cacheKey);h||(h=Object.create(null),this._intentStates.set(s.cacheKey,h)),h.streamReaderCancelTimeout&&(clearTimeout(h.streamReaderCancelTimeout),h.streamReaderCancelTimeout=null);const c=!!(s.renderingIntent&_util.RenderingIntentFlag.PRINT);h.displayReadyCapability||(h.displayReadyCapability=new _util.PromiseCapability,h.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(s));const e=o=>{h.renderTasks.delete(d),(this._maybeCleanupAfterRender||c)&&(this.#e=!0),this.#i(!c),o?(d.capability.reject(o),this._abortOperatorList({intentState:h,reason:o instanceof Error?o:new Error(o)})):d.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")},d=new InternalRenderTask({callback:e,params:{canvasContext:i,viewport:_,transform:C,background:w},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:I,operatorList:h.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!c,pdfBug:this._pdfBug,pageColors:n});(h.renderTasks||=new Set).add(d);const g=d.task;return Promise.all([h.displayReadyCapability.promise,L]).then(([o,v])=>{if(this.destroyed){e();return}this._stats?.time("Rendering"),d.initializeGraphics({transparency:o,optionalContentConfig:v}),d.operatorListChanged()}).catch(e),g}getOperatorList({intent:i="display",annotationMode:_=_util.AnnotationMode.ENABLE,printAnnotationStorage:r=null}={}){function p(){w.operatorList.lastChunk&&(w.opListReadCapability.resolve(w.operatorList),w.renderTasks.delete(L))}const C=this._transport.getRenderingIntent(i,_,r,!0);let w=this._intentStates.get(C.cacheKey);w||(w=Object.create(null),this._intentStates.set(C.cacheKey,w));let L;return w.opListReadCapability||(L=Object.create(null),L.operatorListChanged=p,w.opListReadCapability=new _util.PromiseCapability,(w.renderTasks||=new Set).add(L),w.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(C)),w.opListReadCapability.promise}streamTextContent({includeMarkedContent:i=!1,disableNormalization:_=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:i===!0,disableNormalization:_===!0},{highWaterMark:100,size(p){return p.items.length}})}getTextContent(i={}){if(this._transport._htmlForXfa)return this.getXfa().then(r=>_xfa_text.XfaText.textContent(r));const _=this.streamTextContent(i);return new Promise(function(r,p){function C(){w.read().then(function({value:I,done:n}){if(n){r(L);return}Object.assign(L.styles,I.styles),L.items.push(...I.items),C()},p)}const w=_.getReader(),L={items:[],styles:Object.create(null)};C()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const i=[];for(const _ of this._intentStates.values())if(this._abortOperatorList({intentState:_,reason:new Error("Page was destroyed."),force:!0}),!_.opListReadCapability)for(const r of _.renderTasks)i.push(r.completed),r.cancel();return this.objs.clear(),this.#e=!1,this.#s(),Promise.all(i)}cleanup(i=!1){this.#e=!0;const _=this.#i(!1);return i&&_&&(this._stats&&=new _display_utils.StatTimer),_}#i(i=!1){if(this.#s(),!this.#e||this.destroyed)return!1;if(i)return this.#t=setTimeout(()=>{this.#t=null,this.#i(!1)},DELAYED_CLEANUP_TIMEOUT),!1;for(const{renderTasks:_,operatorList:r}of this._intentStates.values())if(_.size>0||!r.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}#s(){this.#t&&(clearTimeout(this.#t),this.#t=null)}_startRenderPage(i,_){const r=this._intentStates.get(_);r&&(this._stats?.timeEnd("Page Request"),r.displayReadyCapability?.resolve(i))}_renderPageChunk(i,_){for(let r=0,p=i.length;r<p;r++)_.operatorList.fnArray.push(i.fnArray[r]),_.operatorList.argsArray.push(i.argsArray[r]);_.operatorList.lastChunk=i.lastChunk,_.operatorList.separateAnnots=i.separateAnnots;for(const r of _.renderTasks)r.operatorListChanged();i.lastChunk&&this.#i(!0)}_pumpOperatorList({renderingIntent:i,cacheKey:_,annotationStorageSerializable:r}){const{map:p,transfers:C}=r,L=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:i,cacheKey:_,annotationStorage:p},C).getReader(),I=this._intentStates.get(_);I.streamReader=L;const n=()=>{L.read().then(({value:t,done:s})=>{if(s){I.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(t,I),n())},t=>{if(I.streamReader=null,!this._transport.destroyed){if(I.operatorList){I.operatorList.lastChunk=!0;for(const s of I.renderTasks)s.operatorListChanged();this.#i(!0)}if(I.displayReadyCapability)I.displayReadyCapability.reject(t);else if(I.opListReadCapability)I.opListReadCapability.reject(t);else throw t}})};n()}_abortOperatorList({intentState:i,reason:_,force:r=!1}){if(i.streamReader){if(i.streamReaderCancelTimeout&&(clearTimeout(i.streamReaderCancelTimeout),i.streamReaderCancelTimeout=null),!r){if(i.renderTasks.size>0)return;if(_ instanceof _display_utils.RenderingCancelledException){let p=RENDERING_CANCELLED_TIMEOUT;_.extraDelay>0&&_.extraDelay<1e3&&(p+=_.extraDelay),i.streamReaderCancelTimeout=setTimeout(()=>{i.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:i,reason:_,force:!0})},p);return}}if(i.streamReader.cancel(new _util.AbortException(_.message)).catch(()=>{}),i.streamReader=null,!this._transport.destroyed){for(const[p,C]of this._intentStates)if(C===i){this._intentStates.delete(p);break}this.cleanup()}}}get stats(){return this._stats}}exports$1.PDFPageProxy=PDFPageProxy;class LoopbackPort{#t=new Set;#e=Promise.resolve();postMessage(i,_){const r={data:structuredClone(i,_?{transfer:_}:null)};this.#e.then(()=>{for(const p of this.#t)p.call(this,r)})}addEventListener(i,_){this.#t.add(_)}removeEventListener(i,_){this.#t.delete(_)}terminate(){this.#t.clear()}}exports$1.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports$1.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const y=document?.currentScript?.src;y&&(PDFWorkerUtil.fallbackWorkerSrc=y.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(y,i){let _;try{if(_=new URL(y),!_.origin||_.origin==="null")return!1}catch{return!1}const r=new URL(i,_);return _.origin===r.origin},PDFWorkerUtil.createCDNWrapper=function(y){const i=`importScripts("${y}");`;return URL.createObjectURL(new Blob([i]))}}class PDFWorker{static#workerPorts;constructor({name:y=null,port:i=null,verbosity:_=(0,_util.getVerbosityLevel)()}={}){if(this.name=y,this.destroyed=!1,this.verbosity=_,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,i){if(PDFWorker.#workerPorts?.has(i))throw new Error("Cannot use more than one PDFWorker per port.");(PDFWorker.#workerPorts||=new WeakMap).set(i,this),this._initializeFromPort(i);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(y){this._port=y,this._messageHandler=new _message_handler.MessageHandler("main","worker",y),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:y}=PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,y)||(y=PDFWorkerUtil.createCDNWrapper(new URL(y,window.location).href));const i=new Worker(y),_=new _message_handler.MessageHandler("main","worker",i),r=()=>{i.removeEventListener("error",p),_.destroy(),i.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},p=()=>{this._webWorker||r()};i.addEventListener("error",p),_.on("test",w=>{if(i.removeEventListener("error",p),this.destroyed){r();return}w?(this._messageHandler=_,this._port=i,this._webWorker=i,this._readyCapability.resolve(),_.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),_.destroy(),i.terminate())}),_.on("ready",w=>{if(i.removeEventListener("error",p),this.destroyed){r();return}try{C()}catch{this._setupFakeWorker()}});const C=()=>{const w=new Uint8Array;_.send("test",w,[w.buffer])};C();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),PDFWorker._setupFakeWorkerGlobal.then(y=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const i=new LoopbackPort;this._port=i;const _=`fake${PDFWorkerUtil.fakeWorkerId++}`,r=new _message_handler.MessageHandler(_+"_worker",_,i);y.setup(r,i);const p=new _message_handler.MessageHandler(_,_+"_worker",i);this._messageHandler=p,this._readyCapability.resolve(),p.send("configure",{verbosity:this.verbosity})}).catch(y=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${y.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),PDFWorker.#workerPorts?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(y){if(!y?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const i=this.#workerPorts?.get(y.port);if(i){if(i._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return i}return new PDFWorker(y)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}}exports$1.PDFWorker=PDFWorker;class WorkerTransport{#t=new Map;#e=new Map;#i=new Map;#s=null;constructor(i,_,r,p,C){this.messageHandler=i,this.loadingTask=_,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:p.ownerDocument,styleElement:p.styleElement}),this._params=p,this.canvasFactory=C.canvasFactory,this.filterFactory=C.filterFactory,this.cMapReaderFactory=C.cMapReaderFactory,this.standardFontDataFactory=C.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=r,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}#o(i,_=null){const r=this.#t.get(i);if(r)return r;const p=this.messageHandler.sendWithPromise(i,_);return this.#t.set(i,p),p}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(i,_=_util.AnnotationMode.ENABLE,r=null,p=!1){let C=_util.RenderingIntentFlag.DISPLAY,w=_annotation_storage.SerializableEmpty;switch(i){case"any":C=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":C=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${i}`)}switch(_){case _util.AnnotationMode.DISABLE:C+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:C+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:C+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,w=(C&_util.RenderingIntentFlag.PRINT&&r instanceof _annotation_storage.PrintAnnotationStorage?r:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${_}`)}return p&&(C+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:C,cacheKey:`${C}_${w.hash}`,annotationStorageSerializable:w}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,this.#s?.reject(new Error("Worker was destroyed during onPassword callback"));const i=[];for(const r of this.#e.values())i.push(r._destroy());this.#e.clear(),this.#i.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const _=this.messageHandler.sendWithPromise("Terminate",null);return i.push(_),Promise.all(i).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),this._networkStream?.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:i,loadingTask:_}=this;i.on("GetReader",(r,p)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=C=>{this._lastProgress={loaded:C.loaded,total:C.total}},p.onPull=()=>{this._fullReader.read().then(function({value:C,done:w}){if(w){p.close();return}(0,_util.assert)(C instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),p.enqueue(new Uint8Array(C),1,[C])}).catch(C=>{p.error(C)})},p.onCancel=C=>{this._fullReader.cancel(C),p.ready.catch(w=>{if(!this.destroyed)throw w})}}),i.on("ReaderHeadersReady",r=>{const p=new _util.PromiseCapability,C=this._fullReader;return C.headersReady.then(()=>{(!C.isStreamingSupported||!C.isRangeSupported)&&(this._lastProgress&&_.onProgress?.(this._lastProgress),C.onProgress=w=>{_.onProgress?.({loaded:w.loaded,total:w.total})}),p.resolve({isStreamingSupported:C.isStreamingSupported,isRangeSupported:C.isRangeSupported,contentLength:C.contentLength})},p.reject),p.promise}),i.on("GetRangeReader",(r,p)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const C=this._networkStream.getRangeReader(r.begin,r.end);if(!C){p.close();return}p.onPull=()=>{C.read().then(function({value:w,done:L}){if(L){p.close();return}(0,_util.assert)(w instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),p.enqueue(new Uint8Array(w),1,[w])}).catch(w=>{p.error(w)})},p.onCancel=w=>{C.cancel(w),p.ready.catch(L=>{if(!this.destroyed)throw L})}}),i.on("GetDoc",({pdfInfo:r})=>{this._numPages=r.numPages,this._htmlForXfa=r.htmlForXfa,delete r.htmlForXfa,_._capability.resolve(new PDFDocumentProxy(r,this))}),i.on("DocException",function(r){let p;switch(r.name){case"PasswordException":p=new _util.PasswordException(r.message,r.code);break;case"InvalidPDFException":p=new _util.InvalidPDFException(r.message);break;case"MissingPDFException":p=new _util.MissingPDFException(r.message);break;case"UnexpectedResponseException":p=new _util.UnexpectedResponseException(r.message,r.status);break;case"UnknownErrorException":p=new _util.UnknownErrorException(r.message,r.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}_._capability.reject(p)}),i.on("PasswordRequest",r=>{if(this.#s=new _util.PromiseCapability,_.onPassword){const p=C=>{C instanceof Error?this.#s.reject(C):this.#s.resolve({password:C})};try{_.onPassword(p,r.code)}catch(C){this.#s.reject(C)}}else this.#s.reject(new _util.PasswordException(r.message,r.code));return this.#s.promise}),i.on("DataLoaded",r=>{_.onProgress?.({loaded:r.length,total:r.length}),this.downloadInfoCapability.resolve(r)}),i.on("StartRenderPage",r=>{if(this.destroyed)return;this.#e.get(r.pageIndex)._startRenderPage(r.transparency,r.cacheKey)}),i.on("commonobj",([r,p,C])=>{if(!this.destroyed&&!this.commonObjs.has(r))switch(p){case"Font":const w=this._params;if("error"in C){const n=C.error;(0,_util.warn)(`Error during font loading: ${n}`),this.commonObjs.resolve(r,n);break}const L=w.pdfBug&&globalThis.FontInspector?.enabled?(n,t)=>globalThis.FontInspector.fontAdded(n,t):null,I=new _font_loader.FontFaceObject(C,{isEvalSupported:w.isEvalSupported,disableFontFace:w.disableFontFace,ignoreErrors:w.ignoreErrors,inspectFont:L});this.fontLoader.bind(I).catch(n=>i.sendWithPromise("FontFallback",{id:r})).finally(()=>{!w.fontExtraProperties&&I.data&&(I.data=null),this.commonObjs.resolve(r,I)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(r,C);break;default:throw new Error(`Got unknown common object type ${p}`)}}),i.on("obj",([r,p,C,w])=>{if(this.destroyed)return;const L=this.#e.get(p);if(!L.objs.has(r))switch(C){case"Image":if(L.objs.resolve(r,w),w){let I;if(w.bitmap){const{width:n,height:t}=w;I=n*t*4}else I=w.data?.length||0;I>_util.MAX_IMAGE_SIZE_TO_CACHE&&(L._maybeCleanupAfterRender=!0)}break;case"Pattern":L.objs.resolve(r,w);break;default:throw new Error(`Got unknown object type ${C}`)}}),i.on("DocProgress",r=>{this.destroyed||_.onProgress?.({loaded:r.loaded,total:r.total})}),i.on("FetchBuiltInCMap",r=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(r):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),i.on("FetchStandardFontData",r=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(r):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:i,transfers:_}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:i,filename:this._fullReader?.filename??null},_).finally(()=>{this.annotationStorage.resetModified()})}getPage(i){if(!Number.isInteger(i)||i<=0||i>this._numPages)return Promise.reject(new Error("Invalid page request."));const _=i-1,r=this.#i.get(_);if(r)return r;const p=this.messageHandler.sendWithPromise("GetPage",{pageIndex:_}).then(C=>{if(this.destroyed)throw new Error("Transport destroyed");const w=new PDFPageProxy(_,C,this,this._params.pdfBug);return this.#e.set(_,w),w});return this.#i.set(_,p),p}getPageIndex(i){return typeof i!="object"||i===null||!Number.isInteger(i.num)||i.num<0||!Number.isInteger(i.gen)||i.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:i.num,gen:i.gen})}getAnnotations(i,_){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:i,intent:_})}getFieldObjects(){return this.#o("GetFieldObjects")}hasJSActions(){return this.#o("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(i){return typeof i!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:i})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#o("GetDocJSActions")}getPageJSActions(i){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:i})}getStructTree(i){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:i})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(i=>new _optional_content_config.OptionalContentConfig(i))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const i="GetMetadata",_=this.#t.get(i);if(_)return _;const r=this.messageHandler.sendWithPromise(i,null).then(p=>({info:p[0],metadata:p[1]?new _metadata.Metadata(p[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(i,r),r}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(i=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const _ of this.#e.values())if(!_.cleanup())throw new Error(`startCleanup: Page ${_.pageNumber} is currently rendering.`);this.commonObjs.clear(),i||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:i,enableXfa:_}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:i,enableXfa:_})}}class PDFObjects{#t=Object.create(null);#e(i){return this.#t[i]||={capability:new _util.PromiseCapability,data:null}}get(i,_=null){if(_){const p=this.#e(i);return p.capability.promise.then(()=>_(p.data)),null}const r=this.#t[i];if(!r?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${i}.`);return r.data}has(i){return this.#t[i]?.capability.settled||!1}resolve(i,_=null){const r=this.#e(i);r.data=_,r.capability.resolve()}clear(){for(const i in this.#t){const{data:_}=this.#t[i];_?.bitmap?.close()}this.#t=Object.create(null)}}class RenderTask{#t=null;constructor(i){this.#t=i,this.onContinue=null}get promise(){return this.#t.capability.promise}cancel(i=0){this.#t.cancel(null,i)}get separateAnnots(){const{separateAnnots:i}=this.#t.operatorList;if(!i)return!1;const{annotationCanvasMap:_}=this.#t;return i.form||i.canvas&&_?.size>0}}exports$1.RenderTask=RenderTask;class InternalRenderTask{static#t=new WeakSet;constructor({callback:i,params:_,objs:r,commonObjs:p,annotationCanvasMap:C,operatorList:w,pageIndex:L,canvasFactory:I,filterFactory:n,useRequestAnimationFrame:t=!1,pdfBug:s=!1,pageColors:h=null}){this.callback=i,this.params=_,this.objs=r,this.commonObjs=p,this.annotationCanvasMap=C,this.operatorListIdx=null,this.operatorList=w,this._pageIndex=L,this.canvasFactory=I,this.filterFactory=n,this._pdfBug=s,this.pageColors=h,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=t===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=_.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:i=!1,optionalContentConfig:_}){if(this.cancelled)return;if(this._canvas){if(InternalRenderTask.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");InternalRenderTask.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:r,viewport:p,transform:C,background:w}=this.params;this.gfx=new _canvas.CanvasGraphics(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:_},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:C,viewport:p,transparency:i,background:w}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(i=null,_=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),InternalRenderTask.#t.delete(this._canvas),this.callback(i||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,_))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),InternalRenderTask.#t.delete(this._canvas),this.callback())))}}const version="3.11.174";exports$1.version=version;const build="ce8716743";exports$1.build=build}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.SerializableEmpty=i.PrintAnnotationStorage=i.AnnotationStorage=void 0;var r=_(1),p=_(4),C=_(8);const w=Object.freeze({map:null,hash:"",transfers:void 0});i.SerializableEmpty=w;class L{#t=!1;#e=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,s){const h=this.#e.get(t);return h===void 0?s:Object.assign(s,h)}getRawValue(t){return this.#e.get(t)}remove(t){if(this.#e.delete(t),this.#e.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const s of this.#e.values())if(s instanceof p.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(t,s){const h=this.#e.get(t);let c=!1;if(h!==void 0)for(const[e,d]of Object.entries(s))h[e]!==d&&(c=!0,h[e]=d);else c=!0,this.#e.set(t,s);c&&this.#i(),s instanceof p.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(s.constructor._type)}has(t){return this.#e.has(t)}getAll(){return this.#e.size>0?(0,r.objectFromMap)(this.#e):null}setAll(t){for(const[s,h]of Object.entries(t))this.setValue(s,h)}get size(){return this.#e.size}#i(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new I(this)}get serializable(){if(this.#e.size===0)return w;const t=new Map,s=new C.MurmurHash3_64,h=[],c=Object.create(null);let e=!1;for(const[d,g]of this.#e){const o=g instanceof p.AnnotationEditor?g.serialize(!1,c):g;o&&(t.set(d,o),s.update(`${d}:${JSON.stringify(o)}`),e||=!!o.bitmap)}if(e)for(const d of t.values())d.bitmap&&h.push(d.bitmap);return t.size>0?{map:t,hash:s.hexdigest(),transfers:h}:w}}i.AnnotationStorage=L;class I extends L{#t;constructor(t){super();const{map:s,hash:h,transfers:c}=t.serializable,e=structuredClone(s,c?{transfer:c}:null);this.#t={map:e,hash:h,transfers:c}}get print(){(0,r.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}}i.PrintAnnotationStorage=I}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.AnnotationEditor=void 0;var r=_(5),p=_(1),C=_(6);class w{#t="";#e=!1;#i=null;#s=null;#o=null;#a=!1;#r=null;#l=this.focusin.bind(this);#c=this.focusout.bind(this);#n=!1;#f=!1;#d=!1;_initialOptions=Object.create(null);_uiManager=null;_focusEventsAllowed=!0;_l10nPromise=null;#u=!1;#p=w._zIndex++;static _borderLineWidth=-1;static _colorManager=new r.ColorManager;static _zIndex=1;static SMALL_EDITOR_SIZE=0;constructor(n){this.constructor===w&&(0,p.unreachable)("Cannot initialize AnnotationEditor."),this.parent=n.parent,this.id=n.id,this.width=this.height=null,this.pageIndex=n.parent.pageIndex,this.name=n.name,this.div=null,this._uiManager=n.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=n.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:s,pageHeight:h,pageX:c,pageY:e}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,h],this.pageTranslation=[c,e];const[d,g]=this.parentDimensions;this.x=n.x/d,this.y=n.y/g,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,p.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(n){const t=new L({id:n.parent.getNextId(),parent:n.parent,uiManager:n._uiManager});t.annotationElementId=n.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(n,t=null){if(w._l10nPromise||=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(h=>[h,n.get(h)])),t?.strings)for(const h of t.strings)w._l10nPromise.set(h,n.get(h));if(w._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);w._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(n,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(n){return!1}static paste(n,t){(0,p.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#u}set _isDraggable(n){this.#u=n,this.div?.classList.toggle("draggable",n)}center(){const[n,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(n*2),this.y+=this.width*n/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(n*2),this.y-=this.width*n/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(n){this._uiManager.addCommands(n)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#p}setParent(n){n!==null&&(this.pageIndex=n.pageIndex,this.pageDimensions=n.pageDimensions),this.parent=n}focusin(n){this._focusEventsAllowed&&(this.#n?this.#n=!1:this.parent.setSelected(this))}focusout(n){!this._focusEventsAllowed||!this.isAttachedToDOM||n.relatedTarget?.closest(`#${this.id}`)||(n.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(n,t,s,h){const[c,e]=this.parentDimensions;[s,h]=this.screenToPageTranslation(s,h),this.x=(n+s)/c,this.y=(t+h)/e,this.fixAndSetPosition()}#b([n,t],s,h){[s,h]=this.screenToPageTranslation(s,h),this.x+=s/n,this.y+=h/t,this.fixAndSetPosition()}translate(n,t){this.#b(this.parentDimensions,n,t)}translateInPage(n,t){this.#b(this.pageDimensions,n,t),this.div.scrollIntoView({block:"nearest"})}drag(n,t){const[s,h]=this.parentDimensions;if(this.x+=n/s,this.y+=t/h,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:o,y:v}=this.div.getBoundingClientRect();this.parent.findNewParent(this,o,v)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:c,y:e}=this;const[d,g]=this.#m();c+=d,e+=g,this.div.style.left=`${(100*c).toFixed(2)}%`,this.div.style.top=`${(100*e).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}#m(){const[n,t]=this.parentDimensions,{_borderLineWidth:s}=w,h=s/n,c=s/t;switch(this.rotation){case 90:return[-h,c];case 180:return[h,c];case 270:return[h,-c];default:return[-h,-c]}}fixAndSetPosition(){const[n,t]=this.pageDimensions;let{x:s,y:h,width:c,height:e}=this;switch(c*=n,e*=t,s*=n,h*=t,this.rotation){case 0:s=Math.max(0,Math.min(n-c,s)),h=Math.max(0,Math.min(t-e,h));break;case 90:s=Math.max(0,Math.min(n-e,s)),h=Math.min(t,Math.max(c,h));break;case 180:s=Math.min(n,Math.max(c,s)),h=Math.min(t,Math.max(e,h));break;case 270:s=Math.min(n,Math.max(e,s)),h=Math.max(0,Math.min(t-c,h));break}this.x=s/=n,this.y=h/=t;const[d,g]=this.#m();s+=d,h+=g;const{style:o}=this.div;o.left=`${(100*s).toFixed(2)}%`,o.top=`${(100*h).toFixed(2)}%`,this.moveInDOM()}static#g(n,t,s){switch(s){case 90:return[t,-n];case 180:return[-n,-t];case 270:return[-t,n];default:return[n,t]}}screenToPageTranslation(n,t){return w.#g(n,t,this.parentRotation)}pageTranslationToScreen(n,t){return w.#g(n,t,360-this.parentRotation)}#h(n){switch(n){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:n,pageDimensions:[t,s]}=this,h=t*n,c=s*n;return p.FeatureTest.isCSSRoundSupported?[Math.round(h),Math.round(c)]:[h,c]}setDims(n,t){const[s,h]=this.parentDimensions;this.div.style.width=`${(100*n/s).toFixed(2)}%`,this.#a||(this.div.style.height=`${(100*t/h).toFixed(2)}%`),this.#i?.classList.toggle("small",n<w.SMALL_EDITOR_SIZE||t<w.SMALL_EDITOR_SIZE)}fixDims(){const{style:n}=this.div,{height:t,width:s}=n,h=s.endsWith("%"),c=!this.#a&&t.endsWith("%");if(h&&c)return;const[e,d]=this.parentDimensions;h||(n.width=`${(100*parseFloat(s)/e).toFixed(2)}%`),!this.#a&&!c&&(n.height=`${(100*parseFloat(t)/d).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#_(){if(this.#r)return;this.#r=document.createElement("div"),this.#r.classList.add("resizers");const n=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||n.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const t of n){const s=document.createElement("div");this.#r.append(s),s.classList.add("resizer",t),s.addEventListener("pointerdown",this.#x.bind(this,t)),s.addEventListener("contextmenu",C.noContextMenu)}this.div.prepend(this.#r)}#x(n,t){t.preventDefault();const{isMac:s}=p.FeatureTest.platform;if(t.button!==0||t.ctrlKey&&s)return;const h=this.#S.bind(this,n),c=this._isDraggable;this._isDraggable=!1;const e={passive:!0,capture:!0};window.addEventListener("pointermove",h,e);const d=this.x,g=this.y,o=this.width,v=this.height,k=this.parent.div.style.cursor,E=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const f=()=>{this._isDraggable=c,window.removeEventListener("pointerup",f),window.removeEventListener("blur",f),window.removeEventListener("pointermove",h,e),this.parent.div.style.cursor=k,this.div.style.cursor=E;const x=this.x,j=this.y,B=this.width,N=this.height;x===d&&j===g&&B===o&&N===v||this.addCommands({cmd:()=>{this.width=B,this.height=N,this.x=x,this.y=j;const[z,H]=this.parentDimensions;this.setDims(z*B,H*N),this.fixAndSetPosition()},undo:()=>{this.width=o,this.height=v,this.x=d,this.y=g;const[z,H]=this.parentDimensions;this.setDims(z*o,H*v),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",f),window.addEventListener("blur",f)}#S(n,t){const[s,h]=this.parentDimensions,c=this.x,e=this.y,d=this.width,g=this.height,o=w.MIN_SIZE/s,v=w.MIN_SIZE/h,k=T=>Math.round(T*1e4)/1e4,E=this.#h(this.rotation),f=(T,a)=>[E[0]*T+E[2]*a,E[1]*T+E[3]*a],x=this.#h(360-this.rotation),j=(T,a)=>[x[0]*T+x[2]*a,x[1]*T+x[3]*a];let B,N,z=!1,H=!1;switch(n){case"topLeft":z=!0,B=(T,a)=>[0,0],N=(T,a)=>[T,a];break;case"topMiddle":B=(T,a)=>[T/2,0],N=(T,a)=>[T/2,a];break;case"topRight":z=!0,B=(T,a)=>[T,0],N=(T,a)=>[0,a];break;case"middleRight":H=!0,B=(T,a)=>[T,a/2],N=(T,a)=>[0,a/2];break;case"bottomRight":z=!0,B=(T,a)=>[T,a],N=(T,a)=>[0,0];break;case"bottomMiddle":B=(T,a)=>[T/2,a],N=(T,a)=>[T/2,0];break;case"bottomLeft":z=!0,B=(T,a)=>[0,a],N=(T,a)=>[T,0];break;case"middleLeft":H=!0,B=(T,a)=>[0,a/2],N=(T,a)=>[T,a/2];break}const it=B(d,g),Z=N(d,g);let Q=f(...Z);const st=k(c+Q[0]),K=k(e+Q[1]);let D=1,m=1,[l,u]=this.screenToPageTranslation(t.movementX,t.movementY);if([l,u]=j(l/s,u/h),z){const T=Math.hypot(d,g);D=m=Math.max(Math.min(Math.hypot(Z[0]-it[0]-l,Z[1]-it[1]-u)/T,1/d,1/g),o/d,v/g)}else H?D=Math.max(o,Math.min(1,Math.abs(Z[0]-it[0]-l)))/d:m=Math.max(v,Math.min(1,Math.abs(Z[1]-it[1]-u)))/g;const A=k(d*D),R=k(g*m);Q=f(...N(A,R));const M=st-Q[0],O=K-Q[1];this.width=A,this.height=R,this.x=M,this.y=O,this.setDims(s*A,h*R),this.fixAndSetPosition()}async addAltTextButton(){if(this.#i)return;const n=this.#i=document.createElement("button");n.className="altText";const t=await w._l10nPromise.get("editor_alt_text_button_label");n.textContent=t,n.setAttribute("aria-label",t),n.tabIndex="0",n.addEventListener("contextmenu",C.noContextMenu),n.addEventListener("pointerdown",s=>s.stopPropagation()),n.addEventListener("click",s=>{s.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),n.addEventListener("keydown",s=>{s.target===n&&s.key==="Enter"&&(s.preventDefault(),this._uiManager.editAltText(this))}),this.#C(),this.div.append(n),w.SMALL_EDITOR_SIZE||(w.SMALL_EDITOR_SIZE=Math.min(128,Math.round(n.getBoundingClientRect().width*1.4)))}async#C(){const n=this.#i;if(!n)return;if(!this.#t&&!this.#e){n.classList.remove("done"),this.#s?.remove();return}w._l10nPromise.get("editor_alt_text_edit_button_label").then(s=>{n.setAttribute("aria-label",s)});let t=this.#s;if(!t){this.#s=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip");const s=t.id=`alt-text-tooltip-${this.id}`;n.setAttribute("aria-describedby",s);const h=100;n.addEventListener("mouseenter",()=>{this.#o=setTimeout(()=>{this.#o=null,this.#s.classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},h)}),n.addEventListener("mouseleave",()=>{clearTimeout(this.#o),this.#o=null,this.#s?.classList.remove("show")})}n.classList.add("done"),t.innerText=this.#e?await w._l10nPromise.get("editor_alt_text_decorative_tooltip"):this.#t,t.parentNode||n.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:this.#t,decorative:this.#e}}set altTextData({altText:n,decorative:t}){this.#t===n&&this.#e===t||(this.#t=n,this.#e=t,this.#C())}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",this.#l),this.div.addEventListener("focusout",this.#c);const[n,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/n).toFixed(2)}%`,this.div.style.maxHeight=`${(100*n/t).toFixed(2)}%`);const[s,h]=this.getInitialTranslation();return this.translate(s,h),(0,r.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(n){const{isMac:t}=p.FeatureTest.platform;if(n.button!==0||n.ctrlKey&&t){n.preventDefault();return}this.#n=!0,this.#P(n)}#P(n){if(!this._isDraggable)return;const t=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let s,h;t&&(s={passive:!0,capture:!0},h=e=>{const[d,g]=this.screenToPageTranslation(e.movementX,e.movementY);this._uiManager.dragSelectedEditors(d,g)},window.addEventListener("pointermove",h,s));const c=()=>{if(window.removeEventListener("pointerup",c),window.removeEventListener("blur",c),t&&window.removeEventListener("pointermove",h,s),this.#n=!1,!this._uiManager.endDragSession()){const{isMac:e}=p.FeatureTest.platform;n.ctrlKey&&!e||n.shiftKey||n.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",c),window.addEventListener("blur",c)}moveInDOM(){this.parent?.moveEditorInDOM(this)}_setParentAndPosition(n,t,s){n.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition()}getRect(n,t){const s=this.parentScale,[h,c]=this.pageDimensions,[e,d]=this.pageTranslation,g=n/s,o=t/s,v=this.x*h,k=this.y*c,E=this.width*h,f=this.height*c;switch(this.rotation){case 0:return[v+g+e,c-k-o-f+d,v+g+E+e,c-k-o+d];case 90:return[v+o+e,c-k+g+d,v+o+f+e,c-k+g+E+d];case 180:return[v-g-E+e,c-k+o+d,v-g+e,c-k+o+f+d];case 270:return[v-o-f+e,c-k-g-E+d,v-o+e,c-k-g+d];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(n,t){const[s,h,c,e]=n,d=c-s,g=e-h;switch(this.rotation){case 0:return[s,t-e,d,g];case 90:return[s,t-h,g,d];case 180:return[c,t-h,d,g];case 270:return[c,t-e,g,d];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#d=!0}disableEditMode(){this.#d=!1}isInEditMode(){return this.#d}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#l),this.div?.addEventListener("focusout",this.#c)}serialize(n=!1,t=null){(0,p.unreachable)("An editor must be serializable")}static deserialize(n,t,s){const h=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s});h.rotation=n.rotation;const[c,e]=h.pageDimensions,[d,g,o,v]=h.getRectInCurrentCoords(n.rect,e);return h.x=d/c,h.y=g/e,h.width=o/c,h.height=v/e,h}remove(){this.div.removeEventListener("focusin",this.#l),this.div.removeEventListener("focusout",this.#c),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#i?.remove(),this.#i=null,this.#s=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#_(),this.#r.classList.remove("hidden"))}select(){this.makeResizable(),this.div?.classList.add("selectedEditor")}unselect(){this.#r?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(n,t){}disableEditing(){this.#i&&(this.#i.hidden=!0)}enableEditing(){this.#i&&(this.#i.hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return this.#f}set isEditing(n){this.#f=n,this.parent&&(n?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(n,t){this.#a=!0;const s=n/t,{style:h}=this.div;h.aspectRatio=s,h.height="auto"}static get MIN_SIZE(){return 16}}i.AnnotationEditor=w;class L extends w{constructor(n){super(n),this.annotationElementId=n.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.KeyboardManager=i.CommandManager=i.ColorManager=i.AnnotationEditorUIManager=void 0,i.bindEvents=C,i.opacityToHex=w;var r=_(1),p=_(6);function C(c,e,d){for(const g of d)e.addEventListener(g,c[g].bind(c))}function w(c){return Math.round(Math.min(255,Math.max(1,255*c))).toString(16).padStart(2,"0")}class L{#t=0;getId(){return`${r.AnnotationEditorPrefix}${this.#t++}`}}class I{#t=(0,r.getUuid)();#e=0;#i=null;static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',g=new OffscreenCanvas(1,3).getContext("2d"),o=new Image;o.src=e;const v=o.decode().then(()=>(g.drawImage(o,0,0,1,1,0,0,1,3),new Uint32Array(g.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,r.shadow)(this,"_isSVGFittingCanvas",v)}async#s(e,d){this.#i||=new Map;let g=this.#i.get(e);if(g===null)return null;if(g?.bitmap)return g.refCounter+=1,g;try{g||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let o;if(typeof d=="string"){g.url=d;const v=await fetch(d);if(!v.ok)throw new Error(v.statusText);o=await v.blob()}else o=g.file=d;if(o.type==="image/svg+xml"){const v=I._isSVGFittingCanvas,k=new FileReader,E=new Image,f=new Promise((x,j)=>{E.onload=()=>{g.bitmap=E,g.isSvg=!0,x()},k.onload=async()=>{const B=g.svgUrl=k.result;E.src=await v?`${B}#svgView(preserveAspectRatio(none))`:B},E.onerror=k.onerror=j});k.readAsDataURL(o),await f}else g.bitmap=await createImageBitmap(o);g.refCounter=1}catch(o){console.error(o),g=null}return this.#i.set(e,g),g&&this.#i.set(g.id,g),g}async getFromFile(e){const{lastModified:d,name:g,size:o,type:v}=e;return this.#s(`${d}_${g}_${o}_${v}`,e)}async getFromUrl(e){return this.#s(e,e)}async getFromId(e){this.#i||=new Map;const d=this.#i.get(e);return d?d.bitmap?(d.refCounter+=1,d):d.file?this.getFromFile(d.file):this.getFromUrl(d.url):null}getSvgUrl(e){const d=this.#i.get(e);return d?.isSvg?d.svgUrl:null}deleteId(e){this.#i||=new Map;const d=this.#i.get(e);d&&(d.refCounter-=1,d.refCounter===0&&(d.bitmap=null))}isValidId(e){return e.startsWith(`image_${this.#t}_`)}}class n{#t=[];#e=!1;#i;#s=-1;constructor(e=128){this.#i=e}add({cmd:e,undo:d,mustExec:g,type:o=NaN,overwriteIfSameType:v=!1,keepUndo:k=!1}){if(g&&e(),this.#e)return;const E={cmd:e,undo:d,type:o};if(this.#s===-1){this.#t.length>0&&(this.#t.length=0),this.#s=0,this.#t.push(E);return}if(v&&this.#t[this.#s].type===o){k&&(E.undo=this.#t[this.#s].undo),this.#t[this.#s]=E;return}const f=this.#s+1;f===this.#i?this.#t.splice(0,1):(this.#s=f,f<this.#t.length&&this.#t.splice(f)),this.#t.push(E)}undo(){this.#s!==-1&&(this.#e=!0,this.#t[this.#s].undo(),this.#e=!1,this.#s-=1)}redo(){this.#s<this.#t.length-1&&(this.#s+=1,this.#e=!0,this.#t[this.#s].cmd(),this.#e=!1)}hasSomethingToUndo(){return this.#s!==-1}hasSomethingToRedo(){return this.#s<this.#t.length-1}destroy(){this.#t=null}}i.CommandManager=n;class t{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:d}=r.FeatureTest.platform;for(const[g,o,v={}]of e)for(const k of g){const E=k.startsWith("mac+");d&&E?(this.callbacks.set(k.slice(4),{callback:o,options:v}),this.allKeys.add(k.split("+").at(-1))):!d&&!E&&(this.callbacks.set(k,{callback:o,options:v}),this.allKeys.add(k.split("+").at(-1)))}}#t(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const d=this.buffer.join("+");return this.buffer.length=0,d}exec(e,d){if(!this.allKeys.has(d.key))return;const g=this.callbacks.get(this.#t(d));if(!g)return;const{callback:o,options:{bubbles:v=!1,args:k=[],checker:E=null}}=g;E&&!E(e,d)||(o.bind(e,...k)(),v||(d.stopPropagation(),d.preventDefault()))}}i.KeyboardManager=t;class s{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return(0,p.getColorValues)(e),(0,r.shadow)(this,"_colors",e)}convert(e){const d=(0,p.getRGB)(e);if(!window.matchMedia("(forced-colors: active)").matches)return d;for(const[g,o]of this._colors)if(o.every((v,k)=>v===d[k]))return s._colorsMapping.get(g);return d}getHexCode(e){const d=this._colors.get(e);return d?r.Util.makeHexColor(...d):e}}i.ColorManager=s;class h{#t=null;#e=new Map;#i=new Map;#s=null;#o=null;#a=new n;#r=0;#l=new Set;#c=null;#n=null;#f=new Set;#d=null;#u=new L;#p=!1;#b=!1;#m=null;#g=r.AnnotationEditorType.NONE;#h=new Set;#_=null;#x=this.blur.bind(this);#S=this.focus.bind(this);#C=this.copy.bind(this);#P=this.cut.bind(this);#D=this.paste.bind(this);#L=this.keydown.bind(this);#O=this.onEditingAction.bind(this);#A=this.onPageChanging.bind(this);#I=this.onScaleChanging.bind(this);#k=this.onRotationChanging.bind(this);#R={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1};#y=[0,0];#T=null;#E=null;#N=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=h.prototype,d=v=>{const{activeElement:k}=document;return k&&v.#E.contains(k)&&v.hasSomethingToControl()},g=this.TRANSLATE_SMALL,o=this.TRANSLATE_BIG;return(0,r.shadow)(this,"_keyboardManager",new t([[["ctrl+a","mac+meta+a"],e.selectAll],[["ctrl+z","mac+meta+z"],e.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-g,0],checker:d}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-o,0],checker:d}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[g,0],checker:d}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[o,0],checker:d}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-g],checker:d}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-o],checker:d}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,g],checker:d}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,o],checker:d}]]))}constructor(e,d,g,o,v,k){this.#E=e,this.#N=d,this.#s=g,this._eventBus=o,this._eventBus._on("editingaction",this.#O),this._eventBus._on("pagechanging",this.#A),this._eventBus._on("scalechanging",this.#I),this._eventBus._on("rotationchanging",this.#k),this.#o=v.annotationStorage,this.#d=v.filterFactory,this.#_=k,this.viewParameters={realScale:p.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}destroy(){this.#F(),this.#U(),this._eventBus._off("editingaction",this.#O),this._eventBus._off("pagechanging",this.#A),this._eventBus._off("scalechanging",this.#I),this._eventBus._off("rotationchanging",this.#k);for(const e of this.#i.values())e.destroy();this.#i.clear(),this.#e.clear(),this.#f.clear(),this.#t=null,this.#h.clear(),this.#a.destroy(),this.#s.destroy()}get hcmFilter(){return(0,r.shadow)(this,"hcmFilter",this.#_?this.#d.addHCMFilter(this.#_.foreground,this.#_.background):"none")}get direction(){return(0,r.shadow)(this,"direction",getComputedStyle(this.#E).direction)}editAltText(e){this.#s?.editAltText(this,e)}onPageChanging({pageNumber:e}){this.#r=e-1}focusMainContainer(){this.#E.focus()}findParent(e,d){for(const g of this.#i.values()){const{x:o,y:v,width:k,height:E}=g.div.getBoundingClientRect();if(e>=o&&e<=o+k&&d>=v&&d<=v+E)return g}return null}disableUserSelect(e=!1){this.#N.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#f.add(e)}removeShouldRescale(e){this.#f.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*p.PixelsPerInch.PDF_TO_CSS_UNITS;for(const d of this.#f)d.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}addToAnnotationStorage(e){!e.isEmpty()&&this.#o&&!this.#o.has(e.id)&&this.#o.setValue(e.id,e)}#j(){window.addEventListener("focus",this.#S),window.addEventListener("blur",this.#x)}#U(){window.removeEventListener("focus",this.#S),window.removeEventListener("blur",this.#x)}blur(){if(!this.hasSelection)return;const{activeElement:e}=document;for(const d of this.#h)if(d.div.contains(e)){this.#m=[d,e],d._focusEventsAllowed=!1;break}}focus(){if(!this.#m)return;const[e,d]=this.#m;this.#m=null,d.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0}),d.focus()}#B(){window.addEventListener("keydown",this.#L,{capture:!0})}#F(){window.removeEventListener("keydown",this.#L,{capture:!0})}#M(){document.addEventListener("copy",this.#C),document.addEventListener("cut",this.#P),document.addEventListener("paste",this.#D)}#w(){document.removeEventListener("copy",this.#C),document.removeEventListener("cut",this.#P),document.removeEventListener("paste",this.#D)}addEditListeners(){this.#B(),this.#M()}removeEditListeners(){this.#F(),this.#w()}copy(e){if(e.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const d=[];for(const g of this.#h){const o=g.serialize(!0);o&&d.push(o)}d.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(d))}cut(e){this.copy(e),this.delete()}paste(e){e.preventDefault();const{clipboardData:d}=e;for(const v of d.items)for(const k of this.#n)if(k.isHandlingMimeForPasting(v.type)){k.paste(v,this.currentLayer);return}let g=d.getData("application/pdfjs");if(!g)return;try{g=JSON.parse(g)}catch(v){(0,r.warn)(`paste: "${v.message}".`);return}if(!Array.isArray(g))return;this.unselectAll();const o=this.currentLayer;try{const v=[];for(const f of g){const x=o.deserialize(f);if(!x)return;v.push(x)}const k=()=>{for(const f of v)this.#z(f);this.#G(v)},E=()=>{for(const f of v)f.remove()};this.addCommands({cmd:k,undo:E,mustExec:!0})}catch(v){(0,r.warn)(`paste: "${v.message}".`)}}keydown(e){this.getActive()?.shouldGetKeyboardEvents()||h._keyboardManager.exec(this,e)}onEditingAction(e){["undo","redo","delete","selectAll"].includes(e.name)&&this[e.name]()}#v(e){Object.entries(e).some(([g,o])=>this.#R[g]!==o)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#R,e)})}#W(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#j(),this.#B(),this.#M(),this.#v({isEditing:this.#g!==r.AnnotationEditorType.NONE,isEmpty:this.#H(),hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:this.#a.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#U(),this.#F(),this.#w(),this.#v({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#n){this.#n=e;for(const d of this.#n)this.#W(d.defaultPropertiesToUpdate)}}getId(){return this.#u.getId()}get currentLayer(){return this.#i.get(this.#r)}getLayer(e){return this.#i.get(e)}get currentPageIndex(){return this.#r}addLayer(e){this.#i.set(e.pageIndex,e),this.#p?e.enable():e.disable()}removeLayer(e){this.#i.delete(e.pageIndex)}updateMode(e,d=null){if(this.#g!==e){if(this.#g=e,e===r.AnnotationEditorType.NONE){this.setEditingState(!1),this.#X();return}this.setEditingState(!0),this.#V(),this.unselectAll();for(const g of this.#i.values())g.updateMode(e);if(d){for(const g of this.#e.values())if(g.annotationElementId===d){this.setSelected(g),g.enterInEditMode();break}}}}updateToolbar(e){e!==this.#g&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,d){if(this.#n){if(e===r.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(e);return}for(const g of this.#h)g.updateParams(e,d);for(const g of this.#n)g.updateDefaultParams(e,d)}}enableWaiting(e=!1){if(this.#b!==e){this.#b=e;for(const d of this.#i.values())e?d.disableClick():d.enableClick(),d.div.classList.toggle("waiting",e)}}#V(){if(!this.#p){this.#p=!0;for(const e of this.#i.values())e.enable()}}#X(){if(this.unselectAll(),this.#p){this.#p=!1;for(const e of this.#i.values())e.disable()}}getEditors(e){const d=[];for(const g of this.#e.values())g.pageIndex===e&&d.push(g);return d}getEditor(e){return this.#e.get(e)}addEditor(e){this.#e.set(e.id,e)}removeEditor(e){this.#e.delete(e.id),this.unselect(e),(!e.annotationElementId||!this.#l.has(e.annotationElementId))&&this.#o?.remove(e.id)}addDeletedAnnotationElement(e){this.#l.add(e.annotationElementId),e.deleted=!0}isDeletedAnnotationElement(e){return this.#l.has(e)}removeDeletedAnnotationElement(e){this.#l.delete(e.annotationElementId),e.deleted=!1}#z(e){const d=this.#i.get(e.pageIndex);d?d.addOrRebuild(e):this.addEditor(e)}setActiveEditor(e){this.#t!==e&&(this.#t=e,e&&this.#W(e.propertiesToUpdate))}toggleSelected(e){if(this.#h.has(e)){this.#h.delete(e),e.unselect(),this.#v({hasSelectedEditor:this.hasSelection});return}this.#h.add(e),e.select(),this.#W(e.propertiesToUpdate),this.#v({hasSelectedEditor:!0})}setSelected(e){for(const d of this.#h)d!==e&&d.unselect();this.#h.clear(),this.#h.add(e),e.select(),this.#W(e.propertiesToUpdate),this.#v({hasSelectedEditor:!0})}isSelected(e){return this.#h.has(e)}unselect(e){e.unselect(),this.#h.delete(e),this.#v({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#h.size!==0}undo(){this.#a.undo(),this.#v({hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#H()})}redo(){this.#a.redo(),this.#v({hasSomethingToUndo:!0,hasSomethingToRedo:this.#a.hasSomethingToRedo(),isEmpty:this.#H()})}addCommands(e){this.#a.add(e),this.#v({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#H()})}#H(){if(this.#e.size===0)return!0;if(this.#e.size===1)for(const e of this.#e.values())return e.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const e=[...this.#h],d=()=>{for(const o of e)o.remove()},g=()=>{for(const o of e)this.#z(o)};this.addCommands({cmd:d,undo:g,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#G(e){this.#h.clear();for(const d of e)d.isEmpty()||(this.#h.add(d),d.select());this.#v({hasSelectedEditor:!0})}selectAll(){for(const e of this.#h)e.commit();this.#G(this.#e.values())}unselectAll(){if(this.#t){this.#t.commitOrRemove();return}if(this.hasSelection){for(const e of this.#h)e.unselect();this.#h.clear(),this.#v({hasSelectedEditor:!1})}}translateSelectedEditors(e,d,g=!1){if(g||this.commitOrRemove(),!this.hasSelection)return;this.#y[0]+=e,this.#y[1]+=d;const[o,v]=this.#y,k=[...this.#h],E=1e3;this.#T&&clearTimeout(this.#T),this.#T=setTimeout(()=>{this.#T=null,this.#y[0]=this.#y[1]=0,this.addCommands({cmd:()=>{for(const f of k)this.#e.has(f.id)&&f.translateInPage(o,v)},undo:()=>{for(const f of k)this.#e.has(f.id)&&f.translateInPage(-o,-v)},mustExec:!1})},E);for(const f of k)f.translateInPage(e,d)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#c=new Map;for(const e of this.#h)this.#c.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#c)return!1;this.disableUserSelect(!1);const e=this.#c;this.#c=null;let d=!1;for(const[{x:o,y:v,pageIndex:k},E]of e)E.newX=o,E.newY=v,E.newPageIndex=k,d||=o!==E.savedX||v!==E.savedY||k!==E.savedPageIndex;if(!d)return!1;const g=(o,v,k,E)=>{if(this.#e.has(o.id)){const f=this.#i.get(E);f?o._setParentAndPosition(f,v,k):(o.pageIndex=E,o.x=v,o.y=k)}};return this.addCommands({cmd:()=>{for(const[o,{newX:v,newY:k,newPageIndex:E}]of e)g(o,v,k,E)},undo:()=>{for(const[o,{savedX:v,savedY:k,savedPageIndex:E}]of e)g(o,v,k,E)},mustExec:!0}),!0}dragSelectedEditors(e,d){if(this.#c)for(const g of this.#c.keys())g.drag(e,d)}rebuild(e){if(e.parent===null){const d=this.getLayer(e.pageIndex);d?(d.changeParent(e),d.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}isActive(e){return this.#t===e}getActive(){return this.#t}getMode(){return this.#g}get imageManager(){return(0,r.shadow)(this,"imageManager",new I)}}i.AnnotationEditorUIManager=h}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.StatTimer=i.RenderingCancelledException=i.PixelsPerInch=i.PageViewport=i.PDFDateString=i.DOMStandardFontDataFactory=i.DOMSVGFactory=i.DOMFilterFactory=i.DOMCanvasFactory=i.DOMCMapReaderFactory=void 0,i.deprecated=j,i.getColorValues=it,i.getCurrentTransform=Z,i.getCurrentTransformInverse=Q,i.getFilenameFromUrl=o,i.getPdfFilenameFromUrl=v,i.getRGB=H,i.getXfaPageViewport=z,i.isDataScheme=d,i.isPdfFile=g,i.isValidFetchUrl=E,i.loadScript=x,i.noContextMenu=f,i.setLayerDimensions=st;var r=_(7),p=_(1);const C="http://www.w3.org/2000/svg";class w{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}i.PixelsPerInch=w;class L extends r.BaseFilterFactory{#t;#e;#i;#s;#o;#a;#r;#l;#c;#n;#f=0;constructor({docId:D,ownerDocument:m=globalThis.document}={}){super(),this.#i=D,this.#s=m}get#d(){return this.#t||=new Map}get#u(){if(!this.#e){const D=this.#s.createElement("div"),{style:m}=D;m.visibility="hidden",m.contain="strict",m.width=m.height=0,m.position="absolute",m.top=m.left=0,m.zIndex=-1;const l=this.#s.createElementNS(C,"svg");l.setAttribute("width",0),l.setAttribute("height",0),this.#e=this.#s.createElementNS(C,"defs"),D.append(l),l.append(this.#e),this.#s.body.append(D)}return this.#e}addFilter(D){if(!D)return"none";let m=this.#d.get(D);if(m)return m;let l,u,A,R;if(D.length===1){const a=D[0],b=new Array(256);for(let S=0;S<256;S++)b[S]=a[S]/255;R=l=u=A=b.join(",")}else{const[a,b,S]=D,P=new Array(256),F=new Array(256),U=new Array(256);for(let W=0;W<256;W++)P[W]=a[W]/255,F[W]=b[W]/255,U[W]=S[W]/255;l=P.join(","),u=F.join(","),A=U.join(","),R=`${l}${u}${A}`}if(m=this.#d.get(R),m)return this.#d.set(D,m),m;const M=`g_${this.#i}_transfer_map_${this.#f++}`,O=`url(#${M})`;this.#d.set(D,O),this.#d.set(R,O);const T=this.#b(M);return this.#g(l,u,A,T),O}addHCMFilter(D,m){const l=`${D}-${m}`;if(this.#a===l)return this.#r;if(this.#a=l,this.#r="none",this.#o?.remove(),!D||!m)return this.#r;const u=this.#h(D);D=p.Util.makeHexColor(...u);const A=this.#h(m);if(m=p.Util.makeHexColor(...A),this.#u.style.color="",D==="#000000"&&m==="#ffffff"||D===m)return this.#r;const R=new Array(256);for(let b=0;b<=255;b++){const S=b/255;R[b]=S<=.03928?S/12.92:((S+.055)/1.055)**2.4}const M=R.join(","),O=`g_${this.#i}_hcm_filter`,T=this.#l=this.#b(O);this.#g(M,M,M,T),this.#p(T);const a=(b,S)=>{const P=u[b]/255,F=A[b]/255,U=new Array(S+1);for(let W=0;W<=S;W++)U[W]=P+W/S*(F-P);return U.join(",")};return this.#g(a(0,5),a(1,5),a(2,5),T),this.#r=`url(#${O})`,this.#r}addHighlightHCMFilter(D,m,l,u){const A=`${D}-${m}-${l}-${u}`;if(this.#c===A)return this.#n;if(this.#c=A,this.#n="none",this.#l?.remove(),!D||!m)return this.#n;const[R,M]=[D,m].map(this.#h.bind(this));let O=Math.round(.2126*R[0]+.7152*R[1]+.0722*R[2]),T=Math.round(.2126*M[0]+.7152*M[1]+.0722*M[2]),[a,b]=[l,u].map(this.#h.bind(this));T<O&&([O,T,a,b]=[T,O,b,a]),this.#u.style.color="";const S=(U,W,X)=>{const nt=new Array(256),q=(T-O)/X,Y=U/255,$=(W-U)/(255*X);let J=0;for(let tt=0;tt<=X;tt++){const rt=Math.round(O+tt*q),ot=Y+tt*$;for(let lt=J;lt<=rt;lt++)nt[lt]=ot;J=rt+1}for(let tt=J;tt<256;tt++)nt[tt]=nt[J-1];return nt.join(",")},P=`g_${this.#i}_hcm_highlight_filter`,F=this.#l=this.#b(P);return this.#p(F),this.#g(S(a[0],b[0],5),S(a[1],b[1],5),S(a[2],b[2],5),F),this.#n=`url(#${P})`,this.#n}destroy(D=!1){D&&(this.#r||this.#n)||(this.#e&&(this.#e.parentNode.parentNode.remove(),this.#e=null),this.#t&&(this.#t.clear(),this.#t=null),this.#f=0)}#p(D){const m=this.#s.createElementNS(C,"feColorMatrix");m.setAttribute("type","matrix"),m.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),D.append(m)}#b(D){const m=this.#s.createElementNS(C,"filter");return m.setAttribute("color-interpolation-filters","sRGB"),m.setAttribute("id",D),this.#u.append(m),m}#m(D,m,l){const u=this.#s.createElementNS(C,m);u.setAttribute("type","discrete"),u.setAttribute("tableValues",l),D.append(u)}#g(D,m,l,u){const A=this.#s.createElementNS(C,"feComponentTransfer");u.append(A),this.#m(A,"feFuncR",D),this.#m(A,"feFuncG",m),this.#m(A,"feFuncB",l)}#h(D){return this.#u.style.color=D,H(getComputedStyle(this.#u).getPropertyValue("color"))}}i.DOMFilterFactory=L;class I extends r.BaseCanvasFactory{constructor({ownerDocument:D=globalThis.document}={}){super(),this._document=D}_createCanvas(D,m){const l=this._document.createElement("canvas");return l.width=D,l.height=m,l}}i.DOMCanvasFactory=I;async function n(K,D=!1){if(E(K,document.baseURI)){const m=await fetch(K);if(!m.ok)throw new Error(m.statusText);return D?new Uint8Array(await m.arrayBuffer()):(0,p.stringToBytes)(await m.text())}return new Promise((m,l)=>{const u=new XMLHttpRequest;u.open("GET",K,!0),D&&(u.responseType="arraybuffer"),u.onreadystatechange=()=>{if(u.readyState===XMLHttpRequest.DONE){if(u.status===200||u.status===0){let A;if(D&&u.response?A=new Uint8Array(u.response):!D&&u.responseText&&(A=(0,p.stringToBytes)(u.responseText)),A){m(A);return}}l(new Error(u.statusText))}},u.send(null)})}class t extends r.BaseCMapReaderFactory{_fetchData(D,m){return n(D,this.isCompressed).then(l=>({cMapData:l,compressionType:m}))}}i.DOMCMapReaderFactory=t;class s extends r.BaseStandardFontDataFactory{_fetchData(D){return n(D,!0)}}i.DOMStandardFontDataFactory=s;class h extends r.BaseSVGFactory{_createSVG(D){return document.createElementNS(C,D)}}i.DOMSVGFactory=h;class c{constructor({viewBox:D,scale:m,rotation:l,offsetX:u=0,offsetY:A=0,dontFlip:R=!1}){this.viewBox=D,this.scale=m,this.rotation=l,this.offsetX=u,this.offsetY=A;const M=(D[2]+D[0])/2,O=(D[3]+D[1])/2;let T,a,b,S;switch(l%=360,l<0&&(l+=360),l){case 180:T=-1,a=0,b=0,S=1;break;case 90:T=0,a=1,b=1,S=0;break;case 270:T=0,a=-1,b=-1,S=0;break;case 0:T=1,a=0,b=0,S=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}R&&(b=-b,S=-S);let P,F,U,W;T===0?(P=Math.abs(O-D[1])*m+u,F=Math.abs(M-D[0])*m+A,U=(D[3]-D[1])*m,W=(D[2]-D[0])*m):(P=Math.abs(M-D[0])*m+u,F=Math.abs(O-D[1])*m+A,U=(D[2]-D[0])*m,W=(D[3]-D[1])*m),this.transform=[T*m,a*m,b*m,S*m,P-T*m*M-b*m*O,F-a*m*M-S*m*O],this.width=U,this.height=W}get rawDims(){const{viewBox:D}=this;return(0,p.shadow)(this,"rawDims",{pageWidth:D[2]-D[0],pageHeight:D[3]-D[1],pageX:D[0],pageY:D[1]})}clone({scale:D=this.scale,rotation:m=this.rotation,offsetX:l=this.offsetX,offsetY:u=this.offsetY,dontFlip:A=!1}={}){return new c({viewBox:this.viewBox.slice(),scale:D,rotation:m,offsetX:l,offsetY:u,dontFlip:A})}convertToViewportPoint(D,m){return p.Util.applyTransform([D,m],this.transform)}convertToViewportRectangle(D){const m=p.Util.applyTransform([D[0],D[1]],this.transform),l=p.Util.applyTransform([D[2],D[3]],this.transform);return[m[0],m[1],l[0],l[1]]}convertToPdfPoint(D,m){return p.Util.applyInverseTransform([D,m],this.transform)}}i.PageViewport=c;class e extends p.BaseException{constructor(D,m=0){super(D,"RenderingCancelledException"),this.extraDelay=m}}i.RenderingCancelledException=e;function d(K){const D=K.length;let m=0;for(;m<D&&K[m].trim()==="";)m++;return K.substring(m,m+5).toLowerCase()==="data:"}function g(K){return typeof K=="string"&&/\.pdf$/i.test(K)}function o(K,D=!1){return D||([K]=K.split(/[#?]/,1)),K.substring(K.lastIndexOf("/")+1)}function v(K,D="document.pdf"){if(typeof K!="string")return D;if(d(K))return(0,p.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),D;const m=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,l=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,u=m.exec(K);let A=l.exec(u[1])||l.exec(u[2])||l.exec(u[3]);if(A&&(A=A[0],A.includes("%")))try{A=l.exec(decodeURIComponent(A))[0]}catch{}return A||D}class k{started=Object.create(null);times=[];time(D){D in this.started&&(0,p.warn)(`Timer is already running for ${D}`),this.started[D]=Date.now()}timeEnd(D){D in this.started||(0,p.warn)(`Timer has not been started for ${D}`),this.times.push({name:D,start:this.started[D],end:Date.now()}),delete this.started[D]}toString(){const D=[];let m=0;for(const{name:l}of this.times)m=Math.max(l.length,m);for(const{name:l,start:u,end:A}of this.times)D.push(`${l.padEnd(m)} ${A-u}ms
`);return D.join("")}}i.StatTimer=k;function E(K,D){try{const{protocol:m}=D?new URL(K,D):new URL(K);return m==="http:"||m==="https:"}catch{return!1}}function f(K){K.preventDefault()}function x(K,D=!1){return new Promise((m,l)=>{const u=document.createElement("script");u.src=K,u.onload=function(A){D&&u.remove(),m(A)},u.onerror=function(){l(new Error(`Cannot load script at: ${u.src}`))},(document.head||document.documentElement).append(u)})}function j(K){console.log("Deprecated API usage: "+K)}let B;class N{static toDateObject(D){if(!D||typeof D!="string")return null;B||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const m=B.exec(D);if(!m)return null;const l=parseInt(m[1],10);let u=parseInt(m[2],10);u=u>=1&&u<=12?u-1:0;let A=parseInt(m[3],10);A=A>=1&&A<=31?A:1;let R=parseInt(m[4],10);R=R>=0&&R<=23?R:0;let M=parseInt(m[5],10);M=M>=0&&M<=59?M:0;let O=parseInt(m[6],10);O=O>=0&&O<=59?O:0;const T=m[7]||"Z";let a=parseInt(m[8],10);a=a>=0&&a<=23?a:0;let b=parseInt(m[9],10)||0;return b=b>=0&&b<=59?b:0,T==="-"?(R+=a,M+=b):T==="+"&&(R-=a,M-=b),new Date(Date.UTC(l,u,A,R,M,O))}}i.PDFDateString=N;function z(K,{scale:D=1,rotation:m=0}){const{width:l,height:u}=K.attributes.style,A=[0,0,parseInt(l),parseInt(u)];return new c({viewBox:A,scale:D,rotation:m})}function H(K){if(K.startsWith("#")){const D=parseInt(K.slice(1),16);return[(D&16711680)>>16,(D&65280)>>8,D&255]}return K.startsWith("rgb(")?K.slice(4,-1).split(",").map(D=>parseInt(D)):K.startsWith("rgba(")?K.slice(5,-1).split(",").map(D=>parseInt(D)).slice(0,3):((0,p.warn)(`Not a valid color format: "${K}"`),[0,0,0])}function it(K){const D=document.createElement("span");D.style.visibility="hidden",document.body.append(D);for(const m of K.keys()){D.style.color=m;const l=window.getComputedStyle(D).color;K.set(m,H(l))}D.remove()}function Z(K){const{a:D,b:m,c:l,d:u,e:A,f:R}=K.getTransform();return[D,m,l,u,A,R]}function Q(K){const{a:D,b:m,c:l,d:u,e:A,f:R}=K.getTransform().invertSelf();return[D,m,l,u,A,R]}function st(K,D,m=!1,l=!0){if(D instanceof c){const{pageWidth:u,pageHeight:A}=D.rawDims,{style:R}=K,M=p.FeatureTest.isCSSRoundSupported,O=`var(--scale-factor) * ${u}px`,T=`var(--scale-factor) * ${A}px`,a=M?`round(${O}, 1px)`:`calc(${O})`,b=M?`round(${T}, 1px)`:`calc(${T})`;!m||D.rotation%180===0?(R.width=a,R.height=b):(R.width=b,R.height=a)}l&&K.setAttribute("data-main-rotation",D.rotation)}}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BaseStandardFontDataFactory=i.BaseSVGFactory=i.BaseFilterFactory=i.BaseCanvasFactory=i.BaseCMapReaderFactory=void 0;var r=_(1);class p{constructor(){this.constructor===p&&(0,r.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(t){return"none"}addHCMFilter(t,s){return"none"}addHighlightHCMFilter(t,s,h,c){return"none"}destroy(t=!1){}}i.BaseFilterFactory=p;class C{constructor(){this.constructor===C&&(0,r.unreachable)("Cannot initialize BaseCanvasFactory.")}create(t,s){if(t<=0||s<=0)throw new Error("Invalid canvas size");const h=this._createCanvas(t,s);return{canvas:h,context:h.getContext("2d")}}reset(t,s,h){if(!t.canvas)throw new Error("Canvas is not specified");if(s<=0||h<=0)throw new Error("Invalid canvas size");t.canvas.width=s,t.canvas.height=h}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,s){(0,r.unreachable)("Abstract method `_createCanvas` called.")}}i.BaseCanvasFactory=C;class w{constructor({baseUrl:t=null,isCompressed:s=!0}){this.constructor===w&&(0,r.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=t,this.isCompressed=s}async fetch({name:t}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!t)throw new Error("CMap name must be specified.");const s=this.baseUrl+t+(this.isCompressed?".bcmap":""),h=this.isCompressed?r.CMapCompressionType.BINARY:r.CMapCompressionType.NONE;return this._fetchData(s,h).catch(c=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${s}`)})}_fetchData(t,s){(0,r.unreachable)("Abstract method `_fetchData` called.")}}i.BaseCMapReaderFactory=w;class L{constructor({baseUrl:t=null}){this.constructor===L&&(0,r.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!t)throw new Error("Font filename must be specified.");const s=`${this.baseUrl}${t}`;return this._fetchData(s).catch(h=>{throw new Error(`Unable to load font data at: ${s}`)})}_fetchData(t){(0,r.unreachable)("Abstract method `_fetchData` called.")}}i.BaseStandardFontDataFactory=L;class I{constructor(){this.constructor===I&&(0,r.unreachable)("Cannot initialize BaseSVGFactory.")}create(t,s,h=!1){if(t<=0||s<=0)throw new Error("Invalid SVG dimensions");const c=this._createSVG("svg:svg");return c.setAttribute("version","1.1"),h||(c.setAttribute("width",`${t}px`),c.setAttribute("height",`${s}px`)),c.setAttribute("preserveAspectRatio","none"),c.setAttribute("viewBox",`0 0 ${t} ${s}`),c}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){(0,r.unreachable)("Abstract method `_createSVG` called.")}}i.BaseSVGFactory=I}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.MurmurHash3_64=void 0;var r=_(1);const p=3285377520,C=4294901760,w=65535;class L{constructor(n){this.h1=n?n&4294967295:p,this.h2=n?n&4294967295:p}update(n){let t,s;if(typeof n=="string"){t=new Uint8Array(n.length*2),s=0;for(let j=0,B=n.length;j<B;j++){const N=n.charCodeAt(j);N<=255?t[s++]=N:(t[s++]=N>>>8,t[s++]=N&255)}}else if((0,r.isArrayBuffer)(n))t=n.slice(),s=t.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const h=s>>2,c=s-h*4,e=new Uint32Array(t.buffer,0,h);let d=0,g=0,o=this.h1,v=this.h2;const k=3432918353,E=461845907,f=k&w,x=E&w;for(let j=0;j<h;j++)j&1?(d=e[j],d=d*k&C|d*f&w,d=d<<15|d>>>17,d=d*E&C|d*x&w,o^=d,o=o<<13|o>>>19,o=o*5+3864292196):(g=e[j],g=g*k&C|g*f&w,g=g<<15|g>>>17,g=g*E&C|g*x&w,v^=g,v=v<<13|v>>>19,v=v*5+3864292196);switch(d=0,c){case 3:d^=t[h*4+2]<<16;case 2:d^=t[h*4+1]<<8;case 1:d^=t[h*4],d=d*k&C|d*f&w,d=d<<15|d>>>17,d=d*E&C|d*x&w,h&1?o^=d:v^=d}this.h1=o,this.h2=v}hexdigest(){let n=this.h1,t=this.h2;return n^=t>>>1,n=n*3981806797&C|n*36045&w,t=t*4283543511&C|((t<<16|n>>>16)*2950163797&C)>>>16,n^=t>>>1,n=n*444984403&C|n*60499&w,t=t*3301882366&C|((t<<16|n>>>16)*3120437893&C)>>>16,n^=t>>>1,(n>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}i.MurmurHash3_64=L}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.FontLoader=i.FontFaceObject=void 0;var r=_(1);class p{#t=new Set;constructor({ownerDocument:L=globalThis.document,styleElement:I=null}){this._document=L,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(L){this.nativeFontFaces.add(L),this._document.fonts.add(L)}removeNativeFontFace(L){this.nativeFontFaces.delete(L),this._document.fonts.delete(L)}insertRule(L){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const I=this.styleElement.sheet;I.insertRule(L,I.cssRules.length)}clear(){for(const L of this.nativeFontFaces)this._document.fonts.delete(L);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(L){if(!(!L||this.#t.has(L.loadedName))){if((0,r.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:I,src:n,style:t}=L,s=new FontFace(I,n,t);this.addNativeFontFace(s);try{await s.load(),this.#t.add(I)}catch{(0,r.warn)(`Cannot load system font: ${L.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(s)}return}(0,r.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(L){if(L.attached||L.missingFile&&!L.systemFontInfo)return;if(L.attached=!0,L.systemFontInfo){await this.loadSystemFont(L.systemFontInfo);return}if(this.isFontLoadingAPISupported){const n=L.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(t){throw(0,r.warn)(`Failed to load font '${n.family}': '${t}'.`),L.disableFontFace=!0,t}}return}const I=L.createFontFaceRule();if(I){if(this.insertRule(I),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const t=this._queueLoadingCallback(n);this._prepareFontLoadEvent(L,t)})}}get isFontLoadingAPISupported(){const L=!!this._document?.fonts;return(0,r.shadow)(this,"isFontLoadingAPISupported",L)}get isSyncFontLoadingSupported(){let L=!1;return(r.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(L=!0),(0,r.shadow)(this,"isSyncFontLoadingSupported",L)}_queueLoadingCallback(L){function I(){for((0,r.assert)(!t.done,"completeRequest() cannot be called twice."),t.done=!0;n.length>0&&n[0].done;){const s=n.shift();setTimeout(s.callback,0)}}const{loadingRequests:n}=this,t={done:!1,complete:I,callback:L};return n.push(t),t}get _loadTestFont(){const L=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,r.shadow)(this,"_loadTestFont",L)}_prepareFontLoadEvent(L,I){function n(z,H){return z.charCodeAt(H)<<24|z.charCodeAt(H+1)<<16|z.charCodeAt(H+2)<<8|z.charCodeAt(H+3)&255}function t(z,H,it,Z){const Q=z.substring(0,H),st=z.substring(H+it);return Q+Z+st}let s,h;const c=this._document.createElement("canvas");c.width=1,c.height=1;const e=c.getContext("2d");let d=0;function g(z,H){if(++d>30){(0,r.warn)("Load test font never loaded."),H();return}if(e.font="30px "+z,e.fillText(".",0,20),e.getImageData(0,0,1,1).data[3]>0){H();return}setTimeout(g.bind(null,z,H))}const o=`lt${Date.now()}${this.loadTestFontId++}`;let v=this._loadTestFont;v=t(v,976,o.length,o);const E=16,f=1482184792;let x=n(v,E);for(s=0,h=o.length-3;s<h;s+=4)x=x-f+n(o,s)|0;s<o.length&&(x=x-f+n(o+"XXX",s)|0),v=t(v,E,4,(0,r.string32)(x));const j=`url(data:font/opentype;base64,${btoa(v)});`,B=`@font-face {font-family:"${o}";src:${j}}`;this.insertRule(B);const N=this._document.createElement("div");N.style.visibility="hidden",N.style.width=N.style.height="10px",N.style.position="absolute",N.style.top=N.style.left="0px";for(const z of[L.loadedName,o]){const H=this._document.createElement("span");H.textContent="Hi",H.style.fontFamily=z,N.append(H)}this._document.body.append(N),g(o,()=>{N.remove(),I.complete()})}}i.FontLoader=p;class C{constructor(L,{isEvalSupported:I=!0,disableFontFace:n=!1,ignoreErrors:t=!1,inspectFont:s=null}){this.compiledGlyphs=Object.create(null);for(const h in L)this[h]=L[h];this.isEvalSupported=I!==!1,this.disableFontFace=n===!0,this.ignoreErrors=t===!0,this._inspectFont=s}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let L;if(!this.cssFontInfo)L=new FontFace(this.loadedName,this.data,{});else{const I={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(I.style=`oblique ${this.cssFontInfo.italicAngle}deg`),L=new FontFace(this.cssFontInfo.fontFamily,this.data,I)}return this._inspectFont?.(this),L}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const L=(0,r.bytesToString)(this.data),I=`url(data:${this.mimetype};base64,${btoa(L)});`;let n;if(!this.cssFontInfo)n=`@font-face {font-family:"${this.loadedName}";src:${I}}`;else{let t=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(t+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),n=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${t}src:${I}}`}return this._inspectFont?.(this,I),n}getPathGenerator(L,I){if(this.compiledGlyphs[I]!==void 0)return this.compiledGlyphs[I];let n;try{n=L.get(this.loadedName+"_path_"+I)}catch(t){if(!this.ignoreErrors)throw t;return(0,r.warn)(`getPathGenerator - ignoring character: "${t}".`),this.compiledGlyphs[I]=function(s,h){}}if(this.isEvalSupported&&r.FeatureTest.isEvalSupported){const t=[];for(const s of n){const h=s.args!==void 0?s.args.join(","):"";t.push("c.",s.cmd,"(",h,`);
`)}return this.compiledGlyphs[I]=new Function("c","size",t.join(""))}return this.compiledGlyphs[I]=function(t,s){for(const h of n)h.cmd==="scale"&&(h.args=[s,-s]),t[h.cmd].apply(t,h.args)}}}i.FontFaceObject=C}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.NodeStandardFontDataFactory=i.NodeFilterFactory=i.NodeCanvasFactory=i.NodeCMapReaderFactory=void 0;var r=_(7);_(1);const p=function(n){return new Promise((t,s)=>{require$$5.readFile(n,(c,e)=>{if(c||!e){s(new Error(c));return}t(new Uint8Array(e))})})};class C extends r.BaseFilterFactory{}i.NodeFilterFactory=C;class w extends r.BaseCanvasFactory{_createCanvas(t,s){return require$$5.createCanvas(t,s)}}i.NodeCanvasFactory=w;class L extends r.BaseCMapReaderFactory{_fetchData(t,s){return p(t).then(h=>({cMapData:h,compressionType:s}))}}i.NodeCMapReaderFactory=L;class I extends r.BaseStandardFontDataFactory{_fetchData(t){return p(t)}}i.NodeStandardFontDataFactory=I}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CanvasGraphics=void 0;var r=_(1),p=_(6),C=_(12),w=_(13);const L=16,I=100,n=4096,t=15,s=10,h=1e3,c=16;function e(m,l){if(m._removeMirroring)throw new Error("Context is already forwarding operations.");m.__originalSave=m.save,m.__originalRestore=m.restore,m.__originalRotate=m.rotate,m.__originalScale=m.scale,m.__originalTranslate=m.translate,m.__originalTransform=m.transform,m.__originalSetTransform=m.setTransform,m.__originalResetTransform=m.resetTransform,m.__originalClip=m.clip,m.__originalMoveTo=m.moveTo,m.__originalLineTo=m.lineTo,m.__originalBezierCurveTo=m.bezierCurveTo,m.__originalRect=m.rect,m.__originalClosePath=m.closePath,m.__originalBeginPath=m.beginPath,m._removeMirroring=()=>{m.save=m.__originalSave,m.restore=m.__originalRestore,m.rotate=m.__originalRotate,m.scale=m.__originalScale,m.translate=m.__originalTranslate,m.transform=m.__originalTransform,m.setTransform=m.__originalSetTransform,m.resetTransform=m.__originalResetTransform,m.clip=m.__originalClip,m.moveTo=m.__originalMoveTo,m.lineTo=m.__originalLineTo,m.bezierCurveTo=m.__originalBezierCurveTo,m.rect=m.__originalRect,m.closePath=m.__originalClosePath,m.beginPath=m.__originalBeginPath,delete m._removeMirroring},m.save=function(){l.save(),this.__originalSave()},m.restore=function(){l.restore(),this.__originalRestore()},m.translate=function(A,R){l.translate(A,R),this.__originalTranslate(A,R)},m.scale=function(A,R){l.scale(A,R),this.__originalScale(A,R)},m.transform=function(A,R,M,O,T,a){l.transform(A,R,M,O,T,a),this.__originalTransform(A,R,M,O,T,a)},m.setTransform=function(A,R,M,O,T,a){l.setTransform(A,R,M,O,T,a),this.__originalSetTransform(A,R,M,O,T,a)},m.resetTransform=function(){l.resetTransform(),this.__originalResetTransform()},m.rotate=function(A){l.rotate(A),this.__originalRotate(A)},m.clip=function(A){l.clip(A),this.__originalClip(A)},m.moveTo=function(u,A){l.moveTo(u,A),this.__originalMoveTo(u,A)},m.lineTo=function(u,A){l.lineTo(u,A),this.__originalLineTo(u,A)},m.bezierCurveTo=function(u,A,R,M,O,T){l.bezierCurveTo(u,A,R,M,O,T),this.__originalBezierCurveTo(u,A,R,M,O,T)},m.rect=function(u,A,R,M){l.rect(u,A,R,M),this.__originalRect(u,A,R,M)},m.closePath=function(){l.closePath(),this.__originalClosePath()},m.beginPath=function(){l.beginPath(),this.__originalBeginPath()}}class d{constructor(l){this.canvasFactory=l,this.cache=Object.create(null)}getCanvas(l,u,A){let R;return this.cache[l]!==void 0?(R=this.cache[l],this.canvasFactory.reset(R,u,A)):(R=this.canvasFactory.create(u,A),this.cache[l]=R),R}delete(l){delete this.cache[l]}clear(){for(const l in this.cache){const u=this.cache[l];this.canvasFactory.destroy(u),delete this.cache[l]}}}function g(m,l,u,A,R,M,O,T,a,b){const[S,P,F,U,W,X]=(0,p.getCurrentTransform)(m);if(P===0&&F===0){const Y=O*S+W,$=Math.round(Y),J=T*U+X,tt=Math.round(J),rt=(O+a)*S+W,ot=Math.abs(Math.round(rt)-$)||1,lt=(T+b)*U+X,ct=Math.abs(Math.round(lt)-tt)||1;return m.setTransform(Math.sign(S),0,0,Math.sign(U),$,tt),m.drawImage(l,u,A,R,M,0,0,ot,ct),m.setTransform(S,P,F,U,W,X),[ot,ct]}if(S===0&&U===0){const Y=T*F+W,$=Math.round(Y),J=O*P+X,tt=Math.round(J),rt=(T+b)*F+W,ot=Math.abs(Math.round(rt)-$)||1,lt=(O+a)*P+X,ct=Math.abs(Math.round(lt)-tt)||1;return m.setTransform(0,Math.sign(P),Math.sign(F),0,$,tt),m.drawImage(l,u,A,R,M,0,0,ct,ot),m.setTransform(S,P,F,U,W,X),[ct,ot]}m.drawImage(l,u,A,R,M,O,T,a,b);const nt=Math.hypot(S,P),q=Math.hypot(F,U);return[nt*a,q*b]}function o(m){const{width:l,height:u}=m;if(l>h||u>h)return null;const A=1e3,R=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),M=l+1;let O=new Uint8Array(M*(u+1)),T,a,b;const S=l+7&-8;let P=new Uint8Array(S*u),F=0;for(const q of m.data){let Y=128;for(;Y>0;)P[F++]=q&Y?0:255,Y>>=1}let U=0;for(F=0,P[F]!==0&&(O[0]=1,++U),a=1;a<l;a++)P[F]!==P[F+1]&&(O[a]=P[F]?2:1,++U),F++;for(P[F]!==0&&(O[a]=2,++U),T=1;T<u;T++){F=T*S,b=T*M,P[F-S]!==P[F]&&(O[b]=P[F]?1:8,++U);let q=(P[F]?4:0)+(P[F-S]?8:0);for(a=1;a<l;a++)q=(q>>2)+(P[F+1]?4:0)+(P[F-S+1]?8:0),R[q]&&(O[b+a]=R[q],++U),F++;if(P[F-S]!==P[F]&&(O[b+a]=P[F]?2:4,++U),U>A)return null}for(F=S*(u-1),b=T*M,P[F]!==0&&(O[b]=8,++U),a=1;a<l;a++)P[F]!==P[F+1]&&(O[b+a]=P[F]?4:8,++U),F++;if(P[F]!==0&&(O[b+a]=4,++U),U>A)return null;const W=new Int32Array([0,M,-1,0,-M,0,0,0,1]),X=new Path2D;for(T=0;U&&T<=u;T++){let q=T*M;const Y=q+l;for(;q<Y&&!O[q];)q++;if(q===Y)continue;X.moveTo(q%M,T);const $=q;let J=O[q];do{const tt=W[J];do q+=tt;while(!O[q]);const rt=O[q];rt!==5&&rt!==10?(J=rt,O[q]=0):(J=rt&51*J>>4,O[q]&=J>>2|J<<2),X.lineTo(q%M,q/M|0),O[q]||--U}while($!==q);--T}return P=null,O=null,function(q){q.save(),q.scale(1/l,-1/u),q.translate(0,-u),q.fill(X),q.beginPath(),q.restore()}}class v{constructor(l,u){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=r.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=r.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=r.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,l,u])}clone(){const l=Object.create(this);return l.clipBox=this.clipBox.slice(),l}setCurrentPoint(l,u){this.x=l,this.y=u}updatePathMinMax(l,u,A){[u,A]=r.Util.applyTransform([u,A],l),this.minX=Math.min(this.minX,u),this.minY=Math.min(this.minY,A),this.maxX=Math.max(this.maxX,u),this.maxY=Math.max(this.maxY,A)}updateRectMinMax(l,u){const A=r.Util.applyTransform(u,l),R=r.Util.applyTransform(u.slice(2),l);this.minX=Math.min(this.minX,A[0],R[0]),this.minY=Math.min(this.minY,A[1],R[1]),this.maxX=Math.max(this.maxX,A[0],R[0]),this.maxY=Math.max(this.maxY,A[1],R[1])}updateScalingPathMinMax(l,u){r.Util.scaleMinMax(l,u),this.minX=Math.min(this.minX,u[0]),this.maxX=Math.max(this.maxX,u[1]),this.minY=Math.min(this.minY,u[2]),this.maxY=Math.max(this.maxY,u[3])}updateCurvePathMinMax(l,u,A,R,M,O,T,a,b,S){const P=r.Util.bezierBoundingBox(u,A,R,M,O,T,a,b);if(S){S[0]=Math.min(S[0],P[0],P[2]),S[1]=Math.max(S[1],P[0],P[2]),S[2]=Math.min(S[2],P[1],P[3]),S[3]=Math.max(S[3],P[1],P[3]);return}this.updateRectMinMax(l,P)}getPathBoundingBox(l=C.PathType.FILL,u=null){const A=[this.minX,this.minY,this.maxX,this.maxY];if(l===C.PathType.STROKE){u||(0,r.unreachable)("Stroke bounding box must include transform.");const R=r.Util.singularValueDecompose2dScale(u),M=R[0]*this.lineWidth/2,O=R[1]*this.lineWidth/2;A[0]-=M,A[1]-=O,A[2]+=M,A[3]+=O}return A}updateClipFromPath(){const l=r.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(l||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(l){this.clipBox=l,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(l=C.PathType.FILL,u=null){return r.Util.intersect(this.clipBox,this.getPathBoundingBox(l,u))}}function k(m,l){if(typeof ImageData<"u"&&l instanceof ImageData){m.putImageData(l,0,0);return}const u=l.height,A=l.width,R=u%c,M=(u-R)/c,O=R===0?M:M+1,T=m.createImageData(A,c);let a=0,b;const S=l.data,P=T.data;let F,U,W,X;if(l.kind===r.ImageKind.GRAYSCALE_1BPP){const nt=S.byteLength,q=new Uint32Array(P.buffer,0,P.byteLength>>2),Y=q.length,$=A+7>>3,J=4294967295,tt=r.FeatureTest.isLittleEndian?4278190080:255;for(F=0;F<O;F++){for(W=F<M?c:R,b=0,U=0;U<W;U++){const rt=nt-a;let ot=0;const lt=rt>$?A:rt*8-7,ct=lt&-8;let ht=0,ut=0;for(;ot<ct;ot+=8)ut=S[a++],q[b++]=ut&128?J:tt,q[b++]=ut&64?J:tt,q[b++]=ut&32?J:tt,q[b++]=ut&16?J:tt,q[b++]=ut&8?J:tt,q[b++]=ut&4?J:tt,q[b++]=ut&2?J:tt,q[b++]=ut&1?J:tt;for(;ot<lt;ot++)ht===0&&(ut=S[a++],ht=128),q[b++]=ut&ht?J:tt,ht>>=1}for(;b<Y;)q[b++]=0;m.putImageData(T,0,F*c)}}else if(l.kind===r.ImageKind.RGBA_32BPP){for(U=0,X=A*c*4,F=0;F<M;F++)P.set(S.subarray(a,a+X)),a+=X,m.putImageData(T,0,U),U+=c;F<O&&(X=A*R*4,P.set(S.subarray(a,a+X)),m.putImageData(T,0,U))}else if(l.kind===r.ImageKind.RGB_24BPP)for(W=c,X=A*W,F=0;F<O;F++){for(F>=M&&(W=R,X=A*W),b=0,U=X;U--;)P[b++]=S[a++],P[b++]=S[a++],P[b++]=S[a++],P[b++]=255;m.putImageData(T,0,F*c)}else throw new Error(`bad image kind: ${l.kind}`)}function E(m,l){if(l.bitmap){m.drawImage(l.bitmap,0,0);return}const u=l.height,A=l.width,R=u%c,M=(u-R)/c,O=R===0?M:M+1,T=m.createImageData(A,c);let a=0;const b=l.data,S=T.data;for(let P=0;P<O;P++){const F=P<M?c:R;({srcPos:a}=(0,w.convertBlackAndWhiteToRGBA)({src:b,srcPos:a,dest:S,width:A,height:F,nonBlackColor:0})),m.putImageData(T,0,P*c)}}function f(m,l){const u=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const A of u)m[A]!==void 0&&(l[A]=m[A]);m.setLineDash!==void 0&&(l.setLineDash(m.getLineDash()),l.lineDashOffset=m.lineDashOffset)}function x(m){if(m.strokeStyle=m.fillStyle="#000000",m.fillRule="nonzero",m.globalAlpha=1,m.lineWidth=1,m.lineCap="butt",m.lineJoin="miter",m.miterLimit=10,m.globalCompositeOperation="source-over",m.font="10px sans-serif",m.setLineDash!==void 0&&(m.setLineDash([]),m.lineDashOffset=0),!r.isNodeJS){const{filter:l}=m;l!=="none"&&l!==""&&(m.filter="none")}}function j(m,l,u,A){const R=m.length;for(let M=3;M<R;M+=4){const O=m[M];if(O===0)m[M-3]=l,m[M-2]=u,m[M-1]=A;else if(O<255){const T=255-O;m[M-3]=m[M-3]*O+l*T>>8,m[M-2]=m[M-2]*O+u*T>>8,m[M-1]=m[M-1]*O+A*T>>8}}}function B(m,l,u){const A=m.length,R=1/255;for(let M=3;M<A;M+=4){const O=u?u[m[M]]:m[M];l[M]=l[M]*O*R|0}}function N(m,l,u){const A=m.length;for(let R=3;R<A;R+=4){const M=m[R-3]*77+m[R-2]*152+m[R-1]*28;l[R]=u?l[R]*u[M>>8]>>8:l[R]*M>>16}}function z(m,l,u,A,R,M,O,T,a,b,S){const P=!!M,F=P?M[0]:0,U=P?M[1]:0,W=P?M[2]:0,X=R==="Luminosity"?N:B,q=Math.min(A,Math.ceil(1048576/u));for(let Y=0;Y<A;Y+=q){const $=Math.min(q,A-Y),J=m.getImageData(T-b,Y+(a-S),u,$),tt=l.getImageData(T,Y+a,u,$);P&&j(J.data,F,U,W),X(J.data,tt.data,O),l.putImageData(tt,T,Y+a)}}function H(m,l,u,A){const R=A[0],M=A[1],O=A[2]-R,T=A[3]-M;O===0||T===0||(z(l.context,u,O,T,l.subtype,l.backdrop,l.transferMap,R,M,l.offsetX,l.offsetY),m.save(),m.globalAlpha=1,m.globalCompositeOperation="source-over",m.setTransform(1,0,0,1,0,0),m.drawImage(u.canvas,0,0),m.restore())}function it(m,l){const u=r.Util.singularValueDecompose2dScale(m);u[0]=Math.fround(u[0]),u[1]=Math.fround(u[1]);const A=Math.fround((globalThis.devicePixelRatio||1)*p.PixelsPerInch.PDF_TO_CSS_UNITS);return l!==void 0?l:u[0]<=A||u[1]<=A}const Z=["butt","round","square"],Q=["miter","round","bevel"],st={},K={};class D{constructor(l,u,A,R,M,{optionalContentConfig:O,markedContentStack:T=null},a,b){this.ctx=l,this.current=new v(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=u,this.objs=A,this.canvasFactory=R,this.filterFactory=M,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=T||[],this.optionalContentConfig=O,this.cachedCanvases=new d(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=a,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=b,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(l,u=null){return typeof l=="string"?l.startsWith("g_")?this.commonObjs.get(l):this.objs.get(l):u}beginDrawing({transform:l,viewport:u,transparency:A=!1,background:R=null}){const M=this.ctx.canvas.width,O=this.ctx.canvas.height,T=this.ctx.fillStyle;if(this.ctx.fillStyle=R||"#ffffff",this.ctx.fillRect(0,0,M,O),this.ctx.fillStyle=T,A){const a=this.cachedCanvases.getCanvas("transparent",M,O);this.compositeCtx=this.ctx,this.transparentCanvas=a.canvas,this.ctx=a.context,this.ctx.save(),this.ctx.transform(...(0,p.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),x(this.ctx),l&&(this.ctx.transform(...l),this.outputScaleX=l[0],this.outputScaleY=l[0]),this.ctx.transform(...u.transform),this.viewportScale=u.scale,this.baseTransform=(0,p.getCurrentTransform)(this.ctx)}executeOperatorList(l,u,A,R){const M=l.argsArray,O=l.fnArray;let T=u||0;const a=M.length;if(a===T)return T;const b=a-T>s&&typeof A=="function",S=b?Date.now()+t:0;let P=0;const F=this.commonObjs,U=this.objs;let W;for(;;){if(R!==void 0&&T===R.nextBreakPoint)return R.breakIt(T,A),T;if(W=O[T],W!==r.OPS.dependency)this[W].apply(this,M[T]);else for(const X of M[T]){const nt=X.startsWith("g_")?F:U;if(!nt.has(X))return nt.get(X,A),T}if(T++,T===a)return T;if(b&&++P>s){if(Date.now()>S)return A(),T;P=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const l of this._cachedBitmapsMap.values()){for(const u of l.values())typeof HTMLCanvasElement<"u"&&u instanceof HTMLCanvasElement&&(u.width=u.height=0);l.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const l=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(l!=="none"){const u=this.ctx.filter;this.ctx.filter=l,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=u}}}_scaleImage(l,u){const A=l.width,R=l.height;let M=Math.max(Math.hypot(u[0],u[1]),1),O=Math.max(Math.hypot(u[2],u[3]),1),T=A,a=R,b="prescale1",S,P;for(;M>2&&T>1||O>2&&a>1;){let F=T,U=a;M>2&&T>1&&(F=T>=16384?Math.floor(T/2)-1||1:Math.ceil(T/2),M/=T/F),O>2&&a>1&&(U=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a)/2,O/=a/U),S=this.cachedCanvases.getCanvas(b,F,U),P=S.context,P.clearRect(0,0,F,U),P.drawImage(l,0,0,T,a,0,0,F,U),l=S.canvas,T=F,a=U,b=b==="prescale1"?"prescale2":"prescale1"}return{img:l,paintWidth:T,paintHeight:a}}_createMaskCanvas(l){const u=this.ctx,{width:A,height:R}=l,M=this.current.fillColor,O=this.current.patternFill,T=(0,p.getCurrentTransform)(u);let a,b,S,P;if((l.bitmap||l.data)&&l.count>1){const ot=l.bitmap||l.data.buffer;b=JSON.stringify(O?T:[T.slice(0,4),M]),a=this._cachedBitmapsMap.get(ot),a||(a=new Map,this._cachedBitmapsMap.set(ot,a));const lt=a.get(b);if(lt&&!O){const ct=Math.round(Math.min(T[0],T[2])+T[4]),ht=Math.round(Math.min(T[1],T[3])+T[5]);return{canvas:lt,offsetX:ct,offsetY:ht}}S=lt}S||(P=this.cachedCanvases.getCanvas("maskCanvas",A,R),E(P.context,l));let F=r.Util.transform(T,[1/A,0,0,-1/R,0,0]);F=r.Util.transform(F,[1,0,0,1,0,-R]);const U=r.Util.applyTransform([0,0],F),W=r.Util.applyTransform([A,R],F),X=r.Util.normalizeRect([U[0],U[1],W[0],W[1]]),nt=Math.round(X[2]-X[0])||1,q=Math.round(X[3]-X[1])||1,Y=this.cachedCanvases.getCanvas("fillCanvas",nt,q),$=Y.context,J=Math.min(U[0],W[0]),tt=Math.min(U[1],W[1]);$.translate(-J,-tt),$.transform(...F),S||(S=this._scaleImage(P.canvas,(0,p.getCurrentTransformInverse)($)),S=S.img,a&&O&&a.set(b,S)),$.imageSmoothingEnabled=it((0,p.getCurrentTransform)($),l.interpolate),g($,S,0,0,S.width,S.height,0,0,A,R),$.globalCompositeOperation="source-in";const rt=r.Util.transform((0,p.getCurrentTransformInverse)($),[1,0,0,1,-J,-tt]);return $.fillStyle=O?M.getPattern(u,this,rt,C.PathType.FILL):M,$.fillRect(0,0,A,R),a&&!O&&(this.cachedCanvases.delete("fillCanvas"),a.set(b,Y.canvas)),{canvas:Y.canvas,offsetX:Math.round(J),offsetY:Math.round(tt)}}setLineWidth(l){l!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=l,this.ctx.lineWidth=l}setLineCap(l){this.ctx.lineCap=Z[l]}setLineJoin(l){this.ctx.lineJoin=Q[l]}setMiterLimit(l){this.ctx.miterLimit=l}setDash(l,u){const A=this.ctx;A.setLineDash!==void 0&&(A.setLineDash(l),A.lineDashOffset=u)}setRenderingIntent(l){}setFlatness(l){}setGState(l){for(const[u,A]of l)switch(u){case"LW":this.setLineWidth(A);break;case"LC":this.setLineCap(A);break;case"LJ":this.setLineJoin(A);break;case"ML":this.setMiterLimit(A);break;case"D":this.setDash(A[0],A[1]);break;case"RI":this.setRenderingIntent(A);break;case"FL":this.setFlatness(A);break;case"Font":this.setFont(A[0],A[1]);break;case"CA":this.current.strokeAlpha=A;break;case"ca":this.current.fillAlpha=A,this.ctx.globalAlpha=A;break;case"BM":this.ctx.globalCompositeOperation=A;break;case"SMask":this.current.activeSMask=A?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(A);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const l=this.inSMaskMode;this.current.activeSMask&&!l?this.beginSMaskMode():!this.current.activeSMask&&l&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const l=this.ctx.canvas.width,u=this.ctx.canvas.height,A="smaskGroupAt"+this.groupLevel,R=this.cachedCanvases.getCanvas(A,l,u);this.suspendedCtx=this.ctx,this.ctx=R.context;const M=this.ctx;M.setTransform(...(0,p.getCurrentTransform)(this.suspendedCtx)),f(this.suspendedCtx,M),e(M,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),f(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(l){if(!this.current.activeSMask)return;l?(l[0]=Math.floor(l[0]),l[1]=Math.floor(l[1]),l[2]=Math.ceil(l[2]),l[3]=Math.ceil(l[3])):l=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const u=this.current.activeSMask,A=this.suspendedCtx;H(A,u,this.ctx,l),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(f(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const l=this.current;this.stateStack.push(l),this.current=l.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),f(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(l,u,A,R,M,O){this.ctx.transform(l,u,A,R,M,O),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(l,u,A){const R=this.ctx,M=this.current;let O=M.x,T=M.y,a,b;const S=(0,p.getCurrentTransform)(R),P=S[0]===0&&S[3]===0||S[1]===0&&S[2]===0,F=P?A.slice(0):null;for(let U=0,W=0,X=l.length;U<X;U++)switch(l[U]|0){case r.OPS.rectangle:O=u[W++],T=u[W++];const nt=u[W++],q=u[W++],Y=O+nt,$=T+q;R.moveTo(O,T),nt===0||q===0?R.lineTo(Y,$):(R.lineTo(Y,T),R.lineTo(Y,$),R.lineTo(O,$)),P||M.updateRectMinMax(S,[O,T,Y,$]),R.closePath();break;case r.OPS.moveTo:O=u[W++],T=u[W++],R.moveTo(O,T),P||M.updatePathMinMax(S,O,T);break;case r.OPS.lineTo:O=u[W++],T=u[W++],R.lineTo(O,T),P||M.updatePathMinMax(S,O,T);break;case r.OPS.curveTo:a=O,b=T,O=u[W+4],T=u[W+5],R.bezierCurveTo(u[W],u[W+1],u[W+2],u[W+3],O,T),M.updateCurvePathMinMax(S,a,b,u[W],u[W+1],u[W+2],u[W+3],O,T,F),W+=6;break;case r.OPS.curveTo2:a=O,b=T,R.bezierCurveTo(O,T,u[W],u[W+1],u[W+2],u[W+3]),M.updateCurvePathMinMax(S,a,b,O,T,u[W],u[W+1],u[W+2],u[W+3],F),O=u[W+2],T=u[W+3],W+=4;break;case r.OPS.curveTo3:a=O,b=T,O=u[W+2],T=u[W+3],R.bezierCurveTo(u[W],u[W+1],O,T,O,T),M.updateCurvePathMinMax(S,a,b,u[W],u[W+1],O,T,O,T,F),W+=4;break;case r.OPS.closePath:R.closePath();break}P&&M.updateScalingPathMinMax(S,F),M.setCurrentPoint(O,T)}closePath(){this.ctx.closePath()}stroke(l=!0){const u=this.ctx,A=this.current.strokeColor;u.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof A=="object"&&A?.getPattern?(u.save(),u.strokeStyle=A.getPattern(u,this,(0,p.getCurrentTransformInverse)(u),C.PathType.STROKE),this.rescaleAndStroke(!1),u.restore()):this.rescaleAndStroke(!0)),l&&this.consumePath(this.current.getClippedPathBoundingBox()),u.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(l=!0){const u=this.ctx,A=this.current.fillColor,R=this.current.patternFill;let M=!1;R&&(u.save(),u.fillStyle=A.getPattern(u,this,(0,p.getCurrentTransformInverse)(u),C.PathType.FILL),M=!0);const O=this.current.getClippedPathBoundingBox();this.contentVisible&&O!==null&&(this.pendingEOFill?(u.fill("evenodd"),this.pendingEOFill=!1):u.fill()),M&&u.restore(),l&&this.consumePath(O)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=st}eoClip(){this.pendingClip=K}beginText(){this.current.textMatrix=r.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const l=this.pendingTextPaths,u=this.ctx;if(l===void 0){u.beginPath();return}u.save(),u.beginPath();for(const A of l)u.setTransform(...A.transform),u.translate(A.x,A.y),A.addToPath(u,A.fontSize);u.restore(),u.clip(),u.beginPath(),delete this.pendingTextPaths}setCharSpacing(l){this.current.charSpacing=l}setWordSpacing(l){this.current.wordSpacing=l}setHScale(l){this.current.textHScale=l/100}setLeading(l){this.current.leading=-l}setFont(l,u){const A=this.commonObjs.get(l),R=this.current;if(!A)throw new Error(`Can't find font for ${l}`);if(R.fontMatrix=A.fontMatrix||r.FONT_IDENTITY_MATRIX,(R.fontMatrix[0]===0||R.fontMatrix[3]===0)&&(0,r.warn)("Invalid font matrix for font "+l),u<0?(u=-u,R.fontDirection=-1):R.fontDirection=1,this.current.font=A,this.current.fontSize=u,A.isType3Font)return;const M=A.loadedName||"sans-serif",O=A.systemFontInfo?.css||`"${M}", ${A.fallbackName}`;let T="normal";A.black?T="900":A.bold&&(T="bold");const a=A.italic?"italic":"normal";let b=u;u<L?b=L:u>I&&(b=I),this.current.fontSizeScale=u/b,this.ctx.font=`${a} ${T} ${b}px ${O}`}setTextRenderingMode(l){this.current.textRenderingMode=l}setTextRise(l){this.current.textRise=l}moveText(l,u){this.current.x=this.current.lineX+=l,this.current.y=this.current.lineY+=u}setLeadingMoveText(l,u){this.setLeading(-u),this.moveText(l,u)}setTextMatrix(l,u,A,R,M,O){this.current.textMatrix=[l,u,A,R,M,O],this.current.textMatrixScale=Math.hypot(l,u),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(l,u,A,R){const M=this.ctx,O=this.current,T=O.font,a=O.textRenderingMode,b=O.fontSize/O.fontSizeScale,S=a&r.TextRenderingMode.FILL_STROKE_MASK,P=!!(a&r.TextRenderingMode.ADD_TO_PATH_FLAG),F=O.patternFill&&!T.missingFile;let U;(T.disableFontFace||P||F)&&(U=T.getPathGenerator(this.commonObjs,l)),T.disableFontFace||F?(M.save(),M.translate(u,A),M.beginPath(),U(M,b),R&&M.setTransform(...R),(S===r.TextRenderingMode.FILL||S===r.TextRenderingMode.FILL_STROKE)&&M.fill(),(S===r.TextRenderingMode.STROKE||S===r.TextRenderingMode.FILL_STROKE)&&M.stroke(),M.restore()):((S===r.TextRenderingMode.FILL||S===r.TextRenderingMode.FILL_STROKE)&&M.fillText(l,u,A),(S===r.TextRenderingMode.STROKE||S===r.TextRenderingMode.FILL_STROKE)&&M.strokeText(l,u,A)),P&&(this.pendingTextPaths||=[]).push({transform:(0,p.getCurrentTransform)(M),x:u,y:A,fontSize:b,addToPath:U})}get isFontSubpixelAAEnabled(){const{context:l}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);l.scale(1.5,1),l.fillText("I",0,10);const u=l.getImageData(0,0,10,10).data;let A=!1;for(let R=3;R<u.length;R+=4)if(u[R]>0&&u[R]<255){A=!0;break}return(0,r.shadow)(this,"isFontSubpixelAAEnabled",A)}showText(l){const u=this.current,A=u.font;if(A.isType3Font)return this.showType3Text(l);const R=u.fontSize;if(R===0)return;const M=this.ctx,O=u.fontSizeScale,T=u.charSpacing,a=u.wordSpacing,b=u.fontDirection,S=u.textHScale*b,P=l.length,F=A.vertical,U=F?1:-1,W=A.defaultVMetrics,X=R*u.fontMatrix[0],nt=u.textRenderingMode===r.TextRenderingMode.FILL&&!A.disableFontFace&&!u.patternFill;M.save(),M.transform(...u.textMatrix),M.translate(u.x,u.y+u.textRise),b>0?M.scale(S,-1):M.scale(S,1);let q;if(u.patternFill){M.save();const rt=u.fillColor.getPattern(M,this,(0,p.getCurrentTransformInverse)(M),C.PathType.FILL);q=(0,p.getCurrentTransform)(M),M.restore(),M.fillStyle=rt}let Y=u.lineWidth;const $=u.textMatrixScale;if($===0||Y===0){const rt=u.textRenderingMode&r.TextRenderingMode.FILL_STROKE_MASK;(rt===r.TextRenderingMode.STROKE||rt===r.TextRenderingMode.FILL_STROKE)&&(Y=this.getSinglePixelWidth())}else Y/=$;if(O!==1&&(M.scale(O,O),Y/=O),M.lineWidth=Y,A.isInvalidPDFjsFont){const rt=[];let ot=0;for(const lt of l)rt.push(lt.unicode),ot+=lt.width;M.fillText(rt.join(""),0,0),u.x+=ot*X*S,M.restore(),this.compose();return}let J=0,tt;for(tt=0;tt<P;++tt){const rt=l[tt];if(typeof rt=="number"){J+=U*rt*R/1e3;continue}let ot=!1;const lt=(rt.isSpace?a:0)+T,ct=rt.fontChar,ht=rt.accent;let ut,At,mt=rt.width;if(F){const bt=rt.vmetric||W,vt=-(rt.vmetric?bt[1]:mt*.5)*X,It=bt[2]*X;mt=bt?-bt[0]:mt,ut=vt/O,At=(J+It)/O}else ut=J/O,At=0;if(A.remeasure&&mt>0){const bt=M.measureText(ct).width*1e3/R*O;if(mt<bt&&this.isFontSubpixelAAEnabled){const vt=mt/bt;ot=!0,M.save(),M.scale(vt,1),ut/=vt}else mt!==bt&&(ut+=(mt-bt)/2e3*R/O)}if(this.contentVisible&&(rt.isInFont||A.missingFile)){if(nt&&!ht)M.fillText(ct,ut,At);else if(this.paintChar(ct,ut,At,q),ht){const bt=ut+R*ht.offset.x/O,vt=At-R*ht.offset.y/O;this.paintChar(ht.fontChar,bt,vt,q)}}const Et=F?mt*X-lt*b:mt*X+lt*b;J+=Et,ot&&M.restore()}F?u.y-=J:u.x+=J*S,M.restore(),this.compose()}showType3Text(l){const u=this.ctx,A=this.current,R=A.font,M=A.fontSize,O=A.fontDirection,T=R.vertical?1:-1,a=A.charSpacing,b=A.wordSpacing,S=A.textHScale*O,P=A.fontMatrix||r.FONT_IDENTITY_MATRIX,F=l.length,U=A.textRenderingMode===r.TextRenderingMode.INVISIBLE;let W,X,nt,q;if(!(U||M===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,u.save(),u.transform(...A.textMatrix),u.translate(A.x,A.y),u.scale(S,O),W=0;W<F;++W){if(X=l[W],typeof X=="number"){q=T*X*M/1e3,this.ctx.translate(q,0),A.x+=q*S;continue}const Y=(X.isSpace?b:0)+a,$=R.charProcOperatorList[X.operatorListId];if(!$){(0,r.warn)(`Type3 character "${X.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=X,this.save(),u.scale(M,M),u.transform(...P),this.executeOperatorList($),this.restore()),nt=r.Util.applyTransform([X.width,0],P)[0]*M+Y,u.translate(nt,0),A.x+=nt*S}u.restore(),this.processingType3=null}}setCharWidth(l,u){}setCharWidthAndBounds(l,u,A,R,M,O){this.ctx.rect(A,R,M-A,O-R),this.ctx.clip(),this.endPath()}getColorN_Pattern(l){let u;if(l[0]==="TilingPattern"){const A=l[1],R=this.baseTransform||(0,p.getCurrentTransform)(this.ctx),M={createCanvasGraphics:O=>new D(O,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};u=new C.TilingPattern(l,A,this.ctx,M,R)}else u=this._getPattern(l[1],l[2]);return u}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(l,u,A){const R=r.Util.makeHexColor(l,u,A);this.ctx.strokeStyle=R,this.current.strokeColor=R}setFillRGBColor(l,u,A){const R=r.Util.makeHexColor(l,u,A);this.ctx.fillStyle=R,this.current.fillColor=R,this.current.patternFill=!1}_getPattern(l,u=null){let A;return this.cachedPatterns.has(l)?A=this.cachedPatterns.get(l):(A=(0,C.getShadingPattern)(this.getObject(l)),this.cachedPatterns.set(l,A)),u&&(A.matrix=u),A}shadingFill(l){if(!this.contentVisible)return;const u=this.ctx;this.save();const A=this._getPattern(l);u.fillStyle=A.getPattern(u,this,(0,p.getCurrentTransformInverse)(u),C.PathType.SHADING);const R=(0,p.getCurrentTransformInverse)(u);if(R){const{width:M,height:O}=u.canvas,[T,a,b,S]=r.Util.getAxialAlignedBoundingBox([0,0,M,O],R);this.ctx.fillRect(T,a,b-T,S-a)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,r.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,r.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(l,u){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(l)&&l.length===6&&this.transform(...l),this.baseTransform=(0,p.getCurrentTransform)(this.ctx),u)){const A=u[2]-u[0],R=u[3]-u[1];this.ctx.rect(u[0],u[1],A,R),this.current.updateRectMinMax((0,p.getCurrentTransform)(this.ctx),u),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(l){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const u=this.ctx;l.isolated||(0,r.info)("TODO: Support non-isolated groups."),l.knockout&&(0,r.warn)("Knockout groups not supported.");const A=(0,p.getCurrentTransform)(u);if(l.matrix&&u.transform(...l.matrix),!l.bbox)throw new Error("Bounding box is required.");let R=r.Util.getAxialAlignedBoundingBox(l.bbox,(0,p.getCurrentTransform)(u));const M=[0,0,u.canvas.width,u.canvas.height];R=r.Util.intersect(R,M)||[0,0,0,0];const O=Math.floor(R[0]),T=Math.floor(R[1]);let a=Math.max(Math.ceil(R[2])-O,1),b=Math.max(Math.ceil(R[3])-T,1),S=1,P=1;a>n&&(S=a/n,a=n),b>n&&(P=b/n,b=n),this.current.startNewPathAndClipBox([0,0,a,b]);let F="groupAt"+this.groupLevel;l.smask&&(F+="_smask_"+this.smaskCounter++%2);const U=this.cachedCanvases.getCanvas(F,a,b),W=U.context;W.scale(1/S,1/P),W.translate(-O,-T),W.transform(...A),l.smask?this.smaskStack.push({canvas:U.canvas,context:W,offsetX:O,offsetY:T,scaleX:S,scaleY:P,subtype:l.smask.subtype,backdrop:l.smask.backdrop,transferMap:l.smask.transferMap||null,startTransformInverse:null}):(u.setTransform(1,0,0,1,0,0),u.translate(O,T),u.scale(S,P),u.save()),f(u,W),this.ctx=W,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(u),this.groupLevel++}endGroup(l){if(!this.contentVisible)return;this.groupLevel--;const u=this.ctx,A=this.groupStack.pop();if(this.ctx=A,this.ctx.imageSmoothingEnabled=!1,l.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const R=(0,p.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...R);const M=r.Util.getAxialAlignedBoundingBox([0,0,u.canvas.width,u.canvas.height],R);this.ctx.drawImage(u.canvas,0,0),this.ctx.restore(),this.compose(M)}}beginAnnotation(l,u,A,R,M){if(this.#t(),x(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(u)&&u.length===4){const O=u[2]-u[0],T=u[3]-u[1];if(M&&this.annotationCanvasMap){A=A.slice(),A[4]-=u[0],A[5]-=u[1],u=u.slice(),u[0]=u[1]=0,u[2]=O,u[3]=T;const[a,b]=r.Util.singularValueDecompose2dScale((0,p.getCurrentTransform)(this.ctx)),{viewportScale:S}=this,P=Math.ceil(O*this.outputScaleX*S),F=Math.ceil(T*this.outputScaleY*S);this.annotationCanvas=this.canvasFactory.create(P,F);const{canvas:U,context:W}=this.annotationCanvas;this.annotationCanvasMap.set(l,U),this.annotationCanvas.savedCtx=this.ctx,this.ctx=W,this.ctx.save(),this.ctx.setTransform(a,0,0,-b,0,T*b),x(this.ctx)}else x(this.ctx),this.ctx.rect(u[0],u[1],O,T),this.ctx.clip(),this.endPath()}this.current=new v(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...A),this.transform(...R)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(l){if(!this.contentVisible)return;const u=l.count;l=this.getObject(l.data,l),l.count=u;const A=this.ctx,R=this.processingType3;if(R&&(R.compiled===void 0&&(R.compiled=o(l)),R.compiled)){R.compiled(A);return}const M=this._createMaskCanvas(l),O=M.canvas;A.save(),A.setTransform(1,0,0,1,0,0),A.drawImage(O,M.offsetX,M.offsetY),A.restore(),this.compose()}paintImageMaskXObjectRepeat(l,u,A=0,R=0,M,O){if(!this.contentVisible)return;l=this.getObject(l.data,l);const T=this.ctx;T.save();const a=(0,p.getCurrentTransform)(T);T.transform(u,A,R,M,0,0);const b=this._createMaskCanvas(l);T.setTransform(1,0,0,1,b.offsetX-a[4],b.offsetY-a[5]);for(let S=0,P=O.length;S<P;S+=2){const F=r.Util.transform(a,[u,A,R,M,O[S],O[S+1]]),[U,W]=r.Util.applyTransform([0,0],F);T.drawImage(b.canvas,U,W)}T.restore(),this.compose()}paintImageMaskXObjectGroup(l){if(!this.contentVisible)return;const u=this.ctx,A=this.current.fillColor,R=this.current.patternFill;for(const M of l){const{data:O,width:T,height:a,transform:b}=M,S=this.cachedCanvases.getCanvas("maskCanvas",T,a),P=S.context;P.save();const F=this.getObject(O,M);E(P,F),P.globalCompositeOperation="source-in",P.fillStyle=R?A.getPattern(P,this,(0,p.getCurrentTransformInverse)(u),C.PathType.FILL):A,P.fillRect(0,0,T,a),P.restore(),u.save(),u.transform(...b),u.scale(1,-1),g(u,S.canvas,0,0,T,a,0,-1,1,1),u.restore()}this.compose()}paintImageXObject(l){if(!this.contentVisible)return;const u=this.getObject(l);if(!u){(0,r.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(u)}paintImageXObjectRepeat(l,u,A,R){if(!this.contentVisible)return;const M=this.getObject(l);if(!M){(0,r.warn)("Dependent image isn't ready yet");return}const O=M.width,T=M.height,a=[];for(let b=0,S=R.length;b<S;b+=2)a.push({transform:[u,0,0,A,R[b],R[b+1]],x:0,y:0,w:O,h:T});this.paintInlineImageXObjectGroup(M,a)}applyTransferMapsToCanvas(l){return this.current.transferMaps!=="none"&&(l.filter=this.current.transferMaps,l.drawImage(l.canvas,0,0),l.filter="none"),l.canvas}applyTransferMapsToBitmap(l){if(this.current.transferMaps==="none")return l.bitmap;const{bitmap:u,width:A,height:R}=l,M=this.cachedCanvases.getCanvas("inlineImage",A,R),O=M.context;return O.filter=this.current.transferMaps,O.drawImage(u,0,0),O.filter="none",M.canvas}paintInlineImageXObject(l){if(!this.contentVisible)return;const u=l.width,A=l.height,R=this.ctx;if(this.save(),!r.isNodeJS){const{filter:T}=R;T!=="none"&&T!==""&&(R.filter="none")}R.scale(1/u,-1/A);let M;if(l.bitmap)M=this.applyTransferMapsToBitmap(l);else if(typeof HTMLElement=="function"&&l instanceof HTMLElement||!l.data)M=l;else{const a=this.cachedCanvases.getCanvas("inlineImage",u,A).context;k(a,l),M=this.applyTransferMapsToCanvas(a)}const O=this._scaleImage(M,(0,p.getCurrentTransformInverse)(R));R.imageSmoothingEnabled=it((0,p.getCurrentTransform)(R),l.interpolate),g(R,O.img,0,0,O.paintWidth,O.paintHeight,0,-A,u,A),this.compose(),this.restore()}paintInlineImageXObjectGroup(l,u){if(!this.contentVisible)return;const A=this.ctx;let R;if(l.bitmap)R=l.bitmap;else{const M=l.width,O=l.height,a=this.cachedCanvases.getCanvas("inlineImage",M,O).context;k(a,l),R=this.applyTransferMapsToCanvas(a)}for(const M of u)A.save(),A.transform(...M.transform),A.scale(1,-1),g(A,R,M.x,M.y,M.w,M.h,0,-1,1,1),A.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(l){}markPointProps(l,u){}beginMarkedContent(l){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(l,u){l==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(u)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(l){const u=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(l);const A=this.ctx;this.pendingClip&&(u||(this.pendingClip===K?A.clip("evenodd"):A.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),A.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const l=(0,p.getCurrentTransform)(this.ctx);if(l[1]===0&&l[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(l[0]),Math.abs(l[3]));else{const u=Math.abs(l[0]*l[3]-l[2]*l[1]),A=Math.hypot(l[0],l[2]),R=Math.hypot(l[1],l[3]);this._cachedGetSinglePixelWidth=Math.max(A,R)/u}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:l}=this.current,{a:u,b:A,c:R,d:M}=this.ctx.getTransform();let O,T;if(A===0&&R===0){const a=Math.abs(u),b=Math.abs(M);if(a===b)if(l===0)O=T=1/a;else{const S=a*l;O=T=S<1?1/S:1}else if(l===0)O=1/a,T=1/b;else{const S=a*l,P=b*l;O=S<1?1/S:1,T=P<1?1/P:1}}else{const a=Math.abs(u*M-A*R),b=Math.hypot(u,A),S=Math.hypot(R,M);if(l===0)O=S/a,T=b/a;else{const P=l*a;O=S>P?S/P:1,T=b>P?b/P:1}}this._cachedScaleForStroking[0]=O,this._cachedScaleForStroking[1]=T}return this._cachedScaleForStroking}rescaleAndStroke(l){const{ctx:u}=this,{lineWidth:A}=this.current,[R,M]=this.getScaleForStroking();if(u.lineWidth=A||1,R===1&&M===1){u.stroke();return}const O=u.getLineDash();if(l&&u.save(),u.scale(R,M),O.length>0){const T=Math.max(R,M);u.setLineDash(O.map(a=>a/T)),u.lineDashOffset/=T}u.stroke(),l&&u.restore()}isContentVisible(){for(let l=this.markedContentStack.length-1;l>=0;l--)if(!this.markedContentStack[l].visible)return!1;return!0}}i.CanvasGraphics=D;for(const m in r.OPS)D.prototype[m]!==void 0&&(D.prototype[r.OPS[m]]=D.prototype[m])}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TilingPattern=i.PathType=void 0,i.getShadingPattern=c;var r=_(1),p=_(6);const C={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};i.PathType=C;function w(g,o){if(!o)return;const v=o[2]-o[0],k=o[3]-o[1],E=new Path2D;E.rect(o[0],o[1],v,k),g.clip(E)}class L{constructor(){this.constructor===L&&(0,r.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,r.unreachable)("Abstract method `getPattern` called.")}}class I extends L{constructor(o){super(),this._type=o[1],this._bbox=o[2],this._colorStops=o[3],this._p0=o[4],this._p1=o[5],this._r0=o[6],this._r1=o[7],this.matrix=null}_createGradient(o){let v;this._type==="axial"?v=o.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(v=o.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const k of this._colorStops)v.addColorStop(k[0],k[1]);return v}getPattern(o,v,k,E){let f;if(E===C.STROKE||E===C.FILL){const x=v.current.getClippedPathBoundingBox(E,(0,p.getCurrentTransform)(o))||[0,0,0,0],j=Math.ceil(x[2]-x[0])||1,B=Math.ceil(x[3]-x[1])||1,N=v.cachedCanvases.getCanvas("pattern",j,B,!0),z=N.context;z.clearRect(0,0,z.canvas.width,z.canvas.height),z.beginPath(),z.rect(0,0,z.canvas.width,z.canvas.height),z.translate(-x[0],-x[1]),k=r.Util.transform(k,[1,0,0,1,x[0],x[1]]),z.transform(...v.baseTransform),this.matrix&&z.transform(...this.matrix),w(z,this._bbox),z.fillStyle=this._createGradient(z),z.fill(),f=o.createPattern(N.canvas,"no-repeat");const H=new DOMMatrix(k);f.setTransform(H)}else w(o,this._bbox),f=this._createGradient(o);return f}}function n(g,o,v,k,E,f,x,j){const B=o.coords,N=o.colors,z=g.data,H=g.width*4;let it;B[v+1]>B[k+1]&&(it=v,v=k,k=it,it=f,f=x,x=it),B[k+1]>B[E+1]&&(it=k,k=E,E=it,it=x,x=j,j=it),B[v+1]>B[k+1]&&(it=v,v=k,k=it,it=f,f=x,x=it);const Z=(B[v]+o.offsetX)*o.scaleX,Q=(B[v+1]+o.offsetY)*o.scaleY,st=(B[k]+o.offsetX)*o.scaleX,K=(B[k+1]+o.offsetY)*o.scaleY,D=(B[E]+o.offsetX)*o.scaleX,m=(B[E+1]+o.offsetY)*o.scaleY;if(Q>=m)return;const l=N[f],u=N[f+1],A=N[f+2],R=N[x],M=N[x+1],O=N[x+2],T=N[j],a=N[j+1],b=N[j+2],S=Math.round(Q),P=Math.round(m);let F,U,W,X,nt,q,Y,$;for(let J=S;J<=P;J++){if(J<K){const ct=J<Q?0:(Q-J)/(Q-K);F=Z-(Z-st)*ct,U=l-(l-R)*ct,W=u-(u-M)*ct,X=A-(A-O)*ct}else{let ct;J>m?ct=1:K===m?ct=0:ct=(K-J)/(K-m),F=st-(st-D)*ct,U=R-(R-T)*ct,W=M-(M-a)*ct,X=O-(O-b)*ct}let tt;J<Q?tt=0:J>m?tt=1:tt=(Q-J)/(Q-m),nt=Z-(Z-D)*tt,q=l-(l-T)*tt,Y=u-(u-a)*tt,$=A-(A-b)*tt;const rt=Math.round(Math.min(F,nt)),ot=Math.round(Math.max(F,nt));let lt=H*J+rt*4;for(let ct=rt;ct<=ot;ct++)tt=(F-ct)/(F-nt),tt<0?tt=0:tt>1&&(tt=1),z[lt++]=U-(U-q)*tt|0,z[lt++]=W-(W-Y)*tt|0,z[lt++]=X-(X-$)*tt|0,z[lt++]=255}}function t(g,o,v){const k=o.coords,E=o.colors;let f,x;switch(o.type){case"lattice":const j=o.verticesPerRow,B=Math.floor(k.length/j)-1,N=j-1;for(f=0;f<B;f++){let z=f*j;for(let H=0;H<N;H++,z++)n(g,v,k[z],k[z+1],k[z+j],E[z],E[z+1],E[z+j]),n(g,v,k[z+j+1],k[z+1],k[z+j],E[z+j+1],E[z+1],E[z+j])}break;case"triangles":for(f=0,x=k.length;f<x;f+=3)n(g,v,k[f],k[f+1],k[f+2],E[f],E[f+1],E[f+2]);break;default:throw new Error("illegal figure")}}class s extends L{constructor(o){super(),this._coords=o[2],this._colors=o[3],this._figures=o[4],this._bounds=o[5],this._bbox=o[7],this._background=o[8],this.matrix=null}_createMeshCanvas(o,v,k){const j=Math.floor(this._bounds[0]),B=Math.floor(this._bounds[1]),N=Math.ceil(this._bounds[2])-j,z=Math.ceil(this._bounds[3])-B,H=Math.min(Math.ceil(Math.abs(N*o[0]*1.1)),3e3),it=Math.min(Math.ceil(Math.abs(z*o[1]*1.1)),3e3),Z=N/H,Q=z/it,st={coords:this._coords,colors:this._colors,offsetX:-j,offsetY:-B,scaleX:1/Z,scaleY:1/Q},K=H+4,D=it+4,m=k.getCanvas("mesh",K,D,!1),l=m.context,u=l.createImageData(H,it);if(v){const R=u.data;for(let M=0,O=R.length;M<O;M+=4)R[M]=v[0],R[M+1]=v[1],R[M+2]=v[2],R[M+3]=255}for(const R of this._figures)t(u,R,st);return l.putImageData(u,2,2),{canvas:m.canvas,offsetX:j-2*Z,offsetY:B-2*Q,scaleX:Z,scaleY:Q}}getPattern(o,v,k,E){w(o,this._bbox);let f;if(E===C.SHADING)f=r.Util.singularValueDecompose2dScale((0,p.getCurrentTransform)(o));else if(f=r.Util.singularValueDecompose2dScale(v.baseTransform),this.matrix){const j=r.Util.singularValueDecompose2dScale(this.matrix);f=[f[0]*j[0],f[1]*j[1]]}const x=this._createMeshCanvas(f,E===C.SHADING?null:this._background,v.cachedCanvases);return E!==C.SHADING&&(o.setTransform(...v.baseTransform),this.matrix&&o.transform(...this.matrix)),o.translate(x.offsetX,x.offsetY),o.scale(x.scaleX,x.scaleY),o.createPattern(x.canvas,"no-repeat")}}class h extends L{getPattern(){return"hotpink"}}function c(g){switch(g[0]){case"RadialAxial":return new I(g);case"Mesh":return new s(g);case"Dummy":return new h}throw new Error(`Unknown IR type: ${g[0]}`)}const e={COLORED:1,UNCOLORED:2};class d{static MAX_PATTERN_SIZE=3e3;constructor(o,v,k,E,f){this.operatorList=o[2],this.matrix=o[3]||[1,0,0,1,0,0],this.bbox=o[4],this.xstep=o[5],this.ystep=o[6],this.paintType=o[7],this.tilingType=o[8],this.color=v,this.ctx=k,this.canvasGraphicsFactory=E,this.baseTransform=f}createPatternCanvas(o){const v=this.operatorList,k=this.bbox,E=this.xstep,f=this.ystep,x=this.paintType,j=this.tilingType,B=this.color,N=this.canvasGraphicsFactory;(0,r.info)("TilingType: "+j);const z=k[0],H=k[1],it=k[2],Z=k[3],Q=r.Util.singularValueDecompose2dScale(this.matrix),st=r.Util.singularValueDecompose2dScale(this.baseTransform),K=[Q[0]*st[0],Q[1]*st[1]],D=this.getSizeAndScale(E,this.ctx.canvas.width,K[0]),m=this.getSizeAndScale(f,this.ctx.canvas.height,K[1]),l=o.cachedCanvases.getCanvas("pattern",D.size,m.size,!0),u=l.context,A=N.createCanvasGraphics(u);A.groupLevel=o.groupLevel,this.setFillAndStrokeStyleToContext(A,x,B);let R=z,M=H,O=it,T=Z;return z<0&&(R=0,O+=Math.abs(z)),H<0&&(M=0,T+=Math.abs(H)),u.translate(-(D.scale*R),-(m.scale*M)),A.transform(D.scale,0,0,m.scale,0,0),u.save(),this.clipBbox(A,R,M,O,T),A.baseTransform=(0,p.getCurrentTransform)(A.ctx),A.executeOperatorList(v),A.endDrawing(),{canvas:l.canvas,scaleX:D.scale,scaleY:m.scale,offsetX:R,offsetY:M}}getSizeAndScale(o,v,k){o=Math.abs(o);const E=Math.max(d.MAX_PATTERN_SIZE,v);let f=Math.ceil(o*k);return f>=E?f=E:k=f/o,{scale:k,size:f}}clipBbox(o,v,k,E,f){const x=E-v,j=f-k;o.ctx.rect(v,k,x,j),o.current.updateRectMinMax((0,p.getCurrentTransform)(o.ctx),[v,k,E,f]),o.clip(),o.endPath()}setFillAndStrokeStyleToContext(o,v,k){const E=o.ctx,f=o.current;switch(v){case e.COLORED:const x=this.ctx;E.fillStyle=x.fillStyle,E.strokeStyle=x.strokeStyle,f.fillColor=x.fillStyle,f.strokeColor=x.strokeStyle;break;case e.UNCOLORED:const j=r.Util.makeHexColor(k[0],k[1],k[2]);E.fillStyle=j,E.strokeStyle=j,f.fillColor=j,f.strokeColor=j;break;default:throw new r.FormatError(`Unsupported paint type: ${v}`)}}getPattern(o,v,k,E){let f=k;E!==C.SHADING&&(f=r.Util.transform(f,v.baseTransform),this.matrix&&(f=r.Util.transform(f,this.matrix)));const x=this.createPatternCanvas(v);let j=new DOMMatrix(f);j=j.translate(x.offsetX,x.offsetY),j=j.scale(1/x.scaleX,1/x.scaleY);const B=o.createPattern(x.canvas,"repeat");return B.setTransform(j),B}}i.TilingPattern=d}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.convertBlackAndWhiteToRGBA=C,i.convertToRGBA=p,i.grayToRGBA=L;var r=_(1);function p(I){switch(I.kind){case r.ImageKind.GRAYSCALE_1BPP:return C(I);case r.ImageKind.RGB_24BPP:return w(I)}return null}function C({src:I,srcPos:n=0,dest:t,width:s,height:h,nonBlackColor:c=4294967295,inverseDecode:e=!1}){const d=r.FeatureTest.isLittleEndian?4278190080:255,[g,o]=e?[c,d]:[d,c],v=s>>3,k=s&7,E=I.length;t=new Uint32Array(t.buffer);let f=0;for(let x=0;x<h;x++){for(const B=n+v;n<B;n++){const N=n<E?I[n]:255;t[f++]=N&128?o:g,t[f++]=N&64?o:g,t[f++]=N&32?o:g,t[f++]=N&16?o:g,t[f++]=N&8?o:g,t[f++]=N&4?o:g,t[f++]=N&2?o:g,t[f++]=N&1?o:g}if(k===0)continue;const j=n<E?I[n++]:255;for(let B=0;B<k;B++)t[f++]=j&1<<7-B?o:g}return{srcPos:n,destPos:f}}function w({src:I,srcPos:n=0,dest:t,destPos:s=0,width:h,height:c}){let e=0;const d=I.length>>2,g=new Uint32Array(I.buffer,n,d);if(r.FeatureTest.isLittleEndian){for(;e<d-2;e+=3,s+=4){const o=g[e],v=g[e+1],k=g[e+2];t[s]=o|4278190080,t[s+1]=o>>>24|v<<8|4278190080,t[s+2]=v>>>16|k<<16|4278190080,t[s+3]=k>>>8|4278190080}for(let o=e*4,v=I.length;o<v;o+=3)t[s++]=I[o]|I[o+1]<<8|I[o+2]<<16|4278190080}else{for(;e<d-2;e+=3,s+=4){const o=g[e],v=g[e+1],k=g[e+2];t[s]=o|255,t[s+1]=o<<24|v>>>8|255,t[s+2]=v<<16|k>>>16|255,t[s+3]=k<<8|255}for(let o=e*4,v=I.length;o<v;o+=3)t[s++]=I[o]<<24|I[o+1]<<16|I[o+2]<<8|255}return{srcPos:n,destPos:s}}function L(I,n){if(r.FeatureTest.isLittleEndian)for(let t=0,s=I.length;t<s;t++)n[t]=I[t]*65793|4278190080;else for(let t=0,s=I.length;t<s;t++)n[t]=I[t]*16843008|255}}),((y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.GlobalWorkerOptions=void 0;const _=Object.create(null);i.GlobalWorkerOptions=_,_.workerPort=null,_.workerSrc=""}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.MessageHandler=void 0;var r=_(1);const p={DATA:1,ERROR:2},C={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function w(I){switch(I instanceof Error||typeof I=="object"&&I!==null||(0,r.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),I.name){case"AbortException":return new r.AbortException(I.message);case"MissingPDFException":return new r.MissingPDFException(I.message);case"PasswordException":return new r.PasswordException(I.message,I.code);case"UnexpectedResponseException":return new r.UnexpectedResponseException(I.message,I.status);case"UnknownErrorException":return new r.UnknownErrorException(I.message,I.details);default:return new r.UnknownErrorException(I.message,I.toString())}}class L{constructor(n,t,s){this.sourceName=n,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=h=>{const c=h.data;if(c.targetName!==this.sourceName)return;if(c.stream){this.#e(c);return}if(c.callback){const d=c.callbackId,g=this.callbackCapabilities[d];if(!g)throw new Error(`Cannot resolve callback ${d}`);if(delete this.callbackCapabilities[d],c.callback===p.DATA)g.resolve(c.data);else if(c.callback===p.ERROR)g.reject(w(c.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[c.action];if(!e)throw new Error(`Unknown action from worker: ${c.action}`);if(c.callbackId){const d=this.sourceName,g=c.sourceName;new Promise(function(o){o(e(c.data))}).then(function(o){s.postMessage({sourceName:d,targetName:g,callback:p.DATA,callbackId:c.callbackId,data:o})},function(o){s.postMessage({sourceName:d,targetName:g,callback:p.ERROR,callbackId:c.callbackId,reason:w(o)})});return}if(c.streamId){this.#t(c);return}e(c.data)},s.addEventListener("message",this._onComObjOnMessage)}on(n,t){const s=this.actionHandler;if(s[n])throw new Error(`There is already an actionName called "${n}"`);s[n]=t}send(n,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:n,data:t},s)}sendWithPromise(n,t,s){const h=this.callbackId++,c=new r.PromiseCapability;this.callbackCapabilities[h]=c;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:n,callbackId:h,data:t},s)}catch(e){c.reject(e)}return c.promise}sendWithStream(n,t,s,h){const c=this.streamId++,e=this.sourceName,d=this.targetName,g=this.comObj;return new ReadableStream({start:o=>{const v=new r.PromiseCapability;return this.streamControllers[c]={controller:o,startCall:v,pullCall:null,cancelCall:null,isClosed:!1},g.postMessage({sourceName:e,targetName:d,action:n,streamId:c,data:t,desiredSize:o.desiredSize},h),v.promise},pull:o=>{const v=new r.PromiseCapability;return this.streamControllers[c].pullCall=v,g.postMessage({sourceName:e,targetName:d,stream:C.PULL,streamId:c,desiredSize:o.desiredSize}),v.promise},cancel:o=>{(0,r.assert)(o instanceof Error,"cancel must have a valid reason");const v=new r.PromiseCapability;return this.streamControllers[c].cancelCall=v,this.streamControllers[c].isClosed=!0,g.postMessage({sourceName:e,targetName:d,stream:C.CANCEL,streamId:c,reason:w(o)}),v.promise}},s)}#t(n){const t=n.streamId,s=this.sourceName,h=n.sourceName,c=this.comObj,e=this,d=this.actionHandler[n.action],g={enqueue(o,v=1,k){if(this.isCancelled)return;const E=this.desiredSize;this.desiredSize-=v,E>0&&this.desiredSize<=0&&(this.sinkCapability=new r.PromiseCapability,this.ready=this.sinkCapability.promise),c.postMessage({sourceName:s,targetName:h,stream:C.ENQUEUE,streamId:t,chunk:o},k)},close(){this.isCancelled||(this.isCancelled=!0,c.postMessage({sourceName:s,targetName:h,stream:C.CLOSE,streamId:t}),delete e.streamSinks[t])},error(o){(0,r.assert)(o instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,c.postMessage({sourceName:s,targetName:h,stream:C.ERROR,streamId:t,reason:w(o)}))},sinkCapability:new r.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:n.desiredSize,ready:null};g.sinkCapability.resolve(),g.ready=g.sinkCapability.promise,this.streamSinks[t]=g,new Promise(function(o){o(d(n.data,g))}).then(function(){c.postMessage({sourceName:s,targetName:h,stream:C.START_COMPLETE,streamId:t,success:!0})},function(o){c.postMessage({sourceName:s,targetName:h,stream:C.START_COMPLETE,streamId:t,reason:w(o)})})}#e(n){const t=n.streamId,s=this.sourceName,h=n.sourceName,c=this.comObj,e=this.streamControllers[t],d=this.streamSinks[t];switch(n.stream){case C.START_COMPLETE:n.success?e.startCall.resolve():e.startCall.reject(w(n.reason));break;case C.PULL_COMPLETE:n.success?e.pullCall.resolve():e.pullCall.reject(w(n.reason));break;case C.PULL:if(!d){c.postMessage({sourceName:s,targetName:h,stream:C.PULL_COMPLETE,streamId:t,success:!0});break}d.desiredSize<=0&&n.desiredSize>0&&d.sinkCapability.resolve(),d.desiredSize=n.desiredSize,new Promise(function(g){g(d.onPull?.())}).then(function(){c.postMessage({sourceName:s,targetName:h,stream:C.PULL_COMPLETE,streamId:t,success:!0})},function(g){c.postMessage({sourceName:s,targetName:h,stream:C.PULL_COMPLETE,streamId:t,reason:w(g)})});break;case C.ENQUEUE:if((0,r.assert)(e,"enqueue should have stream controller"),e.isClosed)break;e.controller.enqueue(n.chunk);break;case C.CLOSE:if((0,r.assert)(e,"close should have stream controller"),e.isClosed)break;e.isClosed=!0,e.controller.close(),this.#i(e,t);break;case C.ERROR:(0,r.assert)(e,"error should have stream controller"),e.controller.error(w(n.reason)),this.#i(e,t);break;case C.CANCEL_COMPLETE:n.success?e.cancelCall.resolve():e.cancelCall.reject(w(n.reason)),this.#i(e,t);break;case C.CANCEL:if(!d)break;new Promise(function(g){g(d.onCancel?.(w(n.reason)))}).then(function(){c.postMessage({sourceName:s,targetName:h,stream:C.CANCEL_COMPLETE,streamId:t,success:!0})},function(g){c.postMessage({sourceName:s,targetName:h,stream:C.CANCEL_COMPLETE,streamId:t,reason:w(g)})}),d.sinkCapability.reject(w(n.reason)),d.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#i(n,t){await Promise.allSettled([n.startCall?.promise,n.pullCall?.promise,n.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}i.MessageHandler=L}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Metadata=void 0;var r=_(1);class p{#t;#e;constructor({parsedData:w,rawData:L}){this.#t=w,this.#e=L}getRaw(){return this.#e}get(w){return this.#t.get(w)??null}getAll(){return(0,r.objectFromMap)(this.#t)}has(w){return this.#t.has(w)}}i.Metadata=p}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.OptionalContentConfig=void 0;var r=_(1),p=_(8);const C=Symbol("INTERNAL");class w{#t=!0;constructor(n,t){this.name=n,this.intent=t}get visible(){return this.#t}_setVisible(n,t){n!==C&&(0,r.unreachable)("Internal method `_setVisible` called."),this.#t=t}}class L{#t=null;#e=new Map;#i=null;#s=null;constructor(n){if(this.name=null,this.creator=null,n!==null){this.name=n.name,this.creator=n.creator,this.#s=n.order;for(const t of n.groups)this.#e.set(t.id,new w(t.name,t.intent));if(n.baseState==="OFF")for(const t of this.#e.values())t._setVisible(C,!1);for(const t of n.on)this.#e.get(t)._setVisible(C,!0);for(const t of n.off)this.#e.get(t)._setVisible(C,!1);this.#i=this.getHash()}}#o(n){const t=n.length;if(t<2)return!0;const s=n[0];for(let h=1;h<t;h++){const c=n[h];let e;if(Array.isArray(c))e=this.#o(c);else if(this.#e.has(c))e=this.#e.get(c).visible;else return(0,r.warn)(`Optional content group not found: ${c}`),!0;switch(s){case"And":if(!e)return!1;break;case"Or":if(e)return!0;break;case"Not":return!e;default:return!0}}return s==="And"}isVisible(n){if(this.#e.size===0)return!0;if(!n)return(0,r.warn)("Optional content group not defined."),!0;if(n.type==="OCG")return this.#e.has(n.id)?this.#e.get(n.id).visible:((0,r.warn)(`Optional content group not found: ${n.id}`),!0);if(n.type==="OCMD"){if(n.expression)return this.#o(n.expression);if(!n.policy||n.policy==="AnyOn"){for(const t of n.ids){if(!this.#e.has(t))return(0,r.warn)(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!0}return!1}else if(n.policy==="AllOn"){for(const t of n.ids){if(!this.#e.has(t))return(0,r.warn)(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!1}return!0}else if(n.policy==="AnyOff"){for(const t of n.ids){if(!this.#e.has(t))return(0,r.warn)(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!0}return!1}else if(n.policy==="AllOff"){for(const t of n.ids){if(!this.#e.has(t))return(0,r.warn)(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!1}return!0}return(0,r.warn)(`Unknown optional content policy ${n.policy}.`),!0}return(0,r.warn)(`Unknown group type ${n.type}.`),!0}setVisibility(n,t=!0){if(!this.#e.has(n)){(0,r.warn)(`Optional content group not found: ${n}`);return}this.#e.get(n)._setVisible(C,!!t),this.#t=null}get hasInitialVisibility(){return this.#i===null||this.getHash()===this.#i}getOrder(){return this.#e.size?this.#s?this.#s.slice():[...this.#e.keys()]:null}getGroups(){return this.#e.size>0?(0,r.objectFromMap)(this.#e):null}getGroup(n){return this.#e.get(n)||null}getHash(){if(this.#t!==null)return this.#t;const n=new p.MurmurHash3_64;for(const[t,s]of this.#e)n.update(`${t}:${s.visible}`);return this.#t=n.hexdigest()}}i.OptionalContentConfig=L}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.PDFDataTransportStream=void 0;var r=_(1),p=_(6);class C{constructor({length:n,initialData:t,progressiveDone:s=!1,contentDispositionFilename:h=null,disableRange:c=!1,disableStream:e=!1},d){if((0,r.assert)(d,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=s,this._contentDispositionFilename=h,t?.length>0){const g=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;this._queuedChunks.push(g)}this._pdfDataRangeTransport=d,this._isStreamingSupported=!e,this._isRangeSupported=!c,this._contentLength=n,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((g,o)=>{this._onReceiveData({begin:g,chunk:o})}),this._pdfDataRangeTransport.addProgressListener((g,o)=>{this._onProgress({loaded:g,total:o})}),this._pdfDataRangeTransport.addProgressiveReadListener(g=>{this._onReceiveData({chunk:g})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:n,chunk:t}){const s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(n===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const h=this._rangeReaders.some(function(c){return c._begin!==n?!1:(c._enqueue(s),!0)});(0,r.assert)(h,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(n){n.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:n.loaded}):this._fullRequestReader?.onProgress?.({loaded:n.loaded,total:n.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(n){const t=this._rangeReaders.indexOf(n);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){(0,r.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const n=this._queuedChunks;return this._queuedChunks=null,new w(this,n,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(n,t){if(t<=this._progressiveDataLength)return null;const s=new L(this,n,t);return this._pdfDataRangeTransport.requestDataRange(n,t),this._rangeReaders.push(s),s}cancelAllRequests(n){this._fullRequestReader?.cancel(n);for(const t of this._rangeReaders.slice(0))t.cancel(n);this._pdfDataRangeTransport.abort()}}i.PDFDataTransportStream=C;class w{constructor(n,t,s=!1,h=null){this._stream=n,this._done=s||!1,this._filename=(0,p.isPdfFile)(h)?h:null,this._queuedChunks=t||[],this._loaded=0;for(const c of this._queuedChunks)this._loaded+=c.byteLength;this._requests=[],this._headersReady=Promise.resolve(),n._fullRequestReader=this,this.onProgress=null}_enqueue(n){this._done||(this._requests.length>0?this._requests.shift().resolve({value:n,done:!1}):this._queuedChunks.push(n),this._loaded+=n.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const n=new r.PromiseCapability;return this._requests.push(n),n.promise}cancel(n){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class L{constructor(n,t,s){this._stream=n,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(n){if(!this._done){if(this._requests.length===0)this._queuedChunk=n;else{this._requests.shift().resolve({value:n,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const n=new r.PromiseCapability;return this._requests.push(n),n.promise}cancel(n){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.PDFFetchStream=void 0;var r=_(1),p=_(20);function C(s,h,c){return{method:"GET",headers:s,signal:c.signal,mode:"cors",credentials:h?"include":"same-origin",redirect:"follow"}}function w(s){const h=new Headers;for(const c in s){const e=s[c];e!==void 0&&h.append(c,e)}return h}function L(s){return s instanceof Uint8Array?s.buffer:s instanceof ArrayBuffer?s:((0,r.warn)(`getArrayBuffer - unexpected data format: ${s}`),new Uint8Array(s).buffer)}class I{constructor(h){this.source=h,this.isHttp=/^https?:/i.test(h.url),this.httpHeaders=this.isHttp&&h.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new n(this),this._fullRequestReader}getRangeReader(h,c){if(c<=this._progressiveDataLength)return null;const e=new t(this,h,c);return this._rangeRequestReaders.push(e),e}cancelAllRequests(h){this._fullRequestReader?.cancel(h);for(const c of this._rangeRequestReaders.slice(0))c.cancel(h)}}i.PDFFetchStream=I;class n{constructor(h){this._stream=h,this._reader=null,this._loaded=0,this._filename=null;const c=h.source;this._withCredentials=c.withCredentials||!1,this._contentLength=c.length,this._headersCapability=new r.PromiseCapability,this._disableRange=c.disableRange||!1,this._rangeChunkSize=c.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!c.disableStream,this._isRangeSupported=!c.disableRange,this._headers=w(this._stream.httpHeaders);const e=c.url;fetch(e,C(this._headers,this._withCredentials,this._abortController)).then(d=>{if(!(0,p.validateResponseStatus)(d.status))throw(0,p.createResponseStatusError)(d.status,e);this._reader=d.body.getReader(),this._headersCapability.resolve();const g=k=>d.headers.get(k),{allowRangeRequests:o,suggestedLength:v}=(0,p.validateRangeRequestCapabilities)({getResponseHeader:g,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=v||this._contentLength,this._filename=(0,p.extractFilenameFromHeader)(g),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new r.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:h,done:c}=await this._reader.read();return c?{value:h,done:c}:(this._loaded+=h.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:L(h),done:!1})}cancel(h){this._reader?.cancel(h),this._abortController.abort()}}class t{constructor(h,c,e){this._stream=h,this._reader=null,this._loaded=0;const d=h.source;this._withCredentials=d.withCredentials||!1,this._readCapability=new r.PromiseCapability,this._isStreamingSupported=!d.disableStream,this._abortController=new AbortController,this._headers=w(this._stream.httpHeaders),this._headers.append("Range",`bytes=${c}-${e-1}`);const g=d.url;fetch(g,C(this._headers,this._withCredentials,this._abortController)).then(o=>{if(!(0,p.validateResponseStatus)(o.status))throw(0,p.createResponseStatusError)(o.status,g);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:h,done:c}=await this._reader.read();return c?{value:h,done:c}:(this._loaded+=h.byteLength,this.onProgress?.({loaded:this._loaded}),{value:L(h),done:!1})}cancel(h){this._reader?.cancel(h),this._abortController.abort()}}}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.createResponseStatusError=I,i.extractFilenameFromHeader=L,i.validateRangeRequestCapabilities=w,i.validateResponseStatus=n;var r=_(1),p=_(21),C=_(6);function w({getResponseHeader:t,isHttp:s,rangeChunkSize:h,disableRange:c}){const e={allowRangeRequests:!1,suggestedLength:void 0},d=parseInt(t("Content-Length"),10);return!Number.isInteger(d)||(e.suggestedLength=d,d<=2*h)||c||!s||t("Accept-Ranges")!=="bytes"||(t("Content-Encoding")||"identity")!=="identity"||(e.allowRangeRequests=!0),e}function L(t){const s=t("Content-Disposition");if(s){let h=(0,p.getFilenameFromContentDispositionHeader)(s);if(h.includes("%"))try{h=decodeURIComponent(h)}catch{}if((0,C.isPdfFile)(h))return h}return null}function I(t,s){return t===404||t===0&&s.startsWith("file:")?new r.MissingPDFException('Missing PDF "'+s+'".'):new r.UnexpectedResponseException(`Unexpected server response (${t}) while retrieving PDF "${s}".`,t)}function n(t){return t===200||t===206}}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.getFilenameFromContentDispositionHeader=p;var r=_(1);function p(C){let w=!0,L=I("filename\\*","i").exec(C);if(L){L=L[1];let d=h(L);return d=unescape(d),d=c(d),d=e(d),t(d)}if(L=s(C),L){const d=e(L);return t(d)}if(L=I("filename","i").exec(C),L){L=L[1];let d=h(L);return d=e(d),t(d)}function I(d,g){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',g)}function n(d,g){if(d){if(!/^[\x00-\xFF]+$/.test(g))return g;try{const o=new TextDecoder(d,{fatal:!0}),v=(0,r.stringToBytes)(g);g=o.decode(v),w=!1}catch{}}return g}function t(d){return w&&/[\x80-\xff]/.test(d)&&(d=n("utf-8",d),w&&(d=n("iso-8859-1",d))),d}function s(d){const g=[];let o;const v=I("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(o=v.exec(d))!==null;){let[,E,f,x]=o;if(E=parseInt(E,10),E in g){if(E===0)break;continue}g[E]=[f,x]}const k=[];for(let E=0;E<g.length&&E in g;++E){let[f,x]=g[E];x=h(x),f&&(x=unescape(x),E===0&&(x=c(x))),k.push(x)}return k.join("")}function h(d){if(d.startsWith('"')){const g=d.slice(1).split('\\"');for(let o=0;o<g.length;++o){const v=g[o].indexOf('"');v!==-1&&(g[o]=g[o].slice(0,v),g.length=o+1),g[o]=g[o].replaceAll(/\\(.)/g,"$1")}d=g.join('"')}return d}function c(d){const g=d.indexOf("'");if(g===-1)return d;const o=d.slice(0,g),k=d.slice(g+1).replace(/^[^']*'/,"");return n(o,k)}function e(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(g,o,v,k){if(v==="q"||v==="Q")return k=k.replaceAll("_"," "),k=k.replaceAll(/=([0-9a-fA-F]{2})/g,function(E,f){return String.fromCharCode(parseInt(f,16))}),n(o,k);try{k=atob(k)}catch{}return n(o,k)})}return""}}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.PDFNetworkStream=void 0;var r=_(1),p=_(20);const C=200,w=206;function L(h){const c=h.response;return typeof c!="string"?c:(0,r.stringToBytes)(c).buffer}class I{constructor(c,e={}){this.url=c,this.isHttp=/^https?:/i.test(c),this.httpHeaders=this.isHttp&&e.httpHeaders||Object.create(null),this.withCredentials=e.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(c,e,d){const g={begin:c,end:e};for(const o in d)g[o]=d[o];return this.request(g)}requestFull(c){return this.request(c)}request(c){const e=new XMLHttpRequest,d=this.currXhrId++,g=this.pendingRequests[d]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const o in this.httpHeaders){const v=this.httpHeaders[o];v!==void 0&&e.setRequestHeader(o,v)}return this.isHttp&&"begin"in c&&"end"in c?(e.setRequestHeader("Range",`bytes=${c.begin}-${c.end-1}`),g.expectedStatus=w):g.expectedStatus=C,e.responseType="arraybuffer",c.onError&&(e.onerror=function(o){c.onError(e.status)}),e.onreadystatechange=this.onStateChange.bind(this,d),e.onprogress=this.onProgress.bind(this,d),g.onHeadersReceived=c.onHeadersReceived,g.onDone=c.onDone,g.onError=c.onError,g.onProgress=c.onProgress,e.send(null),d}onProgress(c,e){const d=this.pendingRequests[c];d&&d.onProgress?.(e)}onStateChange(c,e){const d=this.pendingRequests[c];if(!d)return;const g=d.xhr;if(g.readyState>=2&&d.onHeadersReceived&&(d.onHeadersReceived(),delete d.onHeadersReceived),g.readyState!==4||!(c in this.pendingRequests))return;if(delete this.pendingRequests[c],g.status===0&&this.isHttp){d.onError?.(g.status);return}const o=g.status||C;if(!(o===C&&d.expectedStatus===w)&&o!==d.expectedStatus){d.onError?.(g.status);return}const k=L(g);if(o===w){const E=g.getResponseHeader("Content-Range"),f=/bytes (\d+)-(\d+)\/(\d+)/.exec(E);d.onDone({begin:parseInt(f[1],10),chunk:k})}else k?d.onDone({begin:0,chunk:k}):d.onError?.(g.status)}getRequestXhr(c){return this.pendingRequests[c].xhr}isPendingRequest(c){return c in this.pendingRequests}abortRequest(c){const e=this.pendingRequests[c].xhr;delete this.pendingRequests[c],e.abort()}}class n{constructor(c){this._source=c,this._manager=new I(c.url,{httpHeaders:c.httpHeaders,withCredentials:c.withCredentials}),this._rangeChunkSize=c.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(c){const e=this._rangeRequestReaders.indexOf(c);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new t(this._manager,this._source),this._fullRequestReader}getRangeReader(c,e){const d=new s(this._manager,c,e);return d.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(d),d}cancelAllRequests(c){this._fullRequestReader?.cancel(c);for(const e of this._rangeRequestReaders.slice(0))e.cancel(c)}}i.PDFNetworkStream=n;class t{constructor(c,e){this._manager=c;const d={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._fullRequestId=c.requestFull(d),this._headersReceivedCapability=new r.PromiseCapability,this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const c=this._fullRequestId,e=this._manager.getRequestXhr(c),d=v=>e.getResponseHeader(v),{allowRangeRequests:g,suggestedLength:o}=(0,p.validateRangeRequestCapabilities)({getResponseHeader:d,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});g&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=(0,p.extractFilenameFromHeader)(d),this._isRangeSupported&&this._manager.abortRequest(c),this._headersReceivedCapability.resolve()}_onDone(c){if(c&&(this._requests.length>0?this._requests.shift().resolve({value:c.chunk,done:!1}):this._cachedChunks.push(c.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(c){this._storedError=(0,p.createResponseStatusError)(c,this._url),this._headersReceivedCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(c){this.onProgress?.({loaded:c.loaded,total:c.lengthComputable?c.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const c=new r.PromiseCapability;return this._requests.push(c),c.promise}cancel(c){this._done=!0,this._headersReceivedCapability.reject(c);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class s{constructor(c,e,d){this._manager=c;const g={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=c.url,this._requestId=c.requestRange(e,d,g),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(c){const e=c.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(c){this._storedError=(0,p.createResponseStatusError)(c,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(c){this.isStreamingSupported||this.onProgress?.({loaded:c.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const c=new r.PromiseCapability;return this._requests.push(c),c.promise}cancel(c){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.PDFNodeStream=void 0;var r=_(1),p=_(20);const C=/^file:\/\/\/[a-zA-Z]:\//;function w(d){const g=require$$5,o=g.parse(d);return o.protocol==="file:"||o.host?o:/^[a-z]:[/\\]/i.test(d)?g.parse(`file:///${d}`):(o.host||(o.protocol="file:"),o)}class L{constructor(g){this.source=g,this.url=w(g.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&g.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new c(this):new s(this),this._fullRequestReader}getRangeReader(g,o){if(o<=this._progressiveDataLength)return null;const v=this.isFsUrl?new e(this,g,o):new h(this,g,o);return this._rangeRequestReaders.push(v),v}cancelAllRequests(g){this._fullRequestReader?.cancel(g);for(const o of this._rangeRequestReaders.slice(0))o.cancel(g)}}i.PDFNodeStream=L;class I{constructor(g){this._url=g.url,this._done=!1,this._storedError=null,this.onProgress=null;const o=g.source;this._contentLength=o.length,this._loaded=0,this._filename=null,this._disableRange=o.disableRange||!1,this._rangeChunkSize=o.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!o.disableStream,this._isRangeSupported=!o.disableRange,this._readableStream=null,this._readCapability=new r.PromiseCapability,this._headersCapability=new r.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const g=this._readableStream.read();return g===null?(this._readCapability=new r.PromiseCapability,this.read()):(this._loaded+=g.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(g).buffer,done:!1})}cancel(g){if(!this._readableStream){this._error(g);return}this._readableStream.destroy(g)}_error(g){this._storedError=g,this._readCapability.resolve()}_setReadableStream(g){this._readableStream=g,g.on("readable",()=>{this._readCapability.resolve()}),g.on("end",()=>{g.destroy(),this._done=!0,this._readCapability.resolve()}),g.on("error",o=>{this._error(o)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new r.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class n{constructor(g){this._url=g.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new r.PromiseCapability;const o=g.source;this._isStreamingSupported=!o.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const g=this._readableStream.read();return g===null?(this._readCapability=new r.PromiseCapability,this.read()):(this._loaded+=g.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(g).buffer,done:!1})}cancel(g){if(!this._readableStream){this._error(g);return}this._readableStream.destroy(g)}_error(g){this._storedError=g,this._readCapability.resolve()}_setReadableStream(g){this._readableStream=g,g.on("readable",()=>{this._readCapability.resolve()}),g.on("end",()=>{g.destroy(),this._done=!0,this._readCapability.resolve()}),g.on("error",o=>{this._error(o)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function t(d,g){return{protocol:d.protocol,auth:d.auth,host:d.hostname,port:d.port,path:d.path,method:"GET",headers:g}}class s extends I{constructor(g){super(g);const o=v=>{if(v.statusCode===404){const x=new r.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=x,this._headersCapability.reject(x);return}this._headersCapability.resolve(),this._setReadableStream(v);const k=x=>this._readableStream.headers[x.toLowerCase()],{allowRangeRequests:E,suggestedLength:f}=(0,p.validateRangeRequestCapabilities)({getResponseHeader:k,isHttp:g.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=E,this._contentLength=f||this._contentLength,this._filename=(0,p.extractFilenameFromHeader)(k)};if(this._request=null,this._url.protocol==="http:"){const v=require$$5;this._request=v.request(t(this._url,g.httpHeaders),o)}else{const v=require$$5;this._request=v.request(t(this._url,g.httpHeaders),o)}this._request.on("error",v=>{this._storedError=v,this._headersCapability.reject(v)}),this._request.end()}}class h extends n{constructor(g,o,v){super(g),this._httpHeaders={};for(const E in g.httpHeaders){const f=g.httpHeaders[E];f!==void 0&&(this._httpHeaders[E]=f)}this._httpHeaders.Range=`bytes=${o}-${v-1}`;const k=E=>{if(E.statusCode===404){const f=new r.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=f;return}this._setReadableStream(E)};if(this._request=null,this._url.protocol==="http:"){const E=require$$5;this._request=E.request(t(this._url,this._httpHeaders),k)}else{const E=require$$5;this._request=E.request(t(this._url,this._httpHeaders),k)}this._request.on("error",E=>{this._storedError=E}),this._request.end()}}class c extends I{constructor(g){super(g);let o=decodeURIComponent(this._url.path);C.test(this._url.href)&&(o=o.replace(/^\//,""));const v=require$$5;v.lstat(o,(k,E)=>{if(k){k.code==="ENOENT"&&(k=new r.MissingPDFException(`Missing PDF "${o}".`)),this._storedError=k,this._headersCapability.reject(k);return}this._contentLength=E.size,this._setReadableStream(v.createReadStream(o)),this._headersCapability.resolve()})}}class e extends n{constructor(g,o,v){super(g);let k=decodeURIComponent(this._url.path);C.test(this._url.href)&&(k=k.replace(/^\//,""));const E=require$$5;this._setReadableStream(E.createReadStream(k,{start:o,end:v-1}))}}}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.SVGGraphics=void 0;var r=_(6),p=_(1);const C={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},w="http://www.w3.org/XML/1998/namespace",L="http://www.w3.org/1999/xlink",I=["butt","round","square"],n=["miter","round","bevel"],t=function(E,f="",x=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!x)return URL.createObjectURL(new Blob([E],{type:f}));const j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let B=`data:${f};base64,`;for(let N=0,z=E.length;N<z;N+=3){const H=E[N]&255,it=E[N+1]&255,Z=E[N+2]&255,Q=H>>2,st=(H&3)<<4|it>>4,K=N+1<z?(it&15)<<2|Z>>6:64,D=N+2<z?Z&63:64;B+=j[Q]+j[st]+j[K]+j[D]}return B},s=(function(){const E=new Uint8Array([137,80,78,71,13,10,26,10]),f=12,x=new Int32Array(256);for(let Z=0;Z<256;Z++){let Q=Z;for(let st=0;st<8;st++)Q=Q&1?3988292384^Q>>1&2147483647:Q>>1&2147483647;x[Z]=Q}function j(Z,Q,st){let K=-1;for(let D=Q;D<st;D++){const m=(K^Z[D])&255,l=x[m];K=K>>>8^l}return K^-1}function B(Z,Q,st,K){let D=K;const m=Q.length;st[D]=m>>24&255,st[D+1]=m>>16&255,st[D+2]=m>>8&255,st[D+3]=m&255,D+=4,st[D]=Z.charCodeAt(0)&255,st[D+1]=Z.charCodeAt(1)&255,st[D+2]=Z.charCodeAt(2)&255,st[D+3]=Z.charCodeAt(3)&255,D+=4,st.set(Q,D),D+=Q.length;const l=j(st,K+4,D);st[D]=l>>24&255,st[D+1]=l>>16&255,st[D+2]=l>>8&255,st[D+3]=l&255}function N(Z,Q,st){let K=1,D=0;for(let m=Q;m<st;++m)K=(K+(Z[m]&255))%65521,D=(D+K)%65521;return D<<16|K}function z(Z){if(!p.isNodeJS)return H(Z);try{const Q=parseInt(process.versions.node)>=8?Z:Buffer.from(Z),st=require$$5.deflateSync(Q,{level:9});return st instanceof Uint8Array?st:new Uint8Array(st)}catch(Q){(0,p.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+Q)}return H(Z)}function H(Z){let Q=Z.length;const st=65535,K=Math.ceil(Q/st),D=new Uint8Array(2+Q+K*5+4);let m=0;D[m++]=120,D[m++]=156;let l=0;for(;Q>st;)D[m++]=0,D[m++]=255,D[m++]=255,D[m++]=0,D[m++]=0,D.set(Z.subarray(l,l+st),m),m+=st,l+=st,Q-=st;D[m++]=1,D[m++]=Q&255,D[m++]=Q>>8&255,D[m++]=~Q&65535&255,D[m++]=(~Q&65535)>>8&255,D.set(Z.subarray(l),m),m+=Z.length-l;const u=N(Z,0,Z.length);return D[m++]=u>>24&255,D[m++]=u>>16&255,D[m++]=u>>8&255,D[m++]=u&255,D}function it(Z,Q,st,K){const D=Z.width,m=Z.height;let l,u,A;const R=Z.data;switch(Q){case p.ImageKind.GRAYSCALE_1BPP:u=0,l=1,A=D+7>>3;break;case p.ImageKind.RGB_24BPP:u=2,l=8,A=D*3;break;case p.ImageKind.RGBA_32BPP:u=6,l=8,A=D*4;break;default:throw new Error("invalid format")}const M=new Uint8Array((1+A)*m);let O=0,T=0;for(let U=0;U<m;++U)M[O++]=0,M.set(R.subarray(T,T+A),O),T+=A,O+=A;if(Q===p.ImageKind.GRAYSCALE_1BPP&&K){O=0;for(let U=0;U<m;U++){O++;for(let W=0;W<A;W++)M[O++]^=255}}const a=new Uint8Array([D>>24&255,D>>16&255,D>>8&255,D&255,m>>24&255,m>>16&255,m>>8&255,m&255,l,u,0,0,0]),b=z(M),S=E.length+f*3+a.length+b.length,P=new Uint8Array(S);let F=0;return P.set(E,F),F+=E.length,B("IHDR",a,P,F),F+=f+a.length,B("IDATA",b,P,F),F+=f+b.length,B("IEND",new Uint8Array(0),P,F),t(P,"image/png",st)}return function(Q,st,K){const D=Q.kind===void 0?p.ImageKind.GRAYSCALE_1BPP:Q.kind;return it(Q,D,st,K)}})();class h{constructor(){this.fontSizeScale=1,this.fontWeight=C.fontWeight,this.fontSize=0,this.textMatrix=p.IDENTITY_MATRIX,this.fontMatrix=p.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=p.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=C.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(f,x){this.x=f,this.y=x}}function c(E){let f=[];const x=[];for(const j of E){if(j.fn==="save"){f.push({fnId:92,fn:"group",items:[]}),x.push(f),f=f.at(-1).items;continue}j.fn==="restore"?f=x.pop():f.push(j)}return f}function e(E){if(Number.isInteger(E))return E.toString();const f=E.toFixed(10);let x=f.length-1;if(f[x]!=="0")return f;do x--;while(f[x]==="0");return f.substring(0,f[x]==="."?x:x+1)}function d(E){if(E[4]===0&&E[5]===0){if(E[1]===0&&E[2]===0)return E[0]===1&&E[3]===1?"":`scale(${e(E[0])} ${e(E[3])})`;if(E[0]===E[3]&&E[1]===-E[2]){const f=Math.acos(E[0])*180/Math.PI;return`rotate(${e(f)})`}}else if(E[0]===1&&E[1]===0&&E[2]===0&&E[3]===1)return`translate(${e(E[4])} ${e(E[5])})`;return`matrix(${e(E[0])} ${e(E[1])} ${e(E[2])} ${e(E[3])} ${e(E[4])} ${e(E[5])})`}let g=0,o=0,v=0;class k{constructor(f,x,j=!1){(0,r.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new r.DOMSVGFactory,this.current=new h,this.transformMatrix=p.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=f,this.objs=x,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!j,this._operatorIdMapping=[];for(const B in p.OPS)this._operatorIdMapping[p.OPS[B]]=B}getObject(f,x=null){return typeof f=="string"?f.startsWith("g_")?this.commonObjs.get(f):this.objs.get(f):x}save(){this.transformStack.push(this.transformMatrix);const f=this.current;this.extraStack.push(f),this.current=f.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(f){this.save(),this.executeOpTree(f),this.restore()}loadDependencies(f){const x=f.fnArray,j=f.argsArray;for(let B=0,N=x.length;B<N;B++)if(x[B]===p.OPS.dependency)for(const z of j[B]){const H=z.startsWith("g_")?this.commonObjs:this.objs,it=new Promise(Z=>{H.get(z,Z)});this.current.dependencies.push(it)}return Promise.all(this.current.dependencies)}transform(f,x,j,B,N,z){const H=[f,x,j,B,N,z];this.transformMatrix=p.Util.transform(this.transformMatrix,H),this.tgrp=null}getSVG(f,x){this.viewport=x;const j=this._initialize(x);return this.loadDependencies(f).then(()=>(this.transformMatrix=p.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(f)),j))}convertOpList(f){const x=this._operatorIdMapping,j=f.argsArray,B=f.fnArray,N=[];for(let z=0,H=B.length;z<H;z++){const it=B[z];N.push({fnId:it,fn:x[it],args:j[z]})}return c(N)}executeOpTree(f){for(const x of f){const j=x.fn,B=x.fnId,N=x.args;switch(B|0){case p.OPS.beginText:this.beginText();break;case p.OPS.dependency:break;case p.OPS.setLeading:this.setLeading(N);break;case p.OPS.setLeadingMoveText:this.setLeadingMoveText(N[0],N[1]);break;case p.OPS.setFont:this.setFont(N);break;case p.OPS.showText:this.showText(N[0]);break;case p.OPS.showSpacedText:this.showText(N[0]);break;case p.OPS.endText:this.endText();break;case p.OPS.moveText:this.moveText(N[0],N[1]);break;case p.OPS.setCharSpacing:this.setCharSpacing(N[0]);break;case p.OPS.setWordSpacing:this.setWordSpacing(N[0]);break;case p.OPS.setHScale:this.setHScale(N[0]);break;case p.OPS.setTextMatrix:this.setTextMatrix(N[0],N[1],N[2],N[3],N[4],N[5]);break;case p.OPS.setTextRise:this.setTextRise(N[0]);break;case p.OPS.setTextRenderingMode:this.setTextRenderingMode(N[0]);break;case p.OPS.setLineWidth:this.setLineWidth(N[0]);break;case p.OPS.setLineJoin:this.setLineJoin(N[0]);break;case p.OPS.setLineCap:this.setLineCap(N[0]);break;case p.OPS.setMiterLimit:this.setMiterLimit(N[0]);break;case p.OPS.setFillRGBColor:this.setFillRGBColor(N[0],N[1],N[2]);break;case p.OPS.setStrokeRGBColor:this.setStrokeRGBColor(N[0],N[1],N[2]);break;case p.OPS.setStrokeColorN:this.setStrokeColorN(N);break;case p.OPS.setFillColorN:this.setFillColorN(N);break;case p.OPS.shadingFill:this.shadingFill(N[0]);break;case p.OPS.setDash:this.setDash(N[0],N[1]);break;case p.OPS.setRenderingIntent:this.setRenderingIntent(N[0]);break;case p.OPS.setFlatness:this.setFlatness(N[0]);break;case p.OPS.setGState:this.setGState(N[0]);break;case p.OPS.fill:this.fill();break;case p.OPS.eoFill:this.eoFill();break;case p.OPS.stroke:this.stroke();break;case p.OPS.fillStroke:this.fillStroke();break;case p.OPS.eoFillStroke:this.eoFillStroke();break;case p.OPS.clip:this.clip("nonzero");break;case p.OPS.eoClip:this.clip("evenodd");break;case p.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case p.OPS.paintImageXObject:this.paintImageXObject(N[0]);break;case p.OPS.paintInlineImageXObject:this.paintInlineImageXObject(N[0]);break;case p.OPS.paintImageMaskXObject:this.paintImageMaskXObject(N[0]);break;case p.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(N[0],N[1]);break;case p.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case p.OPS.closePath:this.closePath();break;case p.OPS.closeStroke:this.closeStroke();break;case p.OPS.closeFillStroke:this.closeFillStroke();break;case p.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case p.OPS.nextLine:this.nextLine();break;case p.OPS.transform:this.transform(N[0],N[1],N[2],N[3],N[4],N[5]);break;case p.OPS.constructPath:this.constructPath(N[0],N[1]);break;case p.OPS.endPath:this.endPath();break;case 92:this.group(x.items);break;default:(0,p.warn)(`Unimplemented operator ${j}`);break}}}setWordSpacing(f){this.current.wordSpacing=f}setCharSpacing(f){this.current.charSpacing=f}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(f,x,j,B,N,z){const H=this.current;H.textMatrix=H.lineMatrix=[f,x,j,B,N,z],H.textMatrixScale=Math.hypot(f,x),H.x=H.lineX=0,H.y=H.lineY=0,H.xcoords=[],H.ycoords=[],H.tspan=this.svgFactory.createElement("svg:tspan"),H.tspan.setAttributeNS(null,"font-family",H.fontFamily),H.tspan.setAttributeNS(null,"font-size",`${e(H.fontSize)}px`),H.tspan.setAttributeNS(null,"y",e(-H.y)),H.txtElement=this.svgFactory.createElement("svg:text"),H.txtElement.append(H.tspan)}beginText(){const f=this.current;f.x=f.lineX=0,f.y=f.lineY=0,f.textMatrix=p.IDENTITY_MATRIX,f.lineMatrix=p.IDENTITY_MATRIX,f.textMatrixScale=1,f.tspan=this.svgFactory.createElement("svg:tspan"),f.txtElement=this.svgFactory.createElement("svg:text"),f.txtgrp=this.svgFactory.createElement("svg:g"),f.xcoords=[],f.ycoords=[]}moveText(f,x){const j=this.current;j.x=j.lineX+=f,j.y=j.lineY+=x,j.xcoords=[],j.ycoords=[],j.tspan=this.svgFactory.createElement("svg:tspan"),j.tspan.setAttributeNS(null,"font-family",j.fontFamily),j.tspan.setAttributeNS(null,"font-size",`${e(j.fontSize)}px`),j.tspan.setAttributeNS(null,"y",e(-j.y))}showText(f){const x=this.current,j=x.font,B=x.fontSize;if(B===0)return;const N=x.fontSizeScale,z=x.charSpacing,H=x.wordSpacing,it=x.fontDirection,Z=x.textHScale*it,Q=j.vertical,st=Q?1:-1,K=j.defaultVMetrics,D=B*x.fontMatrix[0];let m=0;for(const A of f){if(A===null){m+=it*H;continue}else if(typeof A=="number"){m+=st*A*B/1e3;continue}const R=(A.isSpace?H:0)+z,M=A.fontChar;let O,T,a=A.width;if(Q){let S;const P=A.vmetric||K;S=A.vmetric?P[1]:a*.5,S=-S*D;const F=P[2]*D;a=P?-P[0]:a,O=S/N,T=(m+F)/N}else O=m/N,T=0;(A.isInFont||j.missingFile)&&(x.xcoords.push(x.x+O),Q&&x.ycoords.push(-x.y+T),x.tspan.textContent+=M);const b=Q?a*D-R*it:a*D+R*it;m+=b}x.tspan.setAttributeNS(null,"x",x.xcoords.map(e).join(" ")),Q?x.tspan.setAttributeNS(null,"y",x.ycoords.map(e).join(" ")):x.tspan.setAttributeNS(null,"y",e(-x.y)),Q?x.y-=m:x.x+=m*Z,x.tspan.setAttributeNS(null,"font-family",x.fontFamily),x.tspan.setAttributeNS(null,"font-size",`${e(x.fontSize)}px`),x.fontStyle!==C.fontStyle&&x.tspan.setAttributeNS(null,"font-style",x.fontStyle),x.fontWeight!==C.fontWeight&&x.tspan.setAttributeNS(null,"font-weight",x.fontWeight);const l=x.textRenderingMode&p.TextRenderingMode.FILL_STROKE_MASK;if(l===p.TextRenderingMode.FILL||l===p.TextRenderingMode.FILL_STROKE?(x.fillColor!==C.fillColor&&x.tspan.setAttributeNS(null,"fill",x.fillColor),x.fillAlpha<1&&x.tspan.setAttributeNS(null,"fill-opacity",x.fillAlpha)):x.textRenderingMode===p.TextRenderingMode.ADD_TO_PATH?x.tspan.setAttributeNS(null,"fill","transparent"):x.tspan.setAttributeNS(null,"fill","none"),l===p.TextRenderingMode.STROKE||l===p.TextRenderingMode.FILL_STROKE){const A=1/(x.textMatrixScale||1);this._setStrokeAttributes(x.tspan,A)}let u=x.textMatrix;x.textRise!==0&&(u=u.slice(),u[5]+=x.textRise),x.txtElement.setAttributeNS(null,"transform",`${d(u)} scale(${e(Z)}, -1)`),x.txtElement.setAttributeNS(w,"xml:space","preserve"),x.txtElement.append(x.tspan),x.txtgrp.append(x.txtElement),this._ensureTransformGroup().append(x.txtElement)}setLeadingMoveText(f,x){this.setLeading(-x),this.moveText(f,x)}addFontStyle(f){if(!f.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const x=t(f.data,f.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${f.loadedName}"; src: url(${x}); }
`}setFont(f){const x=this.current,j=this.commonObjs.get(f[0]);let B=f[1];x.font=j,this.embedFonts&&!j.missingFile&&!this.embeddedFonts[j.loadedName]&&(this.addFontStyle(j),this.embeddedFonts[j.loadedName]=j),x.fontMatrix=j.fontMatrix||p.FONT_IDENTITY_MATRIX;let N="normal";j.black?N="900":j.bold&&(N="bold");const z=j.italic?"italic":"normal";B<0?(B=-B,x.fontDirection=-1):x.fontDirection=1,x.fontSize=B,x.fontFamily=j.loadedName,x.fontWeight=N,x.fontStyle=z,x.tspan=this.svgFactory.createElement("svg:tspan"),x.tspan.setAttributeNS(null,"y",e(-x.y)),x.xcoords=[],x.ycoords=[]}endText(){const f=this.current;f.textRenderingMode&p.TextRenderingMode.ADD_TO_PATH_FLAG&&f.txtElement?.hasChildNodes()&&(f.element=f.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(f){f>0&&(this.current.lineWidth=f)}setLineCap(f){this.current.lineCap=I[f]}setLineJoin(f){this.current.lineJoin=n[f]}setMiterLimit(f){this.current.miterLimit=f}setStrokeAlpha(f){this.current.strokeAlpha=f}setStrokeRGBColor(f,x,j){this.current.strokeColor=p.Util.makeHexColor(f,x,j)}setFillAlpha(f){this.current.fillAlpha=f}setFillRGBColor(f,x,j){this.current.fillColor=p.Util.makeHexColor(f,x,j),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(f){this.current.strokeColor=this._makeColorN_Pattern(f)}setFillColorN(f){this.current.fillColor=this._makeColorN_Pattern(f)}shadingFill(f){const{width:x,height:j}=this.viewport,B=p.Util.inverseTransform(this.transformMatrix),[N,z,H,it]=p.Util.getAxialAlignedBoundingBox([0,0,x,j],B),Z=this.svgFactory.createElement("svg:rect");Z.setAttributeNS(null,"x",N),Z.setAttributeNS(null,"y",z),Z.setAttributeNS(null,"width",H-N),Z.setAttributeNS(null,"height",it-z),Z.setAttributeNS(null,"fill",this._makeShadingPattern(f)),this.current.fillAlpha<1&&Z.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(Z)}_makeColorN_Pattern(f){return f[0]==="TilingPattern"?this._makeTilingPattern(f):this._makeShadingPattern(f)}_makeTilingPattern(f){const x=f[1],j=f[2],B=f[3]||p.IDENTITY_MATRIX,[N,z,H,it]=f[4],Z=f[5],Q=f[6],st=f[7],K=`shading${v++}`,[D,m,l,u]=p.Util.normalizeRect([...p.Util.applyTransform([N,z],B),...p.Util.applyTransform([H,it],B)]),[A,R]=p.Util.singularValueDecompose2dScale(B),M=Z*A,O=Q*R,T=this.svgFactory.createElement("svg:pattern");T.setAttributeNS(null,"id",K),T.setAttributeNS(null,"patternUnits","userSpaceOnUse"),T.setAttributeNS(null,"width",M),T.setAttributeNS(null,"height",O),T.setAttributeNS(null,"x",`${D}`),T.setAttributeNS(null,"y",`${m}`);const a=this.svg,b=this.transformMatrix,S=this.current.fillColor,P=this.current.strokeColor,F=this.svgFactory.create(l-D,u-m);if(this.svg=F,this.transformMatrix=B,st===2){const U=p.Util.makeHexColor(...x);this.current.fillColor=U,this.current.strokeColor=U}return this.executeOpTree(this.convertOpList(j)),this.svg=a,this.transformMatrix=b,this.current.fillColor=S,this.current.strokeColor=P,T.append(F.childNodes[0]),this.defs.append(T),`url(#${K})`}_makeShadingPattern(f){switch(typeof f=="string"&&(f=this.objs.get(f)),f[0]){case"RadialAxial":const x=`shading${v++}`,j=f[3];let B;switch(f[1]){case"axial":const N=f[4],z=f[5];B=this.svgFactory.createElement("svg:linearGradient"),B.setAttributeNS(null,"id",x),B.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),B.setAttributeNS(null,"x1",N[0]),B.setAttributeNS(null,"y1",N[1]),B.setAttributeNS(null,"x2",z[0]),B.setAttributeNS(null,"y2",z[1]);break;case"radial":const H=f[4],it=f[5],Z=f[6],Q=f[7];B=this.svgFactory.createElement("svg:radialGradient"),B.setAttributeNS(null,"id",x),B.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),B.setAttributeNS(null,"cx",it[0]),B.setAttributeNS(null,"cy",it[1]),B.setAttributeNS(null,"r",Q),B.setAttributeNS(null,"fx",H[0]),B.setAttributeNS(null,"fy",H[1]),B.setAttributeNS(null,"fr",Z);break;default:throw new Error(`Unknown RadialAxial type: ${f[1]}`)}for(const N of j){const z=this.svgFactory.createElement("svg:stop");z.setAttributeNS(null,"offset",N[0]),z.setAttributeNS(null,"stop-color",N[1]),B.append(z)}return this.defs.append(B),`url(#${x})`;case"Mesh":return(0,p.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${f[0]}`)}}setDash(f,x){this.current.dashArray=f,this.current.dashPhase=x}constructPath(f,x){const j=this.current;let B=j.x,N=j.y,z=[],H=0;for(const it of f)switch(it|0){case p.OPS.rectangle:B=x[H++],N=x[H++];const Z=x[H++],Q=x[H++],st=B+Z,K=N+Q;z.push("M",e(B),e(N),"L",e(st),e(N),"L",e(st),e(K),"L",e(B),e(K),"Z");break;case p.OPS.moveTo:B=x[H++],N=x[H++],z.push("M",e(B),e(N));break;case p.OPS.lineTo:B=x[H++],N=x[H++],z.push("L",e(B),e(N));break;case p.OPS.curveTo:B=x[H+4],N=x[H+5],z.push("C",e(x[H]),e(x[H+1]),e(x[H+2]),e(x[H+3]),e(B),e(N)),H+=6;break;case p.OPS.curveTo2:z.push("C",e(B),e(N),e(x[H]),e(x[H+1]),e(x[H+2]),e(x[H+3])),B=x[H+2],N=x[H+3],H+=4;break;case p.OPS.curveTo3:B=x[H+2],N=x[H+3],z.push("C",e(x[H]),e(x[H+1]),e(B),e(N),e(B),e(N)),H+=4;break;case p.OPS.closePath:z.push("Z");break}z=z.join(" "),j.path&&f.length>0&&f[0]!==p.OPS.rectangle&&f[0]!==p.OPS.moveTo?z=j.path.getAttributeNS(null,"d")+z:(j.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(j.path)),j.path.setAttributeNS(null,"d",z),j.path.setAttributeNS(null,"fill","none"),j.element=j.path,j.setCurrentPoint(B,N)}endPath(){const f=this.current;if(f.path=null,!this.pendingClip)return;if(!f.element){this.pendingClip=null;return}const x=`clippath${g++}`,j=this.svgFactory.createElement("svg:clipPath");j.setAttributeNS(null,"id",x),j.setAttributeNS(null,"transform",d(this.transformMatrix));const B=f.element.cloneNode(!0);if(this.pendingClip==="evenodd"?B.setAttributeNS(null,"clip-rule","evenodd"):B.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,j.append(B),this.defs.append(j),f.activeClipUrl){f.clipGroup=null;for(const N of this.extraStack)N.clipGroup=null;j.setAttributeNS(null,"clip-path",f.activeClipUrl)}f.activeClipUrl=`url(#${x})`,this.tgrp=null}clip(f){this.pendingClip=f}closePath(){const f=this.current;if(f.path){const x=`${f.path.getAttributeNS(null,"d")}Z`;f.path.setAttributeNS(null,"d",x)}}setLeading(f){this.current.leading=-f}setTextRise(f){this.current.textRise=f}setTextRenderingMode(f){this.current.textRenderingMode=f}setHScale(f){this.current.textHScale=f/100}setRenderingIntent(f){}setFlatness(f){}setGState(f){for(const[x,j]of f)switch(x){case"LW":this.setLineWidth(j);break;case"LC":this.setLineCap(j);break;case"LJ":this.setLineJoin(j);break;case"ML":this.setMiterLimit(j);break;case"D":this.setDash(j[0],j[1]);break;case"RI":this.setRenderingIntent(j);break;case"FL":this.setFlatness(j);break;case"Font":this.setFont(j);break;case"CA":this.setStrokeAlpha(j);break;case"ca":this.setFillAlpha(j);break;default:(0,p.warn)(`Unimplemented graphic state operator ${x}`);break}}fill(){const f=this.current;f.element&&(f.element.setAttributeNS(null,"fill",f.fillColor),f.element.setAttributeNS(null,"fill-opacity",f.fillAlpha),this.endPath())}stroke(){const f=this.current;f.element&&(this._setStrokeAttributes(f.element),f.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(f,x=1){const j=this.current;let B=j.dashArray;x!==1&&B.length>0&&(B=B.map(function(N){return x*N})),f.setAttributeNS(null,"stroke",j.strokeColor),f.setAttributeNS(null,"stroke-opacity",j.strokeAlpha),f.setAttributeNS(null,"stroke-miterlimit",e(j.miterLimit)),f.setAttributeNS(null,"stroke-linecap",j.lineCap),f.setAttributeNS(null,"stroke-linejoin",j.lineJoin),f.setAttributeNS(null,"stroke-width",e(x*j.lineWidth)+"px"),f.setAttributeNS(null,"stroke-dasharray",B.map(e).join(" ")),f.setAttributeNS(null,"stroke-dashoffset",e(x*j.dashPhase)+"px")}eoFill(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const f=this.svgFactory.createElement("svg:rect");f.setAttributeNS(null,"x","0"),f.setAttributeNS(null,"y","0"),f.setAttributeNS(null,"width","1px"),f.setAttributeNS(null,"height","1px"),f.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(f)}paintImageXObject(f){const x=this.getObject(f);if(!x){(0,p.warn)(`Dependent image with object ID ${f} is not ready yet`);return}this.paintInlineImageXObject(x)}paintInlineImageXObject(f,x){const j=f.width,B=f.height,N=s(f,this.forceDataSchema,!!x),z=this.svgFactory.createElement("svg:rect");z.setAttributeNS(null,"x","0"),z.setAttributeNS(null,"y","0"),z.setAttributeNS(null,"width",e(j)),z.setAttributeNS(null,"height",e(B)),this.current.element=z,this.clip("nonzero");const H=this.svgFactory.createElement("svg:image");H.setAttributeNS(L,"xlink:href",N),H.setAttributeNS(null,"x","0"),H.setAttributeNS(null,"y",e(-B)),H.setAttributeNS(null,"width",e(j)+"px"),H.setAttributeNS(null,"height",e(B)+"px"),H.setAttributeNS(null,"transform",`scale(${e(1/j)} ${e(-1/B)})`),x?x.append(H):this._ensureTransformGroup().append(H)}paintImageMaskXObject(f){const x=this.getObject(f.data,f);if(x.bitmap){(0,p.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const j=this.current,B=x.width,N=x.height,z=j.fillColor;j.maskId=`mask${o++}`;const H=this.svgFactory.createElement("svg:mask");H.setAttributeNS(null,"id",j.maskId);const it=this.svgFactory.createElement("svg:rect");it.setAttributeNS(null,"x","0"),it.setAttributeNS(null,"y","0"),it.setAttributeNS(null,"width",e(B)),it.setAttributeNS(null,"height",e(N)),it.setAttributeNS(null,"fill",z),it.setAttributeNS(null,"mask",`url(#${j.maskId})`),this.defs.append(H),this._ensureTransformGroup().append(it),this.paintInlineImageXObject(x,H)}paintFormXObjectBegin(f,x){if(Array.isArray(f)&&f.length===6&&this.transform(f[0],f[1],f[2],f[3],f[4],f[5]),x){const j=x[2]-x[0],B=x[3]-x[1],N=this.svgFactory.createElement("svg:rect");N.setAttributeNS(null,"x",x[0]),N.setAttributeNS(null,"y",x[1]),N.setAttributeNS(null,"width",e(j)),N.setAttributeNS(null,"height",e(B)),this.current.element=N,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(f){const x=this.svgFactory.create(f.width,f.height),j=this.svgFactory.createElement("svg:defs");x.append(j),this.defs=j;const B=this.svgFactory.createElement("svg:g");return B.setAttributeNS(null,"transform",d(f.transform)),x.append(B),this.svg=B,x}_ensureClipGroup(){if(!this.current.clipGroup){const f=this.svgFactory.createElement("svg:g");f.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(f),this.current.clipGroup=f}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",d(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}i.SVGGraphics=k}),((y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.XfaText=void 0;class _{static textContent(p){const C=[],w={items:C,styles:Object.create(null)};function L(I){if(!I)return;let n=null;const t=I.name;if(t==="#text")n=I.value;else if(_.shouldBuildText(t))I?.attributes?.textContent?n=I.attributes.textContent:I.value&&(n=I.value);else return;if(n!==null&&C.push({str:n}),!!I.children)for(const s of I.children)L(s)}return L(p),w}static shouldBuildText(p){return!(p==="textarea"||p==="input"||p==="option"||p==="select")}}i.XfaText=_}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TextLayerRenderTask=void 0,i.renderTextLayer=d,i.updateTextLayer=g;var r=_(1),p=_(6);const C=1e5,w=30,L=.8,I=new Map;function n(o,v){let k;if(v&&r.FeatureTest.isOffscreenCanvasSupported)k=new OffscreenCanvas(o,o).getContext("2d",{alpha:!1});else{const E=document.createElement("canvas");E.width=E.height=o,k=E.getContext("2d",{alpha:!1})}return k}function t(o,v){const k=I.get(o);if(k)return k;const E=n(w,v);E.font=`${w}px ${o}`;const f=E.measureText("");let x=f.fontBoundingBoxAscent,j=Math.abs(f.fontBoundingBoxDescent);if(x){const N=x/(x+j);return I.set(o,N),E.canvas.width=E.canvas.height=0,N}E.strokeStyle="red",E.clearRect(0,0,w,w),E.strokeText("g",0,0);let B=E.getImageData(0,0,w,w).data;j=0;for(let N=B.length-1-3;N>=0;N-=4)if(B[N]>0){j=Math.ceil(N/4/w);break}E.clearRect(0,0,w,w),E.strokeText("A",0,w),B=E.getImageData(0,0,w,w).data,x=0;for(let N=0,z=B.length;N<z;N+=4)if(B[N]>0){x=w-Math.floor(N/4/w);break}if(E.canvas.width=E.canvas.height=0,x){const N=x/(x+j);return I.set(o,N),N}return I.set(o,L),L}function s(o,v,k){const E=document.createElement("span"),f={angle:0,canvasWidth:0,hasText:v.str!=="",hasEOL:v.hasEOL,fontSize:0};o._textDivs.push(E);const x=r.Util.transform(o._transform,v.transform);let j=Math.atan2(x[1],x[0]);const B=k[v.fontName];B.vertical&&(j+=Math.PI/2);const N=Math.hypot(x[2],x[3]),z=N*t(B.fontFamily,o._isOffscreenCanvasSupported);let H,it;j===0?(H=x[4],it=x[5]-z):(H=x[4]+z*Math.sin(j),it=x[5]-z*Math.cos(j));const Z="calc(var(--scale-factor)*",Q=E.style;o._container===o._rootContainer?(Q.left=`${(100*H/o._pageWidth).toFixed(2)}%`,Q.top=`${(100*it/o._pageHeight).toFixed(2)}%`):(Q.left=`${Z}${H.toFixed(2)}px)`,Q.top=`${Z}${it.toFixed(2)}px)`),Q.fontSize=`${Z}${N.toFixed(2)}px)`,Q.fontFamily=B.fontFamily,f.fontSize=N,E.setAttribute("role","presentation"),E.textContent=v.str,E.dir=v.dir,o._fontInspectorEnabled&&(E.dataset.fontName=v.fontName),j!==0&&(f.angle=j*(180/Math.PI));let st=!1;if(v.str.length>1)st=!0;else if(v.str!==" "&&v.transform[0]!==v.transform[3]){const K=Math.abs(v.transform[0]),D=Math.abs(v.transform[3]);K!==D&&Math.max(K,D)/Math.min(K,D)>1.5&&(st=!0)}st&&(f.canvasWidth=B.vertical?v.height:v.width),o._textDivProperties.set(E,f),o._isReadableStream&&o._layoutText(E)}function h(o){const{div:v,scale:k,properties:E,ctx:f,prevFontSize:x,prevFontFamily:j}=o,{style:B}=v;let N="";if(E.canvasWidth!==0&&E.hasText){const{fontFamily:z}=B,{canvasWidth:H,fontSize:it}=E;(x!==it||j!==z)&&(f.font=`${it*k}px ${z}`,o.prevFontSize=it,o.prevFontFamily=z);const{width:Z}=f.measureText(v.textContent);Z>0&&(N=`scaleX(${H*k/Z})`)}E.angle!==0&&(N=`rotate(${E.angle}deg) ${N}`),N.length>0&&(B.transform=N)}function c(o){if(o._canceled)return;const v=o._textDivs,k=o._capability;if(v.length>C){k.resolve();return}if(!o._isReadableStream)for(const f of v)o._layoutText(f);k.resolve()}class e{constructor({textContentSource:v,container:k,viewport:E,textDivs:f,textDivProperties:x,textContentItemsStr:j,isOffscreenCanvasSupported:B}){this._textContentSource=v,this._isReadableStream=v instanceof ReadableStream,this._container=this._rootContainer=k,this._textDivs=f||[],this._textContentItemsStr=j||[],this._isOffscreenCanvasSupported=B,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=x||new WeakMap,this._canceled=!1,this._capability=new r.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:E.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:n(0,B)};const{pageWidth:N,pageHeight:z,pageX:H,pageY:it}=E.rawDims;this._transform=[1,0,0,-1,-H,it+z],this._pageWidth=N,this._pageHeight=z,(0,p.setLayerDimensions)(k,E),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new r.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new r.AbortException("TextLayer task cancelled."))}_processItems(v,k){for(const E of v){if(E.str===void 0){if(E.type==="beginMarkedContentProps"||E.type==="beginMarkedContent"){const f=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),E.id!==null&&this._container.setAttribute("id",`${E.id}`),f.append(this._container)}else E.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(E.str),s(this,E,k)}}_layoutText(v){const k=this._layoutTextParams.properties=this._textDivProperties.get(v);if(this._layoutTextParams.div=v,h(this._layoutTextParams),k.hasText&&this._container.append(v),k.hasEOL){const E=document.createElement("br");E.setAttribute("role","presentation"),this._container.append(E)}}_render(){const v=new r.PromiseCapability;let k=Object.create(null);if(this._isReadableStream){const E=()=>{this._reader.read().then(({value:f,done:x})=>{if(x){v.resolve();return}Object.assign(k,f.styles),this._processItems(f.items,k),E()},v.reject)};this._reader=this._textContentSource.getReader(),E()}else if(this._textContentSource){const{items:E,styles:f}=this._textContentSource;this._processItems(E,f),v.resolve()}else throw new Error('No "textContentSource" parameter specified.');v.promise.then(()=>{k=null,c(this)},this._capability.reject)}}i.TextLayerRenderTask=e;function d(o){!o.textContentSource&&(o.textContent||o.textContentStream)&&((0,p.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),o.textContentSource=o.textContent||o.textContentStream);const{container:v,viewport:k}=o,E=getComputedStyle(v),f=E.getPropertyValue("visibility"),x=parseFloat(E.getPropertyValue("--scale-factor"));f==="visible"&&(!x||Math.abs(x-k.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const j=new e(o);return j._render(),j}function g({container:o,viewport:v,textDivs:k,textDivProperties:E,isOffscreenCanvasSupported:f,mustRotate:x=!0,mustRescale:j=!0}){if(x&&(0,p.setLayerDimensions)(o,{rotation:v.rotation}),j){const B=n(0,f),z={prevFontSize:null,prevFontFamily:null,div:null,scale:v.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:B};for(const H of k)z.properties=E.get(H),z.div=H,h(z)}}}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.AnnotationEditorLayer=void 0;var r=_(1),p=_(4),C=_(28),w=_(33),L=_(6),I=_(34);class n{#t;#e=!1;#i=null;#s=this.pointerup.bind(this);#o=this.pointerdown.bind(this);#a=new Map;#r=!1;#l=!1;#c=!1;#n;static _initialized=!1;constructor({uiManager:s,pageIndex:h,div:c,accessibilityManager:e,annotationLayer:d,viewport:g,l10n:o}){const v=[C.FreeTextEditor,w.InkEditor,I.StampEditor];if(!n._initialized){n._initialized=!0;for(const k of v)k.initialize(o)}s.registerEditorTypes(v),this.#n=s,this.pageIndex=h,this.div=c,this.#t=e,this.#i=d,this.viewport=g,this.#n.addLayer(this)}get isEmpty(){return this.#a.size===0}updateToolbar(s){this.#n.updateToolbar(s)}updateMode(s=this.#n.getMode()){this.#p(),s===r.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),s!==r.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",s===r.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",s===r.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",s===r.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(s){if(!s&&this.#n.getMode()!==r.AnnotationEditorType.INK)return;if(!s){for(const c of this.#a.values())if(c.isEmpty()){c.setInBackground();return}}this.#d({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(s){this.#n.setEditingState(s)}addCommands(s){this.#n.addCommands(s)}enable(){this.div.style.pointerEvents="auto";const s=new Set;for(const c of this.#a.values())c.enableEditing(),c.annotationElementId&&s.add(c.annotationElementId);if(!this.#i)return;const h=this.#i.getEditableAnnotations();for(const c of h){if(c.hide(),this.#n.isDeletedAnnotationElement(c.data.id)||s.has(c.data.id))continue;const e=this.deserialize(c);e&&(this.addOrRebuild(e),e.enableEditing())}}disable(){this.#c=!0,this.div.style.pointerEvents="none";const s=new Set;for(const h of this.#a.values()){if(h.disableEditing(),!h.annotationElementId||h.serialize()!==null){s.add(h.annotationElementId);continue}this.getEditableAnnotation(h.annotationElementId)?.show(),h.remove()}if(this.#i){const h=this.#i.getEditableAnnotations();for(const c of h){const{id:e}=c.data;s.has(e)||this.#n.isDeletedAnnotationElement(e)||c.show()}}this.#p(),this.isEmpty&&(this.div.hidden=!0),this.#c=!1}getEditableAnnotation(s){return this.#i?.getEditableAnnotation(s)||null}setActiveEditor(s){this.#n.getActive()!==s&&this.#n.setActiveEditor(s)}enableClick(){this.div.addEventListener("pointerdown",this.#o),this.div.addEventListener("pointerup",this.#s)}disableClick(){this.div.removeEventListener("pointerdown",this.#o),this.div.removeEventListener("pointerup",this.#s)}attach(s){this.#a.set(s.id,s);const{annotationElementId:h}=s;h&&this.#n.isDeletedAnnotationElement(h)&&this.#n.removeDeletedAnnotationElement(s)}detach(s){this.#a.delete(s.id),this.#t?.removePointerInTextLayer(s.contentDiv),!this.#c&&s.annotationElementId&&this.#n.addDeletedAnnotationElement(s)}remove(s){this.detach(s),this.#n.removeEditor(s),s.div.contains(document.activeElement)&&setTimeout(()=>{this.#n.focusMainContainer()},0),s.div.remove(),s.isAttachedToDOM=!1,this.#l||this.addInkEditorIfNeeded(!1)}changeParent(s){s.parent!==this&&(s.annotationElementId&&(this.#n.addDeletedAnnotationElement(s.annotationElementId),p.AnnotationEditor.deleteAnnotationElement(s),s.annotationElementId=null),this.attach(s),s.parent?.detach(s),s.setParent(this),s.div&&s.isAttachedToDOM&&(s.div.remove(),this.div.append(s.div)))}add(s){if(this.changeParent(s),this.#n.addEditor(s),this.attach(s),!s.isAttachedToDOM){const h=s.render();this.div.append(h),s.isAttachedToDOM=!0}s.fixAndSetPosition(),s.onceAdded(),this.#n.addToAnnotationStorage(s)}moveEditorInDOM(s){if(!s.isAttachedToDOM)return;const{activeElement:h}=document;s.div.contains(h)&&(s._focusEventsAllowed=!1,setTimeout(()=>{s.div.contains(document.activeElement)?s._focusEventsAllowed=!0:(s.div.addEventListener("focusin",()=>{s._focusEventsAllowed=!0},{once:!0}),h.focus())},0)),s._structTreeParentId=this.#t?.moveElementInDOM(this.div,s.div,s.contentDiv,!0)}addOrRebuild(s){s.needsToBeRebuilt()?s.rebuild():this.add(s)}addUndoableEditor(s){const h=()=>s._uiManager.rebuild(s),c=()=>{s.remove()};this.addCommands({cmd:h,undo:c,mustExec:!1})}getNextId(){return this.#n.getId()}#f(s){switch(this.#n.getMode()){case r.AnnotationEditorType.FREETEXT:return new C.FreeTextEditor(s);case r.AnnotationEditorType.INK:return new w.InkEditor(s);case r.AnnotationEditorType.STAMP:return new I.StampEditor(s)}return null}pasteEditor(s,h){this.#n.updateToolbar(s),this.#n.updateMode(s);const{offsetX:c,offsetY:e}=this.#u(),d=this.getNextId(),g=this.#f({parent:this,id:d,x:c,y:e,uiManager:this.#n,isCentered:!0,...h});g&&this.add(g)}deserialize(s){switch(s.annotationType??s.annotationEditorType){case r.AnnotationEditorType.FREETEXT:return C.FreeTextEditor.deserialize(s,this,this.#n);case r.AnnotationEditorType.INK:return w.InkEditor.deserialize(s,this,this.#n);case r.AnnotationEditorType.STAMP:return I.StampEditor.deserialize(s,this,this.#n)}return null}#d(s,h){const c=this.getNextId(),e=this.#f({parent:this,id:c,x:s.offsetX,y:s.offsetY,uiManager:this.#n,isCentered:h});return e&&this.add(e),e}#u(){const{x:s,y:h,width:c,height:e}=this.div.getBoundingClientRect(),d=Math.max(0,s),g=Math.max(0,h),o=Math.min(window.innerWidth,s+c),v=Math.min(window.innerHeight,h+e),k=(d+o)/2-s,E=(g+v)/2-h,[f,x]=this.viewport.rotation%180===0?[k,E]:[E,k];return{offsetX:f,offsetY:x}}addNewEditor(){this.#d(this.#u(),!0)}setSelected(s){this.#n.setSelected(s)}toggleSelected(s){this.#n.toggleSelected(s)}isSelected(s){return this.#n.isSelected(s)}unselect(s){this.#n.unselect(s)}pointerup(s){const{isMac:h}=r.FeatureTest.platform;if(!(s.button!==0||s.ctrlKey&&h)&&s.target===this.div&&this.#r){if(this.#r=!1,!this.#e){this.#e=!0;return}if(this.#n.getMode()===r.AnnotationEditorType.STAMP){this.#n.unselectAll();return}this.#d(s,!1)}}pointerdown(s){if(this.#r){this.#r=!1;return}const{isMac:h}=r.FeatureTest.platform;if(s.button!==0||s.ctrlKey&&h||s.target!==this.div)return;this.#r=!0;const c=this.#n.getActive();this.#e=!c||c.isEmpty()}findNewParent(s,h,c){const e=this.#n.findParent(h,c);return e===null||e===this?!1:(e.changeParent(s),!0)}destroy(){this.#n.getActive()?.parent===this&&(this.#n.commitOrRemove(),this.#n.setActiveEditor(null));for(const s of this.#a.values())this.#t?.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,this.#a.clear(),this.#n.removeLayer(this)}#p(){this.#l=!0;for(const s of this.#a.values())s.isEmpty()&&s.remove();this.#l=!1}render({viewport:s}){this.viewport=s,(0,L.setLayerDimensions)(this.div,s);for(const h of this.#n.getEditors(this.pageIndex))this.add(h);this.updateMode()}update({viewport:s}){this.#n.commitOrRemove(),this.viewport=s,(0,L.setLayerDimensions)(this.div,{rotation:s.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:s,pageHeight:h}=this.viewport.rawDims;return[s,h]}}i.AnnotationEditorLayer=n}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.FreeTextEditor=void 0;var r=_(1),p=_(5),C=_(4),w=_(29);class L extends C.AnnotationEditor{#t=this.editorDivBlur.bind(this);#e=this.editorDivFocus.bind(this);#i=this.editorDivInput.bind(this);#s=this.editorDivKeydown.bind(this);#o;#a="";#r=`${this.id}-editor`;#l;#c=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const n=L.prototype,t=c=>c.isEmpty(),s=p.AnnotationEditorUIManager.TRANSLATE_SMALL,h=p.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,r.shadow)(this,"_keyboardManager",new p.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],n.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],n.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],n._translateEmpty,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],n._translateEmpty,{args:[-h,0],checker:t}],[["ArrowRight","mac+ArrowRight"],n._translateEmpty,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],n._translateEmpty,{args:[h,0],checker:t}],[["ArrowUp","mac+ArrowUp"],n._translateEmpty,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],n._translateEmpty,{args:[0,-h],checker:t}],[["ArrowDown","mac+ArrowDown"],n._translateEmpty,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],n._translateEmpty,{args:[0,h],checker:t}]]))}static _type="freetext";constructor(n){super({...n,name:"freeTextEditor"}),this.#o=n.color||L._defaultColor||C.AnnotationEditor._defaultLineColor,this.#l=n.fontSize||L._defaultFontSize}static initialize(n){C.AnnotationEditor.initialize(n,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const t=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(t.getPropertyValue("--freetext-padding"))}static updateDefaultParams(n,t){switch(n){case r.AnnotationEditorParamsType.FREETEXT_SIZE:L._defaultFontSize=t;break;case r.AnnotationEditorParamsType.FREETEXT_COLOR:L._defaultColor=t;break}}updateParams(n,t){switch(n){case r.AnnotationEditorParamsType.FREETEXT_SIZE:this.#n(t);break;case r.AnnotationEditorParamsType.FREETEXT_COLOR:this.#f(t);break}}static get defaultPropertiesToUpdate(){return[[r.AnnotationEditorParamsType.FREETEXT_SIZE,L._defaultFontSize],[r.AnnotationEditorParamsType.FREETEXT_COLOR,L._defaultColor||C.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[r.AnnotationEditorParamsType.FREETEXT_SIZE,this.#l],[r.AnnotationEditorParamsType.FREETEXT_COLOR,this.#o]]}#n(n){const t=h=>{this.editorDiv.style.fontSize=`calc(${h}px * var(--scale-factor))`,this.translate(0,-(h-this.#l)*this.parentScale),this.#l=h,this.#u()},s=this.#l;this.addCommands({cmd:()=>{t(n)},undo:()=>{t(s)},mustExec:!0,type:r.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#f(n){const t=this.#o;this.addCommands({cmd:()=>{this.#o=this.editorDiv.style.color=n},undo:()=>{this.#o=this.editorDiv.style.color=t},mustExec:!0,type:r.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(n,t){this._uiManager.translateSelectedEditors(n,t,!0)}getInitialTranslation(){const n=this.parentScale;return[-L._internalPadding*n,-(L._internalPadding+this.#l)*n]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(r.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",this.#s),this.editorDiv.addEventListener("focus",this.#e),this.editorDiv.addEventListener("blur",this.#t),this.editorDiv.addEventListener("input",this.#i))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#r),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",this.#s),this.editorDiv.removeEventListener("focus",this.#e),this.editorDiv.removeEventListener("blur",this.#t),this.editorDiv.removeEventListener("input",this.#i),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(n){this._focusEventsAllowed&&(super.focusin(n),n.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){if(this.width){this.#m();return}this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}#d(){const n=this.editorDiv.getElementsByTagName("div");if(n.length===0)return this.editorDiv.innerText;const t=[];for(const s of n)t.push(s.innerText.replace(/\r\n?|\n/,""));return t.join(`
`)}#u(){const[n,t]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:h,div:c}=this,e=c.style.display;c.style.display="hidden",h.div.append(this.div),s=c.getBoundingClientRect(),c.remove(),c.style.display=e}this.rotation%180===this.parentRotation%180?(this.width=s.width/n,this.height=s.height/t):(this.width=s.height/n,this.height=s.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const n=this.#a,t=this.#a=this.#d().trimEnd();if(n===t)return;const s=h=>{if(this.#a=h,!h){this.remove();return}this.#p(),this._uiManager.rebuild(this),this.#u()};this.addCommands({cmd:()=>{s(t)},undo:()=>{s(n)},mustExec:!1}),this.#u()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(n){this.enterInEditMode()}keydown(n){n.target===this.div&&n.key==="Enter"&&(this.enterInEditMode(),n.preventDefault())}editorDivKeydown(n){L._keyboardManager.exec(this,n)}editorDivFocus(n){this.isEditing=!0}editorDivBlur(n){this.isEditing=!1}editorDivInput(n){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let n,t;this.width&&(n=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#r),this.enableEditing(),C.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(h=>this.editorDiv?.setAttribute("aria-label",h)),C.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(h=>this.editorDiv?.setAttribute("default-content",h)),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${this.#l}px * var(--scale-factor))`,s.color=this.#o,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,p.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[h,c]=this.parentDimensions;if(this.annotationElementId){const{position:e}=this.#c;let[d,g]=this.getInitialTranslation();[d,g]=this.pageTranslationToScreen(d,g);const[o,v]=this.pageDimensions,[k,E]=this.pageTranslation;let f,x;switch(this.rotation){case 0:f=n+(e[0]-k)/o,x=t+this.height-(e[1]-E)/v;break;case 90:f=n+(e[0]-k)/o,x=t-(e[1]-E)/v,[d,g]=[g,-d];break;case 180:f=n-this.width+(e[0]-k)/o,x=t-(e[1]-E)/v,[d,g]=[-d,-g];break;case 270:f=n+(e[0]-k-this.height*v)/o,x=t+(e[1]-E-this.width*o)/v,[d,g]=[-g,d];break}this.setAt(f*h,x*c,d,g)}else this.setAt(n*h,t*c,this.width*h,this.height*c);this.#p(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}#p(){if(this.editorDiv.replaceChildren(),!!this.#a)for(const n of this.#a.split(`
`)){const t=document.createElement("div");t.append(n?document.createTextNode(n):document.createElement("br")),this.editorDiv.append(t)}}get contentDiv(){return this.editorDiv}static deserialize(n,t,s){let h=null;if(n instanceof w.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:e,fontColor:d},rect:g,rotation:o,id:v},textContent:k,textPosition:E,parent:{page:{pageNumber:f}}}=n;if(!k||k.length===0)return null;h=n={annotationType:r.AnnotationEditorType.FREETEXT,color:Array.from(d),fontSize:e,value:k.join(`
`),position:E,pageIndex:f-1,rect:g,rotation:o,id:v,deleted:!1}}const c=super.deserialize(n,t,s);return c.#l=n.fontSize,c.#o=r.Util.makeHexColor(...n.color),c.#a=n.value,c.annotationElementId=n.id||null,c.#c=h,c}serialize(n=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const t=L._internalPadding*this.parentScale,s=this.getRect(t,t),h=C.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#o),c={annotationType:r.AnnotationEditorType.FREETEXT,color:h,fontSize:this.#l,value:this.#a,pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return n?c:this.annotationElementId&&!this.#b(c)?null:(c.id=this.annotationElementId,c)}#b(n){const{value:t,fontSize:s,color:h,rect:c,pageIndex:e}=this.#c;return n.value!==t||n.fontSize!==s||n.rect.some((d,g)=>Math.abs(d-c[g])>=1)||n.color.some((d,g)=>d!==h[g])||n.pageIndex!==e}#m(n=!1){if(!this.annotationElementId)return;if(this.#u(),!n&&(this.width===0||this.height===0)){setTimeout(()=>this.#m(!0),0);return}const t=L._internalPadding*this.parentScale;this.#c.rect=this.getRect(t,t)}}i.FreeTextEditor=L}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.StampAnnotationElement=i.InkAnnotationElement=i.FreeTextAnnotationElement=i.AnnotationLayer=void 0;var r=_(1),p=_(6),C=_(3),w=_(30),L=_(31),I=_(32);const n=1e3,t=9,s=new WeakSet;function h(T){return{width:T[2]-T[0],height:T[3]-T[1]}}class c{static create(a){switch(a.data.annotationType){case r.AnnotationType.LINK:return new d(a);case r.AnnotationType.TEXT:return new g(a);case r.AnnotationType.WIDGET:switch(a.data.fieldType){case"Tx":return new v(a);case"Btn":return a.data.radioButton?new f(a):a.data.checkBox?new E(a):new x(a);case"Ch":return new j(a);case"Sig":return new k(a)}return new o(a);case r.AnnotationType.POPUP:return new B(a);case r.AnnotationType.FREETEXT:return new z(a);case r.AnnotationType.LINE:return new H(a);case r.AnnotationType.SQUARE:return new it(a);case r.AnnotationType.CIRCLE:return new Z(a);case r.AnnotationType.POLYLINE:return new Q(a);case r.AnnotationType.CARET:return new K(a);case r.AnnotationType.INK:return new D(a);case r.AnnotationType.POLYGON:return new st(a);case r.AnnotationType.HIGHLIGHT:return new m(a);case r.AnnotationType.UNDERLINE:return new l(a);case r.AnnotationType.SQUIGGLY:return new u(a);case r.AnnotationType.STRIKEOUT:return new A(a);case r.AnnotationType.STAMP:return new R(a);case r.AnnotationType.FILEATTACHMENT:return new M(a);default:return new e(a)}}}class e{#t=!1;constructor(a,{isRenderable:b=!1,ignoreBorder:S=!1,createQuadrilaterals:P=!1}={}){this.isRenderable=b,this.data=a.data,this.layer=a.layer,this.linkService=a.linkService,this.downloadManager=a.downloadManager,this.imageResourcesPath=a.imageResourcesPath,this.renderForms=a.renderForms,this.svgFactory=a.svgFactory,this.annotationStorage=a.annotationStorage,this.enableScripting=a.enableScripting,this.hasJSActions=a.hasJSActions,this._fieldObjects=a.fieldObjects,this.parent=a.parent,b&&(this.container=this._createContainer(S)),P&&this._createQuadrilaterals()}static _hasPopupData({titleObj:a,contentsObj:b,richText:S}){return!!(a?.str||b?.str||S?.str)}get hasPopupData(){return e._hasPopupData(this.data)}_createContainer(a){const{data:b,parent:{page:S,viewport:P}}=this,F=document.createElement("section");F.setAttribute("data-annotation-id",b.id),this instanceof o||(F.tabIndex=n),F.style.zIndex=this.parent.zIndex++,this.data.popupRef&&F.setAttribute("aria-haspopup","dialog"),b.noRotate&&F.classList.add("norotate");const{pageWidth:U,pageHeight:W,pageX:X,pageY:nt}=P.rawDims;if(!b.rect||this instanceof B){const{rotation:tt}=b;return!b.hasOwnCanvas&&tt!==0&&this.setRotation(tt,F),F}const{width:q,height:Y}=h(b.rect),$=r.Util.normalizeRect([b.rect[0],S.view[3]-b.rect[1]+S.view[1],b.rect[2],S.view[3]-b.rect[3]+S.view[1]]);if(!a&&b.borderStyle.width>0){F.style.borderWidth=`${b.borderStyle.width}px`;const tt=b.borderStyle.horizontalCornerRadius,rt=b.borderStyle.verticalCornerRadius;if(tt>0||rt>0){const lt=`calc(${tt}px * var(--scale-factor)) / calc(${rt}px * var(--scale-factor))`;F.style.borderRadius=lt}else if(this instanceof f){const lt=`calc(${q}px * var(--scale-factor)) / calc(${Y}px * var(--scale-factor))`;F.style.borderRadius=lt}switch(b.borderStyle.style){case r.AnnotationBorderStyleType.SOLID:F.style.borderStyle="solid";break;case r.AnnotationBorderStyleType.DASHED:F.style.borderStyle="dashed";break;case r.AnnotationBorderStyleType.BEVELED:(0,r.warn)("Unimplemented border style: beveled");break;case r.AnnotationBorderStyleType.INSET:(0,r.warn)("Unimplemented border style: inset");break;case r.AnnotationBorderStyleType.UNDERLINE:F.style.borderBottomStyle="solid";break}const ot=b.borderColor||null;ot?(this.#t=!0,F.style.borderColor=r.Util.makeHexColor(ot[0]|0,ot[1]|0,ot[2]|0)):F.style.borderWidth=0}F.style.left=`${100*($[0]-X)/U}%`,F.style.top=`${100*($[1]-nt)/W}%`;const{rotation:J}=b;return b.hasOwnCanvas||J===0?(F.style.width=`${100*q/U}%`,F.style.height=`${100*Y/W}%`):this.setRotation(J,F),F}setRotation(a,b=this.container){if(!this.data.rect)return;const{pageWidth:S,pageHeight:P}=this.parent.viewport.rawDims,{width:F,height:U}=h(this.data.rect);let W,X;a%180===0?(W=100*F/S,X=100*U/P):(W=100*U/S,X=100*F/P),b.style.width=`${W}%`,b.style.height=`${X}%`,b.setAttribute("data-main-rotation",(360-a)%360)}get _commonActions(){const a=(b,S,P)=>{const F=P.detail[b],U=F[0],W=F.slice(1);P.target.style[S]=w.ColorConverters[`${U}_HTML`](W),this.annotationStorage.setValue(this.data.id,{[S]:w.ColorConverters[`${U}_rgb`](W)})};return(0,r.shadow)(this,"_commonActions",{display:b=>{const{display:S}=b.detail,P=S%2===1;this.container.style.visibility=P?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:P,noPrint:S===1||S===2})},print:b=>{this.annotationStorage.setValue(this.data.id,{noPrint:!b.detail.print})},hidden:b=>{const{hidden:S}=b.detail;this.container.style.visibility=S?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:S,noView:S})},focus:b=>{setTimeout(()=>b.target.focus({preventScroll:!1}),0)},userName:b=>{b.target.title=b.detail.userName},readonly:b=>{b.target.disabled=b.detail.readonly},required:b=>{this._setRequired(b.target,b.detail.required)},bgColor:b=>{a("bgColor","backgroundColor",b)},fillColor:b=>{a("fillColor","backgroundColor",b)},fgColor:b=>{a("fgColor","color",b)},textColor:b=>{a("textColor","color",b)},borderColor:b=>{a("borderColor","borderColor",b)},strokeColor:b=>{a("strokeColor","borderColor",b)},rotation:b=>{const S=b.detail.rotation;this.setRotation(S),this.annotationStorage.setValue(this.data.id,{rotation:S})}})}_dispatchEventFromSandbox(a,b){const S=this._commonActions;for(const P of Object.keys(b.detail))(a[P]||S[P])?.(b)}_setDefaultPropertiesFromJS(a){if(!this.enableScripting)return;const b=this.annotationStorage.getRawValue(this.data.id);if(!b)return;const S=this._commonActions;for(const[P,F]of Object.entries(b)){const U=S[P];if(U){const W={detail:{[P]:F},target:a};U(W),delete b[P]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:a}=this.data;if(!a)return;const[b,S,P,F]=this.data.rect;if(a.length===1){const[,{x:rt,y:ot},{x:lt,y:ct}]=a[0];if(P===rt&&F===ot&&b===lt&&S===ct)return}const{style:U}=this.container;let W;if(this.#t){const{borderColor:rt,borderWidth:ot}=U;U.borderWidth=0,W=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${rt}" stroke-width="${ot}">`],this.container.classList.add("hasBorder")}const X=P-b,nt=F-S,{svgFactory:q}=this,Y=q.createElement("svg");Y.classList.add("quadrilateralsContainer"),Y.setAttribute("width",0),Y.setAttribute("height",0);const $=q.createElement("defs");Y.append($);const J=q.createElement("clipPath"),tt=`clippath_${this.data.id}`;J.setAttribute("id",tt),J.setAttribute("clipPathUnits","objectBoundingBox"),$.append(J);for(const[,{x:rt,y:ot},{x:lt,y:ct}]of a){const ht=q.createElement("rect"),ut=(lt-b)/X,At=(F-ot)/nt,mt=(rt-lt)/X,Et=(ot-ct)/nt;ht.setAttribute("x",ut),ht.setAttribute("y",At),ht.setAttribute("width",mt),ht.setAttribute("height",Et),J.append(ht),W?.push(`<rect vector-effect="non-scaling-stroke" x="${ut}" y="${At}" width="${mt}" height="${Et}"/>`)}this.#t&&(W.push("</g></svg>')"),U.backgroundImage=W.join("")),this.container.append(Y),this.container.style.clipPath=`url(#${tt})`}_createPopup(){const{container:a,data:b}=this;a.setAttribute("aria-haspopup","dialog");const S=new B({data:{color:b.color,titleObj:b.titleObj,modificationDate:b.modificationDate,contentsObj:b.contentsObj,richText:b.richText,parentRect:b.rect,borderStyle:0,id:`popup_${b.id}`,rotation:b.rotation},parent:this.parent,elements:[this]});this.parent.div.append(S.render())}render(){(0,r.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(a,b=null){const S=[];if(this._fieldObjects){const P=this._fieldObjects[a];if(P)for(const{page:F,id:U,exportValues:W}of P){if(F===-1||U===b)continue;const X=typeof W=="string"?W:null,nt=document.querySelector(`[data-element-id="${U}"]`);if(nt&&!s.has(nt)){(0,r.warn)(`_getElementsByName - element not allowed: ${U}`);continue}S.push({id:U,exportValue:X,domElement:nt})}return S}for(const P of document.getElementsByName(a)){const{exportValue:F}=P,U=P.getAttribute("data-element-id");U!==b&&s.has(P)&&S.push({id:U,exportValue:F,domElement:P})}return S}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const a=this.getElementsToTriggerPopup();if(Array.isArray(a))for(const b of a)b.classList.add("highlightArea");else a.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:a,data:{id:b}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:a,editId:b})})}}class d extends e{constructor(a,b=null){super(a,{isRenderable:!0,ignoreBorder:!!b?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=a.data.isTooltipOnly}render(){const{data:a,linkService:b}=this,S=document.createElement("a");S.setAttribute("data-element-id",a.id);let P=!1;return a.url?(b.addLinkAttributes(S,a.url,a.newWindow),P=!0):a.action?(this._bindNamedAction(S,a.action),P=!0):a.attachment?(this._bindAttachment(S,a.attachment),P=!0):a.setOCGState?(this.#e(S,a.setOCGState),P=!0):a.dest?(this._bindLink(S,a.dest),P=!0):(a.actions&&(a.actions.Action||a.actions["Mouse Up"]||a.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(S,a),P=!0),a.resetForm?(this._bindResetFormAction(S,a.resetForm),P=!0):this.isTooltipOnly&&!P&&(this._bindLink(S,""),P=!0)),this.container.classList.add("linkAnnotation"),P&&this.container.append(S),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(a,b){a.href=this.linkService.getDestinationHash(b),a.onclick=()=>(b&&this.linkService.goToDestination(b),!1),(b||b==="")&&this.#t()}_bindNamedAction(a,b){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.linkService.executeNamedAction(b),!1),this.#t()}_bindAttachment(a,b){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.downloadManager?.openOrDownloadData(this.container,b.content,b.filename),!1),this.#t()}#e(a,b){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.linkService.executeSetOCGState(b),!1),this.#t()}_bindJSAction(a,b){a.href=this.linkService.getAnchorUrl("");const S=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const P of Object.keys(b.actions)){const F=S.get(P);F&&(a[F]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b.id,name:P}}),!1))}a.onclick||(a.onclick=()=>!1),this.#t()}_bindResetFormAction(a,b){const S=a.onclick;if(S||(a.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){(0,r.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),S||(a.onclick=()=>!1);return}a.onclick=()=>{S?.();const{fields:P,refs:F,include:U}=b,W=[];if(P.length!==0||F.length!==0){const q=new Set(F);for(const Y of P){const $=this._fieldObjects[Y]||[];for(const{id:J}of $)q.add(J)}for(const Y of Object.values(this._fieldObjects))for(const $ of Y)q.has($.id)===U&&W.push($)}else for(const q of Object.values(this._fieldObjects))W.push(...q);const X=this.annotationStorage,nt=[];for(const q of W){const{id:Y}=q;switch(nt.push(Y),q.type){case"text":{const J=q.defaultValue||"";X.setValue(Y,{value:J});break}case"checkbox":case"radiobutton":{const J=q.defaultValue===q.exportValues;X.setValue(Y,{value:J});break}case"combobox":case"listbox":{const J=q.defaultValue||"";X.setValue(Y,{value:J});break}default:continue}const $=document.querySelector(`[data-element-id="${Y}"]`);if($){if(!s.has($)){(0,r.warn)(`_bindResetFormAction - element not allowed: ${Y}`);continue}}else continue;$.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:nt,name:"ResetForm"}}),!1}}}class g extends e{constructor(a){super(a,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const a=document.createElement("img");return a.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",a.alt="[{{type}} Annotation]",a.dataset.l10nId="text_annotation_type",a.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(a),this.container}}class o extends e{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(a){this.data.hasOwnCanvas&&(a.previousSibling?.nodeName==="CANVAS"&&(a.previousSibling.hidden=!0),a.hidden=!1)}_getKeyModifier(a){const{isWin:b,isMac:S}=r.FeatureTest.platform;return b&&a.ctrlKey||S&&a.metaKey}_setEventListener(a,b,S,P,F){S.includes("mouse")?a.addEventListener(S,U=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:P,value:F(U),shift:U.shiftKey,modifier:this._getKeyModifier(U)}})}):a.addEventListener(S,U=>{if(S==="blur"){if(!b.focused||!U.relatedTarget)return;b.focused=!1}else if(S==="focus"){if(b.focused)return;b.focused=!0}F&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:P,value:F(U)}})})}_setEventListeners(a,b,S,P){for(const[F,U]of S)(U==="Action"||this.data.actions?.[U])&&((U==="Focus"||U==="Blur")&&(b||={focused:!1}),this._setEventListener(a,b,F,U,P),U==="Focus"&&!this.data.actions?.Blur?this._setEventListener(a,b,"blur","Blur",null):U==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(a,b,"focus","Focus",null))}_setBackgroundColor(a){const b=this.data.backgroundColor||null;a.style.backgroundColor=b===null?"transparent":r.Util.makeHexColor(b[0],b[1],b[2])}_setTextStyle(a){const b=["left","center","right"],{fontColor:S}=this.data.defaultAppearanceData,P=this.data.defaultAppearanceData.fontSize||t,F=a.style;let U;const W=2,X=nt=>Math.round(10*nt)/10;if(this.data.multiLine){const nt=Math.abs(this.data.rect[3]-this.data.rect[1]-W),q=Math.round(nt/(r.LINE_FACTOR*P))||1,Y=nt/q;U=Math.min(P,X(Y/r.LINE_FACTOR))}else{const nt=Math.abs(this.data.rect[3]-this.data.rect[1]-W);U=Math.min(P,X(nt/r.LINE_FACTOR))}F.fontSize=`calc(${U}px * var(--scale-factor))`,F.color=r.Util.makeHexColor(S[0],S[1],S[2]),this.data.textAlignment!==null&&(F.textAlign=b[this.data.textAlignment])}_setRequired(a,b){b?a.setAttribute("required",!0):a.removeAttribute("required"),a.setAttribute("aria-required",b)}}class v extends o{constructor(a){const b=a.renderForms||!a.data.hasAppearance&&!!a.data.fieldValue;super(a,{isRenderable:b})}setPropertyOnSiblings(a,b,S,P){const F=this.annotationStorage;for(const U of this._getElementsByName(a.name,a.id))U.domElement&&(U.domElement[b]=S),F.setValue(U.id,{[P]:S})}render(){const a=this.annotationStorage,b=this.data.id;this.container.classList.add("textWidgetAnnotation");let S=null;if(this.renderForms){const P=a.getValue(b,{value:this.data.fieldValue});let F=P.value||"";const U=a.getValue(b,{charLimit:this.data.maxLen}).charLimit;U&&F.length>U&&(F=F.slice(0,U));let W=P.formattedValue||this.data.textContent?.join(`
`)||null;W&&this.data.comb&&(W=W.replaceAll(/\s+/g,""));const X={userValue:F,formattedValue:W,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(S=document.createElement("textarea"),S.textContent=W??F,this.data.doNotScroll&&(S.style.overflowY="hidden")):(S=document.createElement("input"),S.type="text",S.setAttribute("value",W??F),this.data.doNotScroll&&(S.style.overflowX="hidden")),this.data.hasOwnCanvas&&(S.hidden=!0),s.add(S),S.setAttribute("data-element-id",b),S.disabled=this.data.readOnly,S.name=this.data.fieldName,S.tabIndex=n,this._setRequired(S,this.data.required),U&&(S.maxLength=U),S.addEventListener("input",q=>{a.setValue(b,{value:q.target.value}),this.setPropertyOnSiblings(S,"value",q.target.value,"value"),X.formattedValue=null}),S.addEventListener("resetform",q=>{const Y=this.data.defaultFieldValue??"";S.value=X.userValue=Y,X.formattedValue=null});let nt=q=>{const{formattedValue:Y}=X;Y!=null&&(q.target.value=Y),q.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){S.addEventListener("focus",Y=>{if(X.focused)return;const{target:$}=Y;X.userValue&&($.value=X.userValue),X.lastCommittedValue=$.value,X.commitKey=1,X.focused=!0}),S.addEventListener("updatefromsandbox",Y=>{this.showElementAndHideCanvas(Y.target);const $={value(J){X.userValue=J.detail.value??"",a.setValue(b,{value:X.userValue.toString()}),J.target.value=X.userValue},formattedValue(J){const{formattedValue:tt}=J.detail;X.formattedValue=tt,tt!=null&&J.target!==document.activeElement&&(J.target.value=tt),a.setValue(b,{formattedValue:tt})},selRange(J){J.target.setSelectionRange(...J.detail.selRange)},charLimit:J=>{const{charLimit:tt}=J.detail,{target:rt}=J;if(tt===0){rt.removeAttribute("maxLength");return}rt.setAttribute("maxLength",tt);let ot=X.userValue;!ot||ot.length<=tt||(ot=ot.slice(0,tt),rt.value=X.userValue=ot,a.setValue(b,{value:ot}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:ot,willCommit:!0,commitKey:1,selStart:rt.selectionStart,selEnd:rt.selectionEnd}}))}};this._dispatchEventFromSandbox($,Y)}),S.addEventListener("keydown",Y=>{X.commitKey=1;let $=-1;if(Y.key==="Escape"?$=0:Y.key==="Enter"&&!this.data.multiLine?$=2:Y.key==="Tab"&&(X.commitKey=3),$===-1)return;const{value:J}=Y.target;X.lastCommittedValue!==J&&(X.lastCommittedValue=J,X.userValue=J,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:J,willCommit:!0,commitKey:$,selStart:Y.target.selectionStart,selEnd:Y.target.selectionEnd}}))});const q=nt;nt=null,S.addEventListener("blur",Y=>{if(!X.focused||!Y.relatedTarget)return;X.focused=!1;const{value:$}=Y.target;X.userValue=$,X.lastCommittedValue!==$&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:$,willCommit:!0,commitKey:X.commitKey,selStart:Y.target.selectionStart,selEnd:Y.target.selectionEnd}}),q(Y)}),this.data.actions?.Keystroke&&S.addEventListener("beforeinput",Y=>{X.lastCommittedValue=null;const{data:$,target:J}=Y,{value:tt,selectionStart:rt,selectionEnd:ot}=J;let lt=rt,ct=ot;switch(Y.inputType){case"deleteWordBackward":{const ht=tt.substring(0,rt).match(/\w*[^\w]*$/);ht&&(lt-=ht[0].length);break}case"deleteWordForward":{const ht=tt.substring(rt).match(/^[^\w]*\w*/);ht&&(ct+=ht[0].length);break}case"deleteContentBackward":rt===ot&&(lt-=1);break;case"deleteContentForward":rt===ot&&(ct+=1);break}Y.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:tt,change:$||"",willCommit:!1,selStart:lt,selEnd:ct}})}),this._setEventListeners(S,X,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Y=>Y.target.value)}if(nt&&S.addEventListener("blur",nt),this.data.comb){const Y=(this.data.rect[2]-this.data.rect[0])/U;S.classList.add("comb"),S.style.letterSpacing=`calc(${Y}px * var(--scale-factor) - 1ch)`}}else S=document.createElement("div"),S.textContent=this.data.fieldValue,S.style.verticalAlign="middle",S.style.display="table-cell";return this._setTextStyle(S),this._setBackgroundColor(S),this._setDefaultPropertiesFromJS(S),this.container.append(S),this.container}}class k extends o{constructor(a){super(a,{isRenderable:!!a.data.hasOwnCanvas})}}class E extends o{constructor(a){super(a,{isRenderable:a.renderForms})}render(){const a=this.annotationStorage,b=this.data,S=b.id;let P=a.getValue(S,{value:b.exportValue===b.fieldValue}).value;typeof P=="string"&&(P=P!=="Off",a.setValue(S,{value:P})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const F=document.createElement("input");return s.add(F),F.setAttribute("data-element-id",S),F.disabled=b.readOnly,this._setRequired(F,this.data.required),F.type="checkbox",F.name=b.fieldName,P&&F.setAttribute("checked",!0),F.setAttribute("exportValue",b.exportValue),F.tabIndex=n,F.addEventListener("change",U=>{const{name:W,checked:X}=U.target;for(const nt of this._getElementsByName(W,S)){const q=X&&nt.exportValue===b.exportValue;nt.domElement&&(nt.domElement.checked=q),a.setValue(nt.id,{value:q})}a.setValue(S,{value:X})}),F.addEventListener("resetform",U=>{const W=b.defaultFieldValue||"Off";U.target.checked=W===b.exportValue}),this.enableScripting&&this.hasJSActions&&(F.addEventListener("updatefromsandbox",U=>{const W={value(X){X.target.checked=X.detail.value!=="Off",a.setValue(S,{value:X.target.checked})}};this._dispatchEventFromSandbox(W,U)}),this._setEventListeners(F,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],U=>U.target.checked)),this._setBackgroundColor(F),this._setDefaultPropertiesFromJS(F),this.container.append(F),this.container}}class f extends o{constructor(a){super(a,{isRenderable:a.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const a=this.annotationStorage,b=this.data,S=b.id;let P=a.getValue(S,{value:b.fieldValue===b.buttonValue}).value;typeof P=="string"&&(P=P!==b.buttonValue,a.setValue(S,{value:P}));const F=document.createElement("input");if(s.add(F),F.setAttribute("data-element-id",S),F.disabled=b.readOnly,this._setRequired(F,this.data.required),F.type="radio",F.name=b.fieldName,P&&F.setAttribute("checked",!0),F.tabIndex=n,F.addEventListener("change",U=>{const{name:W,checked:X}=U.target;for(const nt of this._getElementsByName(W,S))a.setValue(nt.id,{value:!1});a.setValue(S,{value:X})}),F.addEventListener("resetform",U=>{const W=b.defaultFieldValue;U.target.checked=W!=null&&W===b.buttonValue}),this.enableScripting&&this.hasJSActions){const U=b.buttonValue;F.addEventListener("updatefromsandbox",W=>{const X={value:nt=>{const q=U===nt.detail.value;for(const Y of this._getElementsByName(nt.target.name)){const $=q&&Y.id===S;Y.domElement&&(Y.domElement.checked=$),a.setValue(Y.id,{value:$})}}};this._dispatchEventFromSandbox(X,W)}),this._setEventListeners(F,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],W=>W.target.checked)}return this._setBackgroundColor(F),this._setDefaultPropertiesFromJS(F),this.container.append(F),this.container}}class x extends d{constructor(a){super(a,{ignoreBorder:a.data.hasAppearance})}render(){const a=super.render();a.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(a.title=this.data.alternativeText);const b=a.lastChild;return this.enableScripting&&this.hasJSActions&&b&&(this._setDefaultPropertiesFromJS(b),b.addEventListener("updatefromsandbox",S=>{this._dispatchEventFromSandbox({},S)})),a}}class j extends o{constructor(a){super(a,{isRenderable:a.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const a=this.annotationStorage,b=this.data.id,S=a.getValue(b,{value:this.data.fieldValue}),P=document.createElement("select");s.add(P),P.setAttribute("data-element-id",b),P.disabled=this.data.readOnly,this._setRequired(P,this.data.required),P.name=this.data.fieldName,P.tabIndex=n;let F=this.data.combo&&this.data.options.length>0;this.data.combo||(P.size=this.data.options.length,this.data.multiSelect&&(P.multiple=!0)),P.addEventListener("resetform",q=>{const Y=this.data.defaultFieldValue;for(const $ of P.options)$.selected=$.value===Y});for(const q of this.data.options){const Y=document.createElement("option");Y.textContent=q.displayValue,Y.value=q.exportValue,S.value.includes(q.exportValue)&&(Y.setAttribute("selected",!0),F=!1),P.append(Y)}let U=null;if(F){const q=document.createElement("option");q.value=" ",q.setAttribute("hidden",!0),q.setAttribute("selected",!0),P.prepend(q),U=()=>{q.remove(),P.removeEventListener("input",U),U=null},P.addEventListener("input",U)}const W=q=>{const Y=q?"value":"textContent",{options:$,multiple:J}=P;return J?Array.prototype.filter.call($,tt=>tt.selected).map(tt=>tt[Y]):$.selectedIndex===-1?null:$[$.selectedIndex][Y]};let X=W(!1);const nt=q=>{const Y=q.target.options;return Array.prototype.map.call(Y,$=>({displayValue:$.textContent,exportValue:$.value}))};return this.enableScripting&&this.hasJSActions?(P.addEventListener("updatefromsandbox",q=>{const Y={value($){U?.();const J=$.detail.value,tt=new Set(Array.isArray(J)?J:[J]);for(const rt of P.options)rt.selected=tt.has(rt.value);a.setValue(b,{value:W(!0)}),X=W(!1)},multipleSelection($){P.multiple=!0},remove($){const J=P.options,tt=$.detail.remove;J[tt].selected=!1,P.remove(tt),J.length>0&&Array.prototype.findIndex.call(J,ot=>ot.selected)===-1&&(J[0].selected=!0),a.setValue(b,{value:W(!0),items:nt($)}),X=W(!1)},clear($){for(;P.length!==0;)P.remove(0);a.setValue(b,{value:null,items:[]}),X=W(!1)},insert($){const{index:J,displayValue:tt,exportValue:rt}=$.detail.insert,ot=P.children[J],lt=document.createElement("option");lt.textContent=tt,lt.value=rt,ot?ot.before(lt):P.append(lt),a.setValue(b,{value:W(!0),items:nt($)}),X=W(!1)},items($){const{items:J}=$.detail;for(;P.length!==0;)P.remove(0);for(const tt of J){const{displayValue:rt,exportValue:ot}=tt,lt=document.createElement("option");lt.textContent=rt,lt.value=ot,P.append(lt)}P.options.length>0&&(P.options[0].selected=!0),a.setValue(b,{value:W(!0),items:nt($)}),X=W(!1)},indices($){const J=new Set($.detail.indices);for(const tt of $.target.options)tt.selected=J.has(tt.index);a.setValue(b,{value:W(!0)}),X=W(!1)},editable($){$.target.disabled=!$.detail.editable}};this._dispatchEventFromSandbox(Y,q)}),P.addEventListener("input",q=>{const Y=W(!0);a.setValue(b,{value:Y}),q.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:X,changeEx:Y,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(P,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],q=>q.target.value)):P.addEventListener("input",function(q){a.setValue(b,{value:W(!0)})}),this.data.combo&&this._setTextStyle(P),this._setBackgroundColor(P),this._setDefaultPropertiesFromJS(P),this.container.append(P),this.container}}class B extends e{constructor(a){const{data:b,elements:S}=a;super(a,{isRenderable:e._hasPopupData(b)}),this.elements=S}render(){this.container.classList.add("popupAnnotation");const a=new N({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),b=[];for(const S of this.elements)S.popup=a,b.push(S.data.id),S.addHighlightArea();return this.container.setAttribute("aria-controls",b.map(S=>`${r.AnnotationPrefix}${S}`).join(",")),this.container}}class N{#t=null;#e=this.#h.bind(this);#i=this.#S.bind(this);#s=this.#x.bind(this);#o=this.#_.bind(this);#a=null;#r=null;#l=null;#c=null;#n=null;#f=null;#d=!1;#u=null;#p=null;#b=null;#m=null;#g=!1;constructor({container:a,color:b,elements:S,titleObj:P,modificationDate:F,contentsObj:U,richText:W,parent:X,rect:nt,parentRect:q,open:Y}){this.#r=a,this.#m=P,this.#l=U,this.#b=W,this.#n=X,this.#a=b,this.#p=nt,this.#f=q,this.#c=S;const $=p.PDFDateString.toDateObject(F);$&&(this.#t=X.l10n.get("annotation_date_string",{date:$.toLocaleDateString(),time:$.toLocaleTimeString()})),this.trigger=S.flatMap(J=>J.getElementsToTriggerPopup());for(const J of this.trigger)J.addEventListener("click",this.#o),J.addEventListener("mouseenter",this.#s),J.addEventListener("mouseleave",this.#i),J.classList.add("popupTriggerArea");for(const J of S)J.container?.addEventListener("keydown",this.#e);this.#r.hidden=!0,Y&&this.#_()}render(){if(this.#u)return;const{page:{view:a},viewport:{rawDims:{pageWidth:b,pageHeight:S,pageX:P,pageY:F}}}=this.#n,U=this.#u=document.createElement("div");if(U.className="popup",this.#a){const ht=U.style.outlineColor=r.Util.makeHexColor(...this.#a);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?U.style.backgroundColor=`color-mix(in srgb, ${ht} 30%, white)`:U.style.backgroundColor=r.Util.makeHexColor(...this.#a.map(At=>Math.floor(.7*(255-At)+At)))}const W=document.createElement("span");W.className="header";const X=document.createElement("h1");if(W.append(X),{dir:X.dir,str:X.textContent}=this.#m,U.append(W),this.#t){const ht=document.createElement("span");ht.classList.add("popupDate"),this.#t.then(ut=>{ht.textContent=ut}),W.append(ht)}const nt=this.#l,q=this.#b;if(q?.str&&(!nt?.str||nt.str===q.str))I.XfaLayer.render({xfaHtml:q.html,intent:"richText",div:U}),U.lastChild.classList.add("richText","popupContent");else{const ht=this._formatContents(nt);U.append(ht)}let Y=!!this.#f,$=Y?this.#f:this.#p;for(const ht of this.#c)if(!$||r.Util.intersect(ht.data.rect,$)!==null){$=ht.data.rect,Y=!0;break}const J=r.Util.normalizeRect([$[0],a[3]-$[1]+a[1],$[2],a[3]-$[3]+a[1]]),rt=Y?$[2]-$[0]+5:0,ot=J[0]+rt,lt=J[1],{style:ct}=this.#r;ct.left=`${100*(ot-P)/b}%`,ct.top=`${100*(lt-F)/S}%`,this.#r.append(U)}_formatContents({str:a,dir:b}){const S=document.createElement("p");S.classList.add("popupContent"),S.dir=b;const P=a.split(/(?:\r\n?|\n)/);for(let F=0,U=P.length;F<U;++F){const W=P[F];S.append(document.createTextNode(W)),F<U-1&&S.append(document.createElement("br"))}return S}#h(a){a.altKey||a.shiftKey||a.ctrlKey||a.metaKey||(a.key==="Enter"||a.key==="Escape"&&this.#d)&&this.#_()}#_(){this.#d=!this.#d,this.#d?(this.#x(),this.#r.addEventListener("click",this.#o),this.#r.addEventListener("keydown",this.#e)):(this.#S(),this.#r.removeEventListener("click",this.#o),this.#r.removeEventListener("keydown",this.#e))}#x(){this.#u||this.render(),this.isVisible?this.#d&&this.#r.classList.add("focused"):(this.#r.hidden=!1,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)+1e3)}#S(){this.#r.classList.remove("focused"),!(this.#d||!this.isVisible)&&(this.#r.hidden=!0,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)-1e3)}forceHide(){this.#g=this.isVisible,this.#g&&(this.#r.hidden=!0)}maybeShow(){this.#g&&(this.#g=!1,this.#r.hidden=!1)}get isVisible(){return this.#r.hidden===!1}}class z extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.textContent=a.data.textContent,this.textPosition=a.data.textPosition,this.annotationEditorType=r.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const a=document.createElement("div");a.classList.add("annotationTextContent"),a.setAttribute("role","comment");for(const b of this.textContent){const S=document.createElement("span");S.textContent=b,a.append(S)}this.container.append(a)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}i.FreeTextAnnotationElement=z;class H extends e{#t=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const a=this.data,{width:b,height:S}=h(a.rect),P=this.svgFactory.create(b,S,!0),F=this.#t=this.svgFactory.createElement("svg:line");return F.setAttribute("x1",a.rect[2]-a.lineCoordinates[0]),F.setAttribute("y1",a.rect[3]-a.lineCoordinates[1]),F.setAttribute("x2",a.rect[2]-a.lineCoordinates[2]),F.setAttribute("y2",a.rect[3]-a.lineCoordinates[3]),F.setAttribute("stroke-width",a.borderStyle.width||1),F.setAttribute("stroke","transparent"),F.setAttribute("fill","transparent"),P.append(F),this.container.append(P),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class it extends e{#t=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const a=this.data,{width:b,height:S}=h(a.rect),P=this.svgFactory.create(b,S,!0),F=a.borderStyle.width,U=this.#t=this.svgFactory.createElement("svg:rect");return U.setAttribute("x",F/2),U.setAttribute("y",F/2),U.setAttribute("width",b-F),U.setAttribute("height",S-F),U.setAttribute("stroke-width",F||1),U.setAttribute("stroke","transparent"),U.setAttribute("fill","transparent"),P.append(U),this.container.append(P),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Z extends e{#t=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const a=this.data,{width:b,height:S}=h(a.rect),P=this.svgFactory.create(b,S,!0),F=a.borderStyle.width,U=this.#t=this.svgFactory.createElement("svg:ellipse");return U.setAttribute("cx",b/2),U.setAttribute("cy",S/2),U.setAttribute("rx",b/2-F/2),U.setAttribute("ry",S/2-F/2),U.setAttribute("stroke-width",F||1),U.setAttribute("stroke","transparent"),U.setAttribute("fill","transparent"),P.append(U),this.container.append(P),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Q extends e{#t=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const a=this.data,{width:b,height:S}=h(a.rect),P=this.svgFactory.create(b,S,!0);let F=[];for(const W of a.vertices){const X=W.x-a.rect[0],nt=a.rect[3]-W.y;F.push(X+","+nt)}F=F.join(" ");const U=this.#t=this.svgFactory.createElement(this.svgElementName);return U.setAttribute("points",F),U.setAttribute("stroke-width",a.borderStyle.width||1),U.setAttribute("stroke","transparent"),U.setAttribute("fill","transparent"),P.append(U),this.container.append(P),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class st extends Q{constructor(a){super(a),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class K extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class D extends e{#t=[];constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=r.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const a=this.data,{width:b,height:S}=h(a.rect),P=this.svgFactory.create(b,S,!0);for(const F of a.inkLists){let U=[];for(const X of F){const nt=X.x-a.rect[0],q=a.rect[3]-X.y;U.push(`${nt},${q}`)}U=U.join(" ");const W=this.svgFactory.createElement(this.svgElementName);this.#t.push(W),W.setAttribute("points",U),W.setAttribute("stroke-width",a.borderStyle.width||1),W.setAttribute("stroke","transparent"),W.setAttribute("fill","transparent"),!a.popupRef&&this.hasPopupData&&this._createPopup(),P.append(W)}return this.container.append(P),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}i.InkAnnotationElement=D;class m extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class l extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class u extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class A extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class R extends e{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}i.StampAnnotationElement=R;class M extends e{#t=null;constructor(a){super(a,{isRenderable:!0});const{filename:b,content:S}=this.data.file;this.filename=(0,p.getFilenameFromUrl)(b,!0),this.content=S,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:b,content:S})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:a,data:b}=this;let S;b.hasAppearance||b.fillAlpha===0?S=document.createElement("div"):(S=document.createElement("img"),S.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(b.name)?"paperclip":"pushpin"}.svg`,b.fillAlpha&&b.fillAlpha<1&&(S.style=`filter: opacity(${Math.round(b.fillAlpha*100)}%);`)),S.addEventListener("dblclick",this.#e.bind(this)),this.#t=S;const{isMac:P}=r.FeatureTest.platform;return a.addEventListener("keydown",F=>{F.key==="Enter"&&(P?F.metaKey:F.ctrlKey)&&this.#e()}),!b.popupRef&&this.hasPopupData?this._createPopup():S.classList.add("popupTriggerArea"),a.append(S),a}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.container,this.content,this.filename)}}class O{#t=null;#e=null;#i=new Map;constructor({div:a,accessibilityManager:b,annotationCanvasMap:S,l10n:P,page:F,viewport:U}){this.div=a,this.#t=b,this.#e=S,this.l10n=P,this.page=F,this.viewport=U,this.zIndex=0,this.l10n||=L.NullL10n}#s(a,b){const S=a.firstChild||a;S.id=`${r.AnnotationPrefix}${b}`,this.div.append(a),this.#t?.moveElementInDOM(this.div,a,S,!1)}async render(a){const{annotations:b}=a,S=this.div;(0,p.setLayerDimensions)(S,this.viewport);const P=new Map,F={data:null,layer:S,linkService:a.linkService,downloadManager:a.downloadManager,imageResourcesPath:a.imageResourcesPath||"",renderForms:a.renderForms!==!1,svgFactory:new p.DOMSVGFactory,annotationStorage:a.annotationStorage||new C.AnnotationStorage,enableScripting:a.enableScripting===!0,hasJSActions:a.hasJSActions,fieldObjects:a.fieldObjects,parent:this,elements:null};for(const U of b){if(U.noHTML)continue;const W=U.annotationType===r.AnnotationType.POPUP;if(W){const q=P.get(U.id);if(!q)continue;F.elements=q}else{const{width:q,height:Y}=h(U.rect);if(q<=0||Y<=0)continue}F.data=U;const X=c.create(F);if(!X.isRenderable)continue;if(!W&&U.popupRef){const q=P.get(U.popupRef);q?q.push(X):P.set(U.popupRef,[X])}X.annotationEditorType>0&&this.#i.set(X.data.id,X);const nt=X.render();U.hidden&&(nt.style.visibility="hidden"),this.#s(nt,U.id)}this.#o(),await this.l10n.translate(S)}update({viewport:a}){const b=this.div;this.viewport=a,(0,p.setLayerDimensions)(b,{rotation:a.rotation}),this.#o(),b.hidden=!1}#o(){if(!this.#e)return;const a=this.div;for(const[b,S]of this.#e){const P=a.querySelector(`[data-annotation-id="${b}"]`);if(!P)continue;const{firstChild:F}=P;F?F.nodeName==="CANVAS"?F.replaceWith(S):F.before(S):P.append(S)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#i.values())}getEditableAnnotation(a){return this.#i.get(a)}}i.AnnotationLayer=O}),((y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ColorConverters=void 0;function _(C){return Math.floor(Math.max(0,Math.min(1,C))*255).toString(16).padStart(2,"0")}function r(C){return Math.max(0,Math.min(255,255*C))}class p{static CMYK_G([w,L,I,n]){return["G",1-Math.min(1,.3*w+.59*I+.11*L+n)]}static G_CMYK([w]){return["CMYK",0,0,0,1-w]}static G_RGB([w]){return["RGB",w,w,w]}static G_rgb([w]){return w=r(w),[w,w,w]}static G_HTML([w]){const L=_(w);return`#${L}${L}${L}`}static RGB_G([w,L,I]){return["G",.3*w+.59*L+.11*I]}static RGB_rgb(w){return w.map(r)}static RGB_HTML(w){return`#${w.map(_).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([w,L,I,n]){return["RGB",1-Math.min(1,w+n),1-Math.min(1,I+n),1-Math.min(1,L+n)]}static CMYK_rgb([w,L,I,n]){return[r(1-Math.min(1,w+n)),r(1-Math.min(1,I+n)),r(1-Math.min(1,L+n))]}static CMYK_HTML(w){const L=this.CMYK_RGB(w).slice(1);return this.RGB_HTML(L)}static RGB_CMYK([w,L,I]){const n=1-w,t=1-L,s=1-I,h=Math.min(n,t,s);return["CMYK",n,t,s,h]}}i.ColorConverters=p}),((y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.NullL10n=void 0,i.getL10nFallback=r;const _={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};_.print_progress_percent="{{progress}}%";function r(w,L){switch(w){case"find_match_count":w=`find_match_count[${L.total===1?"one":"other"}]`;break;case"find_match_count_limit":w=`find_match_count_limit[${L.limit===1?"one":"other"}]`;break}return _[w]||""}function p(w,L){return L?w.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(I,n)=>n in L?L[n]:"{{"+n+"}}"):w}const C={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(w,L=null,I=r(w,L)){return p(I,L)},async translate(w){}};i.NullL10n=C}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.XfaLayer=void 0;var r=_(25);class p{static setupStorage(w,L,I,n,t){const s=n.getValue(L,{value:null});switch(I.name){case"textarea":if(s.value!==null&&(w.textContent=s.value),t==="print")break;w.addEventListener("input",h=>{n.setValue(L,{value:h.target.value})});break;case"input":if(I.attributes.type==="radio"||I.attributes.type==="checkbox"){if(s.value===I.attributes.xfaOn?w.setAttribute("checked",!0):s.value===I.attributes.xfaOff&&w.removeAttribute("checked"),t==="print")break;w.addEventListener("change",h=>{n.setValue(L,{value:h.target.checked?h.target.getAttribute("xfaOn"):h.target.getAttribute("xfaOff")})})}else{if(s.value!==null&&w.setAttribute("value",s.value),t==="print")break;w.addEventListener("input",h=>{n.setValue(L,{value:h.target.value})})}break;case"select":if(s.value!==null){w.setAttribute("value",s.value);for(const h of I.children)h.attributes.value===s.value?h.attributes.selected=!0:h.attributes.hasOwnProperty("selected")&&delete h.attributes.selected}w.addEventListener("input",h=>{const c=h.target.options,e=c.selectedIndex===-1?"":c[c.selectedIndex].value;n.setValue(L,{value:e})});break}}static setAttributes({html:w,element:L,storage:I=null,intent:n,linkService:t}){const{attributes:s}=L,h=w instanceof HTMLAnchorElement;s.type==="radio"&&(s.name=`${s.name}-${n}`);for(const[c,e]of Object.entries(s))if(e!=null)switch(c){case"class":e.length&&w.setAttribute(c,e.join(" "));break;case"dataId":break;case"id":w.setAttribute("data-element-id",e);break;case"style":Object.assign(w.style,e);break;case"textContent":w.textContent=e;break;default:(!h||c!=="href"&&c!=="newWindow")&&w.setAttribute(c,e)}h&&t.addLinkAttributes(w,s.href,s.newWindow),I&&s.dataId&&this.setupStorage(w,s.dataId,L,I)}static render(w){const L=w.annotationStorage,I=w.linkService,n=w.xfaHtml,t=w.intent||"display",s=document.createElement(n.name);n.attributes&&this.setAttributes({html:s,element:n,intent:t,linkService:I});const h=[[n,-1,s]],c=w.div;if(c.append(s),w.viewport){const d=`matrix(${w.viewport.transform.join(",")})`;c.style.transform=d}t!=="richText"&&c.setAttribute("class","xfaLayer xfaFont");const e=[];for(;h.length>0;){const[d,g,o]=h.at(-1);if(g+1===d.children.length){h.pop();continue}const v=d.children[++h.at(-1)[1]];if(v===null)continue;const{name:k}=v;if(k==="#text"){const f=document.createTextNode(v.value);e.push(f),o.append(f);continue}const E=v?.attributes?.xmlns?document.createElementNS(v.attributes.xmlns,k):document.createElement(k);if(o.append(E),v.attributes&&this.setAttributes({html:E,element:v,storage:L,intent:t,linkService:I}),v.children&&v.children.length>0)h.push([v,-1,E]);else if(v.value){const f=document.createTextNode(v.value);r.XfaText.shouldBuildText(k)&&e.push(f),E.append(f)}}for(const d of c.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))d.setAttribute("readOnly",!0);return{textDivs:e}}static update(w){const L=`matrix(${w.viewport.transform.join(",")})`;w.div.style.transform=L,w.div.hidden=!1}}i.XfaLayer=p}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.InkEditor=void 0;var r=_(1),p=_(4),C=_(29),w=_(6),L=_(5);class I extends p.AnnotationEditor{#t=0;#e=0;#i=this.canvasPointermove.bind(this);#s=this.canvasPointerleave.bind(this);#o=this.canvasPointerup.bind(this);#a=this.canvasPointerdown.bind(this);#r=new Path2D;#l=!1;#c=!1;#n=!1;#f=null;#d=0;#u=0;#p=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";constructor(t){super({...t,name:"inkEditor"}),this.color=t.color||null,this.thickness=t.thickness||null,this.opacity=t.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(t){p.AnnotationEditor.initialize(t,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(t,s){switch(t){case r.AnnotationEditorParamsType.INK_THICKNESS:I._defaultThickness=s;break;case r.AnnotationEditorParamsType.INK_COLOR:I._defaultColor=s;break;case r.AnnotationEditorParamsType.INK_OPACITY:I._defaultOpacity=s/100;break}}updateParams(t,s){switch(t){case r.AnnotationEditorParamsType.INK_THICKNESS:this.#b(s);break;case r.AnnotationEditorParamsType.INK_COLOR:this.#m(s);break;case r.AnnotationEditorParamsType.INK_OPACITY:this.#g(s);break}}static get defaultPropertiesToUpdate(){return[[r.AnnotationEditorParamsType.INK_THICKNESS,I._defaultThickness],[r.AnnotationEditorParamsType.INK_COLOR,I._defaultColor||p.AnnotationEditor._defaultLineColor],[r.AnnotationEditorParamsType.INK_OPACITY,Math.round(I._defaultOpacity*100)]]}get propertiesToUpdate(){return[[r.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||I._defaultThickness],[r.AnnotationEditorParamsType.INK_COLOR,this.color||I._defaultColor||p.AnnotationEditor._defaultLineColor],[r.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??I._defaultOpacity))]]}#b(t){const s=this.thickness;this.addCommands({cmd:()=>{this.thickness=t,this.#w()},undo:()=>{this.thickness=s,this.#w()},mustExec:!0,type:r.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#m(t){const s=this.color;this.addCommands({cmd:()=>{this.color=t,this.#A()},undo:()=>{this.color=s,this.#A()},mustExec:!0,type:r.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#g(t){t/=100;const s=this.opacity;this.addCommands({cmd:()=>{this.opacity=t,this.#A()},undo:()=>{this.opacity=s,this.#A()},mustExec:!0,type:r.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(this.#k(),this.#R()),this.isAttachedToDOM||(this.parent.add(this),this.#y()),this.#w()))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#f.disconnect(),this.#f=null,super.remove())}setParent(t){!this.parent&&t?this._uiManager.removeShouldRescale(this):this.parent&&t===null&&this._uiManager.addShouldRescale(this),super.setParent(t)}onScaleChanging(){const[t,s]=this.parentDimensions,h=this.width*t,c=this.height*s;this.setDimensions(h,c)}enableEditMode(){this.#l||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",this.#a))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#a))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}#h(){const{parentRotation:t,parentDimensions:[s,h]}=this;switch(t){case 90:return[0,h,h,s];case 180:return[s,h,s,h];case 270:return[s,0,h,s];default:return[0,0,s,h]}}#_(){const{ctx:t,color:s,opacity:h,thickness:c,parentScale:e,scaleFactor:d}=this;t.lineWidth=c*e/d,t.lineCap="round",t.lineJoin="round",t.miterLimit=10,t.strokeStyle=`${s}${(0,L.opacityToHex)(h)}`}#x(t,s){this.canvas.addEventListener("contextmenu",w.noContextMenu),this.canvas.addEventListener("pointerleave",this.#s),this.canvas.addEventListener("pointermove",this.#i),this.canvas.addEventListener("pointerup",this.#o),this.canvas.removeEventListener("pointerdown",this.#a),this.isEditing=!0,this.#n||(this.#n=!0,this.#y(),this.thickness||=I._defaultThickness,this.color||=I._defaultColor||p.AnnotationEditor._defaultLineColor,this.opacity??=I._defaultOpacity),this.currentPath.push([t,s]),this.#c=!1,this.#_(),this.#p=()=>{this.#D(),this.#p&&window.requestAnimationFrame(this.#p)},window.requestAnimationFrame(this.#p)}#S(t,s){const[h,c]=this.currentPath.at(-1);if(this.currentPath.length>1&&t===h&&s===c)return;const e=this.currentPath;let d=this.#r;if(e.push([t,s]),this.#c=!0,e.length<=2){d.moveTo(...e[0]),d.lineTo(t,s);return}e.length===3&&(this.#r=d=new Path2D,d.moveTo(...e[0])),this.#L(d,...e.at(-3),...e.at(-2),t,s)}#C(){if(this.currentPath.length===0)return;const t=this.currentPath.at(-1);this.#r.lineTo(...t)}#P(t,s){this.#p=null,t=Math.min(Math.max(t,0),this.canvas.width),s=Math.min(Math.max(s,0),this.canvas.height),this.#S(t,s),this.#C();let h;if(this.currentPath.length!==1)h=this.#O();else{const o=[t,s];h=[[o,o.slice(),o.slice(),o]]}const c=this.#r,e=this.currentPath;this.currentPath=[],this.#r=new Path2D;const d=()=>{this.allRawPaths.push(e),this.paths.push(h),this.bezierPath2D.push(c),this.rebuild()},g=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(this.#k(),this.#R()),this.#w())};this.addCommands({cmd:d,undo:g,mustExec:!0})}#D(){if(!this.#c)return;this.#c=!1;const t=Math.ceil(this.thickness*this.parentScale),s=this.currentPath.slice(-3),h=s.map(d=>d[0]),c=s.map(d=>d[1]);Math.min(...h)-t,Math.max(...h)+t,Math.min(...c)-t,Math.max(...c)+t;const{ctx:e}=this;e.save(),e.clearRect(0,0,this.canvas.width,this.canvas.height);for(const d of this.bezierPath2D)e.stroke(d);e.stroke(this.#r),e.restore()}#L(t,s,h,c,e,d,g){const o=(s+c)/2,v=(h+e)/2,k=(c+d)/2,E=(e+g)/2;t.bezierCurveTo(o+2*(c-o)/3,v+2*(e-v)/3,k+2*(c-k)/3,E+2*(e-E)/3,k,E)}#O(){const t=this.currentPath;if(t.length<=2)return[[t[0],t[0],t.at(-1),t.at(-1)]];const s=[];let h,[c,e]=t[0];for(h=1;h<t.length-2;h++){const[f,x]=t[h],[j,B]=t[h+1],N=(f+j)/2,z=(x+B)/2,H=[c+2*(f-c)/3,e+2*(x-e)/3],it=[N+2*(f-N)/3,z+2*(x-z)/3];s.push([[c,e],H,it,[N,z]]),[c,e]=[N,z]}const[d,g]=t[h],[o,v]=t[h+1],k=[c+2*(d-c)/3,e+2*(g-e)/3],E=[o+2*(d-o)/3,v+2*(g-v)/3];return s.push([[c,e],k,E,[o,v]]),s}#A(){if(this.isEmpty()){this.#E();return}this.#_();const{canvas:t,ctx:s}=this;s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,t.width,t.height),this.#E();for(const h of this.bezierPath2D)s.stroke(h)}commit(){this.#l||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#l=!0,this.div.classList.add("disabled"),this.#w(!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),this.enableEditMode())}canvasPointerdown(t){t.button!==0||!this.isInEditMode()||this.#l||(this.setInForeground(),t.preventDefault(),t.type!=="mouse"&&this.div.focus(),this.#x(t.offsetX,t.offsetY))}canvasPointermove(t){t.preventDefault(),this.#S(t.offsetX,t.offsetY)}canvasPointerup(t){t.preventDefault(),this.#I(t)}canvasPointerleave(t){this.#I(t)}#I(t){this.canvas.removeEventListener("pointerleave",this.#s),this.canvas.removeEventListener("pointermove",this.#i),this.canvas.removeEventListener("pointerup",this.#o),this.canvas.addEventListener("pointerdown",this.#a),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",w.noContextMenu)},10),this.#P(t.offsetX,t.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#k(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",p.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(t=>this.canvas?.setAttribute("aria-label",t)),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#R(){this.#f=new ResizeObserver(t=>{const s=t[0].contentRect;s.width&&s.height&&this.setDimensions(s.width,s.height)}),this.#f.observe(this.div)}get isResizable(){return!this.isEmpty()&&this.#l}render(){if(this.div)return this.div;let t,s;this.width&&(t=this.x,s=this.y),super.render(),p.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(g=>this.div?.setAttribute("aria-label",g));const[h,c,e,d]=this.#h();if(this.setAt(h,c,0,0),this.setDims(e,d),this.#k(),this.width){const[g,o]=this.parentDimensions;this.setAspectRatio(this.width*g,this.height*o),this.setAt(t*g,s*o,this.width*g,this.height*o),this.#n=!0,this.#y(),this.setDims(this.width*g,this.height*o),this.#A(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#R(),this.div}#y(){if(!this.#n)return;const[t,s]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*t),this.canvas.height=Math.ceil(this.height*s),this.#E()}setDimensions(t,s){const h=Math.round(t),c=Math.round(s);if(this.#d===h&&this.#u===c)return;this.#d=h,this.#u=c,this.canvas.style.visibility="hidden";const[e,d]=this.parentDimensions;this.width=t/e,this.height=s/d,this.fixAndSetPosition(),this.#l&&this.#T(t,s),this.#y(),this.#A(),this.canvas.style.visibility="visible",this.fixDims()}#T(t,s){const h=this.#M(),c=(t-h)/this.#e,e=(s-h)/this.#t;this.scaleFactor=Math.min(c,e)}#E(){const t=this.#M()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+t,this.translationY*this.scaleFactor+t)}static#N(t){const s=new Path2D;for(let h=0,c=t.length;h<c;h++){const[e,d,g,o]=t[h];h===0&&s.moveTo(...e),s.bezierCurveTo(d[0],d[1],g[0],g[1],o[0],o[1])}return s}static#j(t,s,h){const[c,e,d,g]=s;switch(h){case 0:for(let o=0,v=t.length;o<v;o+=2)t[o]+=c,t[o+1]=g-t[o+1];break;case 90:for(let o=0,v=t.length;o<v;o+=2){const k=t[o];t[o]=t[o+1]+c,t[o+1]=k+e}break;case 180:for(let o=0,v=t.length;o<v;o+=2)t[o]=d-t[o],t[o+1]+=e;break;case 270:for(let o=0,v=t.length;o<v;o+=2){const k=t[o];t[o]=d-t[o+1],t[o+1]=g-k}break;default:throw new Error("Invalid rotation")}return t}static#U(t,s,h){const[c,e,d,g]=s;switch(h){case 0:for(let o=0,v=t.length;o<v;o+=2)t[o]-=c,t[o+1]=g-t[o+1];break;case 90:for(let o=0,v=t.length;o<v;o+=2){const k=t[o];t[o]=t[o+1]-e,t[o+1]=k-c}break;case 180:for(let o=0,v=t.length;o<v;o+=2)t[o]=d-t[o],t[o+1]-=e;break;case 270:for(let o=0,v=t.length;o<v;o+=2){const k=t[o];t[o]=g-t[o+1],t[o+1]=d-k}break;default:throw new Error("Invalid rotation")}return t}#B(t,s,h,c){const e=[],d=this.thickness/2,g=t*s+d,o=t*h+d;for(const v of this.paths){const k=[],E=[];for(let f=0,x=v.length;f<x;f++){const[j,B,N,z]=v[f],H=t*j[0]+g,it=t*j[1]+o,Z=t*B[0]+g,Q=t*B[1]+o,st=t*N[0]+g,K=t*N[1]+o,D=t*z[0]+g,m=t*z[1]+o;f===0&&(k.push(H,it),E.push(H,it)),k.push(Z,Q,st,K,D,m),E.push(Z,Q),f===x-1&&E.push(D,m)}e.push({bezier:I.#j(k,c,this.rotation),points:I.#j(E,c,this.rotation)})}return e}#F(){let t=1/0,s=-1/0,h=1/0,c=-1/0;for(const e of this.paths)for(const[d,g,o,v]of e){const k=r.Util.bezierBoundingBox(...d,...g,...o,...v);t=Math.min(t,k[0]),h=Math.min(h,k[1]),s=Math.max(s,k[2]),c=Math.max(c,k[3])}return[t,h,s,c]}#M(){return this.#l?Math.ceil(this.thickness*this.parentScale):0}#w(t=!1){if(this.isEmpty())return;if(!this.#l){this.#A();return}const s=this.#F(),h=this.#M();this.#e=Math.max(p.AnnotationEditor.MIN_SIZE,s[2]-s[0]),this.#t=Math.max(p.AnnotationEditor.MIN_SIZE,s[3]-s[1]);const c=Math.ceil(h+this.#e*this.scaleFactor),e=Math.ceil(h+this.#t*this.scaleFactor),[d,g]=this.parentDimensions;this.width=c/d,this.height=e/g,this.setAspectRatio(c,e);const o=this.translationX,v=this.translationY;this.translationX=-s[0],this.translationY=-s[1],this.#y(),this.#A(),this.#d=c,this.#u=e,this.setDims(c,e);const k=t?h/this.scaleFactor/2:0;this.translate(o-this.translationX-k,v-this.translationY-k)}static deserialize(t,s,h){if(t instanceof C.InkAnnotationElement)return null;const c=super.deserialize(t,s,h);c.thickness=t.thickness,c.color=r.Util.makeHexColor(...t.color),c.opacity=t.opacity;const[e,d]=c.pageDimensions,g=c.width*e,o=c.height*d,v=c.parentScale,k=t.thickness/2;c.#l=!0,c.#d=Math.round(g),c.#u=Math.round(o);const{paths:E,rect:f,rotation:x}=t;for(let{bezier:B}of E){B=I.#U(B,f,x);const N=[];c.paths.push(N);let z=v*(B[0]-k),H=v*(B[1]-k);for(let Z=2,Q=B.length;Z<Q;Z+=6){const st=v*(B[Z]-k),K=v*(B[Z+1]-k),D=v*(B[Z+2]-k),m=v*(B[Z+3]-k),l=v*(B[Z+4]-k),u=v*(B[Z+5]-k);N.push([[z,H],[st,K],[D,m],[l,u]]),z=l,H=u}const it=this.#N(N);c.bezierPath2D.push(it)}const j=c.#F();return c.#e=Math.max(p.AnnotationEditor.MIN_SIZE,j[2]-j[0]),c.#t=Math.max(p.AnnotationEditor.MIN_SIZE,j[3]-j[1]),c.#T(g,o),c}serialize(){if(this.isEmpty())return null;const t=this.getRect(0,0),s=p.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:r.AnnotationEditorType.INK,color:s,thickness:this.thickness,opacity:this.opacity,paths:this.#B(this.scaleFactor/this.parentScale,this.translationX,this.translationY,t),pageIndex:this.pageIndex,rect:t,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}i.InkEditor=I}),((y,i,_)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.StampEditor=void 0;var r=_(1),p=_(4),C=_(6),w=_(29);class L extends p.AnnotationEditor{#t=null;#e=null;#i=null;#s=null;#o=null;#a=null;#r=null;#l=null;#c=!1;#n=!1;static _type="stamp";constructor(n){super({...n,name:"stampEditor"}),this.#s=n.bitmapUrl,this.#o=n.bitmapFile}static initialize(n){p.AnnotationEditor.initialize(n)}static get supportedTypes(){const n=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,r.shadow)(this,"supportedTypes",n.map(t=>`image/${t}`))}static get supportedTypesStr(){return(0,r.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(n){return this.supportedTypes.includes(n)}static paste(n,t){t.pasteEditor(r.AnnotationEditorType.STAMP,{bitmapFile:n.getAsFile()})}#f(n,t=!1){if(!n){this.remove();return}this.#t=n.bitmap,t||(this.#e=n.id,this.#c=n.isSvg),this.#p()}#d(){this.#i=null,this._uiManager.enableWaiting(!1),this.#a&&this.div.focus()}#u(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(t=>this.#f(t,!0)).finally(()=>this.#d());return}if(this.#s){const t=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromUrl(t).then(s=>this.#f(s)).finally(()=>this.#d());return}if(this.#o){const t=this.#o;this.#o=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromFile(t).then(s=>this.#f(s)).finally(()=>this.#d());return}const n=document.createElement("input");n.type="file",n.accept=L.supportedTypesStr,this.#i=new Promise(t=>{n.addEventListener("change",async()=>{if(!n.files||n.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(n.files[0]);this.#f(s)}t()}),n.addEventListener("cancel",()=>{this.remove(),t()})}).finally(()=>this.#d()),n.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#a?.remove(),this.#a=null,this.#r?.disconnect(),this.#r=null),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#u();return}super.rebuild(),this.div!==null&&(this.#e&&this.#u(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#i||this.#t||this.#s||this.#o)}get isResizable(){return!0}render(){if(this.div)return this.div;let n,t;if(this.width&&(n=this.x,t=this.y),super.render(),this.div.hidden=!0,this.#t?this.#p():this.#u(),this.width){const[s,h]=this.parentDimensions;this.setAt(n*s,t*h,this.width*s,this.height*h)}return this.div}#p(){const{div:n}=this;let{width:t,height:s}=this.#t;const[h,c]=this.pageDimensions,e=.75;if(this.width)t=this.width*h,s=this.height*c;else if(t>e*h||s>e*c){const v=Math.min(e*h/t,e*c/s);t*=v,s*=v}const[d,g]=this.parentDimensions;this.setDims(t*d/h,s*g/c),this._uiManager.enableWaiting(!1);const o=this.#a=document.createElement("canvas");n.append(o),n.hidden=!1,this.#g(t,s),this.#_(),this.#n||(this.parent.addUndoableEditor(this),this.#n=!0),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()}#b(n,t){const[s,h]=this.parentDimensions;this.width=n/s,this.height=t/h,this.setDims(n,t),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this.#l!==null&&clearTimeout(this.#l);const c=200;this.#l=setTimeout(()=>{this.#l=null,this.#g(n,t)},c)}#m(n,t){const{width:s,height:h}=this.#t;let c=s,e=h,d=this.#t;for(;c>2*n||e>2*t;){const g=c,o=e;c>2*n&&(c=c>=16384?Math.floor(c/2)-1:Math.ceil(c/2)),e>2*t&&(e=e>=16384?Math.floor(e/2)-1:Math.ceil(e/2));const v=new OffscreenCanvas(c,e);v.getContext("2d").drawImage(d,0,0,g,o,0,0,c,e),d=v.transferToImageBitmap()}return d}#g(n,t){n=Math.ceil(n),t=Math.ceil(t);const s=this.#a;if(!s||s.width===n&&s.height===t)return;s.width=n,s.height=t;const h=this.#c?this.#t:this.#m(n,t),c=s.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(h,0,0,h.width,h.height,0,0,n,t)}#h(n){if(n){if(this.#c){const h=this._uiManager.imageManager.getSvgUrl(this.#e);if(h)return h}const t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#t,t.getContext("2d").drawImage(this.#t,0,0),t.toDataURL()}if(this.#c){const[t,s]=this.pageDimensions,h=Math.round(this.width*t*C.PixelsPerInch.PDF_TO_CSS_UNITS),c=Math.round(this.height*s*C.PixelsPerInch.PDF_TO_CSS_UNITS),e=new OffscreenCanvas(h,c);return e.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,h,c),e.transferToImageBitmap()}return structuredClone(this.#t)}#_(){this.#r=new ResizeObserver(n=>{const t=n[0].contentRect;t.width&&t.height&&this.#b(t.width,t.height)}),this.#r.observe(this.div)}static deserialize(n,t,s){if(n instanceof w.StampAnnotationElement)return null;const h=super.deserialize(n,t,s),{rect:c,bitmapUrl:e,bitmapId:d,isSvg:g,accessibilityData:o}=n;d&&s.imageManager.isValidId(d)?h.#e=d:h.#s=e,h.#c=g;const[v,k]=h.pageDimensions;return h.width=(c[2]-c[0])/v,h.height=(c[3]-c[1])/k,o&&(h.altTextData=o),h}serialize(n=!1,t=null){if(this.isEmpty())return null;const s={annotationType:r.AnnotationEditorType.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#c,structTreeParentId:this._structTreeParentId};if(n)return s.bitmapUrl=this.#h(!0),s.accessibilityData=this.altTextData,s;const{decorative:h,altText:c}=this.altTextData;if(!h&&c&&(s.accessibilityData={type:"Figure",alt:c}),t===null)return s;t.stamps||=new Map;const e=this.#c?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!t.stamps.has(this.#e))t.stamps.set(this.#e,{area:e,serialized:s}),s.bitmap=this.#h(!1);else if(this.#c){const d=t.stamps.get(this.#e);e>d.area&&(d.area=e,d.serialized.bitmap.close(),d.serialized.bitmap=this.#h(!1))}return s}}i.StampEditor=L})],__webpack_module_cache__={};function __w_pdfjs_require__(y){var i=__webpack_module_cache__[y];if(i!==void 0)return i.exports;var _=__webpack_module_cache__[y]={exports:{}};return __webpack_modules__[y](_,_.exports,__w_pdfjs_require__),_.exports}var __webpack_exports__={};return(()=>{var y=__webpack_exports__;Object.defineProperty(y,"__esModule",{value:!0}),Object.defineProperty(y,"AbortException",{enumerable:!0,get:function(){return i.AbortException}}),Object.defineProperty(y,"AnnotationEditorLayer",{enumerable:!0,get:function(){return C.AnnotationEditorLayer}}),Object.defineProperty(y,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return i.AnnotationEditorParamsType}}),Object.defineProperty(y,"AnnotationEditorType",{enumerable:!0,get:function(){return i.AnnotationEditorType}}),Object.defineProperty(y,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return w.AnnotationEditorUIManager}}),Object.defineProperty(y,"AnnotationLayer",{enumerable:!0,get:function(){return L.AnnotationLayer}}),Object.defineProperty(y,"AnnotationMode",{enumerable:!0,get:function(){return i.AnnotationMode}}),Object.defineProperty(y,"CMapCompressionType",{enumerable:!0,get:function(){return i.CMapCompressionType}}),Object.defineProperty(y,"DOMSVGFactory",{enumerable:!0,get:function(){return r.DOMSVGFactory}}),Object.defineProperty(y,"FeatureTest",{enumerable:!0,get:function(){return i.FeatureTest}}),Object.defineProperty(y,"GlobalWorkerOptions",{enumerable:!0,get:function(){return I.GlobalWorkerOptions}}),Object.defineProperty(y,"ImageKind",{enumerable:!0,get:function(){return i.ImageKind}}),Object.defineProperty(y,"InvalidPDFException",{enumerable:!0,get:function(){return i.InvalidPDFException}}),Object.defineProperty(y,"MissingPDFException",{enumerable:!0,get:function(){return i.MissingPDFException}}),Object.defineProperty(y,"OPS",{enumerable:!0,get:function(){return i.OPS}}),Object.defineProperty(y,"PDFDataRangeTransport",{enumerable:!0,get:function(){return _.PDFDataRangeTransport}}),Object.defineProperty(y,"PDFDateString",{enumerable:!0,get:function(){return r.PDFDateString}}),Object.defineProperty(y,"PDFWorker",{enumerable:!0,get:function(){return _.PDFWorker}}),Object.defineProperty(y,"PasswordResponses",{enumerable:!0,get:function(){return i.PasswordResponses}}),Object.defineProperty(y,"PermissionFlag",{enumerable:!0,get:function(){return i.PermissionFlag}}),Object.defineProperty(y,"PixelsPerInch",{enumerable:!0,get:function(){return r.PixelsPerInch}}),Object.defineProperty(y,"PromiseCapability",{enumerable:!0,get:function(){return i.PromiseCapability}}),Object.defineProperty(y,"RenderingCancelledException",{enumerable:!0,get:function(){return r.RenderingCancelledException}}),Object.defineProperty(y,"SVGGraphics",{enumerable:!0,get:function(){return _.SVGGraphics}}),Object.defineProperty(y,"UnexpectedResponseException",{enumerable:!0,get:function(){return i.UnexpectedResponseException}}),Object.defineProperty(y,"Util",{enumerable:!0,get:function(){return i.Util}}),Object.defineProperty(y,"VerbosityLevel",{enumerable:!0,get:function(){return i.VerbosityLevel}}),Object.defineProperty(y,"XfaLayer",{enumerable:!0,get:function(){return n.XfaLayer}}),Object.defineProperty(y,"build",{enumerable:!0,get:function(){return _.build}}),Object.defineProperty(y,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return i.createValidAbsoluteUrl}}),Object.defineProperty(y,"getDocument",{enumerable:!0,get:function(){return _.getDocument}}),Object.defineProperty(y,"getFilenameFromUrl",{enumerable:!0,get:function(){return r.getFilenameFromUrl}}),Object.defineProperty(y,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return r.getPdfFilenameFromUrl}}),Object.defineProperty(y,"getXfaPageViewport",{enumerable:!0,get:function(){return r.getXfaPageViewport}}),Object.defineProperty(y,"isDataScheme",{enumerable:!0,get:function(){return r.isDataScheme}}),Object.defineProperty(y,"isPdfFile",{enumerable:!0,get:function(){return r.isPdfFile}}),Object.defineProperty(y,"loadScript",{enumerable:!0,get:function(){return r.loadScript}}),Object.defineProperty(y,"noContextMenu",{enumerable:!0,get:function(){return r.noContextMenu}}),Object.defineProperty(y,"normalizeUnicode",{enumerable:!0,get:function(){return i.normalizeUnicode}}),Object.defineProperty(y,"renderTextLayer",{enumerable:!0,get:function(){return p.renderTextLayer}}),Object.defineProperty(y,"setLayerDimensions",{enumerable:!0,get:function(){return r.setLayerDimensions}}),Object.defineProperty(y,"shadow",{enumerable:!0,get:function(){return i.shadow}}),Object.defineProperty(y,"updateTextLayer",{enumerable:!0,get:function(){return p.updateTextLayer}}),Object.defineProperty(y,"version",{enumerable:!0,get:function(){return _.version}});var i=__w_pdfjs_require__(1),_=__w_pdfjs_require__(2),r=__w_pdfjs_require__(6),p=__w_pdfjs_require__(26),C=__w_pdfjs_require__(27),w=__w_pdfjs_require__(5),L=__w_pdfjs_require__(29),I=__w_pdfjs_require__(14),n=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf)),pdf.exports}var pdfExports=requirePdf();pdfExports.GlobalWorkerOptions.workerSrc=chrome.runtime.getURL("pdf.worker.min.js");async function extractTextFromPDF(y){try{const i=await y.arrayBuffer(),_=await pdfExports.getDocument({data:i}).promise;let r="";for(let p=1;p<=_.numPages;p++){const L=(await(await _.getPage(p)).getTextContent()).items.map(I=>I.str).join(" ");r+=L+`
`}return r}catch(i){throw new Error(`Failed to extract text from PDF: ${i instanceof Error?i.message:"Unknown error"}`)}}function extractEmail(y){const i=/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/,_=y.match(i);return _?_[0]:""}function extractPhone(y){const i=/\+?[1-9]\d{0,3}[\s.-]?\(?\d{1,4}\)?[\s.-]?\d{1,4}[\s.-]?\d{1,9}/,_=/(\+?1?\s?)?\(?([0-9]{3})\)?[-.\s]?([0-9]{3})[-.\s]?([0-9]{4})/;let r=y.match(i);return r?r[0].trim():(r=y.match(_),r?r[0].trim():"")}function extractCountryCode(y){const i=/\+([1-9]\d{0,3})(?=[\s.-]?\(?\d)/,_=y.match(i);return _?`+${_[1]}`:""}function extractPhoneNumber(y){return extractPhone(y).replace(/^\+\d{1,3}/,"").replace(/[\s.\-()]/g,"")}function extractFirstAndLastName(y){const i=y.split(`
`).filter(p=>p.trim());if(i.length===0)return{firstName:"",lastName:""};const r=i[0].trim().split(/\s+/);return r.length===0?{firstName:"",lastName:""}:r.length===1?{firstName:r[0],lastName:""}:{firstName:r[0],lastName:r[r.length-1]}}function extractProfessionalSummary(y){const i=/(?:professional\s+summary|summary|objective)[\s\n:]*([^]*?)(?=\n\n|\n[A-Z][a-z]*(?:\s+[A-Z])?[\s\n:]|$)/i,_=y.match(i);return _?_[1].trim().split(`
`)[0].trim().substring(0,500):""}function extractStreetAddress(y){const i=/(?:address|street)[\s\n:]*([^\n]+)/i,_=y.match(i);return _?_[1].trim():""}function extractCity(y){const i=/(?:city)[\s\n:]*([^\n,]+)/i,_=y.match(i);return _?_[1].trim():""}function extractLocation(y){let i=/(?:location|based)[\s\n:]*([^\n]+)/i,_=y.match(i);if(_)return _[1].trim();const r=extractStreetAddress(y),p=extractCity(y),C=extractCountry(y),w=[r,p,C].filter(L=>L.length>0);return w.length>0?w.join(", "):""}function extractCountry(y){const i=/(?:country|nationality)[\s\n:]*([^\n,]+)/i,_=y.match(i);return _?_[1].trim():""}function extractCountryFromLocation(y){const i=y.split(",").map(_=>_.trim());return i.length>0?i[i.length-1]:""}function extractSkills(y){const i=/skills?[\s\n:]*([^]*?)(?=\n\n|\n(?:experience|education|projects|professional|work)[\s\n:]|$)/i,_=y.match(i);if(!_)return[];const p=_[1].split(/[,\n•\-\|;]/).map(C=>C.trim()).filter(C=>!(C.length===0||C.length>50||/^(and|or|the|a)$/i.test(C)));return[...new Set(p)]}function extractExperienceText(y){const i=/(?:work\s+)?experience[\s\n:]*([^]*?)(?=\n\n|\n(?:education|projects|skills|professional)[\s\n:]|$)/i,_=y.match(i);return _?_[1].split(/\n\n+/).map(C=>C.trim()).filter(C=>C.length>0&&!C.toLowerCase().startsWith("education")):[]}function extractProjectsText(y){const i=/projects?[\s\n:]*([^]*?)(?=\n\n|\n(?:education|experience|skills|professional)[\s\n:]|$)/i,_=y.match(i);return _?_[1].split(/\n\n+/).map(C=>C.trim()).filter(C=>C.length>0):[]}function extractYearsFromText(y){const i=/(\d{1,2})?[\s/]?(\d{4})\s*[-–]\s*(Present|Current|(\d{1,2})?[\s/]?(\d{4}))/i,_=y.match(i);if(_){const r=_[1]||"",p=_[2],C=_[3];let w="",L="";return C.toLowerCase()!=="present"&&C.toLowerCase()!=="current"?(w=_[4]||"",L=_[5]):(w=String(new Date().getMonth()+1),L=String(new Date().getFullYear())),{startMonth:r,startYear:p,endMonth:String(w),endYear:String(L)}}return{startMonth:"",startYear:"",endMonth:"",endYear:""}}function extractEducationText(y){const i=/education[\s\n:]*([^]*?)(?=\n\n|\n(?:experience|projects|skills|professional)[\s\n:]|$)/i,_=y.match(i);return _?_[1].split(/\n\n+/).map(C=>C.trim()).filter(C=>C.length>0):[]}function extractGithub(y){const i=y.match(/github\.com\/([^\s,/"'<>]+)/i);return i?`https://github.com/${i[1]}`:""}function extractLinkedin(y){const i=y.match(/linkedin\.com\/in\/([^\s,/"'<>]+)/i);return i?`https://linkedin.com/in/${i[1]}`:""}function extractPortfolio(y){const i=/(?:portfolio|website|web)[\s\n:]*([^\s\n,]+)/i,_=y.match(i);if(_){const C=_[1].trim();if(C.includes(".")&&!C.includes("github.com")&&!C.includes("linkedin.com"))return C.startsWith("http")?C:`https://${C}`}const r=/https?:\/\/(?!github\.com|linkedin\.com)[^\s,<>"']+\.[^\s,<>"']+/i,p=y.match(r);return p?p[0]:""}function extractZipCode(y){const i=y.match(/(?:zip|postal|postcode)[\s\n:]*([A-Z0-9\s-]{3,10})/i);return i?i[1].trim():""}function extractState(y){const i=y.match(/(?:state|province|region)[\s\n:]*([^\n,]+)/i);return i?i[1].trim():""}function parseExperienceEntry(y){const i=y.split(`
`).filter(w=>w.trim()),_=extractYearsFromText(y);let r="",p="",C=y;return i.length>0&&(r=i[0],i.length>1&&(p=i[1],C=i.slice(2).join(`
`))),{jobTitle:r,companyName:p,description:C,..._}}function parseProjectEntry(y){const i=y.split(`
`).filter(L=>L.trim()),_=/(https?:\/\/[^\s]+)/,r=y.match(_);let p="",C=y,w=r?r[0]:"";return i.length>0&&(p=i[0],C=i.slice(1).join(`
`).replace(_,"").trim()),{projectName:p,description:C,link:w}}function parseEducationEntry(y){const i=y.split(`
`).filter(I=>I.trim()),_=/(\d{4})\s*[-–]\s*(\d{4}|Present|Current)/i,r=y.match(_);let p="",C="",w="",L="";return r&&(w=r[1],L=r[2].toLowerCase()==="present"||r[2].toLowerCase()==="current"?String(new Date().getFullYear()):r[2]),i.length>0&&(p=i[0].replace(_,"").trim(),i.length>1&&(C=i[1].replace(_,"").trim())),{schoolName:p,fieldOfStudy:C,startYear:w,endYear:L}}function parseResume(y){const{firstName:i,lastName:_}=extractFirstAndLastName(y),r=extractPhone(y),p=extractLocation(y);let C=extractCountry(y);const w=extractStreetAddress(y),L=extractCity(y);!C&&p&&(C=extractCountryFromLocation(p));const I=extractExperienceText(y),n=extractProjectsText(y),t=extractEducationText(y),s=I.length>0?I.map(parseExperienceEntry):[{jobTitle:"",companyName:"",description:"",startMonth:"",startYear:"",endMonth:"",endYear:""}],h=n.length>0?n.map(parseProjectEntry):[{projectName:"",description:"",link:""}],c=t.length>0?t.map(parseEducationEntry):[{schoolName:"",fieldOfStudy:"",startYear:"",endYear:""}],e=extractGithub(y);return{firstName:i,lastName:_,email:extractEmail(y),phone:r,countryCode:extractCountryCode(r),phoneNumber:extractPhoneNumber(r),streetAddress:w,city:L,zipCode:extractZipCode(y),state:extractState(y),location:p,country:C,professionalSummary:extractProfessionalSummary(y),skills:extractSkills(y).map(d=>({skill:d,yearStarted:""})),github:e,linkedin:extractLinkedin(y),portfolio:extractPortfolio(y)||e,availability:"",languages:[],salaryAmount:"",salaryCurrency:"USD",salaryType:"monthly",gender:"",ethnicity:"",veteran:"",disability:"",employmentType:"",visaSponsorship:"",workAuthorization:"",experience:s,projects:h,education:c}}function ResumeUpload({onEditClick:y,onSelectionChange:i}){const[_,r]=reactExports.useState(!1),[p,C]=reactExports.useState(null),[w,L]=reactExports.useState(!1),[I,n]=reactExports.useState(null),[t,s]=reactExports.useState([]),[h,c]=reactExports.useState(!0),[e,d]=reactExports.useState(!1),[g,o]=reactExports.useState(null),[v,k]=reactExports.useState(null),E=useAuthStore(m=>m.token),f=useAuthStore(m=>m.user),x=reactExports.useRef(null),j="http://localhost:8080",B=async()=>{if(!f||!E){c(!1);return}try{const[m,l]=await Promise.all([fetch(`${j}/api/resume/tier`,{headers:{Authorization:`Bearer ${E}`}}),fetch(`${j}/api/resumes`,{headers:{Authorization:`Bearer ${E}`}})]);if(m.ok&&n(await m.json()),l.ok){const A=(await l.json()).resumes||[];s(A),k(R=>{const O=A.some(T=>T.id===R)?R:A[0]?.id??null;return i?.(O),O})}}catch(m){console.error("Failed to fetch tier info:",m)}finally{c(!1)}};reactExports.useEffect(()=>{B()},[f,E]);const N=m=>{k(m),i?.(m)},z=()=>{C(null),L(!1),!I?.is_pro&&t.length>=1?d(!0):I?.is_pro&&I.count>=I.limit?C(`You've reached the ${I.limit}-resume limit. Delete one to upload a new profile.`):x.current?.click()},H=()=>{d(!1),x.current?.click()},it=async()=>{try{const m=I?.is_pro&&v?`${j}/api/resume/${v}/view`:`${j}/api/resume/view`,l=await fetch(m,{headers:{Authorization:`Bearer ${E}`}});if(!l.ok)throw new Error("Failed to fetch resume");const u=await l.blob(),A=URL.createObjectURL(u);window.open(A,"_blank"),setTimeout(()=>URL.revokeObjectURL(A),100)}catch(m){C(m instanceof Error?m.message:"Failed to view resume")}},Z=async m=>{o(m),C(null);try{if(!(await fetch(`${j}/api/resume/${m}`,{method:"DELETE",headers:{Authorization:`Bearer ${E}`}})).ok)throw new Error("Failed to delete resume");await B()}catch(l){C(l instanceof Error?l.message:"Failed to delete resume")}finally{o(null)}},Q=async m=>{r(!0),C(null),L(!1);try{const l=await extractTextFromPDF(m),u=parseResume(l),A=await new Promise((T,a)=>{const b=new FileReader;b.onload=()=>T(b.result.split(",")[1]),b.onerror=a,b.readAsDataURL(m)}),R=await fetch(`${j}/api/resume/upload`,{method:"POST",headers:{"Content-Type":"application/json",...E?{Authorization:`Bearer ${E}`}:{}},body:JSON.stringify({file_name:m.name,parsed_data:u,raw_text:l,file_data:A})}),M=await R.text();if(!M)throw new Error("Empty response from server");const O=JSON.parse(M);if(!R.ok)throw new Error(O.error||"Upload failed");L(!0),await B();try{const T=await chrome.windows.getCurrent();T.id&&await chrome.sidePanel.open({windowId:T.id})}catch(T){console.error("[RAE] Could not open sidepanel:",T)}}catch(l){C(l instanceof Error?l.message:"Failed to process resume")}finally{r(!1)}},st=async m=>{const l=m.target.files?.[0];l&&(m.target.value="",await Q(l))};if(h)return jsxRuntimeExports.jsx("div",{style:{display:"flex",justifyContent:"center",padding:"8px"},children:jsxRuntimeExports.jsx("p",{style:{fontSize:"12px",color:"#6b7280"},children:"Loading..."})});const K=I?.is_pro?I.count>=I.limit:!1,D=t.length>0;return jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[I&&jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[jsxRuntimeExports.jsx("span",{style:{fontSize:"10px",padding:"2px 6px",borderRadius:"10px",fontWeight:"bold",textTransform:"uppercase",backgroundColor:I.is_pro?"#fef3c7":"#f3f4f6",color:I.is_pro?"#92400e":"#6b7280"},children:I.is_pro?" Pro":"Free"}),jsxRuntimeExports.jsx("span",{style:{fontSize:"11px",color:"#6b7280"},children:I.is_pro?`${I.count} / ${I.limit} slots used`:D?"Upload will replace existing":"1 resume on free plan"})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"stretch"},children:[D&&jsxRuntimeExports.jsx("button",{onClick:it,title:I?.is_pro&&v?`View: ${t.find(m=>m.id===v)?.file_name??"selected resume"}`:"View resume",style:{backgroundColor:"#64748b",color:"white",padding:"8px 10px",borderRadius:"4px",border:"none",cursor:"pointer",fontSize:"13px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:"View"}),jsxRuntimeExports.jsx("button",{onClick:z,disabled:_||K,style:{flex:1,backgroundColor:K?"#9ca3af":"#16a34a",color:"white",padding:"8px",borderRadius:"4px",border:"none",cursor:_||K?"not-allowed":"pointer",fontSize:"14px",opacity:_?.7:1},children:_?"Uploading...":I?.is_pro?"+ Add Profile":"Upload Resume"}),jsxRuntimeExports.jsx("button",{onClick:y,style:{backgroundColor:"#64748b",color:"white",padding:"8px 16px",borderRadius:"4px",border:"none",cursor:"pointer",fontSize:"14px",fontWeight:"500",flexShrink:0},children:"Edit"})]}),e&&jsxRuntimeExports.jsxs("div",{style:{padding:"10px",backgroundColor:"#fef9c3",border:"1px solid #ca8a04",borderRadius:"6px",fontSize:"12px"},children:[jsxRuntimeExports.jsxs("p",{style:{margin:"0 0 8px",color:"#713f12"},children:["This will ",jsxRuntimeExports.jsx("strong",{children:"replace"})," your existing resume. Continue?"]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:"6px"},children:[jsxRuntimeExports.jsx("button",{onClick:H,style:{flex:1,padding:"6px",backgroundColor:"#16a34a",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"Replace"}),jsxRuntimeExports.jsx("button",{onClick:()=>d(!1),style:{flex:1,padding:"6px",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"Cancel"})]})]}),K&&jsxRuntimeExports.jsxs("div",{style:{padding:"8px",backgroundColor:"#fee2e2",border:"1px solid #dc2626",borderRadius:"4px",fontSize:"12px",color:"#dc2626"},children:["All ",I?.limit," resume slots used. Delete one below to upload a new profile."]}),jsxRuntimeExports.jsx("input",{type:"file",accept:".pdf",ref:x,onChange:st,style:{display:"none"}}),I?.is_pro&&t.length>0&&jsxRuntimeExports.jsxs("div",{style:{marginTop:"2px"},children:[jsxRuntimeExports.jsxs("p",{style:{fontSize:"11px",color:"#6b7280",margin:"0 0 4px"},children:["Resume Profiles — ",jsxRuntimeExports.jsx("span",{style:{color:"#6366f1"},children:"select active"})]}),t.map(m=>{const l=v===m.id;return jsxRuntimeExports.jsxs("div",{onClick:()=>N(m.id),style:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 8px",borderRadius:"4px",marginBottom:"4px",cursor:"pointer",backgroundColor:l?"#eff6ff":"#f9fafb",border:`1px solid ${l?"#3b82f6":"#e5e7eb"}`,transition:"all 0.1s"},children:[jsxRuntimeExports.jsx("div",{style:{width:"14px",height:"14px",borderRadius:"50%",flexShrink:0,border:`2px solid ${l?"#3b82f6":"#9ca3af"}`,backgroundColor:l?"#3b82f6":"white",display:"flex",alignItems:"center",justifyContent:"center"},children:l&&jsxRuntimeExports.jsx("div",{style:{width:"5px",height:"5px",borderRadius:"50%",backgroundColor:"white"}})}),jsxRuntimeExports.jsxs("span",{style:{fontSize:"12px",color:l?"#1d4ed8":"#374151",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,fontWeight:l?"500":"normal"},children:["📄 ",m.file_name]}),l&&jsxRuntimeExports.jsx("span",{style:{fontSize:"9px",padding:"1px 5px",borderRadius:"8px",backgroundColor:"#dbeafe",color:"#1d4ed8",fontWeight:"bold",textTransform:"uppercase",flexShrink:0},children:"Active"}),jsxRuntimeExports.jsx("button",{onClick:u=>{u.stopPropagation(),Z(m.id)},disabled:g===m.id,style:{padding:"3px 8px",backgroundColor:"#dc2626",color:"white",border:"none",borderRadius:"3px",cursor:"pointer",fontSize:"11px",opacity:g===m.id?.5:1,flexShrink:0},children:g===m.id?"...":"Delete"})]},m.id)})]}),!I?.is_pro&&jsxRuntimeExports.jsxs("p",{style:{fontSize:"11px",color:"#9ca3af",margin:"0",textAlign:"center"},children:[jsxRuntimeExports.jsx("span",{style:{color:"#6366f1",cursor:"pointer"},children:"Upgrade to Pro"})," for 5 resume profiles"]}),p&&jsxRuntimeExports.jsx("p",{style:{color:"#dc2626",fontSize:"12px",margin:"0"},children:p}),w&&jsxRuntimeExports.jsx("p",{style:{color:"#16a34a",fontSize:"12px",margin:"0"},children:"✓ Resume uploaded successfully!"})]})}function CVUpload(){const[y,i]=reactExports.useState(!1),[_,r]=reactExports.useState(null),[p,C]=reactExports.useState(null),[w,L]=reactExports.useState(!1),[I,n]=reactExports.useState(!1),[t,s]=reactExports.useState(!0),h=useAuthStore(v=>v.token),c=useAuthStore(v=>v.user),e=reactExports.useRef(null);reactExports.useEffect(()=>{(async()=>{if(!c||!h){s(!1);return}try{const E=await fetch("http://localhost:8080/api/cv/check",{headers:{Authorization:`Bearer ${h}`}});if(E.ok){const f=await E.json();n(f.has_cv)}}catch(k){console.error("Failed to check CV:",k)}finally{s(!1)}})()},[c,h]);const d=()=>{e.current?.click()},g=async()=>{try{const k=await fetch("http://localhost:8080/api/cv/view",{headers:{Authorization:`Bearer ${h}`}});if(!k.ok)throw new Error("Failed to fetch CV");const E=await k.blob(),f=URL.createObjectURL(E);window.open(f,"_blank"),setTimeout(()=>URL.revokeObjectURL(f),100)}catch(v){r(v instanceof Error?v.message:"Failed to view CV")}},o=async v=>{const k=v.target.files?.[0];if(k){i(!0),r(null),L(!1);try{const E=await extractTextFromPDF(k),f=parseResume(E);C(f);const x=await new Promise((H,it)=>{const Z=new FileReader;Z.onload=()=>{const Q=Z.result.split(",")[1];H(Q)},Z.onerror=it,Z.readAsDataURL(k)}),B=await fetch("http://localhost:8080/api/cv/upload",{method:"POST",headers:{"Content-Type":"application/json",...h?{Authorization:`Bearer ${h}`}:{}},body:JSON.stringify({file_name:k.name,parsed_data:f,raw_text:E,file_data:x})}),N=await B.text();if(!N)throw new Error("Empty response from server");const z=JSON.parse(N);if(!B.ok)throw new Error(z.error||"Upload failed");L(!0),n(!0)}catch(E){r(E instanceof Error?E.message:"Failed to process CV")}finally{i(!1)}}};return t?jsxRuntimeExports.jsx("div",{style:{display:"flex",justifyContent:"center",padding:"8px"},children:jsxRuntimeExports.jsx("p",{style:{fontSize:"12px",color:"#6b7280"},children:"Loading..."})}):jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:"8px"},children:[I&&jsxRuntimeExports.jsx("button",{onClick:g,style:{backgroundColor:"#64748b",color:"white",padding:"8px 12px",borderRadius:"4px",border:"none",cursor:"pointer",fontSize:"14px",width:"40px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},title:"View Cover Letter",children:"View"}),jsxRuntimeExports.jsx("button",{onClick:d,disabled:y,style:{flex:1,backgroundColor:"#2563eb",color:"white",padding:"8px",borderRadius:"4px",border:"none",cursor:"pointer",fontSize:"14px",opacity:y?.5:1},children:y?"Uploading...":"Upload Cover Letter"})]}),jsxRuntimeExports.jsx("input",{type:"file",accept:".pdf",ref:e,onChange:o,style:{display:"none"}}),_&&jsxRuntimeExports.jsx("p",{style:{color:"#dc2626",fontSize:"12px"},children:_}),w&&jsxRuntimeExports.jsx("p",{style:{color:"#16a34a",fontSize:"12px"},children:"Cover Letter uploaded successfully!"})]})}function App(){const[y,i]=reactExports.useState(""),[_,r]=reactExports.useState(""),[p,C]=reactExports.useState("login"),[w,L]=reactExports.useState(!0),[I,n]=reactExports.useState(!1),[t,s]=reactExports.useState(null),[h,c]=reactExports.useState(null),{user:e,isLoading:d,error:g,login:o,register:v,logout:k,hydrate:E,loginWithGoogle:f,loginWithLinkedIn:x}=useAuthStore(),j=useAuthStore(H=>H.token);reactExports.useEffect(()=>{E().then(()=>L(!1))},[E]),reactExports.useEffect(()=>{j?chrome.storage.local.set({auth_token:j,api_url:"http://localhost:8080"}):chrome.storage.local.remove(["auth_token","api_url"])},[j]);const B=async()=>{try{p==="login"?await o(y,_):await v(y,_),i(""),r("")}catch(H){console.error(H)}},N=async()=>{try{const H=await chrome.windows.getCurrent();H.id&&(await chrome.sidePanel.open({windowId:H.id}),window.close())}catch(H){console.error("Error opening side panel:",H)}},z=async()=>{n(!0),s(null);try{const H="http://localhost:8080";await chrome.storage.local.set({auth_token:j,api_url:H});let it=h;if(!it){const l=await fetch(`${H}/api/resumes`,{headers:{Authorization:`Bearer ${j}`}});if(!l.ok)throw new Error("No resume found. Please upload a resume first.");const A=(await l.json()).resumes;if(!A||A.length===0)throw new Error("No resume found. Please upload a resume first.");it=A[0].id}const Z=await fetch(`${H}/api/resume/${it}`,{headers:{Authorization:`Bearer ${j}`}});if(!Z.ok)throw new Error("Failed to fetch resume details");const Q=await Z.json(),st=await fetch(`${H}/api/cv/check`,{headers:{Authorization:`Bearer ${j}`}}),K=st.ok?await st.json():{has_cv:!1},[D]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!D.id)throw new Error("No active tab found");const m=await chrome.tabs.sendMessage(D.id,{action:"autofill",resumeData:Q.parsed_data,cvAvailable:K.has_cv});m?.success?(s({type:"success",text:`Filled ${m.filledCount} fields!`}),setTimeout(()=>s(null),3e3)):(s({type:"error",text:"Page not ready — refresh the tab and try again."}),setTimeout(()=>s(null),5e3))}catch(H){s({type:"error",text:H instanceof Error?H.message:"Autofill failed"}),setTimeout(()=>s(null),5e3)}finally{n(!1)}};return w?jsxRuntimeExports.jsx("div",{style:{width:"400px",minHeight:"500px",backgroundColor:"#f0f1f3",display:"flex",alignItems:"center",justifyContent:"center"},children:jsxRuntimeExports.jsx("p",{children:"Loading..."})}):jsxRuntimeExports.jsx("div",{style:{width:"400px",minHeight:"500px",backgroundColor:"#f0f1f3",display:"flex",alignItems:"center",justifyContent:"center",border:"none"},children:jsxRuntimeExports.jsxs("div",{style:{width:"100%",maxWidth:"300px"},children:[jsxRuntimeExports.jsx("h1",{style:{fontSize:"24px",fontWeight:"bold",color:"#111827",marginBottom:"4px",textAlign:"center"},children:"Rae"}),jsxRuntimeExports.jsx("p",{style:{fontSize:"12px",fontWeight:"normal",color:"#6b7280",textAlign:"center",marginBottom:"8px",margin:"0 0 8px 0"},children:"(Resume Autofill Extension)"}),jsxRuntimeExports.jsx("p",{style:{fontSize:"11px",fontWeight:"normal",color:"#1f2937",textAlign:"center",marginBottom:"24px",margin:"0 0 24px 0"},children:"Upload resume once, Apply to jobs everywhere."}),e?jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[jsxRuntimeExports.jsxs("p",{style:{color:"#374151",textAlign:"center"},children:["Welcome back, ",e.email,"!"]}),jsxRuntimeExports.jsx(ResumeUpload,{onEditClick:N,onSelectionChange:c}),jsxRuntimeExports.jsx(CVUpload,{}),t&&jsxRuntimeExports.jsx("div",{style:{padding:"8px",backgroundColor:t.type==="success"?"#dcfce7":"#fee2e2",border:`1px solid ${t.type==="success"?"#16a34a":"#dc2626"}`,borderRadius:"4px",color:t.type==="success"?"#16a34a":"#dc2626",fontSize:"12px",textAlign:"center"},children:t.text}),jsxRuntimeExports.jsx("button",{onClick:z,disabled:I,style:{width:"100%",backgroundColor:"#a855f7",color:"white",padding:"8px",borderRadius:"4px",border:"none",cursor:I?"not-allowed":"pointer",opacity:I?.7:1},children:I?"Autofilling...":"Autofill Form"}),jsxRuntimeExports.jsx("button",{onClick:k,style:{width:"100%",backgroundColor:"#dc2626",color:"white",padding:"8px",borderRadius:"4px",border:"none",cursor:"pointer"},children:"Logout"})]}):jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[jsxRuntimeExports.jsx("input",{type:"email",placeholder:"Email",value:y,onChange:H=>i(H.target.value),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"4px",fontSize:"14px"}}),jsxRuntimeExports.jsx("input",{type:"password",placeholder:"Password",value:_,onChange:H=>r(H.target.value.replace(/\s/g,"")),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"4px",fontSize:"14px"}}),g&&jsxRuntimeExports.jsx("p",{style:{color:"#dc2626",fontSize:"12px"},children:g}),jsxRuntimeExports.jsx("button",{onClick:B,disabled:d,style:{width:"100%",backgroundColor:"#a855f7",color:"white",padding:"8px",borderRadius:"4px",border:"none",cursor:"pointer",opacity:d?.5:1},children:d?"Loading...":p==="login"?"Login":"Register"}),jsxRuntimeExports.jsxs("p",{style:{fontSize:"12px",color:"#6b7280",textAlign:"center"},children:[p==="login"?"Don't have an account? ":"Already have an account? ",jsxRuntimeExports.jsx("button",{onClick:()=>C(p==="login"?"register":"login"),style:{background:"none",border:"none",color:"#a855f7",cursor:"pointer",textDecoration:"underline",fontSize:"12px"},children:p==="login"?"Register":"Login"})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[jsxRuntimeExports.jsx("div",{style:{flex:1,height:"1px",backgroundColor:"#d1d5db"}}),jsxRuntimeExports.jsx("span",{style:{fontSize:"11px",color:"#9ca3af"},children:"or continue with"}),jsxRuntimeExports.jsx("div",{style:{flex:1,height:"1px",backgroundColor:"#d1d5db"}})]}),jsxRuntimeExports.jsxs("button",{onClick:f,disabled:d,style:{width:"100%",padding:"8px 12px",backgroundColor:"#ffffff",color:"#3c4043",border:"1px solid #dadce0",borderRadius:"4px",cursor:d?"not-allowed":"pointer",fontSize:"14px",fontWeight:"500",opacity:d?.5:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[jsxRuntimeExports.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 48 48",children:[jsxRuntimeExports.jsx("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"}),jsxRuntimeExports.jsx("path",{fill:"#4285F4",d:"M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"}),jsxRuntimeExports.jsx("path",{fill:"#FBBC05",d:"M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"}),jsxRuntimeExports.jsx("path",{fill:"#34A853",d:"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.18 1.48-4.97 2.35-8.16 2.35-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"})]}),"Continue with Google"]}),jsxRuntimeExports.jsxs("button",{onClick:x,disabled:d,style:{width:"100%",padding:"8px 12px",backgroundColor:"#0a66c2",color:"white",border:"none",borderRadius:"4px",cursor:d?"not-allowed":"pointer",fontSize:"14px",fontWeight:"500",opacity:d?.5:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[jsxRuntimeExports.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"white",children:jsxRuntimeExports.jsx("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})}),"Continue with LinkedIn"]})]})]})})}ReactDOM.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
